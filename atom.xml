<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å°çŒªçš„åšå®¢</title>
  
  <subtitle>iOSå¼€å‘ Webå¼€å‘ Geek</subtitle>
  <link href="http://dreampiggy.com/atom.xml" rel="self"/>
  
  <link href="http://dreampiggy.com/"/>
  <updated>2022-05-09T07:27:55.179Z</updated>
  <id>http://dreampiggy.com/</id>
  
  <author>
    <name>DreamPiggy</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Swift è°ƒè¯•æ€§èƒ½çš„ä¼˜åŒ–æ–¹æ¡ˆ</title>
    <link href="http://dreampiggy.com/2022/05/07/Swift-%E8%B0%83%E8%AF%95%E6%80%A7%E8%83%BD%E7%9A%84%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/"/>
    <id>http://dreampiggy.com/2022/05/07/Swift-%E8%B0%83%E8%AF%95%E6%80%A7%E8%83%BD%E7%9A%84%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/</id>
    <published>2022-05-07T17:13:43.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h1><p>è¯·è·³è½¬å…¬ä¼—å·é“¾æ¥æŸ¥çœ‹ï¼š<br><img src="https://mp.weixin.qq.com/mp/qrcode?scene=10000005&size=102&__biz=Mzg2NTYyMjYxNg==&mid=2247486840&idx=1&sn=43b8a41875f86f7b62356ff2a3c064ab&send_time="></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å£°æ˜&quot;&gt;&lt;a href=&quot;#å£°æ˜&quot; class=&quot;headerlink&quot; title=&quot;å£°æ˜&quot;&gt;&lt;/a&gt;å£°æ˜&lt;/h1&gt;&lt;p&gt;è¯·è·³è½¬å…¬ä¼—å·é“¾æ¥æŸ¥çœ‹ï¼š&lt;br&gt;&lt;img src=&quot;https://mp.weixin.qq.com/mp/qrcode?scene=1000</summary>
      
    
    
    
    <category term="LLVM" scheme="http://dreampiggy.com/categories/LLVM/"/>
    
    
    <category term="swift" scheme="http://dreampiggy.com/tags/swift/"/>
    
    <category term="lldb" scheme="http://dreampiggy.com/tags/lldb/"/>
    
    <category term="llvm" scheme="http://dreampiggy.com/tags/llvm/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ®µç®€å•é€†å‘ä¹‹æ—…-ç»•å¼€Xcode 13.3æœ€ä½macOS 12.0é™åˆ¶</title>
    <link href="http://dreampiggy.com/2022/03/25/%E4%B8%80%E6%AE%B5%E7%AE%80%E5%8D%95%E9%80%86%E5%90%91%E4%B9%8B%E6%97%85-%E7%BB%95%E5%BC%80Xcode-13-3%E6%9C%80%E4%BD%8EmacOS-12-0%E9%99%90%E5%88%B6/"/>
    <id>http://dreampiggy.com/2022/03/25/%E4%B8%80%E6%AE%B5%E7%AE%80%E5%8D%95%E9%80%86%E5%90%91%E4%B9%8B%E6%97%85-%E7%BB%95%E5%BC%80Xcode-13-3%E6%9C%80%E4%BD%8EmacOS-12-0%E9%99%90%E5%88%B6/</id>
    <published>2022-03-25T20:47:50.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œè‹¹æœçš„Xcodeç‰ˆæœ¬ä¼šä¸æ–­æé«˜è‡ªå·±çš„æœ€ä½å®‰è£…ç‰ˆæœ¬ï¼Œåœ¨Xcode 13.0-13.2.1ä¸Šï¼Œè¿™ä¸ªæœ€ä½å®‰è£…ç‰ˆæœ¬æ˜¯macOS 11</p><p>è€Œéšç€Xcode 13.3æ­£å¼ç‰ˆæ”¾å‡ºï¼Œè¿™ä¸ªæœ€ä½éƒ¨ç½²ç‰ˆæœ¬åœ¨æœ€åå…³å¤´è¢«æå‡åˆ°äº†macOS 12</p></blockquote><h1 id="Whyï¼Ÿ"><a href="#Whyï¼Ÿ" class="headerlink" title="Whyï¼Ÿ"></a>Whyï¼Ÿ</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œå„ä½å¼€å‘è€…æˆ–è€…ä¼—å¤šåŸºå»ºï¼Œæ€»æœ‰å„ç§å„æ ·çš„åŸå› éœ€è¦æš‚æ—¶ç•™åœ¨è€ç‰ˆæœ¬çš„macOSç³»ç»Ÿä¸Šï¼Œä½†æ˜¯åˆå¸Œæœ›ä½¿ç”¨æ–°Xcodeç‰ˆæœ¬è‡ªå¸¦çš„Toolchainè¿›è¡Œä¸€äº›å·¥ä½œå¼€å‘è°ƒè¯•ï¼Œæœ‰äº›æ˜¯ä¸»è§‚é—®é¢˜ï¼Œæœ‰äº›æ˜¯å®¢è§‚é™åˆ¶ï¼š</p><p>ä¸¾ä¾‹å­ï¼š</p><ol><li>macOS 12ç¦æ­¢äº†<code>sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate off</code>ç»•è¿‡GUIé…ç½®ï¼Œå¯¼è‡´ä¸€äº›å…¬å¸é‡‡å–Apple Device Managementç®¡ç†çš„ç”µè„‘ï¼Œæ— æ³•æ­£å¸¸å…³é—­TCPæ‹¦æˆªï¼Œä¼šå¯¼è‡´ä¸€äº›æœåŠ¡å¼‚å¸¸</li><li>macOS 12åŠ å¼ºäº†Kernel Extensionçš„å®‰å…¨æ€§ï¼Œå¯¼è‡´GitHub Actionå’ŒCircle CIæˆªæ­¢2022å¹´3æœˆåº•ï¼Œè¿Ÿè¿Ÿæ— æ³•æ›´æ–°ä»–ä»¬çš„è™šæ‹ŸåŒ–é›†ç¾¤åˆ°macOS 12ï¼Œåªæœ‰11.6çš„æœ€æ–°ç‰ˆæœ¬</li></ol><p>è¿™äº›éƒ½æ˜¯é—²èŠï¼Œè¿›å…¥æ­£é¢˜ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•èƒ½å¤Ÿç»•å¼€ï¼Œæˆ–è€…ä»åŸç†ä¸Šæ¥è®²ï¼Œæ˜¯å¦è¿™ä¸ªç³»ç»Ÿç»‘å®šçš„æœ€ä½éƒ¨ç½²ç‰ˆæœ¬é™åˆ¶æ˜¯å¿…è¦çš„ï¼Ÿ</p><h1 id="å…ˆæ”¾ç»“è®º"><a href="#å…ˆæ”¾ç»“è®º" class="headerlink" title="å…ˆæ”¾ç»“è®º"></a>å…ˆæ”¾ç»“è®º</h1><ol><li>å¯ä»¥ç»•è¿‡è¿™ä¸ªmacOS 12çš„æœ€ä½å®‰è£…ç‰ˆæœ¬é™åˆ¶è¿è¡Œ</li><li>è¿™ä¸ªé™åˆ¶æ˜¯éå¿…è¦çš„ï¼Œç»•è¿‡ä»¥åæ‰€æœ‰åŠŸèƒ½æ­£å¸¸å¯ç”¨ï¼ˆæ„å»ºï¼Œç‹¬ç«‹å·¥å…·é›†ï¼Œè°ƒè¯•ï¼Œè¿æ¥iPhoneï¼‰</li></ol><p>ä¸‹é¢æ¥è¯´æ˜å…·ä½“çš„é€†å‘æµç¨‹ï¼Œå’Œè¿›è¡Œç»•è¿‡çš„ç®€å•Step-by-stepæ‰‹æ³•</p><h1 id="å®‰è£…Xcode"><a href="#å®‰è£…Xcode" class="headerlink" title="å®‰è£…Xcode"></a>å®‰è£…Xcode</h1><p>å…ˆè¯´æ˜æµ‹è¯•æœºå™¨Macç¯å¢ƒå’ŒXcodeç¯å¢ƒï¼š</p><ol><li>macOS 11.4 (20F71)</li><li>Xcode Version 13.2 (13C90)ï¼šéœ€è¦ä¿ç•™ä¸€ä»½ä»¥é˜²ä¸‡ä¸€</li><li>Xcode Version 13.3 (13E113)ï¼šç›®æ ‡å®‰è£…çš„ç‰ˆæœ¬</li></ol><p>é¦–å…ˆï¼Œä½œä¸ºiOS/macOSå¼€å‘è€…ï¼Œæˆ‘ä»¬è‚¯å®šä¼šä½¿ç”¨dmgçš„æ ¼å¼ï¼Œæˆ–è€…ä½¿ç”¨<a href="https://github.com/RobotsAndPencils/xcodes">Xcodes.app</a>æ¥å®‰è£…æˆ‘ä»¬çš„Xcode 13.3äº†ï¼ˆApp Storeå®‰è£…Xcodeæ›¾ç»å‡ºçš„å‘ï¼š<a href="https://appleinsider.com/articles/21/12/14/app-store-version-of-xcode-132-causing-problems-for-developers">App Store version of Xcode 13.2 causing problems for developers</a>ï¼Œæˆ‘æ˜¯ä¸ä¼šå†ç”¨äº†ï¼‰</p><p>å®‰è£…å®Œæ¯•åï¼Œæˆ‘ä»¬åœ¨Finderä¸­çœ‹åˆ°çš„Xcode.appæ˜¯ä¸€ä¸ªç”»ç€âçš„æ ·å­ï¼Œç›´æ¥æ‰“å¼€ä¼šæç¤ºå¦‚ä¸‹ï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752406_af87e2021743b9639d35f86714f127c7.png" alt="1648210752406_af87e2021743b9639d35f86714f127c7"></p><h1 id="ç»•è¿‡GUIéƒ¨åˆ†çš„é™åˆ¶"><a href="#ç»•è¿‡GUIéƒ¨åˆ†çš„é™åˆ¶" class="headerlink" title="ç»•è¿‡GUIéƒ¨åˆ†çš„é™åˆ¶"></a>ç»•è¿‡GUIéƒ¨åˆ†çš„é™åˆ¶</h1><h2 id="ä¿®æ”¹LSMinimumSystemVersion"><a href="#ä¿®æ”¹LSMinimumSystemVersion" class="headerlink" title="ä¿®æ”¹LSMinimumSystemVersion"></a>ä¿®æ”¹<code>LSMinimumSystemVersion</code></h2><p>ä½œä¸ºiOS/macOSå¼€å‘è€…ï¼Œæˆ‘ä»¬ç¬¬ä¸€æƒ³åˆ°çš„å°±æ˜¯ï¼Œæ˜¯å¦æ˜¯Xcode.appå¯¹åº”çš„Info.plistä¸­ï¼Œè®¾ç½®äº†å’Œæœ€ä½éƒ¨ç½²ç‰ˆæœ¬ç›¸å…³çš„å­—æ®µå¯¼è‡´æ‹’ç»è½½å…¥å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ç”¨å¦ä¸€ä¸ªXcodeï¼ˆæˆ–è€…plistutilï¼‰æ‰“å¼€<code>Xcode.app/Contents/Info.plist</code>ï¼Œæœç„¶å‘ç°äº†å¯¹åº”çš„å­—æ®µï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752770_b314e1b23bdd01fe803ede1383e29491.png" alt="1648210752770_b314e1b23bdd01fe803ede1383e29491"></p><p>è¿™ä¸ª<a href="https://developer.apple.com/documentation/bundleresources/information_property_list/lsminimumsystemversion">LSMinimumSystemVersion</a>æ˜¯Macåº”ç”¨æ ‡å‡†çš„å£°æ˜æœ€ä½éƒ¨ç½²ç‰ˆæœ¬çš„æ–¹å¼ï¼Œä¿®æ”¹ä¸ºä½ çš„æœºå™¨å½“å‰OSç‰ˆæœ¬ä¹‹åä¿å­˜ï¼Œæ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch /Applications/Xcode-13.3.0.app</span><br><span class="line">killall Finder</span><br></pre></td></tr></table></figure><p>é‡æ–°å°è¯•åŒå‡»ã€‚ä¸é”™ï¼Œè¿™æ¬¡æˆ‘ä»¬æ‰“å¼€äº†ï¼Œåˆçœ‹èµ·æ¥ä¸é”™ï¼ˆç›´åˆ°æˆ‘ä»¬æ­£å¼å¼€å§‹ç¼–è¯‘ï¼‰ï¼</p><p><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752322_3d4e9ae78eaab94de9cfc7d1f8eaecf0.png" alt="1648210752322_3d4e9ae78eaab94de9cfc7d1f8eaecf0"></p><h1 id="ç»•è¿‡CLIéƒ¨åˆ†çš„é™åˆ¶"><a href="#ç»•è¿‡CLIéƒ¨åˆ†çš„é™åˆ¶" class="headerlink" title="ç»•è¿‡CLIéƒ¨åˆ†çš„é™åˆ¶"></a>ç»•è¿‡CLIéƒ¨åˆ†çš„é™åˆ¶</h1><h2 id="ç¥å¥‡çš„xcrun"><a href="#ç¥å¥‡çš„xcrun" class="headerlink" title="ç¥å¥‡çš„xcrun"></a>ç¥å¥‡çš„xcrun</h2><p>ä½†æ˜¯åªè¦åˆ›å»ºä¸€ä¸‹å·¥ç¨‹å¹¶æ‰§è¡Œç¼–è¯‘ï¼Œå°±ä¼šå‘ç°ï¼Œå„ç§å‘½ä»¤è¡Œå·¥å…·çš„è°ƒç”¨æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å…ˆé€šè¿‡xcode-selectè®¾ç½®ä¸ºå½“å‰çš„Xcode 13.2ï¼Œå°è¯•æ‰§è¡Œï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752844_f21e111a081ff5dfc61dab7137109a39.png" alt="1648210752844_f21e111a081ff5dfc61dab7137109a39"><br><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752266_e83287242af496cbbec7817b4b60f9f0.png" alt="1648210752266_e83287242af496cbbec7817b4b60f9f0"></p><p>ä½†æ˜¯æˆ‘ä»¬å¦‚æœç›´æ¥æ‰¾åˆ°ï¼Œæ‰§è¡Œå¯¹åº”ç»å¯¹è·¯å¾„çš„clangï¼Œæ˜¯å¯ä»¥æ‰§è¡Œçš„</p><p><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752227_fd8cd9f89407475fe62c0489dc61a232.png" alt="1648210752227_fd8cd9f89407475fe62c0489dc61a232"></p><p>å¹¶ä¸”ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ£€æŸ¥clangè¿™ä¸ªäºŒè¿›åˆ¶ï¼Œæ˜¯å¦é“¾æ¥æ—¶è®¾ç½®äº†targetï¼Œè¿™éƒ¨åˆ†å¯ä»¥ä½¿ç”¨otool -lè¯»å–machO HeaderæŸ¥çœ‹åˆ°ï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752133_02c1257232efb1e2adebcb51ea25ceb0.png" alt="1648210752133_02c1257232efb1e2adebcb51ea25ceb0"></p><p>å¥½ï¼Œæœ€ä½éƒ¨ç½²ç‰ˆæœ¬æ˜¯macOS 10.14.6ï¼›é‚£ç°åœ¨æˆ‘ä»¬æœ‰å……åˆ†çš„è¯æ®è¯´æ˜ï¼Œä¸€å®šå¯ä»¥åœ¨æˆ‘å½“å‰çš„ç”µè„‘è¿è¡Œclangï¼Œè€Œä¸Šè¿°æç¤ºåº”è¯¥æ˜¯xcrunè¿™ä¸ªè°ƒåº¦å™¨ï¼Œæ·»åŠ äº†é¢å¤–çš„åˆ¤æ–­ã€‚</p><p>é€šè¿‡æœç´¢å…³é”®è¯ï¼Œå¯ä»¥åœ¨Xcodeçš„stringsè¾“å‡ºä¸­æ‰¾åˆ°è¿™å¥â€œExecutable requires at leastâ€çš„å…³é”®å­—ï¼šå‚è€ƒä»“åº“ï¼š<a href="https://github.com/keith/Xcode.app-strings/blob/11e15fd3cd8446f2a966746caefcef5beebc8929/Xcode.app/Contents/Frameworks/libxcodebuildLoader.dylib">Xcode.app-strings</a></p><h2 id="åç¼–è¯‘libxcodebuildLoader"><a href="#åç¼–è¯‘libxcodebuildLoader" class="headerlink" title="åç¼–è¯‘libxcodebuildLoader"></a>åç¼–è¯‘<code>libxcodebuildLoader</code></h2><p>æˆ‘ä»¬å®šä½åˆ°è¿™ä¸ª<code>libxcodebuildLoader.dylib</code>ï¼Œæ‹–è¿›Hopperå°è¯•åç¼–è¯‘ç†è§£ä»–æ£€æŸ¥çš„åŸç†ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> _checkMinimumOSVersion(<span class="type">int</span> arg0) &#123;</span><br><span class="line">    var_2C = <span class="number">0x0</span>;</span><br><span class="line">    rbx = <span class="number">0x0</span>;</span><br><span class="line">    rax = _NSGetExecutablePath(<span class="number">0x0</span>, &amp;var_2C);</span><br><span class="line">    rdi = var_2C;</span><br><span class="line">    <span class="keyword">if</span> (rdi != <span class="number">0x0</span>) &#123;</span><br><span class="line">            rbx = <span class="built_in">malloc</span>(rdi);</span><br><span class="line">    &#125;</span><br><span class="line">    rax = _NSGetExecutablePath(rbx, &amp;var_2C);</span><br><span class="line">    <span class="keyword">if</span> (rax != <span class="number">0x0</span>) <span class="keyword">goto</span> loc_282c;</span><br><span class="line"></span><br><span class="line">loc_26fc:</span><br><span class="line">    rax = [NSString stringWithUTF8String:rbx];</span><br><span class="line">    rax = [rax retain];</span><br><span class="line">    r14 = rax;</span><br><span class="line">    r15 = [[NSURL fileURLWithPath:rax] retain];</span><br><span class="line">    <span class="keyword">if</span> (rbx != <span class="number">0x0</span>) &#123;</span><br><span class="line">            <span class="built_in">free</span>(rbx);</span><br><span class="line">    &#125;</span><br><span class="line">    rbx = CFBundleCopyInfoDictionaryForURL(r15);</span><br><span class="line">    CFRelease(r15);</span><br><span class="line">    <span class="keyword">if</span> (rbx == <span class="number">0x0</span>) <span class="keyword">goto</span> loc_2867;</span><br><span class="line"></span><br><span class="line">loc_276a:</span><br><span class="line">    r13 = [CFDictionaryGetValue(rbx, @ DVTMinimumSystemVersion ) retain];</span><br><span class="line">    CFRelease(rbx);</span><br><span class="line">    <span class="keyword">if</span> ((r13 == <span class="number">0x0</span>) || ([r13 length] == <span class="number">0x0</span>)) <span class="keyword">goto</span> loc_280c;</span><br><span class="line"></span><br><span class="line">loc_27a6:</span><br><span class="line">    r12 = *_objc_msgSend;</span><br><span class="line">    r15 = [[DVTVersion versionWithStringValue:r13] retain];</span><br><span class="line">    rax = [DVTVersion currentSystemVersion];</span><br><span class="line">    rax = [rax retain];</span><br><span class="line">    rbx = r12;</span><br><span class="line">    r12 = rax;</span><br><span class="line">    rdx = r15;</span><br><span class="line">    <span class="keyword">if</span> ([rax isEqualToOrNewerThanVersion:rdx] == <span class="number">0x0</span>) <span class="keyword">goto</span> loc_288c;</span><br><span class="line"></span><br><span class="line">loc_27fb:</span><br><span class="line">    [r12 release];</span><br><span class="line">    [r15 release];</span><br><span class="line">    <span class="keyword">goto</span> loc_280c;</span><br><span class="line"></span><br><span class="line">loc_280c:</span><br><span class="line">    [r13 release];</span><br><span class="line">    [r14 release];</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">loc_288c:</span><br><span class="line">    r15 = [(rbx)(r15, @selector(stringValue), rdx) retain];</span><br><span class="line">    rax = (rbx)(r12, @selector(stringValue), rdx);</span><br><span class="line">    rax = [rax retain];</span><br><span class="line">    r14 = [(rbx)(@class(NSString), @selector(stringWithFormat:), @ Executable requires at least macOS %@, but is being run on macOS %@, and so is exiting. , r15, rax) retain];</span><br><span class="line">    [rax release];</span><br><span class="line">    [r15 release];</span><br><span class="line">    <span class="built_in">fprintf</span>(**___stderrp,  %s\n , (rbx)(objc_retainAutorelease(r14), @selector(UTF8String), @ Executable requires at least macOS %@, but is being run on macOS %@, and so is exiting. ));</span><br><span class="line">    <span class="keyword">goto</span> loc_292b;</span><br><span class="line"></span><br><span class="line">loc_292b:</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0x1</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">loc_2867:</span><br><span class="line">    fwrite( Unable to open executable info dictionary; xcodebuild may be corrupt and should be reinstalled.\n , <span class="number">0x60</span>, <span class="number">0x1</span>, **___stderrp);</span><br><span class="line">    <span class="keyword">goto</span> loc_292b;</span><br><span class="line"></span><br><span class="line">loc_282c:</span><br><span class="line">    _DVTAssertionFailureHandler(*_self, *__cmd,  <span class="type">void</span> checkMinimumOSVersion() ,  /Library/Caches/com.apple.xbs/Sources/IDETools/IDETools<span class="number">-20008</span>/xcodebuildLoader/xcodebuildLoader.m , <span class="number">0x69</span>, @ <span class="number">0</span> , @ Couldn<span class="number">&#x27;</span>t get executable path to self! );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½ï¼Œé˜…è¯»ä¼ªä»£ç ä»¥åŠæŸ¥é˜…èµ„æ–™å¯çŸ¥ï¼š</p><p><code>xcrun</code>ä¼šå…ˆä¸€æ­¥è°ƒç”¨åˆ°<code>xcodebuild</code>ï¼Œæ£€æŸ¥<code>DVTMinimumSystemVersion</code>è¿™ä¸ªå˜é‡çš„å€¼æ˜¯å¦å’Œå½“å‰OSç‰ˆæœ¬åŒ¹é…ã€‚</p><p>è€Œè¿™ä¸ªå˜é‡ï¼Œç«Ÿç„¶æ˜¯é€šè¿‡<a href="https://developer.apple.com/documentation/corefoundation/1537134-cfbundlecopyinfodictionaryforurl">CFBundleCopyInfoDictionaryForURL</a>æ‰“å¼€çš„ã€‚</p><p>å‚è€ƒè‹¹æœçš„å‡½æ•°è¯´æ˜ï¼Œå®ƒé™¤äº†å¸¸è§„çš„æ‰“å¼€ä¸€ä¸ª.bundleçš„æ–‡ä»¶å¤¹ï¼Œè§£æä¸ºNSBundle.infoDictionaryä»¥å¤–ï¼Œç«Ÿç„¶èƒ½æ‰“å¼€å­˜åœ¨äºäºŒè¿›åˆ¶<code>__TEXT,__info_plist</code>ä¸­çš„æ•°æ®æ¥è§£æä¸ºä¸€ä¸ªå­—å…¸ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥å»æ‰¾<code>xcodebuild</code>çš„äºŒè¿›åˆ¶çœ‹çœ‹ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752247_62087827de34d7b56eea1e48208b261e.png" alt="1648210752247_62087827de34d7b56eea1e48208b261e"></p><p>å‚è€ƒï¼š</p><ol><li> <code>_NSGetExecutablePath</code>ï¼š<a href="https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/dyld.3.html">å‡½æ•°è¯´æ˜</a>ï¼Œå¤§æ¦‚ç†è§£è·å–å½“å‰ç¨‹åºçš„å¯æ‰§è¡Œè·¯å¾„</li></ol><h2 id="åç¼–è¯‘xcodebuild"><a href="#åç¼–è¯‘xcodebuild" class="headerlink" title="åç¼–è¯‘xcodebuild"></a>åç¼–è¯‘<code>xcodebuild</code></h2><p>åŒæ—¶ï¼Œå‡ºäºå¥½å¥‡ï¼Œæˆ‘ä»¬å¯ä»¥å†æŠŠ<code>xcodebuild</code>æ‹–è¿›Hopperå»å°è¯•ç†è§£ï¼Œå‘ç°å®ƒæ•´ä¸ªç¨‹åºç«Ÿç„¶åªæœ‰ä¸€ä¸ªmainå‡½æ•°ï¼Œé€»è¾‘å…¶å®éƒ½åœ¨<code>libxcodebuildLoader.dylib</code>ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> _main(<span class="type">int</span> arg0, <span class="type">int</span> arg1) &#123;</span><br><span class="line">    r14 = arg1;</span><br><span class="line">    rbx = arg0;</span><br><span class="line">    rax = dlopen( @rpath/libxcodebuildLoader.dylib , <span class="number">0x1</span>);</span><br><span class="line">    <span class="keyword">if</span> (rax == <span class="number">0x0</span>) <span class="keyword">goto</span> loc_100002b7f;</span><br><span class="line"></span><br><span class="line">loc_100002b5c:</span><br><span class="line">    rax = dlsym(rax,  XcodeBuildMain );</span><br><span class="line">    <span class="keyword">if</span> (rax == <span class="number">0x0</span>) <span class="keyword">goto</span> loc_100002bd8;</span><br><span class="line"></span><br><span class="line">loc_100002b70:</span><br><span class="line">    (rax)(rbx, r14);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">loc_100002bd8:</span><br><span class="line">    rax = dlerror();</span><br><span class="line">    rax = [NSString stringWithUTF8String:rax];</span><br><span class="line">    rax = [rax retain];</span><br><span class="line">    rax = objc_retainAutorelease(rax);</span><br><span class="line">    r15 = rax;</span><br><span class="line">    rax = [rax UTF8String];</span><br><span class="line">    rsi =  Error loading symbol: %s\n ;</span><br><span class="line">    <span class="keyword">goto</span> loc_100002c2f;</span><br><span class="line"></span><br><span class="line">loc_100002c2f:</span><br><span class="line">    <span class="built_in">fprintf</span>(**___stderrp, rsi);</span><br><span class="line">    rbx = [_prunedErrorMessage() retain];</span><br><span class="line">    [r15 release];</span><br><span class="line">    <span class="keyword">if</span> (rbx != <span class="number">0x0</span>) &#123;</span><br><span class="line">            _main.cold<span class="number">.1</span>(rbx, @selector(UTF8String));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">loc_100002b7f:</span><br><span class="line">    rax = dlerror();</span><br><span class="line">    rax = [NSString stringWithUTF8String:rax];</span><br><span class="line">    rax = [rax retain];</span><br><span class="line">    rax = objc_retainAutorelease(rax);</span><br><span class="line">    r15 = rax;</span><br><span class="line">    rax = [rax UTF8String];</span><br><span class="line">    rsi =  Error loading required libraries. If there is an ongoing installation please wait <span class="keyword">for</span> it to complete. Otherwise reinstall. (%s)\n ;</span><br><span class="line">    <span class="keyword">goto</span> loc_100002c2f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹DVTMinimumSystemVersion"><a href="#ä¿®æ”¹DVTMinimumSystemVersion" class="headerlink" title="ä¿®æ”¹DVTMinimumSystemVersion"></a>ä¿®æ”¹<code>DVTMinimumSystemVersion</code></h2><p>å…¶å®å¤§å®¶ä¹Ÿå‘ç°äº†ï¼Œ<code>xcodebuild</code>äºŒè¿›åˆ¶æœ¬èº«ç«Ÿç„¶å†…åµŒäº†ä¸€æ®µXMLï¼æˆ‘ä½¿ç”¨<code>llvm-objdump</code>æŠŠå®ƒç›´æ¥æå–äº†å‡ºæ¥ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>BuildMachineOSBuild<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>21E160<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleDevelopmentRegion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>English<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleDisplayName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>xcodebuild<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleIdentifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>com.apple.dt.xcodebuild<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleInfoDictionaryVersion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>6.0<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>xcodebuild<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleShortVersionString<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>13.3<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleSupportedPlatforms<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>MacOSX<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleVersion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>20008<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>DTCompiler<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>com.apple.compilers.llvm.clang.1_0<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>DTPlatformBuild<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>21E185d<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>DTPlatformName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>macosx<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>DTPlatformVersion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>12.3<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>DTSDKBuild<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>21E185d<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>DTSDKName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>macosx12.3.internal<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>DTXcode<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>1330<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>DTXcodeBuild<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>13E112a<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>DVTMinimumSystemVersion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>12.0<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>LSMinimumSystemVersion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>11.0<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æˆ‘ä»¬å…³å¿ƒçš„<code>DVTMinimumSystemVersion</code>å’Œ<code>LSMinimumSystemVersion</code>éƒ½åœ¨é‡Œé¢ã€‚å…¶å®ä¹Ÿä¾§é¢è¯æ˜äº†ï¼ŒçœŸæ­£çš„æœ€ä½éƒ¨ç½²ç‰ˆæœ¬æ˜¯macOS 11.0ï¼Œè€Œä¸æ˜¯macOS 12.0ï¼ˆ12.0åªæ˜¯è‹¹æœä¸ºäº†é—´æ¥Push Developerå»é¢‘ç¹æ›´æ–°macOSçš„é˜´è°‹ç½¢äº†ğŸ˜‚ï¼‰</p><p>é‚£ä¸‹ä¸€æ­¥ï¼Œè¦åšçš„äº‹æƒ…å°±æ˜¯ç”¨é­”æ”¹<code>xcodebuild</code>å¹¶é‡æ–°codesignã€‚ä¿®æ”¹çš„æ–¹å¼å¤šç§å¤šæ ·ï¼Œä½ æš´åŠ›ä½¿ç”¨Hex Editorä¹Ÿæ˜¯æœ€ç®€å•ã€‚ä½†æ˜¯æˆ‘æ›´å¥½å¥‡çš„æ˜¯è¿™ä¸ª<code>__TEXT,__info_plist</code>çš„machOæ®µå’ŒèŠ‚çš„ç›¸å…³è¯´æ˜ã€‚</p><p>åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ç›¸å…³èµ„æ–™ï¼Œå¾ˆå®¹æ˜“å°±æ‰¾åˆ°äº†æ„Ÿå…´è¶£çš„èµ„æ–™ï¼š</p><ol><li><a href="https://redsweater.com/blog/2083/the-power-of-plist">The Power Of Plist</a>ï¼šè§£é‡ŠInfo.plistå¯ä»¥å†…åµŒåœ¨äºŒè¿›åˆ¶ä¸­</li><li><a href="https://reverse.put.as/2013/05/28/gimmedebugah-how-to-embedded-a-info-plist-into-arbitrary-binaries">Gimmedebugah: how to embedded a Info.plist into arbitrary binaries</a>ï¼šå¯¹ä»»æ„å·²æœ‰äºŒè¿›åˆ¶æ³¨å…¥Info.plist</li><li><a href="https://llvm.org/docs/CommandGuide/llvm-objcopy.html">llvm-objcopy</a>ï¼šæ‹·è´ä¿®æ”¹machOç»“æ„åˆ°æ–°machO</li></ol><p>åŸºæœ¬è§£é‡Šå¾—å¾ˆæ˜ç¡®æ¸…æ™°ï¼Œå¦‚æœä½ æœ‰æºç ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ld64çš„å‚æ•°<code> --sectcreate __TEXT,__info_plist path_to/Info.plist</code>æ¥æ³¨å…¥ä½ çš„Info.plistä¿¡æ¯ã€‚æ²¡æœ‰æºç å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹machOç»“æ„å¹¶ç­¾åå³å¯ã€‚</p><p>å¯¹äºæˆ‘æ­¤æ¬¡è·‘Xcode 13.3æ¥è¯´ï¼Œæˆ‘é€‰æ‹©æœ€å‚»ç“œæœ€ç›´è§‚çš„Hex Editorä¿®æ”¹ï¼ˆæˆ‘ç”¨çš„æ˜¯å¼€æºå°å·¥å…·<a href="https://github.com/HexFiend/HexFiend">HexFiend</a>ï¼‰ï¼Œåªéœ€è¦æŠŠ<code>12.0</code>ä¿®æ”¹ä¸º<code>11.0</code>å³å¯æ»¡è¶³æˆ‘çš„éœ€è¦ï¼Œå¹¶é‡æ–°codesignä¸€æ³¢ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752222_811d0d800592f601f309e48b732f1194.png" alt="1648210752222_811d0d800592f601f309e48b732f1194"></p><p>codesignï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">codesign --remove-signature /Applications/Xcode-13.3.0.app/Contents/Developer/usr/bin/xcodebuild</span><br><span class="line">sudo /Applications/Xcode-13.3.0.app/Contents/Developer/usr/bin/xcodebuild -license</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹CLIï¼Œå¾ˆæ­£å¸¸</p><p><img src="http://dreampiggy-image.test.upcdn.net/2022/03/25/1648210752374_0a5d6ef92b0e270d6164a05153565572.png" alt="1648210752374_0a5d6ef92b0e270d6164a05153565572"></p><h1 id="æœ€ç»ˆæ›¿æ¢æ­¥éª¤"><a href="#æœ€ç»ˆæ›¿æ¢æ­¥éª¤" class="headerlink" title="æœ€ç»ˆæ›¿æ¢æ­¥éª¤"></a>æœ€ç»ˆæ›¿æ¢æ­¥éª¤</h1><ol><li>ä¿®æ”¹<code>Xcode-13.3.0.app/Contents/Info.plist</code>ä¸­çš„<code>LSMinimumSystemVersion</code>çš„å€¼ä¸º<code>11.0</code></li><li>æ›¿æ¢<code>Xcode-13.3.0.app/Contents/Developer/usr/bin/xcodebuild</code>ä¸­çš„<code>DVTMinimumSystemVersion</code>çš„äºŒè¿›åˆ¶ä¸º<code>11.0</code>ï¼Œæˆ–è€…ä½¿ç”¨æˆ‘è¿™ä¸ªå·²ç»æ›¿æ¢å¥½çš„ï¼ˆå»ºè®®è¿˜æ˜¯æ‰‹åŠ¨å‚è€ƒä¸Šé¢æ­¥éª¤[ä¿®æ”¹DVTMinimumSystemVersion]æ›¿æ¢ï¼Œæˆäººä»¥æ¸”è€Œä¸æ˜¯æˆäººä»¥é±¼ï¼‰</li></ol>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œè‹¹æœçš„Xcodeç‰ˆæœ¬ä¼šä¸æ–­æé«˜è‡ªå·±çš„æœ€ä½å®‰è£…ç‰ˆæœ¬ï¼Œåœ¨Xcode 13.0-13.2.1ä¸Šï¼Œè¿™ä¸ªæœ€ä½å®‰è£…ç‰ˆæœ¬æ˜¯macOS 11&lt;/p&gt;
&lt;p&gt;è€Œéšç€Xcode 13.3æ­£å¼ç‰ˆæ”¾å‡ºï¼Œè¿™ä¸ªæœ€ä½éƒ¨ç½²ç‰ˆæœ¬åœ¨æœ€åå…³å¤´è¢«æå‡åˆ°äº†macOS 12&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;Whyï¼Ÿ&quot;&gt;&lt;a href=&quot;#Whyï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;Whyï¼Ÿ&quot;&gt;&lt;/a&gt;Whyï¼Ÿ&lt;/h1&gt;&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œå„ä½å¼€å‘è€…æˆ–è€…ä¼—å¤šåŸºå»ºï¼Œæ€»æœ‰å„ç§å„æ ·çš„åŸå› éœ€è¦æš‚æ—¶ç•™åœ¨è€ç‰ˆæœ¬çš„macOSç³»ç»Ÿä¸Šï¼Œä½†æ˜¯åˆå¸Œæœ›ä½¿ç”¨æ–°Xcodeç‰ˆæœ¬è‡ªå¸¦çš„Toolchainè¿›è¡Œä¸€äº›å·¥ä½œå¼€å‘è°ƒè¯•ï¼Œæœ‰äº›æ˜¯ä¸»è§‚é—®é¢˜ï¼Œæœ‰äº›æ˜¯å®¢è§‚é™åˆ¶ï¼š&lt;/p&gt;
&lt;p&gt;ä¸¾ä¾‹å­ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;macOS 12ç¦æ­¢äº†&lt;code&gt;sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate off&lt;/code&gt;ç»•è¿‡GUIé…ç½®ï¼Œå¯¼è‡´ä¸€äº›å…¬å¸é‡‡å–Apple Device Managementç®¡ç†çš„ç”µè„‘ï¼Œæ— æ³•æ­£å¸¸å…³é—­TCPæ‹¦æˆªï¼Œä¼šå¯¼è‡´ä¸€äº›æœåŠ¡å¼‚å¸¸&lt;/li&gt;
&lt;li&gt;macOS 12åŠ å¼ºäº†Kernel Extensionçš„å®‰å…¨æ€§ï¼Œå¯¼è‡´GitHub Actionå’ŒCircle CIæˆªæ­¢2022å¹´3æœˆåº•ï¼Œè¿Ÿè¿Ÿæ— æ³•æ›´æ–°ä»–ä»¬çš„è™šæ‹ŸåŒ–é›†ç¾¤åˆ°macOS 12ï¼Œåªæœ‰11.6çš„æœ€æ–°ç‰ˆæœ¬&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™äº›éƒ½æ˜¯é—²èŠï¼Œè¿›å…¥æ­£é¢˜ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•èƒ½å¤Ÿç»•å¼€ï¼Œæˆ–è€…ä»åŸç†ä¸Šæ¥è®²ï¼Œæ˜¯å¦è¿™ä¸ªç³»ç»Ÿç»‘å®šçš„æœ€ä½éƒ¨ç½²ç‰ˆæœ¬é™åˆ¶æ˜¯å¿…è¦çš„ï¼Ÿ&lt;/p&gt;</summary>
    
    
    
    
    <category term="Xcode" scheme="http://dreampiggy.com/tags/Xcode/"/>
    
    <category term="é€†å‘" scheme="http://dreampiggy.com/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="macOS" scheme="http://dreampiggy.com/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>CocoaPodsèµ„æºç®¡ç†â€”Data Assetæœ€ä½éƒ¨ç½²ç‰ˆæœ¬çš„å‘</title>
    <link href="http://dreampiggy.com/2021/07/16/CocoaPods%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E2%80%94Data-Asset%E6%9C%80%E4%BD%8E%E9%83%A8%E7%BD%B2%E7%89%88%E6%9C%AC%E7%9A%84%E5%9D%91/"/>
    <id>http://dreampiggy.com/2021/07/16/CocoaPods%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E2%80%94Data-Asset%E6%9C%80%E4%BD%8E%E9%83%A8%E7%BD%B2%E7%89%88%E6%9C%AC%E7%9A%84%E5%9D%91/</id>
    <published>2021-07-16T16:16:18.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>è‡ªå·±å¾ˆæ—©ä¹‹å‰æ›¾ç»å†™è¿‡ä¸€äº›CocoaPodsç®¡ç†Resourceèµ„æºçš„æ–‡ç« ï¼š<a href="https://bytedance.feishu.cn/wiki/wikcnJUiDWMmCbkSnfFvYpcMT0f">CocoaPodsçš„èµ„æºç®¡ç†å’ŒAsset Catalogä¼˜åŒ–</a> ï¼Œå½“æ—¶åˆ—ä¸¾äº†å¯¹æ™®é€šå›¾ç‰‡ç±»å‹çš„ç®¡ç†æ–¹å¼å’Œä¸€äº›ç”¨æ³•ï¼Œä¹Ÿæ™®åŠäº†ä¸€ä¸‹UIImageè·å–Bundleå»åŠ è½½ä¸åœ¨mainBundleå›¾åƒçš„æ–¹å¼ã€‚</p><p>ä½†æ˜¯è‹¹æœæ—©åœ¨iOS 9ï¼ŒXcode 7æ—¶ä»£ï¼Œè‹¹æœå°±å·²ç»æ¨å‡ºäº†Data Assetçš„æ¦‚å¿µï¼Œå¹¶åœ¨éšåçš„Xcodeï¼Œå°¤å…¶æ˜¯Xcode 10ä¸­ï¼Œä¸ºData Assetæä¾›äº†App Slicingçš„èƒ½åŠ›ï¼ˆå³App Storeæå®¡åŒ…ä¼šæ ¹æ®é€‰æ‹©çš„ä¸åŒè®¾å¤‡/å†…å­˜/åˆ†è¾¨ç‡/GPU/CPUï¼Œæœ€ç»ˆä¸‹è½½åˆ°å”¯ä¸€åŒ¹é…çš„ä¸€ä»½æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªåŠŸèƒ½æ¸æ¸åœ°å¼€å§‹è¢«ä¸€äº›å›½å†…å¼€å‘è€…ä½¿ç”¨ã€‚</p><p>åœ¨NSHipsterè¿™é‡Œï¼Œæœ‰ä¸€ç¯‡ä¸“é—¨çš„æ–‡ç« ä»‹ç»ï¼šã€Š<a href="https://nshipster.cn/nsdataasset/">NSDataAsset</a>ã€‹</p><p>ä¸è¿‡ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦çš„å†…å®¹æ˜¯ï¼Œæœ€è¿‘æœ‰åŒäº‹è¸©åˆ°ä¸€ä¸ªå…³äºData Assetå’Œæœ€ä½éƒ¨ç½²ç‰ˆæœ¬çš„å‘ï¼Œè¿™é‡Œå•ç‹¬åˆ—ä¸¾ä¸€ä¸‹ä»¥é˜²åäººé‡å¤è¸©å‘ã€‚</p><h1 id="Data-Assetåˆè§"><a href="#Data-Assetåˆè§" class="headerlink" title="Data Assetåˆè§"></a>Data Assetåˆè§</h1><p>æ ‡å‡†çš„é…ç½®ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨Xcodeé‡Œåˆ›å»ºä¸€ä¸ªAsset Catalogï¼Œç„¶åæ‹–å…¥æƒ³è¦çš„æ–‡ä»¶ã€‚æ³¨æ„æˆ‘ä»¬å¯ä»¥åœ¨å³ä¾§é’ˆå¯¹ä¸åŒçš„é…ç½®è®¾ç½®ä¸åŒçš„æ–‡ä»¶å†…å®¹ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2021/07/16/1625559957403_29bd9b59c2bbaa1f363122a8276779b6.png" alt="1625559957403_29bd9b59c2bbaa1f363122a8276779b6"></p><p>æœ€ç»ˆä¸€ä¸ªData Assetçš„è¾“å…¥å¤§æ¦‚çš„å½¢å¼æ˜¯è¿™æ ·å­çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Image.xcassets</span><br><span class="line"></span><br><span class="line">- A.dataset</span><br><span class="line"></span><br><span class="line">-- Contents.json</span><br><span class="line"></span><br><span class="line">-- 1.zip</span><br><span class="line"></span><br><span class="line">-- 2.webp</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é™¤äº†åç¼€åä»¥å¤–ï¼Œå…¶ä»–çš„ç»“æ„å’Œæ™®é€šçš„imagesetä¿æŒä¸€è‡´ã€‚</p><h1 id="Data-Assetäº§ç‰©"><a href="#Data-Assetäº§ç‰©" class="headerlink" title="Data Assetäº§ç‰©"></a>Data Assetäº§ç‰©</h1><p>åœ¨æ‰§è¡ŒXcodeæ ‡å‡†çš„<code>Copy Bundle Resources</code>çš„Build Phaseä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„Data Assetä¼šè¢«ç¼–è¯‘ä¸ºä¸€ä¸ªAssets.caræ–‡ä»¶ï¼Œè¿™ä¸ªæ ¼å¼ä¹Ÿæ˜¯è€ç†Ÿäººäº†ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2021/07/16/1625559957281_7b787078bbae747abaf28cde1a513955.png" alt="1625559957281_7b787078bbae747abaf28cde1a513955"></p><h1 id="Data-Assetè·å–ä»£ç "><a href="#Data-Assetè·å–ä»£ç " class="headerlink" title="Data Assetè·å–ä»£ç "></a>Data Assetè·å–ä»£ç </h1><p>ç±»ä¼¼äºå›¾åƒï¼Œç”±äºData Assetæœ€ç»ˆä¼šç¼–è¯‘åˆ°Carä¸­ï¼Œæ— æ³•ç›´æ¥è·å–æ–‡ä»¶è·¯å¾„ï¼ˆFlutter/H5ç­‰è·¨å¹³å°åº“åˆéœ€è¦ä½¿ç”¨Bridgeæ–¹æ¡ˆæ¥è°ƒç”¨Nativeæ¥å£ï¼‰</p><p>åœ¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Fondationæä¾›çš„ä¸“é—¨ç±»<a href="https://developer.apple.com/documentation/uikit/nsdataasset?language=objc">NSDataAsset</a>ç›¸å…³æ¥å£ï¼Œæ¥è·å–çœŸæ­£çš„NSDataï¼Œæ¥å£æ¯”è¾ƒç®€å•ç›´è§‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/** å¦‚æœæ˜¯éMain Bundleï¼Œè¦è·å–Bundle</span><br><span class="line"></span><br><span class="line">NSString *bundlePath = [[NSBundle bundleForClass:self.class].resourcePath stringByAppendingPathComponent:@&quot;A.bundle&quot;];</span><br><span class="line"></span><br><span class="line">NSBundle *bundle = [NSBundle bundleWithPath:bundlePath];</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">NSBundle *bundle = [NSBundle mainBundle];</span><br><span class="line"></span><br><span class="line">NSDataAsset *asset = [[NSDataAsset alloc] initWithName:@&quot;TestImageAnimated&quot; bundle:bundle];</span><br><span class="line"></span><br><span class="line">NSData *data = asset.data;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥æ¯”UIImageçš„ç›¸å…³æ¥å£ç®€å•ç†è§£å¤šäº†ï¼Œå¯¹å§ã€‚</p><h1 id="å‘-æœ€ä½éƒ¨ç½²ç‰ˆæœ¬å½±å“è¡Œä¸º"><a href="#å‘-æœ€ä½éƒ¨ç½²ç‰ˆæœ¬å½±å“è¡Œä¸º" class="headerlink" title="å‘-æœ€ä½éƒ¨ç½²ç‰ˆæœ¬å½±å“è¡Œä¸º"></a>å‘-æœ€ä½éƒ¨ç½²ç‰ˆæœ¬å½±å“è¡Œä¸º</h1><p>ç„¶è€Œæœ€è¿‘æœ‰åŒäº‹å‘ç°ï¼Œä»–ä»¬çš„ä¸€ä¸ªSDKï¼Œä½¿ç”¨äº†Data Assetï¼Œåœ¨ä¸åŒçš„å®¿ä¸»Appä¸­è¡Œä¸ºä¸ä¸€è‡´ã€‚æŸä¸ªå®¿ä¸»ä¸­å¯ä»¥èƒ½è®¿é—®åˆ°æ•°æ®ï¼Œå¦ä¸€ä¸ªä¸€ç›´è®¿é—®ä¸åˆ°ã€‚å‰æ¥å’¨è¯¢ï¼ˆï¼Ÿï¼‰äº†æˆ‘ï¼Œå› æ­¤åšäº†ä¸€ç•ªæ’æŸ¥ï¼Œå‘ç°äº†ä¸€ä¸ªå‘ï¼š</p><p><strong>å…ˆè¯´ç»“è®ºï¼šData Assetçš„ç¼–è¯‘å•å…ƒï¼Œåœ¨æœ€ä½éƒ¨ç½²ç‰ˆæœ¬iOS 9ä»¥ä¸‹æ—¶ï¼Œä¸ä¼šäº§å‡ºAsset.carè€Œæ˜¯ç›´æ¥æ‹·è´äº†æ–‡ä»¶åˆ°åŸBundleè·¯å¾„ä¸‹ï¼›åªæœ‰iOS 9åŠä»¥ä¸Šæ‰ä¼šäº§å‡ºAsset.car</strong></p><p>å¦‚å›¾ï¼Œè¿™æ˜¯SDKçš„èµ„æºã€‚SDKä½¿ç”¨äº†CocoaPodsè¿›è¡Œæ‰˜ç®¡ï¼ŒPodspecé‡Œé¢ä½¿ç”¨äº†<code>resource_bundles</code>æ¥æä¾›å¯¹å¤–çš„èµ„æºã€‚è¿™é‡Œçš„Data Asseté‡Œé¢å†…å®¹æ˜¯ä¸€ä¸ªWebPæ–‡ä»¶ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2021/07/16/1625559957352_30cb4a561799eec3da92fa1c607c101e.png" alt="1625559957352_30cb4a561799eec3da92fa1c607c101e"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">s.ios.deployment_target = &quot;8.0&quot;</span><br><span class="line"></span><br><span class="line">s.subspec &#x27;Core&#x27; do |ss|</span><br><span class="line"></span><br><span class="line">  ss.resource_bundle     =  &#123;&#x27;splashResourceCore&#x27; =&gt; [&#x27;TTAdSplashSDK/Assets/splashResource/CoreImage.xcassets&#x27;, &#x27;TTAdSplashSDK/Assets/splashResource/ShakeMusic.mp3&#x27;]&#125;</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥éå¸¸æ­£å¸¸ï¼Œä½†æ˜¯å®é™…ä¸Šè¡Œä¸ºå°±æ˜¯æœ‰æ‰€ä¸åŒã€‚äºæ˜¯ç®€å•å¼€å§‹ä»æºå¤´æ’æŸ¥å·®å¼‚ã€‚</p><h2 id="å®¿ä¸»A"><a href="#å®¿ä¸»A" class="headerlink" title="å®¿ä¸»A"></a>å®¿ä¸»A</h2><p>æˆ‘ä»¬æœç´¢æŸ¥çœ‹Xcodeæœ€ç»ˆç¼–è¯‘çš„å‘½ä»¤ã€‚è´Ÿè´£ç¼–è¯‘xcassetsçš„å‘½ä»¤æ˜¯actoolã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>com.apple.actool.compilation-results</code>è¿™é‡Œæœ‰æ‰“å°æ‰€æœ‰çš„è¾“å‡ºï¼Œæ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CompileAssetCatalog /Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Products/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy/splashResourceCore.bundle /Users/bytedance/TTiOS/subs/tt_splash_sdk/TTAdSplashSDK/Assets/splashResource/CoreImage.xcassets (in target &#x27;TTAdSplashSDK-Core-Interactive-Privacy-splashResourceCore&#x27; from project &#x27;TTAdSplashSDK&#x27;)</span><br><span class="line"></span><br><span class="line">    cd /Users/bytedance/TTiOS/subs/tt_splash_sdk/Example/Pods</span><br><span class="line"></span><br><span class="line">    /Applications/Xcode.app/Contents/Developer/usr/bin/actool --output-format human-readable-text --notices --warnings --export-dependency-info /Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Intermediates.noindex/TTAdSplashSDK.build/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy-splashResourceCore.build/assetcatalog_dependencies --output-partial-info-plist /Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Intermediates.noindex/TTAdSplashSDK.build/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy-splashResourceCore.build/assetcatalog_generated_info.plist --compress-pngs --enable-on-demand-resources NO --optimization space --filter-for-device-model iPhone13,2 --filter-for-device-os-version 14.5 --development-region en --target-device iphone --target-device ipad --minimum-deployment-target 10.0 --platform iphonesimulator --compile /Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Products/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy/splashResourceCore.bundle /Users/bytedance/TTiOS/subs/tt_splash_sdk/TTAdSplashSDK/Assets/splashResource/CoreImage.xcassets</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">/* com.apple.actool.compilation-results */</span><br><span class="line"></span><br><span class="line">/Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Intermediates.noindex/TTAdSplashSDK.build/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy-splashResourceCore.build/assetcatalog_generated_info.plist</span><br><span class="line"></span><br><span class="line">/Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Products/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy/splashResourceCore.bundle/Assets.car</span><br></pre></td></tr></table></figure><p>æ£€ç´¢äº§ç‰©Assets.carï¼Œä¹Ÿç¬¦åˆé¢„æœŸï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/2021/07/16/1625559957323_ceced1da15007185b48893a6eda48754.png" alt="1625559957323_ceced1da15007185b48893a6eda48754"></p><h2 id="å®¿ä¸»B"><a href="#å®¿ä¸»B" class="headerlink" title="å®¿ä¸»B"></a>å®¿ä¸»B</h2><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬æŸ¥çœ‹ç¼–è¯‘å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CompileAssetCatalog /Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Products/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy/splashResourceCore.bundle /Users/bytedance/TTiOS/subs/tt_splash_sdk/TTAdSplashSDK/Assets/splashResource/CoreImage.xcassets (in target &#x27;TTAdSplashSDK-Core-Interactive-Privacy-splashResourceCore&#x27; from project &#x27;TTAdSplashSDK&#x27;)</span><br><span class="line"></span><br><span class="line">    cd /Users/bytedance/TTiOS/subs/tt_splash_sdk/Example/Pods</span><br><span class="line"></span><br><span class="line">    /Applications/Xcode.app/Contents/Developer/usr/bin/actool --output-format human-readable-text --notices --warnings --export-dependency-info /Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Intermediates.noindex/TTAdSplashSDK.build/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy-splashResourceCore.build/assetcatalog_dependencies --output-partial-info-plist /Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Intermediates.noindex/TTAdSplashSDK.build/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy-splashResourceCore.build/assetcatalog_generated_info.plist --compress-pngs --enable-on-demand-resources NO --optimization space --filter-for-device-model iPhone13,2 --filter-for-device-os-version 14.5 --development-region en --target-device iphone --target-device ipad --minimum-deployment-target 8.0 --platform iphonesimulator --compile /Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Products/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy/splashResourceCore.bundle /Users/bytedance/TTiOS/subs/tt_splash_sdk/TTAdSplashSDK/Assets/splashResource/CoreImage.xcassets</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* com.apple.actool.compilation-results */</span><br><span class="line"></span><br><span class="line">/Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Intermediates.noindex/TTAdSplashSDK.build/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy-splashResourceCore.build/assetcatalog_generated_info.plist</span><br><span class="line"></span><br><span class="line">/Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Products/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy/splashResourceCore.bundle/Assets.car</span><br><span class="line"></span><br><span class="line">/Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Products/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy/splashResourceCore.bundle/ad_btn_hand.webp</span><br><span class="line"></span><br><span class="line">/Users/bytedance/Library/Developer/Xcode/DerivedData/TTAdSplashSDK-bouxjwktwlrwfthejbcmzvcqddie/Build/Products/Debug-iphonesimulator/TTAdSplashSDK-Core-Interactive-Privacy/splashResourceCore.bundle/ad_btn_triangle.webp</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œåœ¨actoolçš„ç¼–è¯‘ç»“æœä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼ŒåŸæœ¬é¢„æœŸåº”è¯¥åœ¨Data Assetçš„<code>ad_btn_hand.webp</code>å’Œ<code>ad_btn_triangle.webp</code>ä¸¤ä¸ªæ–‡ä»¶ï¼Œç«Ÿç„¶ç›´æ¥æ‹·è´åˆ°äº†.bundleçš„æ ¹è·¯å¾„ï¼Œè€Œä¸æ˜¯Assets.carä¸­ï¼</p><p><img src="http://dreampiggy-image.test.upcdn.net/2021/07/16/1625559957272_fa17b69e9dd37090291bc0a6952baa38.png" alt="1625559957272_fa17b69e9dd37090291bc0a6952baa38"></p><p>å¯¹æ¯”ä¸¤è€…çš„å‘½ä»¤ï¼Œåªæœ‰<code>--minimum-deployment-target</code>è¿™ä¸€é¡¹æœ‰å·®è·ï¼Œå®¿ä¸»Aæ˜¯iOS 10.0ï¼Œå®¿ä¸»Bæ˜¯iOS 8.0ã€‚</p><p>ç»è¿‡å†æ¬¡DemoéªŒè¯ï¼Œç¡®å®šäº†æ˜¯è¿™ä¸ªå¯¼è‡´äº†è¡Œä¸ºçš„å·®å¼‚ï¼</p><h2 id="SDKè°ƒç”¨ä»£ç "><a href="#SDKè°ƒç”¨ä»£ç " class="headerlink" title="SDKè°ƒç”¨ä»£ç "></a>SDKè°ƒç”¨ä»£ç </h2><p>SDKè¿è¡Œæ—¶éœ€è¦è·å–è¿™äº›ä»£ç ï¼Œç»è¿‡æŸ¥çœ‹ï¼Œè¿™é‡Œçš„ä»£ç æ˜¯å‡è®¾æŒ‰ç…§.bundleæ ¹è·¯å¾„å­˜åœ¨Data Assetçš„æ–‡ä»¶åçš„æ–¹å¼å»å–çš„ï¼Œå› æ­¤åœ¨å®¿ä¸»Aä¸­ä¼šå‡ºç°å¼‚å¸¸ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// ä¼ªä»£ç </span><br><span class="line"></span><br><span class="line">NSString *bundlePath = [[NSBundle bundleForClass:TTAdSplashManager.class].resourcePath stringByAppendingPathComponent:@&quot;splashResourceCore.bundle&quot;];</span><br><span class="line"></span><br><span class="line">NSbundle* bundle = [NSBundle bundleWithPath:bundlePath];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NSString *trianglePath = [bundle.resourcePath stringByAppendingPathComponent:@&quot;ad_btn_triangle.webp&quot;];</span><br><span class="line"></span><br><span class="line">NSData *triangleData = [NSData dataWithContentsOfFile:trianglePath];</span><br><span class="line"></span><br><span class="line">self.imageView.image = [UIImage imageWithData:triangleData];</span><br></pre></td></tr></table></figure><h2 id="è¿›ä¸€æ­¥æ’æŸ¥æœ€ä½éƒ¨ç½²ç‰ˆæœ¬å˜åŒ–"><a href="#è¿›ä¸€æ­¥æ’æŸ¥æœ€ä½éƒ¨ç½²ç‰ˆæœ¬å˜åŒ–" class="headerlink" title="è¿›ä¸€æ­¥æ’æŸ¥æœ€ä½éƒ¨ç½²ç‰ˆæœ¬å˜åŒ–"></a>è¿›ä¸€æ­¥æ’æŸ¥æœ€ä½éƒ¨ç½²ç‰ˆæœ¬å˜åŒ–</h2><p>æœ¬è´¨åŸå› äº†è§£æ¸…æ¥šåï¼Œè¿›ä¸€æ­¥æ’æŸ¥è¿™ä¸ªç–‘é—®ï¼š</p><blockquote><p>ä¸ºä»€ä¹ˆå®¿ä¸»Aå’Œå®¿ä¸»Bï¼Œå¯¹äºä¸€ä¸ªSDKçš„Podï¼Œæœ€ä½éƒ¨ç½²ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Ÿ</p></blockquote><p>å› ä¸ºSDKçš„Podspecçš„æœ€ä½éƒ¨ç½²ç‰ˆæœ¬å·²ç»æŒ‡æ˜äº†iOS 8ï¼ŒæŒ‰ç†è¯´åœ¨å“ªä¸ªå®¿ä¸»é›†æˆéƒ½åº”è¯¥èµ°çš„æ˜¯è·¯å¾„çš„é€»è¾‘ï¼Œè€Œä¸åº”è¯¥å—é™äºå®¿ä¸»iOS Appè‡ªå·±çš„ç¼–è¯‘æœ€ä½éƒ¨ç½²ç‰ˆæœ¬ã€‚</p><p>æŸ¥çœ‹å®¿ä¸»Aï¼Œå‘ç°å®¿ä¸»Aä½¿ç”¨äº†CocoaPodsçš„æ’ä»¶ï¼Œåœ¨Pod Project Generateçš„æ—¶å€™ï¼Œå¼ºåˆ¶ä¿®æ”¹äº†æ‰€æœ‰Podï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">all_targets.each do |target|</span><br><span class="line"></span><br><span class="line">  target.set_build_settings(&#x27;IPHONEOS_DEPLOYMENT_TARGET&#x27;) do |_, old|</span><br><span class="line"></span><br><span class="line">    old.to_f &lt; 10.0 ? &#x27;10.0&#x27; : old</span><br><span class="line"></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  target.set_build_settings(&#x27;ASSETCATALOG_COMPILER_OPTIMIZATION&#x27;) do |_, old|</span><br><span class="line"></span><br><span class="line">    definitions = &#x27;space&#x27;</span><br><span class="line"></span><br><span class="line">    definitions</span><br><span class="line"></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>å¯¼è‡´SDKçš„ç¼–è¯‘Assets.caræ—¶ï¼Œ<code>--minimum-deployment-target</code>ä¼ å…¥äº†iOS 10.0ï¼ŒData Assetç¼–è¯‘åˆ°Assets.caré‡Œ</p><p>è€Œå®¿ä¸»Bï¼Œå¹¶æ²¡æœ‰è¿™ä¸ªé€»è¾‘ï¼ŒæŒ‰ç…§iOS 8.0ä¼ å…¥ï¼ŒData Assetæ•£è½åœ¨Bundleæ ¹è·¯å¾„ã€‚</p><h1 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h1><p>ä»è¿™ä¸ªå‘å¯ä»¥çœ‹åˆ°ï¼Œæœ€ä½éƒ¨ç½²ç‰ˆæœ¬ï¼Œè¿™ä¸ªç¼–è¯‘é…ç½®ï¼Œè®¾ç½®æ—¶éœ€è¦è°¨æ…ã€‚ç”±äºiOS Appä¸ä¼šé’ˆå¯¹ä¸åŒçš„éƒ¨ç½²ç‰ˆæœ¬ï¼Œå•ç‹¬æ‰“ä¸€ä»½ç‹¬ç«‹çš„ipaåŒ…ï¼ˆç±»ä¼¼PCç­‰å¹³å°ï¼‰ï¼Œæ‰€ä»¥å¾ˆå¤šå·¥å…·é“¾å¯¹é’ˆå¯¹æœ€ä½éƒ¨ç½²ç‰ˆæœ¬ï¼Œæœ‰ç€å¯èƒ½ä¸åŒçš„å…¼å®¹æ€§è¡Œä¸ºï¼ŒiOSç³»ç»Ÿå¿«é€Ÿè¿­ä»£çš„èŠ‚å¥ä¸‹å°¤å…¶æ˜¯è¿™æ ·ã€‚</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ”¹è¿›æ–¹æ¡ˆï¼š</p><ol><li> å¯¹äºå®¿ä¸»ï¼Œé™¤éä½ æ¸…æ¥šçŸ¥é“æ”¹å˜æœ€ä½éƒ¨ç½²ç‰ˆæœ¬çš„å‰¯ä½œç”¨ï¼Œå¦åˆ™è¦æ…é‡å¤„ç†å¤–éƒ¨Podçš„æœ€ä½éƒ¨ç½²ç‰ˆæœ¬ï¼Œå»ºè®®åœ¨ä¿®æ”¹åè¿›è¡Œä¸€å®šçš„å›å½’æµ‹è¯•ï¼Œæˆ–è€…é’ˆå¯¹ç™½åå•æ¥è¿›è¡Œä¿®æ”¹ã€‚</li><li> å¯¹äºSDKä½œè€…ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°Data Assetçš„ç‰¹æ€§ï¼ˆApp Slicingï¼‰ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥ä¸ç”¨Data Assetè€Œç›´æ¥æ”¾åˆ°Bundleä¸­ï¼Œçœå»è¸©å‘çš„é—®é¢˜ã€‚å¦‚æœéœ€è¦åˆ©ç”¨Data Assetï¼Œå¹¶ä¸”ä½ æ— æ³•ä¿è¯å¼•å…¥æ–¹å®¿ä¸»ä¼šå¯¹ä½ çš„Podåšé¢å¤–çš„ä¿®æ”¹ï¼Œå¯ä»¥è€ƒè™‘è¿™ç§å…¼å®¹ä»£ç æ¥åˆ¤æ–­ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">NSString *bundlePath = [[NSBundle bundleForClass:self.class].resourcePath stringByAppendingPathComponent:@&quot;Image.bundle&quot;];</span><br><span class="line"></span><br><span class="line">NSBundle *bundle = [NSBundle bundleWithPath:bundlePath];</span><br><span class="line"></span><br><span class="line">// å¦‚æœç¼–è¯‘æ—¶çš„æœ€ä½éƒ¨ç½²ç‰ˆæœ¬iOS 9ä»¥ä¸Šï¼ŒData Assetéœ€è¦ç”¨NSDataAssetç±»è·å–ï¼Œå¦åˆ™ç”¨ç›´æ¥å–è·¯å¾„</span><br><span class="line"></span><br><span class="line">NSDataAsset *asset = [[NSDataAsset alloc] initWithName:@&quot;TestImageAnimated&quot; bundle:bundle]; // æ­¤å¤„æ˜¯Assetåï¼Œä¸æ˜¯æ–‡ä»¶åï¼</span><br><span class="line"></span><br><span class="line">NSData *data = asset.data;</span><br><span class="line"></span><br><span class="line">if (!data) &#123;</span><br><span class="line"></span><br><span class="line">    // Fallbackåˆ°è·¯å¾„</span><br><span class="line"></span><br><span class="line">    data = [NSData dataWithContentsOfFile:[bundlePath stringByAppendingPathComponent:&quot;TestImageAnimated.webp&quot;]]; // æ­¤å¤„æ˜¯æ–‡ä»¶åï¼Œæ³¨æ„ï¼</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;è‡ªå·±å¾ˆæ—©ä¹‹å‰æ›¾ç»å†™è¿‡ä¸€äº›CocoaPodsç®¡ç†Resourceèµ„æºçš„æ–‡ç« ï¼š&lt;a href=&quot;https://bytedance.feishu.cn/wiki/wikcnJUiDWMmCbkSnfFvYpcMT0f&quot;&gt;CocoaPodsçš„èµ„æºç®¡ç†å’ŒAsset Catalogä¼˜åŒ–&lt;/a&gt; ï¼Œå½“æ—¶åˆ—ä¸¾äº†å¯¹æ™®é€šå›¾ç‰‡ç±»å‹çš„ç®¡ç†æ–¹å¼å’Œä¸€äº›ç”¨æ³•ï¼Œä¹Ÿæ™®åŠäº†ä¸€ä¸‹UIImageè·å–Bundleå»åŠ è½½ä¸åœ¨mainBundleå›¾åƒçš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è‹¹æœæ—©åœ¨iOS 9ï¼ŒXcode 7æ—¶ä»£ï¼Œè‹¹æœå°±å·²ç»æ¨å‡ºäº†Data Assetçš„æ¦‚å¿µï¼Œå¹¶åœ¨éšåçš„Xcodeï¼Œå°¤å…¶æ˜¯Xcode 10ä¸­ï¼Œä¸ºData Assetæä¾›äº†App Slicingçš„èƒ½åŠ›ï¼ˆå³App Storeæå®¡åŒ…ä¼šæ ¹æ®é€‰æ‹©çš„ä¸åŒè®¾å¤‡/å†…å­˜/åˆ†è¾¨ç‡/GPU/CPUï¼Œæœ€ç»ˆä¸‹è½½åˆ°å”¯ä¸€åŒ¹é…çš„ä¸€ä»½æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªåŠŸèƒ½æ¸æ¸åœ°å¼€å§‹è¢«ä¸€äº›å›½å†…å¼€å‘è€…ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨NSHipsterè¿™é‡Œï¼Œæœ‰ä¸€ç¯‡ä¸“é—¨çš„æ–‡ç« ä»‹ç»ï¼šã€Š&lt;a href=&quot;https://nshipster.cn/nsdataasset/&quot;&gt;NSDataAsset&lt;/a&gt;ã€‹&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦çš„å†…å®¹æ˜¯ï¼Œæœ€è¿‘æœ‰åŒäº‹è¸©åˆ°ä¸€ä¸ªå…³äºData Assetå’Œæœ€ä½éƒ¨ç½²ç‰ˆæœ¬çš„å‘ï¼Œè¿™é‡Œå•ç‹¬åˆ—ä¸¾ä¸€ä¸‹ä»¥é˜²åäººé‡å¤è¸©å‘ã€‚&lt;/p&gt;
&lt;h1 id=&quot;Data-Assetåˆè§&quot;&gt;&lt;a href=&quot;#Data-Assetåˆè§&quot; class=&quot;headerlink&quot; title=&quot;Data Assetåˆè§&quot;&gt;&lt;/a&gt;Data Assetåˆè§&lt;/h1&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="CocoaPods" scheme="http://dreampiggy.com/tags/CocoaPods/"/>
    
  </entry>
  
  <entry>
    <title>iOSç«¯çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆæ±‡æ€»ï¼ˆSVGç¯‡ï¼‰</title>
    <link href="http://dreampiggy.com/2020/03/30/iOS%E7%AB%AF%E7%9F%A2%E9%87%8F%E5%9B%BE%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%B1%87%E6%80%BB%EF%BC%88SVG%E7%AF%87%EF%BC%89/"/>
    <id>http://dreampiggy.com/2020/03/30/iOS%E7%AB%AF%E7%9F%A2%E9%87%8F%E5%9B%BE%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%B1%87%E6%80%BB%EF%BC%88SVG%E7%AF%87%EF%BC%89/</id>
    <published>2020-03-30T19:01:33.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<h1 id="iOSç«¯çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆæ±‡æ€»ï¼ˆSVGç¯‡ï¼‰"><a href="#iOSç«¯çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆæ±‡æ€»ï¼ˆSVGç¯‡ï¼‰" class="headerlink" title="iOSç«¯çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆæ±‡æ€»ï¼ˆSVGç¯‡ï¼‰"></a>iOSç«¯çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆæ±‡æ€»ï¼ˆSVGç¯‡ï¼‰</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://en.wikipedia.org/wiki/Vector_graphics">çŸ¢é‡å›¾</a>ï¼ŒæŒ‡çš„æ˜¯é€šè¿‡ä¸€ç³»åˆ—æ•°å­¦æè¿°ï¼Œèƒ½å¤Ÿè¿›è¡Œæ— æŸçº§åˆ«çš„å˜åŒ–å’Œç¼©æ”¾çš„ä¸€ç§å›¾åƒã€‚ç›¸æ¯”äºæ ‡é‡å›¾ï¼ˆå¦‚JPEGç­‰æ ‡é‡å›¾å‹ç¼©æ ¼å¼ï¼‰ï¼Œèƒ½å¤Ÿåœ¨ç»˜åˆ¶æ—¶è¿›è¡Œä»»æ„å¤§å°ä¼¸ç¼©è€Œä¸äº§ç”Ÿæ¨¡ç³Šï¼Œç”šè‡³èƒ½å¤Ÿå®ç°åŠ¨æ€ç€è‰²ï¼ŒåŠ¨ç”»ç­‰ç­‰ä¸€ç³»åˆ—äº¤äº’ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2020/03/30/intro_raster_to_vector.png" alt="intro_raster_to_vecto"></p><p>åœ¨å½“ä»Šç§»åŠ¨ç«¯è®¾å¤‡å°ºå¯¸è¶Šæ¥è¶Šå¤æ‚ï¼Œå„ç§æ“ä½œç³»ç»Ÿçº§åˆ«çš„å¤œé—´ä¸»é¢˜ï¼ˆæˆ–è€…Dark Modeï¼‰è¶Šæ¥è¶Šæå€¡çš„åœºæ™¯ä¸‹ï¼Œå¦‚æœä¾æ—§ä½¿ç”¨æ ‡é‡å›¾ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹ä¸åŒçš„å±å¹•å¤§å°ï¼ˆå¦‚2xï¼Œ3xï¼‰ï¼Œå’Œå¯¹åº”ä¸»é¢˜åœºæ™¯ï¼ˆLight/Darkï¼‰ï¼Œæä¾›NxMæ•°é‡çº§çš„æ ‡é‡å›¾ï¼Œå¯¹äºAppå¤§å°å¼€é”€æ˜¯å¾ˆå¤§çš„ã€‚å› æ­¤ï¼Œä½¿ç”¨çŸ¢é‡å›¾æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚è¿™ä¸ªç³»åˆ—æ–‡ç« ï¼Œå°±æ˜¯ä¸»è¦ä¾§é‡è®²è§£iOSç«¯ä¸Šçš„çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆã€‚</p><p>ç¬¬ä¸€ç« æ˜¯å…³äº<a href="https://en.wikipedia.org/wiki/Scalable_Vector_Graphics">SVG</a>åŠå…¶ç›¸åº”è¡ç”Ÿæ–¹æ¡ˆçš„è§£å†³æ–¹æ¡ˆï¼Œåç»­ä¼šæœ‰å…¶ä»–çŸ¢é‡å›¾ç›¸å…³çš„PDFç« èŠ‚ï¼ŒLottieç­‰ã€‚ä»–ä»¬å„è‡ªæœ‰ä¸åŒçš„ç»†èŠ‚åœºæ™¯åŒºåˆ†å’Œä¼˜ç¼ºç‚¹ã€‚</p><p>SVGä½œä¸ºç›®å‰åœ¨Webä¸Šæœ€æµè¡Œçš„çŸ¢é‡æ ¼å¼ï¼Œåœ¨iOSç«¯çš„æ”¯æŒå¯ä»¥è¯´æ˜¯ä¸€è¨€éš¾å°½ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»å„ä¸ªæ–¹å‘ä¸Šæ€»ç»“äº†æˆªè‡³ç›®å‰å·²æœ‰çš„å®ç°ï¼ˆå…¬å¼€çš„æ–¹æ¡ˆï¼Œä¼ä¸šå†…éƒ¨å®ç°æ— ä»å¾—çŸ¥ï¼‰ï¼Œæ–¹ä¾¿å¯¹æ¯”é€‰æ‹©æœ€é€‚åˆè‡ªå·±åœºæ™¯çš„é€‰æ‹©ã€‚</p><h2 id="Symbol-Image"><a href="#Symbol-Image" class="headerlink" title="Symbol Image"></a>Symbol Image</h2><p><a href="https://developer.apple.com/videos/play/wwdc2019/206/">Symbol Image</a>ï¼Œæ˜¯Appleåœ¨WWDC 2019å’ŒiOS 13ä¸Šæä¾›çš„çŸ¢é‡å›¾è§£ææ–¹æ¡ˆã€‚</p><p>ä¹‹æ‰€ä»¥åç§°å«åšSymbol Imageï¼Œæºè‡ªäºè¿™ä¸ªæŠ€æœ¯æ–¹æ¡ˆçš„å®ç°ç»†èŠ‚ï¼Œå®ƒæœ€æ—©è¯ç”ŸäºSVGå­—ä½“è§„èŒƒï¼š<a href="https://helpx.adobe.com/fonts/using/ot-svg-color-fonts.html">OpenType-SVG</a>ã€‚è¿™ä¸ªè§„èŒƒæ˜¯Adobeæå‡ºçš„ï¼Œå¹¶ä¸”å¾—åˆ°äº†åŒ…æ‹¬Microsoftåœ¨å†…çš„å¤šå®¶å…¬å¸æ”¯æŒã€‚Appleè‡ªå·±çš„CoreTextå­—ä½“æ¡†æ¶ï¼Œå…¶å®æ—©æ—©å°±åœ¨<a href="https://developer.apple.com/documentation/coretext/1524658-anonymous/kctfonttablesvg?language=objc">iOS 11æ—¶ä»£</a>å†…éƒ¨æ”¯æŒäº†SVGç±»å‹çš„font tableã€‚</p><h3 id="åˆ¶ä½œSymbol-Image"><a href="#åˆ¶ä½œSymbol-Image" class="headerlink" title="åˆ¶ä½œSymbol Image"></a>åˆ¶ä½œSymbol Image</h3><p>Symbol Imageçš„æ•´ä½“APIè®¾è®¡ï¼Œå…¶å®ä¸åƒæ˜¯å›¾åƒï¼Œæ›´åƒæ˜¯ä¸€ç§å­—ä½“ï¼ˆå’ŒIcon Fontç±»ä¼¼ï¼‰ã€‚</p><p>å¯¹äºåŒä¸€ä¸ªSymbol Imageï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªSVG Pathçš„é›†åˆã€‚å‰é¢æåˆ°ï¼ŒSymbol ImageåŸºäºOpenType-SVGå­—ä½“ï¼Œå¯¹äºå­—ä½“æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å­—é‡çš„æ¦‚å¿µï¼Œç”¨æ¥å†³å®šæ¸²æŸ“æ—¶å€™çš„çº¿æ¡ç²—ç»†ç¨‹åº¦ã€‚</p><p>å› æ­¤Symbol Imageä¹Ÿæœ‰9ä¸ªå­—é‡ï¼šUltralightï¼ŒThinï¼ŒLightï¼ŒRegularï¼ŒMediumï¼ŒSemiboldï¼ŒBoldï¼ŒHeavyï¼ŒBlackã€‚ä¸æ­¤åŒæ—¶ï¼ŒSymbol Imageå¯¹æ¯ä¸€ä¸ªå­—é‡ï¼Œæ”¯æŒäº†3ç§å¤§å°ï¼Œåˆ†åˆ«æ˜¯Smallï¼ŒMediumå’ŒLargeã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªSymbol Imageæœ€å¤šå¯ä»¥æœ‰27ç§å¤§å°å­—é‡çš„æ ·å¼é€‰æ‹©ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œä»å¤´æ„å»ºä¸€ä¸ªSymbol Imageä¼šéå¸¸å¤æ‚ï¼ŒAppleæ¨èçš„æ–¹å¼ï¼Œæ˜¯é€šè¿‡ä½¿ç”¨<a href="https://developer.apple.com/design/human-interface-guidelines/sf-symbols/overview/">SF Symbols App</a>ï¼Œæ¥å¯¼å‡ºä¸€ä¸ªSVGæ¨¡ç‰ˆï¼Œå†é€šè¿‡Sketchæ¥è¿›è¡Œå›¾å±‚ç¼–è¾‘ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2020/03/30/Sketch2.png" alt="Sketch2"></p><p>ä»åŸå§‹çš„SVGæ•°æ®æ¥çœ‹ï¼Œæ¯ä¸€ä¸ªSymbol ImageåŒ…å«çš„æ‰€æœ‰æ ·å¼éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„PathèŠ‚ç‚¹ï¼Œå¯¹åº”äº†å›¾æ ‡çš„ç»˜åˆ¶ã€‚å¦‚æœè¦æ–°å»ºä¸€ä¸ªSymbol Imageï¼Œéœ€è¦å®Œå…¨åˆ é™¤PathèŠ‚ç‚¹ï¼Œé‡æ–°ç»˜åˆ¶çŸ¢é‡è·¯å¾„ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">xmlns:xlink</span>=<span class="string">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="attr">width</span>=<span class="string">&quot;3300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;2200&quot;</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--glyph: &quot;uni100665.medium&quot;, point size: 100.000000, font version: &quot;Version 15.0d7e11&quot;, template writer version: &quot;5&quot;--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">g</span> <span class="attr">id</span>=<span class="string">&quot;Notes&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">g</span> <span class="attr">id</span>=<span class="string">&quot;Guides&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">g</span> <span class="attr">id</span>=<span class="string">&quot;H-reference&quot;</span> <span class="attr">style</span>=<span class="string">&quot;fill:#27AAE1;stroke:none;&quot;</span> <span class="attr">transform</span>=<span class="string">&quot;matrix(1 0 0 1 339 696)&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M 54.9316 0 L 57.666 0 L 30.5664 -70.459 L 28.0762 -70.459 L 0.976562 0 L 3.66211 0 L 12.9395 -24.4629 L 45.7031 -24.4629 Z M 29.1992 -67.0898 L 29.4434 -67.0898 L 44.8242 -26.709 L 13.8184 -26.709 Z&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">g</span> <span class="attr">id</span>=<span class="string">&quot;Symbols&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">g</span> <span class="attr">id</span>=<span class="string">&quot;Medium-M&quot;</span> <span class="attr">transform</span>=<span class="string">&quot;matrix(1 0 0 1 1682.22 1126)&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M 64.3555 -18.6035 C 67.8223 -18.6035 69.9219 -20.752 70.0195 -24.3164 C 70.166 -40.2832 70.5078 -59.7656 70.6543 -75.1953 C 70.6543 -78.7598 67.9688 -81.3477 64.3555 -81.3477 C 60.6934 -81.3477 58.0078 -78.7598 58.0078 -75.1953 C 58.1543 -59.7656 58.4961 -40.2832 58.6914 -24.3164 C 58.7891 -20.752 60.8887 -18.6035 64.3555 -18.6035 Z M 17.1875 -41.0645 C 18.1641 -40.0391 19.7266 -40.0879 20.7031 -41.1621 C 29.2969 -50.2441 39.9414 -56.0547 51.8066 -58.3984 L 51.6113 -73.3398 C 34.8145 -70.4102 19.5801 -61.7676 10.498 -50.7812 C 9.76562 -49.9023 9.76562 -48.6816 10.6445 -47.7539 Z M 108.057 -41.1133 C 108.984 -40.1367 110.498 -40.1367 111.523 -41.2109 L 117.969 -47.7539 C 118.896 -48.6816 118.896 -49.9023 118.164 -50.7812 C 108.984 -61.6699 93.7988 -70.3613 77.0508 -73.291 L 76.9043 -58.3496 C 88.7695 -56.0059 99.3164 -50.0488 108.057 -41.1133 Z M 36.6699 -21.5332 C 37.793 -20.4102 39.2578 -20.5078 40.2832 -21.7285 C 43.457 -25.1465 47.7051 -28.0273 52.3926 -29.7852 L 51.9531 -45.4102 C 42.4805 -43.0664 34.375 -37.9883 29.1992 -31.8359 C 28.3691 -30.8594 28.4668 -29.6875 29.3457 -28.8086 Z M 88.5254 -21.5332 C 89.5508 -20.459 90.8691 -20.5078 91.9922 -21.582 L 99.2676 -28.8086 C 100.195 -29.6875 100.293 -30.8594 99.4629 -31.8359 C 94.2871 -37.9395 86.1816 -43.0176 76.709 -45.4102 L 76.3184 -29.6875 C 81.0547 -27.8809 85.3516 -24.9512 88.5254 -21.5332 Z M 64.3555 6.25 C 69.043 6.25 72.8516 2.53906 72.8516 -2.09961 C 72.8516 -6.73828 69.043 -10.4492 64.3555 -10.4492 C 59.668 -10.4492 55.8105 -6.73828 55.8105 -2.09961 C 55.8105 2.53906 59.668 6.25 64.3555 6.25 Z&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¯¼å…¥Symbol-Image"><a href="#å¯¼å…¥Symbol-Image" class="headerlink" title="å¯¼å…¥Symbol Image"></a>å¯¼å…¥Symbol Image</h3><p>å¯¼å…¥Symbol Imageçš„æ–¹å¼éå¸¸ç®€å•ï¼Œä½ åªéœ€è¦å°†åˆ¶ä½œå¥½çš„Symbol Imageï¼Œå‘Xcodeçš„Asset Catalogçª—å£æ‹–åŠ¨ï¼Œå°±å¯ä»¥é›†æˆã€‚Xcodeå¯ä»¥ä¼šå±•ç¤ºå¯¹åº”çš„é¢„è§ˆæ•ˆæœã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2020/03/30/%E6%88%AA%E5%B1%8F2020-03-30%E4%B8%8B%E5%8D%886.08.56.png" alt="æˆªå±2020-03-30ä¸‹åˆ6.08.56"></p><p>å¦å¤–ï¼Œå®é™…ä¸Šäº§ç”Ÿçš„æ–‡ä»¶å¤¹åç¼€ä¸º<code>.symbolset</code>ï¼Œè¿™ä¸ªä¸åŒäºæ™®é€šçš„Asset Imageï¼ˆåç¼€å<code>.imageset</code>ï¼‰ï¼Œä¹Ÿå°±æ„å‘³ç€ä½ å¯ä»¥åŒæ—¶å¼•å…¥ä¸€ä¸ªåŒåçš„Symbol Imageå’Œæ™®é€šImageã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2020/03/30/%E6%88%AA%E5%B1%8F2020-03-30%E4%B8%8B%E5%8D%886.09.18.png" alt="æˆªå±2020-03-30ä¸‹åˆ6.09.18"></p><h3 id="ä½¿ç”¨Symbol-Image"><a href="#ä½¿ç”¨Symbol-Image" class="headerlink" title="ä½¿ç”¨Symbol Image"></a>ä½¿ç”¨Symbol Image</h3><p>å¯¹äºiOS 13ç³»ç»Ÿæä¾›çš„è‡ªå¸¦Symbol Imageï¼ŒUIKitæä¾›äº†<a href="https://developer.apple.com/documentation/uikit/uiimage/3294233-init">init(systemName:)</a>æ–¹æ³•æ¥è·å–ï¼Œå¯¹äºAppè‡ªè¡Œæä¾›çš„Symbol Imageï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://developer.apple.com/documentation/uikit/uiimage/1624146-init">init(named:)</a>æ–¹æ³•ã€‚</p><p>æ³¨æ„ï¼Œä½ å¯ä»¥åŒæ—¶åŒ…å«ä¸€ä¸ªSymbol Imageå’Œæ™®é€šçš„Asset Imageï¼Œå…±äº«ä¸€ä¸ªNameã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„ï¼Œåœ¨WWDCä¸Šæœ‰ä»‹ç»ï¼Œæ˜¯ä¸ºäº†å…¼å®¹iOS 12ç­‰ä½ç³»ç»Ÿç‰ˆæœ¬ï¼Œåœ¨iOS 13ä¸Šï¼ŒSymbol Imageä¼˜å…ˆçº§æ°¸è¿œé«˜äºæ™®é€šAsset Imageï¼Œåœ¨iOS 12ä¼šè‡ªåŠ¨fallbackã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> imageView <span class="operator">=</span> <span class="type">UIImageView</span>()</span><br><span class="line"><span class="keyword">let</span> symbolImage <span class="operator">=</span> <span class="type">UIImage</span>(named: <span class="string">&quot;my.symbol.image&quot;</span>)</span><br><span class="line"><span class="comment">// é»˜è®¤é…ç½®ä¸‹ï¼Œè¿™ä¸ªsymbol imageæ˜¯templateçš„ï¼Œæ„å‘³ç€ä»–ä¸ä¼šå«æœ‰é¢œè‰²ï¼Œé¢œè‰²ç”±UIViewçº§åˆ«tintColorå†³å®š</span></span><br><span class="line">imageView.image <span class="operator">=</span> symbolImage</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœç¡®å®šè¦è·å–ç³»ç»ŸSymbol Image</span></span><br><span class="line"><span class="keyword">let</span> systemSymbolImage <span class="operator">=</span> <span class="type">UIImage</span>(systemName: <span class="string">&quot;wifi.exclamationmark&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœè¦æŒ‡å®šé¢œè‰²</span></span><br><span class="line"><span class="keyword">let</span> redSymbolImage <span class="operator">=</span> symbolImage.withTintColor(.red, renderingMode: .alwaysOrigin)</span><br><span class="line">imageView.image <span class="operator">=</span> redSymbolImage</span><br></pre></td></tr></table></figure><p>å¯¹äºSymbol Imageæ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šåœ¨è¿è¡Œæ—¶éœ€è¦çš„å­—é‡</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> regularSymbolImage <span class="operator">=</span> <span class="type">UIImage</span>(named: <span class="string">&quot;my.symbol.image&quot;</span>)</span><br><span class="line"><span class="comment">// æŒ‡å®šä½ æƒ³è¦çš„å­—å·ï¼Œå­—é‡ï¼Œè¿™é‡Œæ˜¯18å·ï¼ŒBold å­—é‡ï¼ŒLarge å¤§å°</span></span><br><span class="line"><span class="keyword">let</span> symbolConfiguration <span class="operator">=</span> <span class="type">UImage</span>.<span class="type">SymbolConfiguration</span>(pointSize: <span class="number">18</span>, weight: .large, scale: .large)</span><br><span class="line"><span class="keyword">let</span> boldSymbolImage <span class="operator">=</span> regularSymbolImage.applyingSymbolConfiguration(symbolConfiguration)</span><br><span class="line">imageView.image <span class="operator">=</span> boldSymbolImage</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é…åˆAttributedStringä½¿ç”¨ï¼Œåªè¦ä½¿ç”¨TextAttachmentä¼ å…¥å¯¹åº”çš„Symbol Imageå³å¯ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> textView <span class="operator">=</span> <span class="type">UITextView</span>()</span><br><span class="line"><span class="comment">// å¯ä»¥å¾®è°ƒSymbol Imageä¸æ–‡å­—çš„å¯¹é½</span></span><br><span class="line"><span class="keyword">let</span> baselineSymbolImage <span class="operator">=</span> symbolImage.withBaselineOffset(fromBottom: <span class="number">1.0</span>)</span><br><span class="line"><span class="keyword">let</span> imageAttachment <span class="operator">=</span> <span class="type">NSTextAttachment</span>(image: baselineSymbolImage)</span><br><span class="line"><span class="keyword">let</span> imageString <span class="operator">=</span> <span class="type">NSAttributedString</span>(attachment: imageAttachment)</span><br><span class="line">textView.attributedText <span class="operator">=</span> imageString</span><br></pre></td></tr></table></figure><h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š</p><ul><li>iOSåŸç”Ÿæ”¯æŒï¼Œå·¥å…·é“¾å®Œå–„</li><li>SwiftUIåŸç”Ÿæ”¯æŒï¼Œæˆªæ­¢ç›®å‰Imageèƒ½å”¯ä¸€ä½¿ç”¨çš„çŸ¢é‡æ–¹æ¡ˆï¼ˆæ’é™¤UIViewRepresentableï¼‰</li><li>æ”¯æŒå’ŒAttributedStringæ— ç¼æ··åˆï¼Œç±»ä¼¼Icon Font</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>iOS 13+ Only</li><li>é€šè¿‡å­—ä½“å±æ€§æ§åˆ¶å¤§å°ï¼Œå–å†³äºUIåœºæ™¯ï¼Œåšåˆ°Pixelçº§åˆ«çš„æ‹‰ä¼¸ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜</li><li>éœ€è¦å•ç‹¬åˆ¶ä½œSymbol Imageï¼Œè·¨å¹³å°ï¼ŒWebä½¿ç”¨ç—›ç‚¹</li></ul><h2 id="CoreSVG"><a href="#CoreSVG" class="headerlink" title="CoreSVG"></a>CoreSVG</h2><p>CoreSVGæ˜¯iOS 13æ”¯æŒSymbol Imageçš„èƒŒåçš„åº•å±‚SVGæ¸²æŸ“å¼•æ“ï¼Œä½¿ç”¨C++ç¼–å†™ã€‚</p><p>æˆªè‡³ç›®å‰ï¼ŒCoreSVGä¾ç„¶å±äºPrivate Frameworkï¼Œç¤¾åŒºä¹Ÿæœ‰å¾ˆå¤šäººå‘Appleæäº†åé¦ˆå¹¶å»ºè®®å¼€æ”¾å‡ºæ¥ï¼Œå¯èƒ½åœ¨ä¹‹åçš„WWDC 2020æˆ‘ä»¬èƒ½å¤Ÿå¾—çŸ¥æ›´å¤šçš„æ¶ˆæ¯ã€‚</p><p>æ³¨æ„ï¼ä»¥ä¸‹æ–¹æ³•å‡ä¸ºä½¿ç”¨äº†CoreSVGçš„Private APIï¼Œå¯èƒ½éšç€æ“ä½œç³»ç»Ÿå˜åŠ¨ä¼šæœ‰æ”¹å˜ï¼Œå¹¶ä¸”æœ‰å®¡æ ¸é£é™©ï¼Œå¦‚æœéœ€è¦çº¿ä¸Šä½¿ç”¨ï¼Œè¯·è‡ªè¡Œè¿›è¡Œä»£ç æ··æ·†ç­‰æ–¹æ¡ˆã€‚</p><h3 id="é€šè¿‡Asset-Catalogä½¿ç”¨SVG"><a href="#é€šè¿‡Asset-Catalogä½¿ç”¨SVG" class="headerlink" title="é€šè¿‡Asset Catalogä½¿ç”¨SVG"></a>é€šè¿‡Asset Catalogä½¿ç”¨SVG</h3><p>ç›®å‰Xcodeä¸æ”¯æŒç›´æ¥æ‹–åŠ¨SVGæ–‡ä»¶æ¥é›†æˆåˆ°Asset Catalogï¼Œå› ä¸ºæ‹–åŠ¨SVGé»˜è®¤ä¼šå½“ä½œSymbol Imageå¤„ç†ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªå–å·§çš„æ–¹å¼æ¥å®ç°ï¼ŒXcodeæ”¯æŒPDFçŸ¢é‡å›¾ï¼ˆä»iOS 11ä¸Xcode 9å¼€å§‹æ”¯æŒï¼ŒPDFç« ä¼šè®²è§£ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†SVGåç¼€æ”¹æˆPDFï¼Œç„¶åæ‹–åŠ¨åˆ°Xcodeä¸­ï¼Œæœ€åå†ä¿®æ”¹å›SVGåç¼€åï¼Œå¹¶ä¸”åŒæ­¥<code>.imageset/Contents.json</code>é‡Œé¢çš„æ–‡ä»¶åå³å¯ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/2020/03/30/EUR_hKSUwAA1-65.png" alt="EUR_hKSUwAA1-65"></p><p>å½“ä½ æ·»åŠ å¥½SVGå›¾åƒåï¼Œå¯ä»¥é€šè¿‡Nameï¼Œä»¥å’ŒPDFçŸ¢é‡å›¾ä¸€æ ·çš„æ–¹å¼æ¥å¼•å…¥å’Œä½¿ç”¨ï¼Œå¦‚ä¸‹</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImageView</span> *imageView = [<span class="built_in">UIImageView</span> new];</span><br><span class="line"><span class="built_in">UIImage</span> *svgImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@&quot;my_svg&quot;</span>];</span><br><span class="line">imageView.image = svgImage;</span><br><span class="line"><span class="comment">// ç„¶åæˆ‘ä»¬å¯ä»¥è‡ªç”±ç¼©æ”¾ImageViewçš„å¤§å°ï¼Œä¼šè‡ªåŠ¨è§¦å‘çŸ¢é‡ç»˜åˆ¶</span></span><br><span class="line">imageView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1000</span>, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>ä»è¿è¡Œæ—¶æ¥çœ‹ï¼ŒåŠ å…¥Asset Catalogçš„SVGçŸ¢é‡å›¾çš„UIImageï¼Œå«æœ‰å¯¹åº”çš„CGSVGDocumentRefå¯¹è±¡ï¼Œå¹¶ä¸”ä¹ŸåŒ…å«äº†ä¸€ä¸ªæ ‡é‡å›¾çš„ç¼©ç•¥å›¾ï¼Œå¯ä»¥ä¾›ç¼©ç•¥å›¾æˆ–è€…å…¶ä»–ç³»ç»ŸAPIæ¥è°ƒç”¨ã€‚å¹¶ä¸”åœ¨Xcodeçš„Interface Builderä¸Šä¹Ÿä¼šæœ‰æ˜æ˜¾çš„SVGæ ‡è¯†ï¼ˆç±»ä¼¼PDFï¼‰</p><p><img src="http://dreampiggy-image.test.upcdn.net/2020/03/30/EUU_DLPU8AM5KHD.jpeg" alt="EUU_DLPU8AM5KHD"></p><h3 id="åŠ è½½ä»»æ„SVGæ•°æ®ï¼ˆç½‘ç»œï¼‰"><a href="#åŠ è½½ä»»æ„SVGæ•°æ®ï¼ˆç½‘ç»œï¼‰" class="headerlink" title="åŠ è½½ä»»æ„SVGæ•°æ®ï¼ˆç½‘ç»œï¼‰"></a>åŠ è½½ä»»æ„SVGæ•°æ®ï¼ˆç½‘ç»œï¼‰</h3><p>é™¤äº†èƒ½å¤Ÿé€šè¿‡Asset Catalogæ·»åŠ SVGå›¾åƒï¼Œé€šè¿‡CoreSVGï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶å»è§£æç½‘ç»œæ•°æ®ä¸‹è½½å¾—åˆ°çš„SVGæ•°æ®ï¼Œä¸ºæ­¤èƒ½æä¾›æ›´ä¸ºå¹¿é˜”çš„åº”ç”¨åœºæ™¯ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImageView</span> *imageView = [<span class="built_in">UIImageView</span> new];</span><br><span class="line"><span class="built_in">NSData</span> *data;</span><br><span class="line"><span class="built_in">CGSVGDocumentRef</span> document = <span class="built_in">CGSVGDocumentCreateFromData</span>((__bridge <span class="built_in">CFDataRef</span>)data, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">UIImage</span> *svgImage = [<span class="built_in">UIImage</span> _imageWithCGSVGDocument:document];</span><br><span class="line">imageView.image = svgImage;</span><br></pre></td></tr></table></figure><h3 id="æ¸²æŸ“SVGçŸ¢é‡å›¾åˆ°æ ‡é‡å›¾"><a href="#æ¸²æŸ“SVGçŸ¢é‡å›¾åˆ°æ ‡é‡å›¾" class="headerlink" title="æ¸²æŸ“SVGçŸ¢é‡å›¾åˆ°æ ‡é‡å›¾"></a>æ¸²æŸ“SVGçŸ¢é‡å›¾åˆ°æ ‡é‡å›¾</h3><p>ä¸€äº›UIKitçš„è§†å›¾ï¼Œæˆ–è€…ä¸€äº›å›¾åƒå¤„ç†ï¼Œå¯¹çŸ¢é‡å›¾æ”¯æŒå¹¶æ²¡æœ‰è€ƒè™‘ï¼Œæˆ–è€…æ˜¯æˆ‘ä»¬åœ¨åšæ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œéœ€è¦å°†çŸ¢é‡å›¾å…‰æ …åŒ–å¾—åˆ°å¯¹åº”çš„æ ‡é‡å›¾ã€‚CoreSVGæä¾›äº†å’ŒCoreGraphicsçš„PDFç±»ä¼¼çš„æ¥å£ï¼Œå…è®¸ä½ å»ç»˜åˆ¶å¾—åˆ°å¯¹åº”çš„æ ‡é‡å›¾ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGSVGDocumentRef</span> document; <span class="comment">// åŸå§‹SVG Document</span></span><br><span class="line"><span class="built_in">CGSize</span> targetSize; <span class="comment">// æŒ‡å®šæ ‡é‡å›¾å¤§å°</span></span><br><span class="line"><span class="type">BOOL</span> preserveAspectRatio; <span class="comment">// æ˜¯å¦ä¿æŒå®½é«˜æ¯”</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–SVGçš„canvaså¤§å°ï¼Œæœ¬è´¨ä¸Šæ˜¯æŒ‰ç…§SVGè§„èŒƒï¼Œå°†viewPortå’ŒviewBoxè®¡ç®—å¾—å‡ºçš„</span></span><br><span class="line"><span class="built_in">CGSize</span> size = <span class="built_in">CGSVGDocumentGetCanvasSize</span>(document);</span><br><span class="line"><span class="comment">// è®¡ç®—Transform</span></span><br><span class="line"><span class="built_in">CGFloat</span> xRatio = targetSize.width / size.width;</span><br><span class="line"><span class="built_in">CGFloat</span> yRatio = targetSize.height / size.height;</span><br><span class="line"><span class="built_in">CGFloat</span> xScale = preserveAspectRatio ? MIN(xRatio, yRatio) : xRatio;</span><br><span class="line"><span class="built_in">CGFloat</span> yScale = preserveAspectRatio ? MIN(xRatio, yRatio) : yRatio;</span><br><span class="line">    </span><br><span class="line"><span class="built_in">CGAffineTransform</span> scaleTransform = <span class="built_in">CGAffineTransformMakeScale</span>(xScale, yScale);</span><br><span class="line"><span class="built_in">CGSize</span> scaledSize = <span class="built_in">CGSizeApplyAffineTransform</span>(size, scaleTransform);</span><br><span class="line"><span class="built_in">CGAffineTransform</span> translationTransform = <span class="built_in">CGAffineTransformMakeTranslation</span>(targetSize.width / <span class="number">2</span> - scaledSize.width / <span class="number">2</span>, targetSize.height / <span class="number">2</span> - scaledSize.height / <span class="number">2</span>);</span><br><span class="line"><span class="comment">// å¼€å§‹CGContextç»˜åˆ¶</span></span><br><span class="line"><span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(targetSize, <span class="literal">NO</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line"><span class="comment">// UIKitåæ ‡ç³»å’ŒCGåæ ‡ç³»è½¬æ¢</span></span><br><span class="line"><span class="built_in">CGContextTranslateCTM</span>(context, <span class="number">0</span>, targetSize.height);</span><br><span class="line"><span class="built_in">CGContextScaleCTM</span>(context, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line"><span class="comment">// åº”ç”¨Transform   </span></span><br><span class="line"><span class="built_in">CGContextConcatCTM</span>(context, translationTransform);</span><br><span class="line"><span class="built_in">CGContextConcatCTM</span>(context, scaleTransform);</span><br><span class="line"><span class="comment">// ç»˜åˆ¶SVG Document</span></span><br><span class="line"><span class="built_in">CGContextDrawSVGDocument</span>(context, document);</span><br><span class="line"><span class="comment">// è·å–æ ‡é‡å›¾</span></span><br><span class="line">image = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line"><span class="built_in">UIGraphicsEndImageContext</span>();</span><br></pre></td></tr></table></figure><h3 id="SVGå¯¼å‡º"><a href="#SVGå¯¼å‡º" class="headerlink" title="SVGå¯¼å‡º"></a>SVGå¯¼å‡º</h3><p>ç›®å‰ï¼ŒCoreSVGæ²¡æœ‰æä¾›ç±»ä¼¼äºPDFçš„ä¿®æ”¹å…ƒç´ çš„æ¥å£ï¼Œæˆ‘ä»¬åªèƒ½ç›´æ¥å¯¹SVGDocumentè¿›è¡Œå¯¼å‡ºã€‚æˆ–è®¸éšç€æœªæ¥æ¡†æ¶çš„å¼€æ”¾ï¼Œä¼šæœ‰ç±»ä¼¼äºç›®å‰CoreGraphicså¯¹PDFè¿›è¡Œç¼–è¾‘çš„é«˜çº§æ¥å£ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–SVG Document</span></span><br><span class="line"><span class="built_in">UIImage</span> *svgImage;</span><br><span class="line"><span class="built_in">CGSVGDocumentRef</span> document = [svgImage _CGSVGDocument];</span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="string">@&quot;/tmp/output.svg&quot;</span>];</span><br><span class="line"><span class="built_in">NSMutableData</span> *data = [<span class="built_in">NSMutableData</span> data];</span><br><span class="line"><span class="comment">// å¯¼å‡ºåˆ°Data</span></span><br><span class="line"><span class="built_in">CGSVGDocumentWriteToData</span>(document, (__bridge <span class="built_in">CFMutableDataRef</span>)data, <span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">// æˆ–è€…æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">CGSVGDocumentWriteToURL</span>(document, (__bridge <span class="built_in">CFURLRef</span>)url, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure><h3 id="ä¼˜ç¼ºç‚¹-1"><a href="#ä¼˜ç¼ºç‚¹-1" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹</p><ul><li>èƒ½å¤Ÿæ”¯æŒç›®å‰å·²æœ‰çš„å¤§é‡SVGï¼Œåœ¨Androidå’ŒWebç«¯å¤ç”¨</li><li>AppleåŸç”Ÿæ”¯æŒï¼Œç¨³å®šæ€§æœ‰ä¸€å®šä¿è¯ï¼Œå¹¶ä¸”éšç³»ç»Ÿå‡çº§ä¼šæŒç»­ä¼˜åŒ–</li><li>æ€§èƒ½é«˜ï¼ŒCoreSVGåˆ©ç”¨äº†CoreGraphicsç³»ç»Ÿåº“å’Œå†…éƒ¨çš„SPIåšçŸ¢é‡ç»˜åˆ¶ï¼Œç›®å‰æ€§èƒ½æœ€å¥½</li></ul><p>ç¼ºç‚¹</p><ul><li>ç›®å‰æ˜¯ç§æœ‰Frameworkï¼Œæœ‰å®¡æ ¸å’Œä½¿ç”¨é£é™©</li><li>å¯èƒ½å­˜åœ¨ä¸€äº›SVGå…ƒç´ å…¼å®¹é—®é¢˜ï¼Œéœ€è¦ä¸æ–­æ‘¸ç´¢</li><li>SwiftUIä¸æ”¯æŒï¼Œéœ€è¦ä½¿ç”¨UIViewRepresentable</li></ul><h2 id="ä¸‰æ–¹SVGåº“"><a href="#ä¸‰æ–¹SVGåº“" class="headerlink" title="ä¸‰æ–¹SVGåº“"></a>ä¸‰æ–¹SVGåº“</h2><h3 id="SVGKit"><a href="#SVGKit" class="headerlink" title="SVGKit"></a><a href="https://github.com/SVGKit/SVGKit">SVGKit</a></h3><p>SVGKitæ˜¯æœ€æ—©çš„iOSä¸Šå¼€æºSVGæ¸²æŸ“æ–¹æ¡ˆï¼Œå·²ç»æœ‰8å¹´ä¹‹ä¹…ã€‚SVGKitå†…éƒ¨æ”¯æŒä¸¤ç§æ¸²æŸ“æ¨¡å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡CPUæ¸²æŸ“ï¼ˆCoreGraphicsé‡ç»˜åˆ¶ï¼‰ï¼Œä¸€ç§æ˜¯é€šè¿‡GPUæ¸²æŸ“ï¼ˆCALayeræ ‘ç»„åˆï¼‰ã€‚æœ‰ç€ä¸åŒçš„å…¼å®¹æ€§å’Œæ€§èƒ½ã€‚</p><p>ç¤ºä¾‹</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CPUæ¸²æŸ“</span></span><br><span class="line">SVGKImageView *imageView = [SVGKFastImageView new];</span><br><span class="line"><span class="comment">// GPUæ¸²æŸ“</span></span><br><span class="line">imageView = [SVGKLayeredImageView new];</span><br><span class="line">SVGKImage *svgImage = [[SVGKImage alloc] initWithData:data];</span><br><span class="line">imageView.image = svgImage;</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹</p><ul><li>æ”¯æŒçº¯Objective-C</li><li>å¦‚æœæ˜¯æ”¯æŒçš„å›¾åƒï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒé«˜ï¼ˆ1000ä¸ªçº§åˆ«çš„Pathå¯åœ¨1ç§’å†…æ¸²æŸ“ï¼‰</li></ul><p>ç¼ºç‚¹</p><ul><li>ç¤¾åŒºä¸å†ç»´æŠ¤ï¼Œå¤§é‡Issueæ— äººè·Ÿè¿›è§£å†³</li><li>ä¸éµå¾ªè¯­ä¹‰ç‰ˆæœ¬å·ï¼Œç”¨åˆ†æ”¯å‘å¸ƒæ›´æ–°ï¼Œä¸‹æ¸¸æ— æ³•ä¾èµ–</li><li>éƒ¨åˆ†SVGç‰¹æ€§è™½ç„¶å£°æ˜æ”¯æŒï¼Œä½†å­˜åœ¨é—®é¢˜ï¼Œå¦‚Gradientç­‰ï¼Œç¼ºå°‘å•æµ‹</li><li>ä¸æ”¯æŒSVGåŠ¨ç”»</li></ul><h3 id="Macaw"><a href="#Macaw" class="headerlink" title="Macaw"></a><a href="https://github.com/exyte/Macaw">Macaw</a></h3><p>Macawæ˜¯ä¸€ä¸ªçŸ¢é‡ç»˜åˆ¶æ¡†æ¶ï¼Œæä¾›äº†éå¸¸ç®€å•çš„DSLè¯­æ³•æ¥æè¿°çŸ¢é‡è·¯å¾„ç»˜åˆ¶çš„åœºæ™¯ã€‚å®ƒæœ¬èº«ä¸æ˜¯å’ŒSVGå¼ºç»‘å®šçš„ï¼Œä½†æ˜¯å¯¹SVGæ ¼å¼æä¾›äº†å…¼å®¹å’Œæ”¯æŒ</p><p>ç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> node <span class="operator">=</span> <span class="keyword">try!</span> <span class="type">SVGParser</span>.parse(path: <span class="string">&quot;/path/to/svg&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> imageView <span class="operator">=</span> <span class="type">SVGView</span>()</span><br><span class="line">imageView.node <span class="operator">=</span> node</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹</p><ul><li>ç›®å‰æœ€æ´»è·ƒå’Œæˆç†Ÿçš„iOSç«¯SVGå¼€æºæ¡†æ¶ï¼ˆåœ¨GitHubä¸Šï¼‰</li><li>æ”¯æŒDSLå»ç›´æ¥ç”ŸæˆçŸ¢é‡å›¾ï¼Œä¿®æ”¹èŠ‚ç‚¹ç­‰ï¼Œéå¸¸å¼ºå¤§</li><li>æ”¯æŒSVGåŠ¨ç”»ï¼ˆéƒ¨åˆ†ç‰¹æ€§ï¼‰</li></ul><p>ç¼ºç‚¹</p><ul><li>éƒ¨åˆ†SVGç‰¹æ€§ç‰¹æ€§å£°æ˜ä¸æ”¯æŒ</li><li>SVGæ€§èƒ½æ¸²æŸ“å·®ï¼ˆç›¸å¯¹äºSVGKitï¼‰ï¼Œä¾èµ–å¤§é‡çš„çš„CPUç»˜åˆ¶æ“ä½œï¼ˆéCALayerç»„åˆï¼‰ï¼Œå¯èƒ½éœ€è¦ç»“åˆå¼‚æ­¥ç»˜åˆ¶æ¡†æ¶</li></ul><h3 id="SwiftSVG"><a href="#SwiftSVG" class="headerlink" title="SwiftSVG"></a><a href="https://github.com/mchoe/SwiftSVG">SwiftSVG</a></h3><p>SwiftSVGæ˜¯ä¸€ä¸ªä¸“é—¨é’ˆå¯¹SVG Pathç­‰å¸¸è§ç‰¹æ€§çš„çŸ¢é‡å›¾è§£ææ¡†æ¶ï¼Œä»–ä¸ä¾§é‡äºå®Œæ•´çš„SVG/1.1è§„èŒƒæ”¯æŒï¼Œè€Œæ˜¯ä¿è¯äº†åŸºæœ¬çš„ç»˜åˆ¶å®ç°çš„æ­£ç¡®æ€§ï¼Œå¹¶ä¸”æ”¯æŒå¯¼å‡ºSVGçš„Pathåˆ°UIBezierPath</p><p>ç¤ºä¾‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> svgURL <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://openclipart.org/download/181651/manhammock.svg&quot;</span>)<span class="operator">!</span></span><br><span class="line"><span class="keyword">let</span> hammock <span class="operator">=</span> <span class="type">UIView</span>(SVGURL: svgURL) &#123; (svgLayer) <span class="keyword">in</span></span><br><span class="line">    svgLayer.fillColor <span class="operator">=</span> <span class="type">UIColor</span>(red:<span class="number">0.52</span>, green:<span class="number">0.16</span>, blue:<span class="number">0.32</span>, alpha:<span class="number">1.00</span>).cgColor</span><br><span class="line">    svgLayer.resizeToFit(<span class="keyword">self</span>.view.bounds)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">self</span>.view.addSubview(hammock)</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹</p><ul><li>æ€§èƒ½ç›¸å¯¹MacPawè¾ƒå¥½</li><li>å¯¹Pathï¼ŒCircleç­‰å¸¸è§å…ƒç´ ï¼Œæœ‰ç€è‰¯å¥½çš„å…¼å®¹æ€§å’Œå®Œæ•´å•æµ‹ï¼ŒåŸºæœ¬ä¸Šåªç”¨è¿™äº›ç‰¹æ€§çš„SVGä¸å­˜åœ¨é—®é¢˜</li><li>æ”¯æŒå¯¼å‡ºUIBezierPathï¼Œå¯ä»¥ç”¨ä½œä¸€äº›æè¾¹çš„äº¤äº’</li><li>æä¾›äº†ä¾¿æºæ–¹æ³•ï¼Œèƒ½ç›´æ¥è¯»å–Xcodeçš„Data Assetï¼ŒURLç­‰</li></ul><p>ç¼ºç‚¹</p><ul><li>åŸºæœ¬ä¸Šåªé’ˆå¯¹Pathï¼ŒCircleç­‰å…ƒç´ æœ‰è‰¯å¥½çš„æ”¯æŒï¼Œå…¶ä»–çš„Gradientï¼ŒTextç­‰å‡ä¸æ”¯æŒ</li><li>ä¸æ”¯æŒSVGåŠ¨ç”»</li></ul><h2 id="VectorDrawable"><a href="#VectorDrawable" class="headerlink" title="VectorDrawable"></a>VectorDrawable</h2><p><a href="https://developer.android.com/guide/topics/graphics/vector-drawable-resources">VectorDrawable</a>æ˜¯Androidå¹³å°ä¸Šå®˜æ–¹æä¾›çš„ä¸€å¥—çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆï¼Œä»–æ˜¯ä»¥ä¸€ä¸ªç±»ä¼¼SVGçš„XMLè¡¨è¾¾å½¢å¼ï¼Œæ¥æè¿°çŸ¢é‡å›¾çš„ç»˜åˆ¶æ–¹å¼ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2020/03/30/%E6%88%AA%E5%B1%8F2020-03-30%E4%B8%8B%E5%8D%885.44.59.png" alt="æˆªå±2020-03-30ä¸‹åˆ5.44.59"></p><p>ä»æ•´ä½“è®¾è®¡ä¸Šçœ‹ï¼ŒVectorDrawableåŸºæœ¬ä¸Šæ˜¯å¯¹SVGçš„ç²¾ç®€å’ŒäºŒæ¬¡æ”¹é€ ï¼Œå¤§éƒ¨åˆ†çš„å…ƒç´ åœ¨SVGä¸­éƒ½æœ‰å¯¹åº”çš„æ¦‚å¿µï¼Œå¹¶ä¸”æ ·å¼å±æ€§ä¹Ÿä¸€ä¸€å¯¹åº”ã€‚ç”šè‡³ï¼ŒAndroid Studioæ”¯æŒç›´æ¥å°†SVGå¯¼å‡ºæˆVectorDrawableæ–‡ä»¶å¹¶ç›´æ¥é›†æˆã€‚</p><p>åœ¨iOSä¸Šå¹³å°ä¸Šï¼ŒUberå†…éƒ¨å¼€æºäº†ä¸€å¥—è‡ªå·±åœ¨ç”¨çš„VectorDrawableå®ç°ï¼š<a href="https://github.com/uber/cyborg">Cyborg</a>ï¼Œé€šè¿‡åˆ©ç”¨CoreGraphicså’ŒCoreAnimationæ¥æ¸²æŸ“VectorDrawableæ–‡ä»¶ã€‚</p><h3 id="ä½¿ç”¨VectorDrawableæ¸²æŸ“"><a href="#ä½¿ç”¨VectorDrawableæ¸²æŸ“" class="headerlink" title="ä½¿ç”¨VectorDrawableæ¸²æŸ“"></a>ä½¿ç”¨VectorDrawableæ¸²æŸ“</h3><p>VectorDrawableæä¾›äº†ä¸€ä¸ªä¸“é—¨ç”¨äºçŸ¢é‡å›¾çš„Viewï¼Œå¹¶ä¸”èƒ½å¤Ÿåˆ¶å®šå¯¹åº”çš„Themeï¼ˆThemeæ˜¯ç”¨æ¥æ”¯æŒä¸åŒèµ„æºçš„Dark Modeåˆ‡æ¢çš„ï¼‰ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BundleåŠ è½½</span></span><br><span class="line"><span class="keyword">let</span> vectorView <span class="operator">=</span> <span class="type">VectorView</span>(theme: myTheme)</span><br><span class="line">vectorView.drawable <span class="operator">=</span> <span class="type">VectorDrawable</span>.named(<span class="string">&quot;MyDrawable&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// DataåŠ è½½</span></span><br><span class="line">vectorView.drawable <span class="operator">=</span> <span class="type">VectorDrawable</span>.create(from: data)</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªä¸æ»¡è¶³ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡CALayeræ¥åšæ¸²æŸ“ï¼Œåšæ›´ä¸ºç»†è‡´çš„è°ƒèŠ‚ã€‚å¹¶ä¸”VectorDrawableä¹Ÿæä¾›äº†ä¸€äº›å®šåˆ¶é¡¹ï¼ˆå¦‚è®¾ç½®tintColorï¼‰</p><h3 id="ä¼˜ç¼ºç‚¹-2"><a href="#ä¼˜ç¼ºç‚¹-2" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹</p><ul><li>èƒ½å¤Ÿå’ŒAndroidç«¯å¤ç”¨ï¼Œå¹¶ä¸”ç”±äºå¯ç”±SVGç”Ÿæˆï¼Œæ„å‘³ç€Webç«¯ä¹Ÿå¯å¤ç”¨è®¾è®¡èµ„æº</li><li>æ€§èƒ½è‰¯å¥½ï¼Œæ— è®ºå®˜æ–¹è¿˜æ˜¯Exampleæµ‹è¯•ï¼Œé™¤å»CoreSVGå¤–éƒ½æ˜¯æœ€å¿«çš„æ¸²æŸ“é€Ÿåº¦</li></ul><p>ç¼ºç‚¹</p><ul><li>ç›®å‰iOSå®ç°ä¸æ”¯æŒåŠ¨ç”»ï¼ˆAnimatedVectorDrawableï¼‰</li><li>éƒ¨åˆ†SVGå®ç°VectorDrawableä¸æ”¯æŒï¼Œéœ€è¦è®¾è®¡èµ„æºä¿®æ”¹</li><li>Uberå†…éƒ¨å¼€æºï¼Œå¯èƒ½å­˜åœ¨æœªæ¥æŒç»­ç¤¾åŒºå»ºè®¾å’Œç»´æŠ¤æˆæœ¬ï¼Œéœ€è¦è¯„ä¼°</li></ul><h2 id="SVG-Native"><a href="#SVG-Native" class="headerlink" title="SVG-Native"></a>SVG-Native</h2><p><a href="https://svgwg.org/specs/svg-native/">SVG-Native</a>æ˜¯ç”±Adobeä¸»å¯¼æå‡ºçš„ä¸€ä¸ªW3Cè§„èŒƒï¼Œç›®å‰å¤„äºDraft Stageï¼Œä¸è¿‡ç”±äºAppleï¼ŒGoogleçš„èµåŒï¼Œå¤§æ¦‚ç‡ä¼šåœ¨2020å¹´å†…é€šè¿‡ï¼Œå¹¶ä¸”æ­£å¼è§„èŒƒå®šç¨¿ã€‚</p><p>SVG-NativeåŸºäºç›®å‰çš„SVG/1.1ç‰ˆæœ¬ï¼Œæ˜¯SVG/1.1çš„çœŸå­é›†ï¼ˆå³ä¸€ä¸ªSVG-Nativeå›¾ä¸€å®šå¯ä»¥è¢«æµè§ˆå™¨æ­£ç¡®æ¸²æŸ“ï¼‰ã€‚</p><p>æ³¨ï¼šæ›¾ç»W3Cæœ‰ä¸€ä¸ªSVG Tinyçš„è§„èŒƒï¼Œä½†æ˜¯å®ƒæ˜¯é’ˆå¯¹ç§»åŠ¨æµè§ˆå™¨åœºæ™¯çš„ï¼Œå’ŒSVG-Nativeè§£å†³çš„é—®é¢˜æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>å®ƒé’ˆå¯¹ç§»åŠ¨å¹³å°ï¼Œæ¡Œé¢å¹³å°ç­‰éæµè§ˆå™¨åœºæ™¯åšäº†é’ˆå¯¹æ€§å®šåˆ¶ï¼ŒåºŸå¼ƒäº†ä¸€äº›Nativeç«¯éå¸¸å›°éš¾å®ç°çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>scripting: ä¸ä¾èµ–JavaScriptç¯å¢ƒ</li><li>animations: ä¸æ”¯æŒåŠ¨ç”»</li><li>filters: ä¸æ”¯æŒæ»¤é•œï¼Œéƒ¨åˆ†æ•ˆæœï¼ˆå¦‚æ–‡å­—æ»¤é•œï¼‰ä¾èµ–å®ç°å¤æ‚</li><li>masks: ä¸æ”¯æŒè’™å±‚</li><li>patterns: ä¸æ”¯æŒä»¿åˆ¶å›¾ç« ï¼ŒColor Pattern</li><li>texts: ä¸å†…åµŒæ–‡å­—ï¼Œæ–‡å­—ä½¿ç”¨Pathç»˜åˆ¶</li><li>events: ç‚¹å‡»äº‹ä»¶ç­‰ï¼Œå› ä¸ºæ²¡æœ‰Scriptäº¤äº’è‡ªç„¶ä¸éœ€è¦</li><li>CSS3ï¼šCSS3æ˜¯ä¸€ä¸ªå®Œæ•´å¸ƒå±€ç³»ç»Ÿï¼Œå¤§é‡å±æ€§è¿œè¿œè¶…è¿‡SVGçš„åŠŸèƒ½ï¼Œå¦‚Flexboxï¼ŒMedia-Queryï¼Œéƒ½æ˜¯ä¸å¿…è¦çš„ï¼Œåªæœ‰åŸºæœ¬çš„æ¸²æŸ“å±æ€§</li></ul><p>å¯ä»¥çœ‹å‡ºï¼Œè¿™äº›å‰¥ç¦»çš„åŠŸèƒ½éƒ½æ˜¯å’Œæµè§ˆå™¨åœºæ™¯å®Œå…¨ç»‘å®šçš„ï¼Œä¸é€‚ç”¨äºé€šç”¨çš„Appå†…æ¸²æŸ“çŸ¢é‡å›¾çš„ç”¨é€”ã€‚SVG-Nativeæ›´é€‚åˆæ¡Œé¢/ç§»åŠ¨çš„Appï¼Œæ¸²æŸ“å™¨å®ç°ä¹Ÿä¼šç²¾ç®€å¾ˆå¤šï¼Œå®¹æ˜“å•å…ƒæµ‹è¯•ï¼Œå¹¶ä¸”å¯ä¾›æ“ä½œç³»ç»Ÿå†…åµŒé›†æˆã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>Adobeæä¾›äº†ä¸€ä¸ªç›®å‰Draftè§„èŒƒçš„æ¸²æŸ“å®ç°<a href="https://github.com/adobe/svg-native-viewer">SVG Native Viewer</a>ï¼Œç›®å‰æä¾›äº†å¤šç§æ¸²æŸ“å¼•æ“çš„æ¡¥æ¥ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ç†Ÿæ‚‰çš„CoreGraphicså’ŒSkiaã€‚</p><p>SVG-Nativeè§£ç å™¨ï¼Œèƒ½å¤Ÿä»¥æ ‡é‡å›¾çš„æ–¹å¼ï¼Œæ¸²æŸ“SVGåˆ°ä¸€ä¸ªæŒ‡å®šå¤§å°çš„CGContextä¸Šï¼Œæ€§èƒ½ç›®å‰çœ‹è¶³å¤Ÿå¿«ï¼ˆå’ŒCoreSVGå¯¹æ¯”ï¼‰ã€‚ç›®å‰ä¸€èˆ¬æ˜¯é€šè¿‡é‡å†™drawRectæ¥è®©Viewå¤§å°å˜åŒ–æ—¶è¿›è¡Œé‡ç»˜ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)drawRect:(<span class="built_in">NSRect</span>)dirtyRect &#123;</span><br><span class="line">    [<span class="variable language_">super</span> drawRect:dirtyRect];</span><br><span class="line">    </span><br><span class="line">    Document* d = [[[<span class="keyword">self</span> window] windowController] document];</span><br><span class="line">    SVGNative::SVGDocument* doc = [d getSVGDocument];</span><br><span class="line">    <span class="keyword">if</span> (!doc)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">NSGraphicsContext</span>* nsGraphicsContext = [<span class="built_in">NSGraphicsContext</span> currentContext];</span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = (<span class="built_in">CGContextRef</span>) [nsGraphicsContext <span class="built_in">CGContext</span>];</span><br><span class="line">    SVGNative::<span class="built_in">CGSVGRenderer</span>* renderer = static_cast&lt;SVGNative::<span class="built_in">CGSVGRenderer</span>*&gt;(doc-&gt;Renderer());</span><br><span class="line">    <span class="built_in">CGRect</span> r(dirtyRect);</span><br><span class="line">    <span class="built_in">CGAffineTransform</span> m = &#123;<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, r.size.height&#125;;</span><br><span class="line">    <span class="built_in">CGContextConcatCTM</span>(ctx, m);</span><br><span class="line">    renderer-&gt;SetGraphicsContext(ctx);</span><br><span class="line">    doc-&gt;Render(r.size.width, r.size.height);</span><br><span class="line">    renderer-&gt;ReleaseGraphicsContext();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¼˜ç¼ºç‚¹-3"><a href="#ä¼˜ç¼ºç‚¹-3" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹</p><ul><li>W3Cè§„èŒƒï¼Œå¯ä»¥ç¡®ä¿æœªæ¥è§„èŒƒçš„å‡†ç¡®æ€§ï¼Œå¹¶ä¸”æ“ä½œç³»ç»Ÿæä¾›å•†ï¼Œå¦‚Appleæ›´å®¹æ˜“é›†æˆ</li><li>SVG-Nativeæ˜¯SVG1.1çš„çœŸå­é›†ï¼Œæ„å‘³è€…å¯ä»¥å¤ç”¨åˆ°Webä¸Š</li><li>SVG-Nativeä¼šæ˜¯æœªæ¥çš„OpenType-SVGå®ç°ï¼Œæ„å‘³ç€Adobeå­—ä½“æˆ–è€…è®¾è®¡å¸ˆç¾¤ä½“æ›´å®¹æ˜“æ¥å—</li></ul><p>ç¼ºç‚¹</p><ul><li>SVG-Nativeæ˜¯SVGçœŸå­é›†ï¼Œæ„å‘³ç€ç›®å‰çš„SVGè®¾è®¡èµ„æºï¼Œéœ€è¦é€‚é…ä¿®æ”¹æ‰å¯æ”¯æŒ</li><li>æˆªè‡³ç›®å‰ï¼ŒSVG-Nativeä¾ç„¶å¤„äºDrafté˜¶æ®µï¼Œç¨³å®šï¼Œæ¨å¹¿æ™®åŠéœ€è¦è¾ƒé•¿æ—¶é—´</li><li>SVG-Nativeç›®å‰åªæœ‰Adobeçš„è§£æå™¨å®ç°ï¼Œéƒ¨åˆ†ç‰¹æ€§åœ¨CoreGraphicsä¸Šå·¥ä½œå¹¶ä¸è‰¯å¥½</li><li>ç›®å‰æ²¡æœ‰çœ‹åˆ°åŠ¨ç”»çš„æ”¯æŒ</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“ä¸€ä¸‹å…³äºSVGçš„ç›¸å…³è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥çœ‹å‡ºï¼Œæ²¡æœ‰ä¸€ç§Caseèƒ½å¤Ÿæ¶µç›–æ‰€æœ‰åœºæ™¯ï¼Œå½“ç„¶ï¼Œè¿™å’ŒAppleæœ¬èº«å¯¹çŸ¢é‡å›¾æ”¯æŒçš„å»ºè®¾æœ‰ä¸€å®šå…³ç³»ï¼Œå¤§éƒ¨åˆ†å»ºè®¾ä¾èµ–äºå¼€æºç¤¾åŒºã€‚å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹éœ€è¦æ ¹æ®è‡ªå·±å…·ä½“çš„å®é™…éœ€è¦æ¥é€‰æ‹©ï¼Œæ¯”å¦‚ï¼š</p><ul><li>åªè€ƒè™‘Pathï¼ŒCircleç­‰çŸ¢é‡è·¯å¾„ï¼šä½¿ç”¨SwiftSVGã€Macawå³å¯</li><li>è€ƒè™‘å’ŒAndroidå¤ç”¨ï¼šä½¿ç”¨VectorDrawable</li><li>ä¸è€ƒè™‘iOS 13ä»¥ä¸‹å…¼å®¹ï¼šä¼˜å…ˆç”¨Symbol Imageå’ŒCoreSVG</li><li>è€ƒè™‘SVGåŠ¨ç”»ï¼šMacaw</li><li>é¢å‘æœªæ¥ï¼šSVG-Native</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://swiftcafe.io/post/sf-symbol">è§£è¯» WWDC19 - SF Symbols å†…ç½®å›¾æ ‡åº“</a></li><li><a href="https://www.avanderlee.com/swift/sf-symbols-guide/">SF Symbols: The benefits and how to use them guide</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/SVG">SVG: Scalable Vector Graphics</a></li><li><a href="https://github.com/SDWebImage/SDWebImageSVGCoder">SDWebImageSVGCoder</a></li><li><a href="https://developer.android.com/guide/topics/graphics/vector-drawable-resources">Vector drawables overview</a></li><li><a href="https://eng.uber.com/cyborg/">Introducing Cyborg, an Open Source iOS Implementation of Android VectorDrawable</a></li><li><a href="https://helpx.adobe.com/fonts/using/ot-svg-color-fonts.html">OpenType-SVG color fonts</a></li><li><a href="https://medium.com/adobetech/svg-native-open-sourcing-svg-native-viewer-988125328a07">SVG Native: Open Sourcing SVG Native Viewer</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;iOSç«¯çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆæ±‡æ€»ï¼ˆSVGç¯‡ï¼‰&quot;&gt;&lt;a href=&quot;#iOSç«¯çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆæ±‡æ€»ï¼ˆSVGç¯‡ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;iOSç«¯çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆæ±‡æ€»ï¼ˆSVGç¯‡ï¼‰&quot;&gt;&lt;/a&gt;iOSç«¯çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆæ±‡æ€»ï¼ˆSVGç¯‡ï¼‰&lt;/h1&gt;&lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Vector_graphics&quot;&gt;çŸ¢é‡å›¾&lt;/a&gt;ï¼ŒæŒ‡çš„æ˜¯é€šè¿‡ä¸€ç³»åˆ—æ•°å­¦æè¿°ï¼Œèƒ½å¤Ÿè¿›è¡Œæ— æŸçº§åˆ«çš„å˜åŒ–å’Œç¼©æ”¾çš„ä¸€ç§å›¾åƒã€‚ç›¸æ¯”äºæ ‡é‡å›¾ï¼ˆå¦‚JPEGç­‰æ ‡é‡å›¾å‹ç¼©æ ¼å¼ï¼‰ï¼Œèƒ½å¤Ÿåœ¨ç»˜åˆ¶æ—¶è¿›è¡Œä»»æ„å¤§å°ä¼¸ç¼©è€Œä¸äº§ç”Ÿæ¨¡ç³Šï¼Œç”šè‡³èƒ½å¤Ÿå®ç°åŠ¨æ€ç€è‰²ï¼ŒåŠ¨ç”»ç­‰ç­‰ä¸€ç³»åˆ—äº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://dreampiggy-image.test.upcdn.net/2020/03/30/intro_raster_to_vector.png&quot; alt=&quot;intro_raster_to_vecto&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å½“ä»Šç§»åŠ¨ç«¯è®¾å¤‡å°ºå¯¸è¶Šæ¥è¶Šå¤æ‚ï¼Œå„ç§æ“ä½œç³»ç»Ÿçº§åˆ«çš„å¤œé—´ä¸»é¢˜ï¼ˆæˆ–è€…Dark Modeï¼‰è¶Šæ¥è¶Šæå€¡çš„åœºæ™¯ä¸‹ï¼Œå¦‚æœä¾æ—§ä½¿ç”¨æ ‡é‡å›¾ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹ä¸åŒçš„å±å¹•å¤§å°ï¼ˆå¦‚2xï¼Œ3xï¼‰ï¼Œå’Œå¯¹åº”ä¸»é¢˜åœºæ™¯ï¼ˆLight/Darkï¼‰ï¼Œæä¾›NxMæ•°é‡çº§çš„æ ‡é‡å›¾ï¼Œå¯¹äºAppå¤§å°å¼€é”€æ˜¯å¾ˆå¤§çš„ã€‚å› æ­¤ï¼Œä½¿ç”¨çŸ¢é‡å›¾æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚è¿™ä¸ªç³»åˆ—æ–‡ç« ï¼Œå°±æ˜¯ä¸»è¦ä¾§é‡è®²è§£iOSç«¯ä¸Šçš„çŸ¢é‡å›¾è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ç« æ˜¯å…³äº&lt;a href=&quot;https://en.wikipedia.org/wiki/Scalable_Vector_Graphics&quot;&gt;SVG&lt;/a&gt;åŠå…¶ç›¸åº”è¡ç”Ÿæ–¹æ¡ˆçš„è§£å†³æ–¹æ¡ˆï¼Œåç»­ä¼šæœ‰å…¶ä»–çŸ¢é‡å›¾ç›¸å…³çš„PDFç« èŠ‚ï¼ŒLottieç­‰ã€‚ä»–ä»¬å„è‡ªæœ‰ä¸åŒçš„ç»†èŠ‚åœºæ™¯åŒºåˆ†å’Œä¼˜ç¼ºç‚¹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="Swift" scheme="http://dreampiggy.com/tags/Swift/"/>
    
    <category term="Image" scheme="http://dreampiggy.com/tags/Image/"/>
    
    <category term="SVG" scheme="http://dreampiggy.com/tags/SVG/"/>
    
  </entry>
  
  <entry>
    <title>WatchKitæ¸²æŸ“åŸç†ä»¥åŠSwiftUIæ¡¥æ¥</title>
    <link href="http://dreampiggy.com/2019/12/10/WatchKit%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8ASwiftUI%E6%A1%A5%E6%8E%A5/"/>
    <id>http://dreampiggy.com/2019/12/10/WatchKit%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8ASwiftUI%E6%A1%A5%E6%8E%A5/</id>
    <published>2019-12-10T17:04:16.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WatchKitæ¸²æŸ“åŸç†ä»¥åŠSwiftUIæ¡¥æ¥"><a href="#WatchKitæ¸²æŸ“åŸç†ä»¥åŠSwiftUIæ¡¥æ¥" class="headerlink" title="WatchKitæ¸²æŸ“åŸç†ä»¥åŠSwiftUIæ¡¥æ¥"></a>WatchKitæ¸²æŸ“åŸç†ä»¥åŠSwiftUIæ¡¥æ¥</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>Apple Watchä½œä¸ºè‹¹æœæ™ºèƒ½ç©¿æˆ´è®¾å¤‡é¢†åŸŸçš„é‡å¤´ï¼Œè‡ªä»ç¬¬ä¸€ä»£å‘å¸ƒå·²ç»ç»å†äº†6æ¬¡æ¢ä»£äº§å“ï¼Œæ“ä½œç³»ç»Ÿçš„è¿­ä»£ä¹Ÿå·²ç»æ›´æ–°åˆ°äº†watchOS 6ã€‚</p><p>ä¸åŒäºiPhoneçš„Appï¼ŒwatchOSä¸Šçš„å¤§éƒ¨åˆ†Appéƒ½ä¾§é‡äºå¥åº·ç®¡ç†ï¼Œå¹¶ä¸”UIäº¤äº’ä»¥ç›´è§‚ï¼Œå¿«é€Ÿä¸ºåŸºå‡†ã€‚åœ¨2015å¹´WWDCä¸Šï¼Œè‹¹æœå‘å¸ƒçš„watchOSçš„åŒæ—¶ï¼Œé¢å‘å¼€å‘è€…å‘å¸ƒäº†WatchKitï¼Œä»¥ç”¨äºæ„å»ºwatchOS Appã€‚</p><p><img src="https://help.apple.com/assets/61BCCC0198613862887EA61B/61BCCC2A98613862887EA62C/en_US/091b3af363505482da15ec78aa547a4d.png" alt="watchkit-app.jpg"></p><p>è¿™ç¯‡ä¸»è¦è®²äº†å…³äºWatchOSä¸Šçš„Appçš„æ¶æ„ä»‹ç»ï¼ŒåŸºæœ¬æ¦‚å¿µï¼Œå¹¶æ·±å…¥åˆ†æäº†WatchKitçš„UIæ¸²æŸ“é€»è¾‘ï¼Œä¹Ÿè°ˆäº†ä¸€äº›WatchOSå’ŒSwiftUIç›¸å…³çš„é—®é¢˜ã€‚</p><p>å…¶å®å†™è¿™ä¸ªæ–‡ç« çš„æœ€ä¸»è¦çš„åŸå› ï¼Œæ˜¯åœ¨äºè‡ªå·±å‰æ®µæ—¶é—´å†™åº“æ—¶å€™ï¼Œåœ¨SwiftUIä¸watchOSçš„é›†æˆä¸­ï¼Œé‡åˆ°äº†ç›¸å½“å¤šçš„é—®é¢˜ï¼Œè¿«ä½¿æˆ‘å¯¹WatchKitè¿›è¡Œäº†ä¸€äº›æ¢ç´¢å’Œé€†å‘åˆ†æï¼Œè¿™é‡Œå…±äº«å‡ºæ¥ï¼Œä¸»è¦åŸå› æœ‰å¤šä¸ªï¼š</p><ol><li>èƒ½å¤Ÿäº†è§£WatchKitçš„èƒŒåå®ç°ç»†èŠ‚ï¼Œå›ç­”è¯¸å¦‚è¿™ç§é—®é¢˜ï¼šâ€œä¸ºä»€ä¹ˆWatchKitä½¿ç”¨Interface Objectçš„æ¦‚å¿µï¼Œè€Œä¸èƒ½å«åšViewâ€œ</li><li>èƒ½å¤Ÿç†è§£WatchKitçš„æ¶æ„è®¾è®¡ï¼Œä½œä¸ºåº“å¼€å‘è€…æå‡è‡ªå·±çš„åˆ†å±‚æŠ½è±¡ï¼Œæ¶æ„èƒ½åŠ›ï¼Œç”šè‡³å¯ä»¥è‡ªå·±åšä¸€å¥—ç±»ä¼¼WatchKitçš„å®ç°ï¼ˆä¸Šå±‚å°è£…å¸ƒå±€æ¡†æ¶æˆ–è€…DSLï¼‰</li><li>äº†è§£åˆ°SwiftUIå’ŒWatchKitä¹‹é—´çš„å‘ç‚¹åœ¨äºä»€ä¹ˆï¼Œåœ¨å¼€å‘æ—¶å€™é‡åˆ°å¥‡æ€ªé—®é¢˜èƒ½å¤Ÿè¿›è¡Œåˆ†æå½’å› </li><li>å®åœ¨è¢«é€¼æ— å¥ˆçš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘åˆ©ç”¨æ¸²æŸ“æœºåˆ¶èµ°UIKitï¼ˆæ³¨æ„ç§æœ‰APIé£é™©ï¼‰</li></ol><h2 id="WatchKitæ¶æ„ä»‹ç»"><a href="#WatchKitæ¶æ„ä»‹ç»" class="headerlink" title="WatchKitæ¶æ„ä»‹ç»"></a>WatchKitæ¶æ„ä»‹ç»</h2><p>ä¸€ä¸ªæ ‡å‡†WatchKit Appï¼Œå¯ä»¥åˆ†ä¸ºè‡³å°‘ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>Watch App Targetï¼šåªæœ‰Storyboardå’Œèµ„æºï¼Œç”¨æ¥æä¾›é™æ€çš„UIå±‚çº§ï¼Œä½ ä¸å…è®¸åŠ¨æ€æ„å»ºViewæ ‘ï¼ˆå¯ä»¥éšè—å’Œæ¢å¤ï¼‰</li><li>Watch Extensionï¼šç®¡ç†æ‰€æœ‰é€»è¾‘ä»£ç ï¼ŒInterface Controllerè½¬åœºï¼Œæ›´æ–°UI</li></ul><p>å¦‚æœæ²¡æœ‰æ¥è§¦è¿‡WatchKitï¼Œæ¨èå‚è€ƒè¿™ç¯‡æ–‡ç« å¿«é€Ÿæ¦‚è§ˆäº†è§£ä¸€ä¸‹ï¼š<a href="https://nshipster.cn/watchkit/">NSHipster - Watchâ€‹Kit</a>ã€‚åªéœ€è¦çŸ¥é“ï¼Œæˆ‘ä»¬çš„æ ¸å¿ƒçš„UIæ„é€ å•å…ƒï¼Œæ˜¯Interface Objectå’ŒInterface Controllerï¼Œç±»ä¼¼äºUIKitçš„Viewå’ŒViewControllerã€‚</p><p>Interface Controllerç”¨äºç®¡ç†é¡µé¢å±•ç¤ºå…ƒç´ çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€ŒInterface Objectæ˜¯ç®¡ç†Storyboardä¸ŠUIå…ƒç´ çš„å•å…ƒï¼Œä¸”åªèƒ½è§¦å‘æ›´æ–°ï¼Œæ— æ³•è·å–å½“å‰çš„UIçŠ¶æ€ï¼ˆsetter-onlyï¼‰ã€‚</p><p><img src="https://trymakedo.files.wordpress.com/2014/11/watch_app_lifecycle_simple_2x.png"></p><p>åœ¨watchOS 1æ—¶ä»£ï¼ŒWatchKité‡‡å–çš„æ¶æ„æ˜¯WatchKit Extensionä»£ç ï¼Œè¿è¡Œåœ¨iPhoneè®¾å¤‡ä¸Šï¼ŒäºApple Watchä½¿ç”¨æ— çº¿é€šä¿¡æ¥æ›´æ–°UIï¼Œå¹¶ä¸”ç”±äºè¿è¡Œåœ¨iPhoneä¸Šï¼Œå¯ä»¥ç›´æ¥è®¿é—®åˆ°Appçš„å…±äº«æ²™ç›’å’ŒUserDefaultsã€‚è¿™å—å½“æ—¶æ—©æœŸçš„Apple Watchç¡¬ä»¶å’Œå®šä½å¯¼è‡´çš„ä¸€ç§å±€é™æ€§ã€‚</p><p>åœ¨watchOS 2æ—¶ä»£ï¼Œä¸ºäº†è§£å†³1æ—¶å€™çš„æ›´æ–°UIå»¶è¿Ÿé—®é¢˜ï¼ŒWatchKitè¿›è¡Œäº†æ”¹é€ ï¼Œå°†Extensionä»£ç æ”¾åˆ°Apple Watchä¸­æ‰§è¡Œï¼Œå°±åœ¨åŒæ ·çš„è¿›ç¨‹å½“ä¸­ï¼Œé¿å…é¢å¤–çš„ä¼ è¾“ã€‚ä¸ºäº†è§£å†³å’ŒiPhoneçš„å­˜å‚¨åŒæ­¥é—®é¢˜ï¼Œä¸æ­¤åŒæ—¶æ¨å‡ºäº†WatchConnectivityæ¡†æ¶ï¼Œå¯ä»¥ä¸iPhone Appè¿›è¡Œé€šä¿¡ã€‚</p><p><img src="https://developer.apple.com/library/archive/documentation/General/Conceptual/AppleWatch2TransitionGuide/Art/architecture_compared_2x.png"></p><h2 id="WatchKit-UIå¸ƒå±€åŸç†"><a href="#WatchKit-UIå¸ƒå±€åŸç†" class="headerlink" title="WatchKit UIå¸ƒå±€åŸç†"></a>WatchKit UIå¸ƒå±€åŸç†</h2><p>WatchKitæœ¬èº«è®¾è®¡çš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„å®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¶æ„ï¼Œåœ¨watchOS 1æ—¶ä»£ï¼Œç”±äºæˆ‘ä»¬çš„Extensionè¿›ç¨‹åœ¨iPhoneæ‰‹æœºä¸Šï¼Œè€ŒAppè¿›ç¨‹åœ¨Apple Watchä¸Šï¼Œå› æ­¤é€šä¿¡æ–¹å¼å¿…å®šæ˜¯çœŸæ­£çš„ç½‘ç»œä¼ è¾“ï¼Œè‹¹æœé‡‡å–äº†WiFi-Direct+ç§æœ‰åè®®ï¼Œæ¥ä¼ è¾“å¯¹åº”çš„æ•°æ®ã€‚</p><p>watchOS 1æ—¶ä»£çš„Appæ€§èƒ½è¡¨ç°å¾ˆç³Ÿç³•ï¼Œä¸€æ—¦iPhoneå’ŒApple Watchè·ç¦»è¾ƒè¿œï¼Œæ•´ä¸ªwatchOS AppåŠŸèƒ½åŸºæœ¬æ˜¯æ— æ³•ä½¿ç”¨ï¼Œåªèƒ½é‡æ–°è¿æ¥ã€‚</p><p>åœ¨watchOS 2ä¸Šï¼Œè‹¹æœå–å·§çš„æŠŠExtensionè¿›ç¨‹æ”¾åˆ°äº†Apple Watchæœ¬èº«ï¼Œè€Œä¸Šå±‚å·²æœ‰çš„WatchKitä»£ç ä¸éœ€è¦å¤§å¹…æ”¹å˜ã€‚ä½†æ˜¯ï¼ŒAppleå¹¶æ²¡æœ‰å› ä¸ºè¿™ä¸ªæ¶æ„æ”¹å˜ï¼Œè€Œæä¾›çœŸæ­£çš„UIKitç»™å¼€å‘è€…ã€‚ç±»ä¼¼çš„ï¼Œä¸€äº›è´¯ç©¿äºiOS/macOS/tvOSçš„åŸºæœ¬æ¡†æ¶ï¼ŒAppleä¾æ—§æŠŠå®ƒä¿ç•™ä¸ºç§æœ‰ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>CoreAnimation</li><li>Metal</li><li>OpenGL/ES</li><li>GLKit</li></ul><p>å¼€å‘è€…åœ¨watchOSä¸Šï¼Œé™¤äº†ä½¿ç”¨WatchKitä»¥å¤–ï¼Œåªèƒ½é‡‡å–SceneKitæˆ–è€…SpriteKitè¿™ç§é«˜çº§æ¸¸æˆå¼•æ“ï¼Œæ¥å¼€å‘ä½ çš„watchOS Appã€‚</p><p>è™½ç„¶è‹¹æœè¿™æ ·åšï¼Œæœ‰å¾ˆå¤šå…·ä½“çš„åŸå› ï¼Œæ¯”å¦‚è¯´å…¼å®¹ä»£ç ï¼Œæ¯”å¦‚æ€§èƒ½è€ƒé‡ï¼Œç”šè‡³è¿˜æœ‰ä»æŠ€æœ¯å±‚é¢ä¸Šå¼ºè¿«ç»Ÿä¸€UIé£æ ¼ç­‰ç­‰ã€‚ä¸è¿‡éšç€watchOS 6çš„å‘å¸ƒï¼ŒwatchOSç»ˆäºæœ‰çœŸæ­£çš„UIæ¡†æ¶äº†ã€‚</p><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><p>WatchKitçš„å®¢æˆ·ç«¯ï¼ŒæŒ‡çš„æ˜¯Apple Watch Appè‡ªå¸¦çš„WatchKit Extensionéƒ¨åˆ†ã€‚</p><p>åœ¨watchOS 1ä¸Šï¼Œå®¢æˆ·ç«¯çš„è¿›ç¨‹ä½äºiPhoneå½“ä¸­ï¼Œè€Œä¸æ˜¯å’ŒApple Watchåœ¨ä¸€èµ·ã€‚ä¹‹é—´çš„ä¼ è¾“éœ€è¦èµ°ç½‘ç»œåè®®ã€‚åœ¨watchOS 2ä¸­ï¼Œä¹‹é—´çš„ä¼ è¾“ä¾æ—§ä¿æŒäº†ä¸€å±‚æŠ½è±¡ï¼Œä½†æ˜¯å®é™…ä¸Šæœ€ç»ˆç­‰ä»·äºåŒè¿›ç¨‹ä»£ç çš„è°ƒç”¨ã€‚</p><p>ç”±Storyboardåˆ›å»ºçš„WKInterfaceObjectï¼Œä¸€å®šä¼šæœ‰ä¸ä¹‹ç»‘å®šçš„WKInterfaceControllerï¼Œè¿™äº›Controllerä¼šä¿ç•™ä¸€ä¸ªviewControllerIDï¼Œç”¨äºå‘æœåŠ¡ç«¯å®šä½å…·ä½“çš„UIKit ViewControllerï¼ˆåé¢æåˆ°ï¼‰</p><p>WKInterfaceObjectçš„<strong>æ‰€æœ‰</strong>å…¬å¼€APIç›¸å…³å±æ€§è®¾ç½®ï¼Œæ¯”å¦‚width heightï¼Œalpha, imageç­‰ï¼Œå‡ä¼šæœ€ç»ˆè½¬å‘åˆ°ä¸€ä¸ª<code>_sendValueChanged:forProperty:</code>æ–¹æ³•ä¸Šã€‚Valueæ˜¯å¯¹åº”çš„å¯¹è±¡ï¼ˆCGFloatä¼šè½¬æ¢ä¸ºNSNumberï¼Œéƒ¨åˆ†å±æ€§ä¼šä½¿ç”¨å­—å…¸ï¼‰ï¼ŒPropertyæ˜¯è¿™äº›å±æ€§å¯¹åº”çš„åç§°ï¼ˆå¦‚widthï¼Œheightï¼Œimageï¼Œtextç­‰ï¼‰ã€‚</p><p>æ ¹æ®æ˜¯å¦WatchKit 2ï¼Œä¼šåšä¸åŒçš„å¤„ç†ã€‚WatchKit 2ä¼šç»è¿‡Main Queue Dispatchåˆ†å‘ï¼Œè€ŒWatch 1é‡‡å–çš„æ˜¯è‡ªå®šä¹‰çš„ä¸€ä¸ªé€šä¿¡åè®®ï¼Œé€šè¿‡å’ŒiPhoneç›´è¿çš„WiFiå’Œç§æœ‰åè®®ä¼ è¾“ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œç­‰ä»·äºå¦‚ä¸‹ä¼ªä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WKInterfaceObject</span></span></span><br><span class="line">- (<span class="type">void</span>)setWidth:(<span class="built_in">CGFloat</span>)width &#123;</span><br><span class="line">  [<span class="keyword">self</span> _sendValueChanged:@(width) forProperty:<span class="string">@&quot;width&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)_sendValueChanged:(<span class="type">id</span>&lt;<span class="built_in">NSCoding</span>&gt;)value forProperty:(<span class="built_in">NSString</span> *)property &#123;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *message = @&#123;</span><br><span class="line">      <span class="string">@&quot;viewController&quot;</span>: <span class="keyword">self</span>.viewControllerID,</span><br><span class="line">      <span class="string">@&quot;key&quot;</span>: <span class="string">&quot;wkInterfaceObject&quot;</span>,</span><br><span class="line">      <span class="string">@&quot;value&quot;</span>: value,</span><br><span class="line">      <span class="string">@&quot;property&quot;</span>: property,</span><br><span class="line">      <span class="string">@&quot;interfaceProperty&quot;</span>: <span class="keyword">self</span>.interfaceProperty</span><br><span class="line">    &#125;;</span><br><span class="line">    [[SPExtensionConnection remoteObjectProxy] sendMessage:message];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><p>è¿™é‡Œçš„æåˆ°æœåŠ¡ç«¯ï¼Œåœ¨watchOS 1æ—¶ä»£å…¶å®å°±æ˜¯Apple Watchä¸Šå•ç‹¬è·‘çš„è¿›ç¨‹ï¼Œè€Œåœ¨watchOS 2ä¸Šï¼Œå®ƒå’ŒExtensionéƒ½æ˜¯åœ¨Apple Watchä¸Šï¼Œä¹Ÿå®é™…ä¸Šè¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚</p><p>å¯¹äºæ¯ä¸ªwatchOS Appï¼Œå®ƒå®é™…å¯ä»¥å½“ä½œä¸€ä¸ªUIKit Appã€‚å®ƒçš„mainå‡½æ•°å…¥å£æ˜¯ä¸€ä¸ªå«åšWKExtensionMainçš„æ–¹æ³•ï¼Œé‡Œé¢åšäº†ä¸€äº›Extensionçš„åˆå§‹åŒ–ä»¥åï¼Œå°±ç›´æ¥è°ƒç”¨äº†<br>æœ‰UIApplicationMainã€‚watchOS Appæœ‰AppDelegateï¼ˆç±»åä¸º<a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPApplicationDelegate.h">SPApplicationDelegate</a>ï¼‰ï¼Œä¼šæœ‰ä¸€ä¸ªå…¨å±çš„root UIWindowå½“ä½œkey windowã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2019/12/10/watchkit1.jpg" alt="watchkit1"></p><h4 id="UIåˆå§‹åŒ–"><a href="#UIåˆå§‹åŒ–" class="headerlink" title="UIåˆå§‹åŒ–"></a>UIåˆå§‹åŒ–</h4><p>åœ¨æœåŠ¡ç«¯å¯åŠ¨åï¼Œå®ƒä¼šåŠ è½½Storyboardä¸­çš„UIã€‚å¯¹æ¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„Interface Controllerï¼Œå®é™…ä¸ŠæœåŠ¡ç«¯å¯¹åº”ä¼šåˆ›å»ºä¸€ä¸ªView Controllerï¼Œå¯¹åº”UIViewControllerçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¼šè½¬å‘åˆ°å®¢æˆ·ç«¯ï¼Œè§¦å‘å¯¹åº”çš„Interface Controllerçš„willActivate/didAppearæ–¹æ³•ã€‚</p><p>å› æ­¤ï¼ŒwatchOSåˆ›å»ºäº†ä¸€ä¸ª<a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPInterfaceViewController.h">SPInterfaceViewController</a>å­ç±»æ¥ç»Ÿä¸€åšè¿™ä¸ªäº‹æƒ…ï¼Œå®ƒç»§æ‰¿è‡ª<a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPViewController.h">SPViewController</a>ï¼Œçˆ¶ç±»åˆç»§æ‰¿è‡ªUIViewControllerï¼Œä½¿ç”¨å®¢æˆ·ç«¯ä¼ æ¥çš„Interface Controller IDæ¥ç»‘å®šèµ·æ¥ã€‚</p><p>å¯¹äºUIæ¥è¯´ï¼Œæ¯ä¸€ç§WKInterfaceObjectï¼Œå…¶å®éƒ½ä¼šæœ‰ä¸€ä¸ªåŸç”Ÿçš„ç»§æ‰¿è‡ªUIViewçš„ç±»å»åšçœŸæ­£çš„æ¸²æŸ“ï¼Œæ¯”å¦‚ï¼š</p><ul><li>WKInterfaceButton: <a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPInterfaceButton.h">SPInterfaceButton</a>ï¼Œç»§æ‰¿è‡ª<code>UIControl</code></li><li>WKInterfaceImage: <a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPInterfaceImageView.h">SPInterfaceImageView</a>ï¼Œç»§æ‰¿è‡ª<code>UIImageView</code></li><li>WKInterfaceGroup: <a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPInterfaceGroupView.h">SPInterfaceGroupView</a>ï¼Œç»§æ‰¿è‡ª<code>UIImageView</code></li><li>WKInterfaceMap: <a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPInterfaceMapView.h">SPInterfaceMapView</a>ï¼Œç»§æ‰¿è‡ª<code>MKMapView</code></li><li>WKInterfaceSwitch: <a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPInterfaceSwitch.h">SPInterfaceSwitch</a>ï¼Œç»§æ‰¿è‡ª<code>UIControl</code></li><li>WKInterfaceTable: <a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPInterfaceListView.h">SPInterfaceListView</a>ï¼Œç»§æ‰¿è‡ª<code>UIView</code></li></ul><p>SPInterfaceViewControllerçš„ä¸»è¦åŠŸèƒ½ï¼Œå°±æ˜¯æ ¹æ®Storyboardæä¾›çš„ä¿¡æ¯ï¼Œæ„é€ å‡ºå¯¹åº”è¿™äº›UIViewçš„æ ‘ç»“æ„ï¼Œå¹¶ä¸”åˆå§‹åŒ–å¯¹åº”çš„å€¼æ¸²æŸ“åˆ°UIä¸Šï¼ˆæ¯”å¦‚è¯´ï¼ŒImageæœ‰åˆå§‹åŒ–çš„Nameï¼ŒLabelæœ‰åˆå§‹çš„Textï¼‰ã€‚å®é™…ä¸Šï¼Œè¿™äº›å…·ä½“çš„åˆå§‹åŒ–å€¼ï¼Œéƒ½å­˜å‚¨åœ¨Storyboardä¸­ï¼Œæ¯”å¦‚è¯´ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„åŒ…å«Tableï¼Œæ¯ä¸ªTableRowæ˜¯ä¸€ä¸ªå±…ä¸­çš„Labelï¼Œå®ƒå¯¹åº”çš„ç»“æ„åŒ–æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    controllerClass = <span class="string">&quot;InterfaceController&quot;</span>;</span><br><span class="line">    items =     (</span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">            property = interfaceTable;</span><br><span class="line">            rows =             <span class="punctuation">&#123;</span></span><br><span class="line">                default =                 <span class="punctuation">&#123;</span></span><br><span class="line">                    color = EFF1FB24;</span><br><span class="line">                    controllerClass = <span class="string">&quot;ElementRowController&quot;</span>;</span><br><span class="line">                    items =                     (</span><br><span class="line">                                                <span class="punctuation">&#123;</span></span><br><span class="line">                            alignment = center;</span><br><span class="line">                            fontScale = <span class="number">1</span>;</span><br><span class="line">                            property = elementLabel;</span><br><span class="line">                            text = Label;</span><br><span class="line">                            type = label;</span><br><span class="line">                            verticalAlignment = center;</span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    );</span><br><span class="line">                    type = group;</span><br><span class="line">                    width = <span class="number">1</span>;</span><br><span class="line">                <span class="punctuation">&#125;</span>;</span><br><span class="line">            <span class="punctuation">&#125;</span>;</span><br><span class="line">            type = table;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    );</span><br><span class="line">    title = Catalog;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™äº›ä¿¡æ¯ä¼šåœ¨è¿è¡Œæ—¶ç”¨äºæ„å»ºçœŸæ­£çš„View Treeã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒwatchOSç”±äºæœ¬èº«çš„UIï¼Œè¿™äº›SPInterfaceViewControllerçš„rootViewï¼Œä¸€å®šæ˜¯ä¸€ä¸ªå®¹å™¨çš„Viewã€‚æ¯”å¦‚è¯´ä¸€èˆ¬çš„å¤šç§æ§ä»¶å¹³é“ºçš„Storyboardä¼šè‡ªå¸¦<code>SPInterfaceGroupView</code>ï¼Œä¸€ä¸ªå¯æ»šåŠ¨çš„Storyboardä¼šè‡ªå¸¦ä¸€ä¸ª<code>SPCollectionView</code>ï¼Œç­‰ç­‰ã€‚è¿™é‡Œæ˜¯ç®€å•çš„ä¼ªä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SPInterfaceViewController</span></span></span><br><span class="line">- (<span class="type">void</span>)loadView &#123;</span><br><span class="line">  Class rootViewClass;</span><br><span class="line">  <span class="built_in">UIView</span> *rootView = [[rootViewClass alloc] initWithItemDescription:<span class="keyword">self</span>.rootItemDescription bundle:<span class="keyword">self</span>.bundle stringsFileName:<span class="keyword">self</span>.stringsFileName];</span><br><span class="line">  <span class="keyword">self</span>.view = rootView;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h4 id="UIæ›´æ–°"><a href="#UIæ›´æ–°" class="headerlink" title="UIæ›´æ–°"></a>UIæ›´æ–°</h4><p>UIåˆ›å»ºå¥½ä»¥åï¼Œå®é™…ä¸Šæˆ‘ä»¬çš„Extensionä»£ç ä¼šè§¦å‘å¾ˆå¤šInterface objectçš„åˆ·æ–°ï¼Œæ¯”å¦‚è¯´æ›´æ–°Labelçš„æ–‡æ¡ˆï¼ŒImageçš„å›¾ç‰‡ç­‰ç­‰ï¼Œè¿™äº›ä¼šä»å®¢æˆ·ç«¯è§¦å‘æ¶ˆæ¯ï¼Œç„¶ååœ¨æœåŠ¡ç«¯ç»Ÿä¸€ç”±AppDelegateæ¥æ”¶åˆ°ï¼Œæ¥æ ¹æ®viewControllerIDæ‰¾åˆ°å¯¹åº”å…ˆå‰åˆ›å»ºçš„SPInterfaceViewControllerã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SPApplicationDelegate</span> : <span class="title">NSObject</span> &lt;<span class="title">SPExtensionConnectionDelegate</span>, <span class="title">UIApplicationDelegate</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SPApplicationDelegate</span></span></span><br><span class="line">- (<span class="type">void</span>)extensionConnection:(SPExtensionConnection *)connection interfaceViewController:(<span class="built_in">NSString</span> *)viewControllerID setValue:(<span class="type">id</span>)value forKey:(<span class="built_in">NSString</span> *)key property:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">if</span> ([key isEqualToString:<span class="string">@&quot;wkInterfaceObject&quot;</span>]) &#123;</span><br><span class="line">        SPInterfaceViewController *vc = [SPInterfaceViewController viewControllerForIdentifier:viewControllerID];</span><br><span class="line">        [vc setInterfaceValue:value forKey:key property:property];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæ‹¿åˆ°UIViewControllerä»¥åï¼ŒWatchKitä¼šæ ¹æ®å‰é¢ä¼ æ¥çš„interfacePropertyæ¥å®šä½ï¼Œæ‰¾åˆ°ä¸€ä¸ªéœ€è¦æ›´æ–°çš„Viewã€‚ç„¶åå‘å¯¹åº”çš„UIViewå¯¹è±¡ï¼Œå‘é€å¯¹åº”çš„propertyå’Œvalueï¼Œä»¥æ›´æ–°UIã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SPInterfaceImageView</span> : <span class="title">UIImageView</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SPInterfaceImageView</span></span></span><br><span class="line">- (<span class="type">void</span>)setInterfaceItemValue:(<span class="type">id</span>)value property:(<span class="built_in">NSString</span> *)property &#123;</span><br><span class="line">    <span class="keyword">if</span> ([property isEqualToString:<span class="string">@&quot;width&quot;</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.width = value.doubleValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ([property isEqualToString:<span class="string">@&quot;image&quot;</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.image = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>åç»­çš„æµç¨‹ï¼Œå°±å®Œå…¨äº¤ç»™UIKitå’ŒCALayeræ¥è¿›è¡Œæ¸²æŸ“äº†ã€‚</p><h2 id="æ€»ç»“æµç¨‹"><a href="#æ€»ç»“æµç¨‹" class="headerlink" title="æ€»ç»“æµç¨‹"></a>æ€»ç»“æµç¨‹</h2><p><img src="http://dreampiggy-image.test.upcdn.net/2019/12/10/watchkit2.jpg" alt="watchkit2"></p><p>é€šè¿‡è¿™å¼ å›¾ï¼Œå…¶å®å®Œæ•´çš„æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨æ ˆæ¸…æ™°çœ‹åˆ°ï¼Œå¦‚å›¾å„ä¸ªé˜¶æ®µï¼š</p><ol><li>å¼€å‘è€…è°ƒç”¨WKInterfaceObjectçš„UIæ–¹æ³•</li><li>å®¢æˆ·ç«¯çš„WKInterfaceObjectç»Ÿä¸€å°è£…å‘é€æ¶ˆæ¯</li><li>ä¼ è¾“å±‚ä¼ è¾“æ¶ˆæ¯ï¼ˆwatchOS 1èµ°ç½‘ç»œï¼ŒwatchOS 2å®é™…ä¸Šå°±Dispatchåˆ°main queueï¼‰</li><li>æœåŠ¡ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæ¶ˆæ¯åˆ†å‘ç»™å¯¹åº”çš„ViewController</li><li>ViewControlleråˆ†å‘æ¶ˆæ¯ç»™rootViewï¼ˆä¼šé€’å½’å¤„ç†ï¼‰</li><li>Viewè§£ç æ¶ˆæ¯ï¼Œå¾—åˆ°å¯¹åº”çš„éœ€è¦è®¾ç½®çš„UIKitå±æ€§å’Œå€¼</li><li>è°ƒç”¨UIKitçš„UIæ›´æ–°æ–¹æ³•</li></ol><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œå…¶å®WatchKitè¿™è¾¹ä¸»è¦çš„å·¥ä½œå°±æ˜¯æŠ½è±¡äº†ä¸€å±‚Interface Objectè€Œä¸è®©å¼€å‘è€…ç›´æ¥æ›´æ–°UIViewã€‚åœ¨watchOS 1æ—¶ä»£è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„è®¾è®¡ï¼Œå› ä¸ºExtensionè¿›ç¨‹åœ¨iPhoneä¸­ï¼Œè€ŒAppè¿›ç¨‹åœ¨Apple Watchä¸Šã€‚ä½†æ˜¯åˆ°äº†watchOS 2ä»¥åï¼Œä¾ç„¶ä¿ç•™äº†è¿™ä¸€å¥—è®¾è®¡æ–¹æ¡ˆï¼Œå®é™…ä¸Šå¼€å‘è€…èƒ½è‡ªå®šä¹‰çš„UIå¾ˆæœ‰é™ã€‚</p><h2 id="WatchKitä¸Long-Look-Notification"><a href="#WatchKitä¸Long-Look-Notification" class="headerlink" title="WatchKitä¸Long-Look Notification"></a>WatchKitä¸Long-Look Notification</h2><p>watchOSé™¤äº†æœ¬èº«çš„AppåŠŸèƒ½å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–ç‰¹æ€§ï¼Œæ¯”å¦‚è¿™é‡Œæåˆ°çš„Long-Look Notificationã€‚è¿™æ˜¯åœ¨Apple Watchæ”¶åˆ°æ¨é€é€šçŸ¥æ—¶å€™å±•ç¤ºçš„é¡µé¢ï¼Œå®ƒå®é™…ä¸Šç±»ä¼¼äºiOSä¸Šçš„Notification Extensionï¼Œå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰çš„UIã€‚</p><p><img src="https://docs-assets.developer.apple.com/published/2d2f6b930c/52360133-b314-48c5-aa59-f2cb6c5e4e8f.png"></p><p>è‹¹æœè¿™é‡Œé¢å¯¹Notificationæä¾›äº†3ç§ç±»å‹ï¼Œæ ¹æ®èƒ½ä¸èƒ½åŠ¨æ€æ›´æ–°UI/èƒ½ä¸èƒ½å“åº”ç”¨æˆ·ç‚¹å‡»å¯ä»¥åˆ†ä¸ºï¼š</p><ul><li>Static Notificationï¼ˆå›ºå®šUIï¼Œç‚¹å‡»åå…³é—­ï¼‰</li><li>Dynamic Notificationï¼ˆå¯ä»¥æ›´æ–°UIï¼Œç‚¹å‡»åå…³é—­ï¼‰</li><li>Dynamic Interactive Notificationï¼ˆå¯ä»¥æ›´æ–°UIï¼Œå¯ä»¥å“åº”äº¤äº’ï¼Œä¸é»˜è®¤å…³é—­ï¼‰</li></ul><p>å’Œæ™®é€šçš„WatchKit UIä¸€æ ·ï¼ŒNotificationä¾ç„¶ä½¿ç”¨Storyboardæ„å»ºã€‚å¹¶ä¸”æœ‰å•ç‹¬çš„Storyboard Entry Pointã€‚åœ¨ä»£ç é‡Œé¢é€šè¿‡WKUserNotificationInterfaceControllerçš„æ–¹æ³•<code>didReceive(_:)</code>ï¼Œæ¥å¤„ç†æ¥æ”¶åˆ°é€šçŸ¥åçš„UIåˆ·æ–°ï¼Œå­˜å‚¨åŒæ­¥ç­‰ç­‰é€»è¾‘ã€‚</p><p><img src="https://docs-assets.developer.apple.com/published/0599a724ac/8487cfa2-b872-481d-b0ae-409d1aaea6d1.png"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæ•´ä½“çš„ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥å‚è€ƒè‹¹æœçš„æ–‡æ¡£å³å¯ï¼š<a href="https://developer.apple.com/documentation/watchkit/enhancing_your_watchos_app_with_notifications/customizing_your_long-look_interface">Customizing Your Long-Look Interface</a></p><h3 id="Long-Look-NotificationåŸç†"><a href="#Long-Look-NotificationåŸç†" class="headerlink" title="Long-Look NotificationåŸç†"></a>Long-Look NotificationåŸç†</h3><p>æŒ‰ç…§ä¹‹å‰è¯´çš„ï¼ŒWatchOSçš„Native Appä¸­ï¼Œä½¿ç”¨äº†SPApplicationDelegateä½œä¸ºå®ƒçš„AppDelegateï¼Œä¹Ÿç›´æ¥å®ç°äº†UNUserNotificationCenterDelegateç›¸å…³æ–¹æ³•ã€‚</p><p>å½“æœ‰æ¨é€é€šçŸ¥å‡ºç°æ—¶ï¼Œå¦‚æœwatchOS Appæ­£å¤„äºå‰å°ï¼Œä¼šè§¦å‘ä¸€ç³»åˆ—UserNotificationçš„é€šçŸ¥ã€‚ç±»ä¼¼äºUIKitçš„é€»è¾‘ï¼Œå°±ä¸å†èµ˜è¿°ã€‚</p><p>å¦‚æœwatchOS Appæœªå¯åŠ¨ï¼Œé‚£ä¹ˆä¼šè¢«åå°å¯åŠ¨ï¼ˆä¸”ä¸è§¦å‘UserNotificationçš„é€šçŸ¥ï¼‰ï¼Œå¯¹åº”Storyboardä¸­çš„WKUserNotificationInterfaceControllerå®ä¾‹ä¼šè¢«åˆå§‹åŒ–ã€‚åŠ è½½å®ŒæˆUIåï¼Œä¼šè°ƒç”¨<code>willActivate()</code>æ–¹æ³•å¹¶è‡ªåŠ¨å¼¹èµ·ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2019/12/10/watchkit4.jpg" alt="watchkit4"></p><p>å…¶å®å¯ä»¥çœ‹å‡ºæ¥ï¼ŒWatchKitä¸»è¦åšçš„äº‹æƒ…ï¼Œæ˜¯åœ¨äºwatchOS Appæœªå¯åŠ¨æ—¶ï¼Œéœ€è¦å¯¹ç”¨æˆ·æä¾›çš„WKUserNotificationInterfaceControllerï¼Œæ¡¥æ¥å¯¹åº”çš„UserNotificationæ¥å£å’Œç”Ÿå‘½å‘¨æœŸã€‚</p><ol><li>å½“SPApplicationDelegateçš„<code>userNotificationCenter:willPresentNotification:withCompletionHandler:</code>è¢«è°ƒç”¨ï¼Œå®ƒä¼šå‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œè§¦å‘WKUserNotificationInterfaceControllerçš„<code>didReceive(_:)</code>æ–¹æ³•</li><li>å½“ç”¨æˆ·ç‚¹å‡»äº†Notificationä¸Šé¢çš„æŒ‰é’®æ—¶ï¼ŒSPApplicationDelegateçš„<code>userNotificationCenter:didReceiveNotificationResponse:withCompletionHandler:</code>è¢«è°ƒç”¨ï¼Œå¦‚æœAppä¸æ”¯æŒdynamic interactive notificationï¼Œå®ƒä¼šç›´æ¥å…³é—­é€šçŸ¥ï¼Œå¹¶å”¤èµ·watchOS Appåˆ°å‰å°</li><li>å¦‚æœæ”¯æŒdynamic interactive notification(watchOS 5/iOS 12)ï¼Œé‚£ä¹ˆç”¨æˆ·ç‚¹å‡»çš„Button/Sliderä¹‹ç±»ï¼Œä¼šè°ƒç”¨WKUserNotificationInterfaceControllerä¸Šç»‘å®šçš„Target-Actionï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨åœ¨äº¤äº’å®Œæ¯•åè°ƒç”¨<code>performNotificationDefaultAction</code>ï¼Œ<code>performDismissAction</code>å…³é—­é€šçŸ¥ï¼ˆç³»ç»Ÿä¸å†è‡ªåŠ¨å…³é—­é€šçŸ¥ï¼‰ï¼Œå¦å¤–ï¼Œç³»ç»Ÿç»™é€šçŸ¥çš„æœ€ä¸‹æ–¹æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„DismissæŒ‰é’®ï¼Œç‚¹å‡»åä¼šå¼ºåˆ¶å…³é—­ã€‚</li></ol><p>ä¸ªäººè§è§£ï¼šä¹‹æ‰€ä»¥watchOSéè¦å°è£…ä¸€å±‚ï¼Œä¸»è¦åŸå› æ˜¯watchOS 1æ—¶ä»£ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰é€šçŸ¥ï¼›åœ¨watchOS 2æ—¶ä»£ï¼ŒUserNotificationè¿™ä¸ªæ¡†æ¶è¿˜ä¸å­˜åœ¨ï¼ŒUIKitå’ŒAppKitéƒ½å„è‡ªæœ‰ä¸€å¥—æ¥æ”¶Notificationçš„å®ç°ï¼Œè€ŒWatchKitä¹Ÿç…§çŒ«ç”»è™æäº†ä¸€å¥—ï¼ˆå½“æ—¶å°±ç”¨çš„UILocalNotificationï¼‰ã€‚UserNotificationè¿™ä¸ªè·¨å¹³å°çš„é€šçŸ¥åº“ï¼Œæ˜¯ä¼´éšç€watchOS 3æ‰å‡ºç°çš„ï¼Œä½†æ˜¯å·²ç»æ™šäº†ï¼Œå› æ­¤WatchKitç»§ç»­åœ¨å·²æœ‰çš„è¿™ä¸ªWKUserNotificationInterfaceControllerä¸Šæ–°å¢åŠŸèƒ½ã€‚</p><p>å…¶å®å¯ä»¥çœ‹åˆ°ï¼ŒWKUserNotificationInterfaceControllerå®é™…ä¸Šæä¾›çš„æ¥å£ï¼ŒåŸºæœ¬å®Œå…¨ç­‰ä»·äºUserNotifications + UserNotificationsUIï¼Œæ–¹æ³•åç±»ä¼¼ï¼Œæœ‰å…´è¶£çš„è¯è‡ªè¡Œå‚è€ƒå®˜æ–¹æ–‡æ¡£å¯¹æ¯”ä¸€ä¸‹<a href="https://developer.apple.com/documentation/watchkit/enhancing_your_watchos_app_with_notifications">watchOS Custom Notification Tutorial</a> å’Œ <a href="https://developer.apple.com/documentation/usernotificationsui/customizing_the_appearance_of_notifications">iOS Custom Notification Tutorial</a></p><h2 id="WatchKitå’ŒSwiftUI"><a href="#WatchKitå’ŒSwiftUI" class="headerlink" title="WatchKitå’ŒSwiftUI"></a>WatchKitå’ŒSwiftUI</h2><p>åœ¨WWDC 2019ä¸Šï¼Œè‹¹æœå‘å¸ƒäº†æ–°çš„å…¨å¹³å°UIæ¡†æ¶ï¼ŒSwiftUIã€‚SwiftUIæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„UIæ¡†æ¶ï¼Œå¤§é‡ä½¿ç”¨äº†Swiftè¯­æ³•ç‰¹æ€§å’ŒAPIæ¥å£è®¾è®¡ï¼Œæå€¡Single Source of Truthè€Œä¸æ˜¯UIKitä¸€ç›´ä»¥æ¥çš„View State Mutationã€‚</p><p>ä¸ºä»€ä¹ˆä¸“é—¨è¦è®²SwiftUIï¼Œå› ä¸ºå®é™…ä¸Šï¼ŒSwiftUIæ‰æ˜¯Apple Watchä¸ŠçœŸæ­£çš„å®Œæ•´UIæ¡†æ¶ï¼Œè€ŒWatchKitç”±äºè®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œæ— æ³•å®ç°<strong>Owning Every Pixel</strong>è¿™ä¸€ç‚¹ï¼Œåœ¨æˆ‘å¿ƒä¸­å®ƒçš„å®šä½æ›´ç±»ä¼¼äºTVMLçš„çº§åˆ«ã€‚</p><p><img src="https://developer.apple.com/assets/elements/icons/swiftui/swiftui-96x96_2x.png" alt="swiftui"></p><p>å…³äºSwiftUIåœ¨watchOSä¸Šçš„å¿«é€Ÿä¸Šæ‰‹ï¼Œæ²¡æœ‰ä»€ä¹ˆæ¯”Appleå®˜æ–¹æ–‡æ¡£è¦ç›´è§‚çš„äº†ï¼Œæœ‰å…´è¶£å‚è€ƒï¼š<a href="https://developer.apple.com/tutorials/swiftui/creating-a-watchos-app">SwiftUI Tutorials - Creating a watchOS App</a></p><p>è¿™é‡Œä¸ä¼šä¸“é—¨ä»‹ç»SwiftUIçš„åŸºç¡€çŸ¥è¯†ï¼Œåç»­æˆ‘å¯èƒ½ä¹Ÿä¼šå†™ä¸€ç¯‡SwiftUIåŸç†æ€§ä»‹ç»çš„æ–‡ç« ã€‚ä½†æ˜¯è¿™ç¯‡æ–‡ç« ï¼Œä¸»è¦ä¾§é‡ä¸€äº›SwiftUIåœ¨watchOSçš„ç‹¬æœ‰ç‰¹æ€§å’Œæ³¨æ„ç‚¹ï¼Œä»¥åŠä¸€äº›è‡ªå·±å‘ç°çš„å‘ã€‚</p><h3 id="SwiftUIä¸WatchKitæ¡¥æ¥"><a href="#SwiftUIä¸WatchKitæ¡¥æ¥" class="headerlink" title="SwiftUIä¸WatchKitæ¡¥æ¥"></a>SwiftUIä¸WatchKitæ¡¥æ¥</h3><p>SwiftUIï¼Œå…è®¸æ¡¥æ¥ç›®å‰å·²æœ‰çš„WatchKitçš„Interface Objectï¼Œå°±å¦‚åœ¨iOSä¸Šå…è®¸æ¡¥æ¥UIKitä¸€æ ·ã€‚ä½†æ˜¯å®ƒèƒ½åšçš„äº‹æƒ…å’Œæ¦‚å¿µå…¶å®å®Œå…¨ä¸ä¸€æ ·ã€‚</p><p>åœ¨iOSä¸Šï¼Œä½ èƒ½é€šè¿‡ä»£ç /Storyboardæ¥æ„å»ºä½ è‡ªå·±çš„UIViewå­ç±»ï¼Œå¹¶ä¸”ä½ èƒ½æ„é€ è‡ªå·±çš„ViewControllerç®¡ç†ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚è¿™äº›éƒ½èƒ½é€šè¿‡SwiftUIçš„<a href="https://developer.apple.com/documentation/swiftui/uiviewrepresentable">UIViewRepresentable</a>æ¥æ¡¥æ¥è€Œæ¥ã€‚ä¸æ­¤åŒæ—¶ï¼Œä½ è¿˜å¯ä»¥åœ¨ä½ çš„UIKitä»£ç ä¸­ï¼Œæ¥å¼•å…¥SwiftUIçš„Viewã€‚ä½ å¯ä»¥ä½¿ç”¨UIHostingControllerå½“ä½œChild VCï¼Œç”šè‡³æ˜¯å¯¹åº”çš„UIViewï¼ˆ<code>UIHostingController.view</code>æ˜¯ä¸€ä¸ªç§æœ‰ç±»<code>_UIHostingView</code>ï¼Œç»§æ‰¿è‡ªUIViewï¼‰ï¼Œæ˜¯ä¸€ç§åŒå‘çš„æ¡¥æ¥ã€‚</p><p>ä½†æ˜¯ï¼Œæ­£å¦‚ä¹‹å‰æåˆ°ï¼ŒWatchKitè®¾è®¡æ˜¯ä¸¥é‡Storyboard Basedï¼Œä½ ä¸å…è®¸ç»§æ‰¿Interface Objectã€‚ä½ ä¸èƒ½ä½¿ç”¨SwiftUIæ¥å¼•å…¥Storyboardè‡ªå·±æ„å»ºå¥½çš„Interface Object/Controllerå±‚çº§ã€‚ä¸è¿‡ç›¸åçš„æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨WKHostingControllerï¼Œåœ¨Storyboardä¸­å»presentæˆ–è€…pushä¸€ä¸ªæ–°çš„SwiftUIé¡µé¢ï¼Œå®é™…æ˜¯ä¸€ç§å•å‘çš„æ¡¥æ¥ã€‚</p><p>SwiftUIæä¾›çš„<a href="https://developer.apple.com/documentation/swiftui/wkinterfaceobjectrepresentable">WKInterfaceObjectRepresentable</a>ï¼Œå®é™…ä¸Šå®ƒåªå…è®¸ä½ å»ç»‘å®šä¸€äº›å·²æœ‰çš„ç³»ç»ŸUIåˆ°SwiftUIä¸­ï¼ˆå› ä¸ºSwiftUIç›®å‰è¿˜ä¸æ”¯æŒè¿™äº›æ§ä»¶ï¼Œæ¯”å¦‚InlineMovieï¼ŒMapKitï¼Œä¸æ’é™¤ä»¥åæœ‰åŸç”Ÿå®ç°ï¼‰ã€‚è¿™äº›å¯¹åº”çš„WatchKit Interface Objectï¼Œåœ¨watchOS 6ä¸Šé¢éƒ½åŠ å…¥äº†å¯¹åº”çš„initåˆå§‹åŒ–æ–¹æ³•ï¼Œå…è®¸ä½ ä»£ç ä¸­åŠ¨æ€åˆ›å»ºï¼Œè¿™é‡Œæ˜¯å…¨éƒ¨çš„åˆ—è¡¨ï¼š</p><ul><li>WKInterfaceActivityRing</li><li>WKInterfaceHMCamera</li><li>WKInterfaceInlineMovie</li><li>WKInterfaceMap</li><li>WKInterfaceMovie</li><li>WKInterfaceSCNScene</li><li>WKInterfaceSKScene</li></ul><p>æ¡¥æ¥äº†Interface Objectçš„Viewå¯ä»¥åƒæ™®é€šçš„SwiftUI Viewä¸€æ ·ä½¿ç”¨ï¼Œå¸¸è§çš„SwiftUIçš„modifierï¼ˆæ¯”å¦‚<code>.frame</code>, <code>.background</code>ï¼‰ä¹Ÿå¯ä»¥æ­£å¸¸workã€‚ä½†æ˜¯æœ‰ä¸€äº›ç³»ç»ŸUIæœ‰ç€è‡ªå·±æä¾›çš„æœ€å°å¸ƒå±€ï¼ˆæ¯”å¦‚MapKitï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶ä¼šå¯¼è‡´æ¸²æŸ“å¼‚å¸¸ï¼Œå»ºè®®é‡‡å–scaleTransformå¤„ç†ã€‚å¦å¤–ï¼Œè¯·ä¸è¦åŒæ—¶è°ƒç”¨Interface Objectçš„setWidthç­‰æ¦‚å¿µç­‰ä»·çš„å¸ƒå±€æ–¹æ³•ï¼Œè¿™ä¼šå¯¼è‡´æ›´å¤šçš„é—®é¢˜ã€‚</p><h3 id="æ¡¥æ¥åŸç†"><a href="#æ¡¥æ¥åŸç†" class="headerlink" title="æ¡¥æ¥åŸç†"></a>æ¡¥æ¥åŸç†</h3><p>ä¸Šæ–‡æåˆ°çš„æ‰€æœ‰å¯åŠ¨æ€åˆ›å»ºçš„Interface Objectï¼Œæ ¹æ®æˆ‘ä»¬ä¹‹å‰çš„æ¢ç´¢ï¼Œå®ƒç°åœ¨æ˜¯æ²¡æœ‰ç»‘å®šä»»ä½•viewControllerIDçš„ï¼Œå…·ä½“SwiftUIæ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼ŒSwiftUIä¼šå¯¹è¿™äº›initåˆ›å»ºçš„interfaceObjectï¼Œæ‰‹åŠ¨é€šè¿‡UUIDæ„é€ ä¸€ä¸ªå•ç‹¬çš„æ–°å­—ç¬¦ä¸²ï¼Œç„¶åç”¨è¿™ä¸ªUUIDï¼Œåˆ›å»ºä¸€ä¸ªæ–°ViewControlleråˆ°WatchKit Appä¸­ï¼Œæ’å…¥åˆ°å¯¹åº”HostingControllerçš„è§†å›¾æ ˆé‡Œé¢ã€‚</p><p>å®ƒçš„åˆå§‹åŒ–UIçŠ¶æ€ï¼Œé€šè¿‡ä¸€ä¸ªå•ç‹¬çš„å±æ€§æ‹¿åˆ°ï¼ˆç”±æ¯ä¸ªå­ç±»å®ç°ï¼Œæ¯”å¦‚MapViewï¼Œé»˜è®¤çš„ç»çº¬åº¦æ˜¯0,0ï¼‰ã€‚æ•´ä½“ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WKInterfaceMap</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *UUID = [<span class="built_in">NSUUID</span> UUID].UUIDString;</span><br><span class="line">    <span class="built_in">NSString</span> *property = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;%@_%@&quot;</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], UUID];</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> _initForDynamicCreationWithInterfaceProperty:property];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)interfaceDescriptionForDynamicCreation &#123;</span><br><span class="line">    <span class="keyword">return</span> @&#123;</span><br><span class="line">        <span class="string">@&quot;type&quot;</span> : <span class="string">@&quot;map&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;property&quot;</span> : <span class="keyword">self</span>.interfaceProperty,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œè¿™ç§ä½¿ç”¨initæ³¨å†Œçš„WKInterfaceObjectï¼Œä¼šä¿ç•™ä¸€ä¸ªå¯¹åº”UIViewçš„weakå¼•ç”¨ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ç§æœ‰çš„<code>_interfaceView</code>æ‹¿åˆ°ã€‚SwiftUIå†…éƒ¨åœ¨å¸ƒå±€çš„æ—¶å€™ä¹Ÿç”¨åˆ°äº†è¿™ä¸ªNative UIViewæ¥å®ç°ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2019/12/10/watchkit-swiftui2.png" alt="watchkit-swiftui2"></p><h3 id="SwiftUIä¸watchOS-Native-App"><a href="#SwiftUIä¸watchOS-Native-App" class="headerlink" title="SwiftUIä¸watchOS Native App"></a>SwiftUIä¸watchOS Native App</h3><p>é€šè¿‡ä»Native watchOS Appçš„å¸ƒå±€åˆ†æä¸Šæ¥çœ‹ï¼ŒSwiftUIå‚è€ƒiOSä¸Šçš„æ–¹æ¡ˆï¼Œä¾æ—§æ˜¯ç”¨äº†ä¸€ä¸ªå•ç‹¬çš„UIHostingViewæ¥æ’å…¥åˆ°Native Appçš„è§†å›¾å±‚çº§ä¸­ï¼Œä¹Ÿæœ‰å¯¹åº”çš„UIHostingControllerã€‚</p><p>ä½†æ˜¯ä¸åŒäºiOSçš„æ˜¯ï¼ŒSwiftUIä¼šå¯¹æ¯ä¸€ä¸ªPush/Presentå‡ºæ¥çš„æ–°Viewï¼ˆä¸æ˜¯å¦ç”¨äº†ä¸Šé¢æåˆ°çš„WKInterfaceObjectRepresentableæ— å…³ï¼Œè¿™æ ·è®¾è®¡çš„åŸå› è§ä¸‹ï¼‰ï¼Œé¢å¤–å¥—äº†ä¸€ä¸ªå«åš<a href="https://github.com/LeoNatan/Apple-Runtime-Headers/blob/master/watchOS/Frameworks/WatchKit.framework/SPHostingViewController.h">SPHostingViewController</a>çš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ªä¸Šæ–‡æåˆ°çš„SPViewControllerã€‚</p><p>æ¯ä¸ªUIHostingControllerå¥—åœ¨äº†SPHostingViewControllerçš„Child VCä¸­ï¼Œå¯¹åº”Viewé€šè¿‡çº¦æŸå®šæˆä¸€æ ·çš„frameï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå®¹å™¨çš„å…³ç³»ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2019/12/10/watchkit3.jpg" alt="watchkit3"></p><p>å½“ä½ çš„SwiftUI Viewï¼Œå«æœ‰è‡³å°‘ä¸€ä¸ªWatchKit Interface Objectä¹‹åï¼Œè¿™ä¸ªSPHostingViewControllerå°±èµ·åˆ°äº†å¾ˆå¤§ä½œç”¨ã€‚å®ƒéœ€è¦è°ƒåº¦å’Œå¤„ç†ä¸Šæ–‡æåˆ°çš„WatchKitæ¶ˆæ¯ã€‚SPHostingViewControllerå†…éƒ¨å­˜å‚¨äº†æ‰€æœ‰interfaceçš„propertyï¼ŒNative UIViewåˆ—è¡¨ï¼Œé€šè¿‡éå†æ¥è¿›è¡Œåˆ†å‘ï¼Œèµ°æ™®é€šçš„WatchKitæµç¨‹ã€‚å®ƒç›¸å½“äºèµ·åˆ°ä¸€ä¸ªè½¬å‘ä»£ç†çš„ä½œç”¨ï¼Œè®©è¿™äº›WatchKitçš„Interface Objectå®ç°ä¸éœ€è¦ä¿®æ”¹ä»£ç èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2019/12/10/watchkit-swiftui1.jpeg" alt="watchkit-swiftui1"></p><h3 id="SwiftUIä¸Long-Look-Notification"><a href="#SwiftUIä¸Long-Look-Notification" class="headerlink" title="SwiftUIä¸Long-Look Notification"></a>SwiftUIä¸Long-Look Notification</h3><p>åˆ°è¿™é‡Œå…¶å®äº‹æƒ…è¿˜ç®—ç®€å•ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ç§æ›´ä¸ºå¤æ‚çš„æƒ…å½¢ã€‚SwiftUIæ”¯æŒåˆ›å»ºè‡ªå®šä¹‰çš„watchOS Long-Look UIã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¯¹åº”çš„WKUserNotificationHostingControllerï¼ˆç»§æ‰¿è‡ªWKUserNotificationInterfaceControllerï¼‰ï¼Œå°±åƒWatchOS Appä¸€æ ·ã€‚</p><p>ä½†æ˜¯ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼šæ—¢ç„¶SwiftUIæ”¯æŒæ¡¥æ¥ç³»ç»ŸInterface Objectï¼Œå¦‚æœæˆ‘åœ¨è¿™é‡Œçš„HostingViewä¸­ï¼Œå†æ”¾ä¸€ä¸ªWatchKit Interface Objectï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿç­”æ¡ˆä¾ç„¶æ˜¯æ”¯æŒã€‚</p><p>SPHostingViewControllerè¿™ä¸ªç±»å…¼å®¹äº†è¿™ç§æç«¯Caseï¼Œå®ƒè½¬å‘æ‰€æœ‰æ”¶åˆ°çš„Remote/Local Notificationï¼Œæ‰¿æ‹…äº†åŸæœ¬WatchKitçš„WKUserNotificationInterfaceControllerçš„ä¸€éƒ¨åˆ†è´£ä»»ï¼ˆå› ä¸ºç»§æ‰¿é“¾çš„å…³ç³»ï¼Œå®ƒä¸æ˜¯WKUserNotificationInterfaceControllerå­ç±»ï¼Œä½†æ˜¯å®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼‰ã€‚å› æ­¤å®é™…ä¸Šï¼ŒSPHostingViewControllerå†…éƒ¨é™¤äº†ä¸Šé¢æåˆ°çš„property, Native UIViewåˆ—è¡¨å¤–ï¼Œè¿˜å­˜å‚¨äº†å¯¹åº”Notification Actionçš„åˆ—è¡¨ï¼Œç”¨äºè½¬å‘ç”¨æˆ·ç‚¹å‡»åœ¨é€šçŸ¥ä¸Šçš„åŠ¨ä½œæ¥åˆ·æ–°UIã€‚</p><h2 id="Independent-watchOS-App"><a href="#Independent-watchOS-App" class="headerlink" title="Independent watchOS App"></a>Independent watchOS App</h2><p>åœ¨å†å²ä¸Šï¼Œæ‰€æœ‰çš„watchOS Appï¼Œéƒ½å¿…é¡»Bundleåœ¨ä¸€ä¸ªiOS Appä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œå°±ç®—ä½ çš„watchOS Appæ˜¯ä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨ï¼Œä¸éœ€è¦ä»»ä½•iPhoneçš„è”åŠ¨å’ŒåŒæ­¥åŠŸèƒ½ï¼Œä½ ä¹Ÿå¿…é¡»åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿåœ¨iOSä¸Šçš„App Storeå®¡æ ¸é€šè¿‡çš„Appã€‚å› æ­¤åˆ¶ä½œä¸€ä¸ªwatchOS Appçš„å‰æå˜å¾—æ›´å¤æ‚ï¼Œå®ƒéœ€è¦ä¸€ä¸ªiOS Appã€‚è€Œä¸”ä»¥è¿™é‡Œçš„è®¡ç®—å™¨æ¥è¯´ï¼Œä½ ä¸å¯ä»¥ç›´æ¥å¥—ä¸€ä¸ªç®€å•ç©ºå£³çš„iOS Appï¼Œå¼•å¯¼ç”¨æˆ·åªä½¿ç”¨Apple Watchï¼Œå› ä¸ºiOS App Storeçš„å®¡æ ¸å°†ä¸ä¼šé€šè¿‡ã€‚è¿™ä¹Ÿæ˜¯é€ æˆwatchOS AppåŒ®ä¹çš„ä¸€ä¸ªé—®é¢˜ã€‚</p><p>ä»watchOS 6ä¹‹åï¼Œç”±äºä¸Šè¿°çš„ä¸€ç³»åˆ—å¼€å‘å·¥å…·ä¸Šå’Œæ¨¡å¼ä¸Šçš„æ”¹åŠ¨ï¼Œè‹¹æœå¬å–äº†å¼€å‘è€…çš„æ„è§ï¼Œèƒ½å¤Ÿå…è®¸ä½ åˆ›é€ ä¸€ä¸ªç‹¬ç«‹çš„watchOS Appï¼Œå®ƒä¸å†ä¸éœ€è¦ä»»ä½•iOS Appï¼Œç›´æ¥ä»Apple Watchä¸Šå®‰è£…ï¼Œä¸‹è½½ï¼Œè¿è¡Œã€‚watchOS Appä¹Ÿä¸å†å¿…é¡»å’ŒiOS Appæœ‰æ‰€å…³è”ã€‚</p><h3 id="å¼€å‘é…ç½®"><a href="#å¼€å‘é…ç½®" class="headerlink" title="å¼€å‘é…ç½®"></a>å¼€å‘é…ç½®</h3><p>å°†ä¸€ä¸ªå·²æœ‰çš„éç‹¬ç«‹watchOS Appè½¬å˜ä¸ºç‹¬ç«‹Appæ¯”è¾ƒç®€å•ï¼Œä½ åªéœ€è¦åœ¨Xcodeä¸­é€‰ä¸­çš„watchOS Extension Targetï¼Œå‹¾é€‰<code>Supports Running Without iOS App Installation</code>å³å¯ã€‚</p><p>æ³¨æ„ï¼Œç‹¬ç«‹watchOS Appç›®å‰å¹¶ä¸æ„å‘³ç€ä½ ä¸èƒ½ä½¿ç”¨WatchConnectivityæ¥åŒæ­¥iPhoneçš„æ•°æ®ã€‚ä½ ä¾ç„¶å¯ä»¥åœ¨ä½ çš„Extension Targetä¸­å£°æ˜ä½ å¯¹åº”çš„iOS Appçš„Bundle IDã€‚</p><p>æ³¨æ„ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ä¸‹è½½è¿™ä¸ªwatchOS Appå¯¹åº”çš„iOS Appï¼Œé‚£ä¹ˆWatchConnectivityçš„<code>WCSession.companionAppInstalled</code>çš„æ–¹æ³•ä¼šç›´æ¥è¿”å›NOï¼Œå°±ç®—å¼ºåˆ¶è°ƒç”¨<code>sendMessage:</code>ï¼Œä¹Ÿä¼šè¿”å›ä¸å¯ç”¨çš„Errorï¼Œåœ¨ä»£ç é‡Œé¢éœ€è¦å¯¹æ­¤æå‰åˆ¤æ–­ã€‚</p><h3 id="App-Slicing"><a href="#App-Slicing" class="headerlink" title="App Slicing"></a>App Slicing</h3><p>ç‹¬ç«‹watchOS Appä¼šåˆ©ç”¨App Slicingï¼Œè€Œéç‹¬ç«‹Appä¸ä¼šã€‚Apple Watchä»Series 4å¼€å§‹é‡‡å–äº†64ä½çš„CPUï¼Œè€Œä¸æ­¤åŒæ—¶ï¼Œç”±äºç”¨æˆ·çš„iPhoneçš„CPUæ¶æ„å’ŒApple Watchçš„CPUæ¶æ„æ˜¯æ— å…³çš„ï¼ˆä½ å¯ä»¥åœ¨iPhone 11ä¸Šé…å¯¹ä¸€ä¸ªApple Watch Series 3ï¼Œå¯¹å§ï¼‰ï¼Œè€ŒwatchOS Appåˆæ˜¯æ†ç»‘åœ¨ipaä¸­çš„ï¼Œè¿™å°±å¯¼è‡´ä½ çš„ipaåŒ…ä¸­ï¼Œå§‹ç»ˆä¼šå«æœ‰ä¸¤ä»½watchOSçš„äºŒè¿›åˆ¶ï¼ˆarmv7k arm64_32ï¼‰ï¼Œç”¨æˆ·ä¸‹è½½å®Œæˆåï¼Œåœ¨åŒæ­¥æ‰‹è¡¨æ—¶åªä¼šç”¨åˆ°ä¸€ä»½ï¼Œå¹¶ä¸”åŸå§‹ipaä¸­ä¾æ—§ä¼šä¿ç•™è¿™ä»½äºŒè¿›åˆ¶ã€‚è¿™æ˜¯ä¸€ç§å¸¦å®½å’Œå­˜å‚¨æµªè´¹ã€‚</p><p>å¯¹äºç‹¬ç«‹watchOS Appï¼Œå¯ä»¥ç›´æ¥ä»watchOS App Storeä¸‹è½½ï¼Œé‚£ä¹ˆå°†åªä¸‹è½½Slicingä¹‹åçš„éƒ¨åˆ†ï¼ŒèŠ‚çœè¿‘ä¸€åŠçš„å¸¦å®½/å­˜å‚¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°±ç®—æ˜¯ç‹¬ç«‹watchOS Appï¼Œä¾ç„¶å¯ä»¥ä»iPhoneæ‰‹æœºä¸Šæ“ä½œï¼Œæ¥ç›´æ¥å®‰è£…åˆ°Apple Watchä¸­ï¼Œå› ä¸ºåœ¨Apple Watchå°å±å¹•ä¸Šçš„App Storeæœç´¢æ–‡æœ¬å’Œè¯­éŸ³è¾“å…¥çš„ä½“éªŒå¹¶ä¸æ˜¯å¾ˆå¥½ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸Šé¢å®Œæ•´çš„åŸç†åˆ†æï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒWatchKitè¿™ä¸€ä¸ªUIæ¡†æ¶ï¼Œé€šè¿‡ä¸€ç§å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„æ–¹æ¡ˆï¼Œç”±äºæŠ½è±¡äº†è¿æ¥ï¼Œå³ä½¿watchOS 1åˆ°watchOS 2äº§ç”Ÿäº†å¦‚æ­¤å¤§çš„æ¶æ„å˜åŒ–ï¼Œå¯¹ä¸Šå±‚çš„APIåŸºæœ¬ä¿æŒäº†ç›¸å¯¹ä¸å˜ã€‚è¿™ä¸€ç‚¹å¯¹äºåº“å¼€å‘è€…å€¼å¾—å‚è€ƒï¼Œé€šè¿‡è‰¯å¥½çš„æ¶æ„è®¾è®¡èƒ½å¤Ÿå¹³æ»‘è¿ç§»ã€‚</p><p>ä¸è¿‡å®é™…ä»å„ä¸ªç¤¾äº¤æ¸ é“çš„åé¦ˆï¼Œå¼€å‘è€…å¯¹äºWatchKitçš„æ€åº¦å¹¶ä¸æ˜¯é‚£ä¹ˆä¹è§‚ï¼Œç”±äºéšè—äº†æ‰€æœ‰çœŸæ­£èƒ½å¤Ÿæ“ä½œå±å¹•åƒç´ çš„æ–¹æ¡ˆï¼ˆæ— æ³•ä½¿ç”¨Metalè¿™ç§åº•å±‚æ¥å£ï¼Œä¹Ÿæ²¡æœ‰UIKitè¿™ç§ä¸Šå±‚æ¥å£ï¼‰ï¼Œå¯¼è‡´WatchOS Appçš„ç”Ÿæ€ç¯å¢ƒå®é™…ä¸Šå¹¶ä¸æ˜¯é‚£ä¹ˆç†æƒ³ï¼Œå¾ˆå¤šAppéƒ½æ˜¯éå¸¸ç®€å•å’Œç©å…·çº§åˆ«çš„é¡¹ç›®ã€‚è™½ç„¶è¿™æ˜¯å¯ä»¥å½’å› äºApple Watchæœ¬èº«ç¡¬ä»¶æ€§èƒ½çš„é™åˆ¶ï¼Œä½†æ˜¯å’ŒWatchKitæä¾›çš„æ¥å£ä¹Ÿè„±ç¦»ä¸äº†å…³ç³»ã€‚</p><p>å¦‚æœè®©æˆ‘æ¥é‡æ–°è®¾è®¡WatchKitï¼Œå¯èƒ½åœ¨watchOS 2æ—¶ä»£ï¼Œå°±ä¼šå½»åº•Deprecateç›®å‰çš„WatchKitï¼Œè€Œæ˜¯å–è€Œä»£ä¹‹é‡‡å–å…¬å¼€ç²¾ç®€çš„UIKitå®ç°æ¥è®©å¼€å‘è€…æœ€å¤§åŒ–åˆ©ç”¨ç¡¬ä»¶ï¼ˆç±»ä¼¼äºç›®å‰çš„UIKitåœ¨tvOSä¸Šçš„ç°çŠ¶ï¼‰ï¼ŒåŒæ—¶ï¼Œæä¾›ä¸€ä¸ªæ–°çš„WatchUIKitæ¥æä¾›æ‰€æœ‰ä¸“ä¸ºApple Watchè®¾è®¡çš„UIå’ŒåŠŸèƒ½ï¼Œæ¯”å¦‚Digital Crownï¼Œæ¯”å¦‚Activity Ringã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/2019/12/10/watchkit-twitter.jpg" alt="watchkit-twitte"></p><p>SwiftUIä¸ºwatchOS Appæä¾›äº†ä¸€ä¸ªæ–°çš„å‡ºè·¯ï¼Œå®ƒå¯ä»¥è¯´æ˜¯çœŸæ­£çš„èƒ½å¤Ÿå‘æŒ¥å¼€å‘è€…èƒ½åŠ›æ¥å®ç°ç²¾è‡´çš„Appï¼Œè€Œä¸å†å—é™äºç³»ç»Ÿæä¾›çš„åŸºæœ¬æ§ä»¶ã€‚è€ŒWatchKitï¼Œä¹Ÿå·²ç»å®Œæˆäº†å®ƒçš„ä½¿å‘½ã€‚ç›¸ä¿¡ä¹‹åçš„SwiftUI Native Appå°†ä¼šä¸ºwatchOSåˆ›é€ ä¸€ç‰‡æ–°çš„ç”Ÿæ€ï¼ŒApple Watchä¹Ÿèƒ½çœŸæ­£æ‘†è„±â€œiPhoneå¤–è®¾â€è¿™ä¸€ä¸ªå°´å°¬çš„å±€é¢ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/WatchKitProgrammingGuide/index.html">App Programming Guide for watchOS</a></li><li><a href="https://developer.apple.com/library/archive/samplecode/WKInterfaceCatalog/Introduction/Intro.html">WatchKit Catalog Example</a></li><li><a href="https://nshipster.com/watchkit/">NSHipster - WatchKit</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2019/219/">WWDC - SwiftUI on watchOS</a></li><li><a href="https://developer.apple.com/tutorials/swiftui/creating-a-watchos-app">SwiftUI Tutorials - Creating a watchOS App</a></li><li><a href="http://developer.limneos.net/">iOS Runtime Headers</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;WatchKitæ¸²æŸ“åŸç†ä»¥åŠSwiftUIæ¡¥æ¥&quot;&gt;&lt;a href=&quot;#WatchKitæ¸²æŸ“åŸç†ä»¥åŠSwiftUIæ¡¥æ¥&quot; class=&quot;headerlink&quot; title=&quot;WatchKitæ¸²æŸ“åŸç†ä»¥åŠSwiftUIæ¡¥æ¥&quot;&gt;&lt;/a&gt;WatchKitæ¸²æŸ“åŸç†ä»¥åŠSwiftUIæ¡¥æ¥&lt;/h1&gt;&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;Apple Watchä½œä¸ºè‹¹æœæ™ºèƒ½ç©¿æˆ´è®¾å¤‡é¢†åŸŸçš„é‡å¤´ï¼Œè‡ªä»ç¬¬ä¸€ä»£å‘å¸ƒå·²ç»ç»å†äº†6æ¬¡æ¢ä»£äº§å“ï¼Œæ“ä½œç³»ç»Ÿçš„è¿­ä»£ä¹Ÿå·²ç»æ›´æ–°åˆ°äº†watchOS 6ã€‚&lt;/p&gt;
&lt;p&gt;ä¸åŒäºiPhoneçš„Appï¼ŒwatchOSä¸Šçš„å¤§éƒ¨åˆ†Appéƒ½ä¾§é‡äºå¥åº·ç®¡ç†ï¼Œå¹¶ä¸”UIäº¤äº’ä»¥ç›´è§‚ï¼Œå¿«é€Ÿä¸ºåŸºå‡†ã€‚åœ¨2015å¹´WWDCä¸Šï¼Œè‹¹æœå‘å¸ƒçš„watchOSçš„åŒæ—¶ï¼Œé¢å‘å¼€å‘è€…å‘å¸ƒäº†WatchKitï¼Œä»¥ç”¨äºæ„å»ºwatchOS Appã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://help.apple.com/assets/61BCCC0198613862887EA61B/61BCCC2A98613862887EA62C/en_US/091b3af363505482da15ec78aa547a4d.png&quot; alt=&quot;watchkit-app.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡ä¸»è¦è®²äº†å…³äºWatchOSä¸Šçš„Appçš„æ¶æ„ä»‹ç»ï¼ŒåŸºæœ¬æ¦‚å¿µï¼Œå¹¶æ·±å…¥åˆ†æäº†WatchKitçš„UIæ¸²æŸ“é€»è¾‘ï¼Œä¹Ÿè°ˆäº†ä¸€äº›WatchOSå’ŒSwiftUIç›¸å…³çš„é—®é¢˜ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="watchOS" scheme="http://dreampiggy.com/tags/watchOS/"/>
    
    <category term="SwiftUI" scheme="http://dreampiggy.com/tags/SwiftUI/"/>
    
    <category term="WatchKit" scheme="http://dreampiggy.com/tags/WatchKit/"/>
    
  </entry>
  
  <entry>
    <title>å‘ç°iOS SDKçš„Bug - Hopperä½¿ç”¨æ•™ç¨‹å‘</title>
    <link href="http://dreampiggy.com/2019/06/13/%E5%8F%91%E7%8E%B0iOS-SDK%E7%9A%84Bug-Hopper%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%E5%90%91/"/>
    <id>http://dreampiggy.com/2019/06/13/%E5%8F%91%E7%8E%B0iOS-SDK%E7%9A%84Bug-Hopper%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%E5%90%91/</id>
    <published>2019-06-13T21:39:38.000Z</published>
    <updated>2022-05-09T07:27:55.183Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hopperç®€ä»‹"><a href="#Hopperç®€ä»‹" class="headerlink" title="Hopperç®€ä»‹"></a>Hopperç®€ä»‹</h1><p>Hopperï¼Œå…¨ç§°Hopper Disassemblerï¼Œæ˜¯ä¸€ä¸ªmacOSå’ŒLinuxå¹³å°ä¸Šçš„åæ±‡ç¼–IDEã€‚æä¾›äº†è¯¸å¦‚ä¼ªä»£ç ï¼Œå­ç¨‹åºï¼Œè„šæœ¬ï¼ŒDebuggerï¼ŒHexç¼–è¾‘ç­‰ç­‰ä¸€äº›åˆ—å·¥å…·ã€‚ç›¸æ¯”äºå…¶ä»–çŸ¥åçš„åæ±‡ç¼–å·¥å…·å¦‚<a href="https://www.hex-rays.com/products/ida/">IDA</a>ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯å¯¹å¹³å°ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯Objective-Cçš„åæ±‡ç¼–æœ‰ä¼˜åŒ–ï¼Œæä¾›éå¸¸è´´è¿‘åŸå§‹ä»£ç çš„ä¼ªä»£ç ï¼ˆIDAç›®å‰åˆ™ä¼šæ˜¯ä¿ç•™è¯¸å¦‚objc_msgSendçš„ä¼ªä»£ç ï¼‰ï¼Œå¹¶ä¸”æ–°ç‰ˆæœ¬ä¹Ÿå¯¹Swiftæä¾›äº†ä¸€å®šçš„åæ±‡ç¼–ç¬¦å·ä¼˜åŒ–ï¼Œå› æ­¤ä½œä¸ºæ¢ç©¶iOSå¹³å°ä¸Šçš„SDKå®ç°ï¼Œå¯ä»¥è¯´æ˜¯ä¸€åˆ©å™¨ã€‚</p><h1 id="Hopperå®‰è£…"><a href="#Hopperå®‰è£…" class="headerlink" title="Hopperå®‰è£…"></a>Hopperå®‰è£…</h1><p>Hopperæœ¬èº«ç›®å‰æ˜¯æ”¶è´¹çš„è½¯ä»¶ï¼Œæä¾›äº†å…è´¹çš„ä½¿ç”¨ï¼ˆ30åˆ†é’Ÿï¼‰ã€‚å®˜æ–¹ä¸‹è½½åœ°å€ä¸ºï¼š<a href="https://www.hopperapp.com/">https://www.hopperapp.com</a></p><p>Macç‰ˆæœ¬åè§£å‹ï¼Œæ‹–åˆ°Applicationä¸‹å³å¯ä½¿ç”¨ã€‚</p><p>å¯¹äºä¸ªäººä½¿ç”¨ï¼Œä»·æ ¼ä¸è²ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸ªäººæ¯”è¾ƒæ¨èç¬¬ä¸€ç§</p><ul><li>Per Userï¼šæ”¶è´¹ä¸ºÂ¥700ï¼Œå…è®¸åŒä¸€æ—¶é—´å”¯ä¸€æ¿€æ´»ï¼Œä¸ç»‘å®šæœºå™¨ç¡¬ä»¶</li><li>Per Computerï¼Œæ”¶è´¹Â¥900ï¼Œå’Œä¸€å°ç”µè„‘çš„æœºå™¨ç¡¬ä»¶ç»‘å®š</li></ul><p>å¯¹äºåªæ˜¯å°é²œæˆ–è€…è½»åº¦ä½¿ç”¨ï¼Œå…¶å®ä½¿ç”¨å…è´¹ç‰ˆå³å¯ã€‚ç½‘ä¸Šç°åœ¨ä¹Ÿæœ‰é’ˆå¯¹æ—§ç‰ˆæœ¬çš„Crackedç‰ˆæœ¬ï¼Œä¸è¿‡å­˜åœ¨ä¸€äº›é—®é¢˜å’Œå´©æºƒã€‚å¦‚æœæ˜¯åœ¨éœ€è¦ï¼Œå¯å°è¯•<a href="https://xclient.info/s/hopper-disassembler.html">é“¾æ¥</a></p><h1 id="Hopperä½¿ç”¨"><a href="#Hopperä½¿ç”¨" class="headerlink" title="Hopperä½¿ç”¨"></a>Hopperä½¿ç”¨</h1><p>Hopperæä¾›äº†ä¸€ä¸ªæ•™ç¨‹ï¼Œå¯ä»¥å‚è€ƒ<a href="https://www.hopperapp.com/tutorial.html">å®˜æ–¹ç®€æ˜“æ•™ç¨‹</a></p><p>é’ˆå¯¹æˆ‘ä»¬çš„åœºæ™¯ï¼šåˆ†æiOSçš„SDKå†…å®ç°æˆ–è€…é—®é¢˜ï¼Œæˆ‘è¿™é‡Œæä¾›äº†ä¸€ä¸ªStep By Stepçš„è¿‡ç¨‹ï¼Œæ•™ä½ å¦‚ä½•æŸ¥æ‰¾é—®é¢˜ã€‚</p><h2 id="è·å–éœ€è¦åæ±‡ç¼–çš„äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#è·å–éœ€è¦åæ±‡ç¼–çš„äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="è·å–éœ€è¦åæ±‡ç¼–çš„äºŒè¿›åˆ¶æ–‡ä»¶"></a>è·å–éœ€è¦åæ±‡ç¼–çš„äºŒè¿›åˆ¶æ–‡ä»¶</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è·å–ä¸€ä»½iOS SDKçš„äºŒè¿›åˆ¶Mach-Oæ–‡ä»¶ã€‚æœ€ç®€å•çš„æ–¹å¼ï¼Œæ˜¯é€šè¿‡Xcodeæä¾›çš„iPhoneæ¨¡æ‹Ÿå™¨å»è·å–å®ƒã€‚åœ¨è·å–ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹iOS SDKå¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ã€‚</p><ul><li>Xcodeè‡ªå¸¦æ¨¡æ‹Ÿå™¨ï¼Œå¯¹åº”ç³»ç»Ÿæ ¹è·¯å¾„ï¼š</li></ul><p>Xcode 11:</p><p><code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot</code></p><p>Xcode 10:</p><p><code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/</code></p><ul><li>å·²ä¸‹è½½çš„å†å²ç‰ˆæœ¬å›ºä»¶çš„æ¨¡æ‹Ÿå™¨ï¼Œå¯¹åº”ç³»ç»Ÿæ ¹è·¯å¾„ï¼Œè‡ªå·±æ ¹æ®ç‰ˆæœ¬ç‰ˆæœ¬ä¿®æ”¹ä¸­é—´çš„æ•°å­—ï¼š</li></ul><p><code>/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS\ 11.4.simruntime/Contents/Resources/RuntimeRoot/</code></p><ul><li>çœŸæœºçš„ç³»ç»Ÿæ ¹è·¯å¾„ï¼Œä¸ç”¨è¯´äº†å§ï¼š</li></ul><p><code>/</code></p><p>iOS ç³»ç»Ÿæçš„åº“å’ŒäºŒè¿›åˆ¶ï¼Œå¯ä»¥ç®€å•åˆ†ä»¥ä¸‹å‡ ç±»ï¼ŒæŒ‰ç…§éœ€è¦é€‰æ‹©å¯¹åº”çš„ç›¸å¯¹æ ¹è·¯å¾„ï¼š</p><ul><li>å…¬å¼€Framework: <code>/System/Library/Framework</code></li><li>ç§æœ‰Frameworkï¼š<code>/System/Library/PrivateFrameworks</code></li><li>ç³»ç»ŸAppï¼š<code>/Applications</code></li><li>UNIXåŠ¨æ€åº“: <code>/usr/lib</code></li></ul><p>è¿™é‡Œæˆ‘ä»¬ä»¥Xcode 10è‡ªå¸¦çš„iOS 12 SDKï¼ŒUIKitCoreä¸ºä¾‹ï¼ˆæ³¨æ„ï¼ŒUIKitä»iOS 12å¼€å§‹ï¼Œä¸ºäº†æ”¯æŒéƒ¨ç½²åˆ°macOSï¼Œå°†ä»£ç åŸºæœ¬å…¨ç›˜ç§»åŠ¨åˆ°äº†ç§æœ‰Frameworkçš„UIKitCore.frameworkä¸­ï¼ŒUIKit.frameworkåªæ˜¯ä¸€ä¸ªå¤–å±‚çš„å£³ï¼‰ï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥å»è®¿é—®è¿™ä¸ªè·¯å¾„ï¼Œè·å–å®ƒçš„Mach-OäºŒè¿›åˆ¶ï¼š</p><p><code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/PrivateFrameworks/UIKitCore.framework/UIKitCore</code></p><p>ä¸€èˆ¬æ¥è¯´ï¼ŒiPhoneæ¨¡æ‹Ÿå™¨æä¾›çš„äºŒè¿›åˆ¶Mach-Oå³å¯å¤Ÿç”¨ï¼Œè™½ç„¶å®ƒå®é™…ä¸Šæ˜¯x86_64æ¶æ„çš„ç¼–è¯‘äº§ç‰©ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šçš„é€»è¾‘å’ŒçœŸæœºä¸Šæ˜¯ä¸€è‡´çš„ã€‚å¦‚æœæ¶‰åŠåˆ°éœ€è¦åªèƒ½åœ¨çœŸæœºå¯ç”¨çš„åº“ï¼Œå¦‚AVFoundationçš„æ‘„åƒæœºï¼Œå»ºè®®å¯ä»¥ä»çœŸæœºä¸­æå–ï¼ˆä¹Ÿå¯ä»¥ä»iOSçš„IPSWå›ºä»¶ä¸­æå–ï¼‰ï¼Œè§ä¸‹æ–‡ã€‚</p><h3 id="çœŸæœºè·å–ç³»ç»Ÿåº“çš„äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#çœŸæœºè·å–ç³»ç»Ÿåº“çš„äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="çœŸæœºè·å–ç³»ç»Ÿåº“çš„äºŒè¿›åˆ¶æ–‡ä»¶"></a>çœŸæœºè·å–ç³»ç»Ÿåº“çš„äºŒè¿›åˆ¶æ–‡ä»¶</h3><h3 id="è·å–dyld-shared-cache"><a href="#è·å–dyld-shared-cache" class="headerlink" title="è·å–dyld shared cache"></a>è·å–dyld shared cache</h3><p>åœ¨çœŸæœºä¸Šï¼Œä¸ºäº†åŠ å¿«åŠ¨æ€åº“çš„åŠ è½½ï¼Œå¹¶å‡å°‘iOS å ç”¨ç£ç›˜çš„ä½“ç§¯ï¼Œdyldé‡‡å–äº†ä¸€ä¸ªç¼“å­˜ï¼Œå°†å¤šä¸ªMach-Oæ–‡ä»¶åˆå¹¶åˆ°ä¸€èµ·ï¼Œç”±ç³»ç»Ÿå¯åŠ¨åå°±é¢„çƒ­ã€‚å› æ­¤ï¼Œå®é™…ä¸Šç³»ç»Ÿåº“ï¼ˆå…¬å¼€å’Œç§æœ‰ï¼‰çš„è·¯å¾„ä¸Šï¼Œåªæœ‰Frameworkå’Œå…¶ä¸­çš„èµ„æºæ–‡ä»¶ï¼Œå´æ²¡æœ‰å¯¹åº”çš„Mach-OäºŒè¿›åˆ¶ã€‚æˆ‘ä»¬éœ€è¦é¦–å…ˆè·å–åˆ°è¿™ä¸ªcacheï¼Œç„¶åè§£å‹å‡ºæ¥å¯¹åº”çš„äºŒè¿›åˆ¶ã€‚å‚è€ƒ<a href="https://iphonedevwiki.net/index.php/Dyld_shared_cache">dyld_shared_cache</a></p><p>å¯¹åº”dyld shared cacheè·¯å¾„ï¼ˆä»¥arm64æœºå™¨ä¸ºä¾‹ï¼‰ï¼š<code>/System/Library/Caches/com.apple.dyld/dyld_shared_cache_arm64</code></p><p>å½“ç„¶ï¼Œé™¤äº†ä½¿ç”¨å·²ç»è¶Šç‹±çš„çœŸæœºï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡IPSWï¼Œå³iOSçš„å›ºä»¶åŒ…ï¼Œæ¥ç›´æ¥æå–å¯¹åº”çš„dyld shared cacheï¼Œå¹¶è§£å‹å¾—åˆ°å¯¹åº”çš„Mach-Oæ–‡ä»¶ã€‚</p><p>IPSWå¯ä»¥ä»è¿™ä¸ª<a href="https://ipsw.me/">ç½‘é¡µ</a>ä¸Šä¸‹è½½ï¼Œé€‰æ‹©ä½ çš„è®¾å¤‡ä»¥åŠiOSç‰ˆæœ¬å·ï¼Œå°±å¯ä»¥ä¸‹è½½å¯¹åº”çš„IPSWæ–‡ä»¶ã€‚</p><p>å°†ä¸‹è½½çš„IPSWè§£å‹ï¼ˆå»ºè®®ä½¿ç”¨zipå‘½ä»¤è¡Œï¼Œæˆ–è€…BetterZipä¹‹ç±»çš„è§£å‹è½¯ä»¶ï¼ŒMacè‡ªå¸¦çš„è§£å‹ä¼¼ä¹ä¼šæŠ¥é”™ï¼‰ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæœ€å¤§å®¹é‡çš„DMGæ–‡ä»¶ï¼ŒåŒå‡»å³å¯åŠ è½½<br><img src="http://dreampiggy-image.test.upcdn.net/image/2019/06/13/15604236336003.jpg"></p><p>åŠ è½½åå°±æ˜¯å®Œæ•´çš„iOSç³»ç»Ÿæ ¹è·¯å¾„äº†ï¼Œä»å¯¹åº”è·¯å¾„ä¸‹æ‰¾åˆ°dyld shared cacheã€‚</p><h3 id="è§£å‹dyld-shared-cache"><a href="#è§£å‹dyld-shared-cache" class="headerlink" title="è§£å‹dyld shared cache"></a>è§£å‹dyld shared cache</h3><p>ä¸ºäº†è§£å‹dyld shared cacheï¼Œå¸‚é¢ä¸Šä¸€äº›å·¥å…·å…¶å®æ—©å·²è¿‡æœŸï¼Œè¦ä¹ˆä¸æ”¯æŒarm64ï¼Œè¦ä¹ˆå­˜åœ¨Bugã€‚ä½†å®é™…ä¸Šï¼ŒAppleè‡ªå·±å¼€æºçš„dyldæºä»£ç ï¼Œå°±å·²ç»åŒ…å«äº†è¿™æ ·ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå«åš<code>dsc_extractor</code>ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥ç”¨æ¥æºç æ¥ç¼–è¯‘ä¸€ä»½æ¥ä½¿ç”¨å³å¯ã€‚</p><p>è¿›å…¥<a href="https://opensource.apple.com/%EF%BC%8C">opensource.apple.com</a>é€‰æ‹©æœ€æ–°çš„macOSçš„ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œä¾‹å­ä½¿ç”¨çš„æ˜¯æˆ‘å†™è¿™ç¯‡æ–‡ç« æœ€æ–°å…¬å¼€çš„ <a href="https://opensource.apple.com/release/macos-10141.html">macOS 10.14.1</a></p><p>ç„¶åä¸‹è½½ä¸¤ä»½ä»£ç ï¼Œä¸€ä»½æ˜¯<a href="https://opensource.apple.com/tarballs/dyld/dyld-635.2.tar.gz">dyld</a>ï¼Œä¸€ä»½æ˜¯<a href="https://opensource.apple.com/tarballs/CommonCrypto/CommonCrypto-60118.220.1.tar.gz">CommonCrypto</a></p><p>ä¸ºäº†ç¼–è¯‘ï¼Œéœ€è¦ä¸€ç‚¹å°æŠ€å·§ï¼Œä½†æ˜¯å¯¹äºiOSå¼€å‘è€…æˆ‘è§‰å¾—æŒºç®€å•</p><ol><li>ç”¨Xcodeï¼Œæ‰“å¼€dyldä»£ç ä¸­çš„<code>dyld.xcodeproj</code></li><li>ä¿®æ”¹Build Settingsä¸­ï¼ŒæŠŠå¯¹åº”çš„Base SDKï¼Œä»<code>macosx.internal</code>æ”¹æˆå…¬å¼€çš„<code>macOS</code></li><li>è¿›å…¥<code>dsc_extractor.cpp</code>ï¼Œçœ‹åˆ°æœ€åæœ‰ä¸€ä¸ª<code>test program</code>ï¼ŒæŠŠä¸Šé¢çš„<code>#if 0</code>æ”¹æˆ<code>#if 1</code></li><li>æˆ‘åœ¨ç¼–è¯‘æ–°ç‰ˆæœ¬æ—¶å‘ç°ä¾èµ–äº†ä¸€ä¸ªå«åš<code>CommonDigestSPI.h</code>çš„ç§æœ‰å¤´æ–‡ä»¶ï¼Œè¿™ä¸ªåœ¨ä¸‹è½½çš„CommonCryptoå·¥ç¨‹ä¸­ï¼Œæ‹–è¿›æ¥æ”¹ä¸€ä¸‹å¼•ç”¨æ–¹å¼å³å¯</li><li>é€‰æ‹©<code>dsc_extractor</code>ï¼ŒArchiveå¾—åˆ°ä¸€ä¸ªäº§ç‰©ï¼Œå«åš<code>dsc_extractor.bundle</code>ï¼Œç„¶è€Œä»–å®é™…å°±æ˜¯ä¸€ä¸ªMach-OäºŒè¿›åˆ¶ï¼Œç›´æ¥åˆ æ‰åç¼€ï¼Œchmod+xï¼Œå³å¯ä½¿ç”¨</li></ol><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/06/13/15604271114928.jpg"></p><p>å¦‚æœä¸Šé¢çš„ç¼–è¯‘æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½æˆ‘è¿™é‡Œç¼–è¯‘å¥½çš„ä¸€ä»½äºŒè¿›åˆ¶ï¼Œç„¶åæ”¾åˆ°ä½ çš„PATHè·¯å¾„ä¸‹ï¼š<a href="https://raw.githubusercontent.com/dreampiggy/dsc_extractor/master/bin/dsc_extractor">dsc_extractor</a></p><p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>dsc_extractor</code>æ¥è§£å‹æˆ‘ä»¬æå–åˆ°çš„dyld shared cacheï¼Œå¾ˆç®€å•çš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dsc_extractor ./dyld_shared_cache_arm64e ./output</span><br></pre></td></tr></table></figure><p>ä¼šå¾—åˆ°æ‰€æœ‰dyld shared cacheä¸­çš„äºŒè¿›åˆ¶Mach-Oæ–‡ä»¶ï¼ŒæŒ‰ç…§è·¯å¾„æ’åˆ—ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”¨è‡ªå·±æƒ³åç¼–è¯‘çš„åº“ï¼Œå¦‚UIKitCoreï¼Œæ¥ä½¿ç”¨Hopperäº†ã€‚</p><h2 id="è½½å…¥Hopper"><a href="#è½½å…¥Hopper" class="headerlink" title="è½½å…¥Hopper"></a>è½½å…¥Hopper</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªUIKitCoreçš„Mach-Oæ–‡ä»¶äº†ï¼Œæˆ‘ä»¬æ‰“å¼€Hopperæ¥è½½å…¥å®ƒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Command+Shift+Oæ¥é€‰æ‹©ä¸€ä¸ªMach-Oæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å°†æ–‡ä»¶æ‹–åŠ¨åˆ°Hopperç•Œé¢ä¸Šæ¥æ‰“å¼€ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/06/13/15604335461822.jpg"></p><p>è½½å…¥Mach-Oæ–‡ä»¶åï¼ŒHopperä¼šå¼¹å‡ºæ¡†æ¥é€‰æ‹©å…·ä½“åˆ†æçš„å†…å®¹ï¼Œå¤§éƒ¨åˆ†æƒ…å†µç›´æ¥ç¡®è®¤å³å¯ã€‚å¦‚æœæ˜¯åˆ†æå…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œå¯èƒ½æœ‰ç‰¹ä¾‹å¦‚ä¸‹ï¼š</p><ul><li>åˆ†æä¸€ä¸ª.aæˆ–è€….dylibï¼Œå¹¶ä¸”è¯¥äºŒè¿›åˆ¶ç”±å¤šä¸ª.aæˆ–è€….dylibåˆæˆï¼Œè¿™æ—¶å€™ä¼šæç¤ºä½ é€‰æ‹©å…·ä½“çš„æŸä¸ªç¼–è¯‘äº§ç‰©</li><li>åˆ†æä¸€ä¸ªFAT Binaryï¼Œè¿™æ—¶å€™ä¼šæç¤ºä½ é€‰æ‹©å…·ä½“çš„æŸä¸€ä¸ªæ¶æ„çš„æ–‡ä»¶</li></ul><p>è½½å…¥å¼€å§‹åï¼Œä¸€èˆ¬éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ¥åˆ†æï¼ˆä¸‹æ–¹ä¼šæœ‰è¿›åº¦æ¡ï¼‰ï¼Œç­‰å¾…åˆ†æå®Œæˆåï¼Œä½ å¯ä»¥å°†å½“å‰åˆ†æçš„ç»“æœï¼Œä¿å­˜æˆä¸€ä¸ª<code>.hop</code>ç»“å°¾çš„æ–‡ä»¶ï¼Œæœªæ¥å°±ä¸å†éœ€è¦åˆ†æäº†ï¼Œéå¸¸æœ‰ç”¨ï¼ˆæ³¨ï¼šå…è´¹ç‰ˆä¸å¯ç”¨ï¼‰ã€‚</p><h2 id="ç¬¦å·åˆ†æ"><a href="#ç¬¦å·åˆ†æ" class="headerlink" title="ç¬¦å·åˆ†æ"></a>ç¬¦å·åˆ†æ</h2><p>å·¦ä¾§æœ‰ä¸€ä¸ªç¬¦å·æ¡†ï¼Œä»å·¦åˆ°å³ä¾æ¬¡è¡¨ç¤ºï¼š</p><ul><li>Labels: C/C++Objective-Cçš„ç¬¦å·ï¼ŒåŒ…æ‹¬ç±»åï¼Œæ–¹æ³•åï¼Œå…¨å±€å˜é‡ç­‰</li><li>Procï¼šå­ç¨‹åºï¼Œå¯¹åº”C/C++çš„å‡½æ•°ï¼ŒObjective-Cçš„æ–¹æ³•ï¼ŒBlockä»£ç æ®µç­‰</li><li>Strï¼šå¸¸é‡æ®µï¼ŒåŒ…æ‹¬äº†æ‰€æœ‰C/C++Objective-Cå­—é¢é‡ï¼Œå³ä»£ç ä¸­ç›´æ¥ç”¨<code>@&quot;&quot;, &quot;&quot;</code>å†™çš„å†…å®¹</li></ul><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/06/13/15592985644004.jpg"></p><p>æ¯é¡¹å†…å®¹éƒ½æ”¯æŒæœç´¢ï¼Œä¸€èˆ¬æ¥è¯´å–å†³äºæˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜ï¼Œæœ‰å¤§æ¦‚å‡ ä¸ªåœºæ™¯</p><ol><li>åˆ†æç‰¹å®šæ–¹æ³•çš„å®ç°ï¼šä½¿ç”¨Procæœç´¢</li><li>è¿è¡Œæ—¶æŠ›å‡ºçš„å¼‚å¸¸æˆ–è€…Logï¼šä½¿ç”¨Stræœç´¢å…³é”®å­—</li><li>å¾—çŸ¥ä¸€ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•ï¼šå¯ä»¥ä½¿ç”¨Labelï¼Œä½†æ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡Class-dumpè·å–å¤´æ–‡ä»¶ï¼ˆè§ä¸‹ï¼‰</li></ol><h2 id="Class-dumpä¸ç§æœ‰å¤´æ–‡ä»¶"><a href="#Class-dumpä¸ç§æœ‰å¤´æ–‡ä»¶" class="headerlink" title="Class-dumpä¸ç§æœ‰å¤´æ–‡ä»¶"></a>Class-dumpä¸ç§æœ‰å¤´æ–‡ä»¶</h2><p><a href="https://github.com/nygard/class-dump">Class-dump</a>æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè§£æMach-Oæ–‡ä»¶ï¼Œå¯¹åº”çš„Objective-Cç¬¦å·ï¼Œä»¥ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„å¤´æ–‡ä»¶çš„å·¥å…·ã€‚å¾—ç›ŠäºObjective-Cè¿è¡Œæ—¶å’Œç¬¦å·çš„ç‰¹ç‚¹ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿˜åŸå›åŸºæœ¬æ¥è¿‘åŸå§‹çš„ç±»å£°æ˜ä»£ç ã€‚å…·ä½“ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œå‚è§é¡¹ç›®çš„Readmeï¼Œç¼–è¯‘å¾—åˆ°äºŒè¿›åˆ¶ï¼Œæ”¾åˆ°PATHä¸­ï¼Œç„¶åæ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class-dump UIKitCore.framework -r -o output -H</span><br></pre></td></tr></table></figure><p>å¯¹äºé‡å¤´æˆï¼Œå…³äºiOS SDKçš„æ‰€æœ‰å¤´æ–‡ä»¶ï¼Œæ—©æœ‰ä¸“äººå»ºç«‹äº†ä¸€ä¸ªåœ¨çº¿ç½‘ç«™å»åˆ†æï¼Œç‚¹å‡»è·³è½¬ï¼š<a href="http://developer.limneos.net/">iOS Runtime Headers</a></p><p>åœ¨è¿™ä¸ªç½‘é¡µä¸Šï¼Œå¯ä»¥æ”¯æŒFramework/ç±»/æ–¹æ³•çº§åˆ«çš„æœç´¢ï¼Œæ”¯æŒç‚¹å‡»å¤´æ–‡ä»¶è·³è½¬é“¾æ¥ï¼Œéå¸¸çš„æ–¹ä¾¿ï¼Œä¸€èˆ¬çš„åˆ†æiOS SDKéƒ½å¯ä»¥é‡‡å–è¿™ä¸ªç½‘é¡µçš„ç»“æœæ¥è¾…åŠ©åˆ†æã€‚</p><h2 id="ä¼ªä»£ç åˆ†æ"><a href="#ä¼ªä»£ç åˆ†æ" class="headerlink" title="ä¼ªä»£ç åˆ†æ"></a>ä¼ªä»£ç åˆ†æ</h2><p>å½“æˆ‘ä»¬äº†è§£åˆ°éœ€è¦åˆ†æçš„ç¬¦å·æ–¹æ³•åï¼Œä¸‹ä¸€æ­¥ä¸€èˆ¬å°±ä¼šè¿›è¡Œä¼ªä»£ç åˆ†æã€‚åœ¨Hopperä¸­ï¼Œç‚¹å‡»åˆ°ä¸€ä¸ªå­ç¨‹åºå…¥å£ï¼Œç„¶åç‚¹å‡»ä¸Šæ–¹çš„è¿™ä¸ªåƒæ˜¯<code>if (b)</code>ä»£ç çš„å›¾æ ‡ï¼Œå³å¯æ‰“å¼€ä¼ªä»£ç åˆ†ææ¡†</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/06/13/15592994457947.jpg"></p><p>å¯¹äºç®€å•çš„ä»£ç ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šèƒ½å¤Ÿè¿˜åŸå›100%å¯è¯»çš„Objective-Cä»£ç ï¼Œç”±äºARCæ—¶ä¾¿ä¸€èµ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹åº”çš„Retainå’ŒRealseè°ƒç”¨</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/06/13/15592995793557.jpg"></p><h3 id="åˆ†æè°ƒç”¨å…³ç³»"><a href="#åˆ†æè°ƒç”¨å…³ç³»" class="headerlink" title="åˆ†æè°ƒç”¨å…³ç³»"></a>åˆ†æè°ƒç”¨å…³ç³»</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹åº”çš„å­ç¨‹åºé¡µé¢ï¼Œå³é”®é€‰æ‹©â€References To Selectorâ€ï¼Œæ¥æŸ¥çœ‹æ‰€æœ‰å¯¹è¿™ä¸ªSelectorçš„è°ƒç”¨ã€‚ï¼ˆç”±äºObjective-Cè¿è¡Œæ—¶çš„ç‰¹ç‚¹ï¼Œåªèƒ½æ˜¯Selectorçº§åˆ«çš„è°ƒç”¨ï¼Œå¦‚æœæœ‰ä¸åŒç±»çš„åŒåSelectorï¼Œå¯ä»¥åœ¨å¼¹å‡ºçš„çª—å£ä¸­æœç´¢æˆ–è€…ä¾æ¬¡æ£€æŸ¥ï¼‰</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/06/13/15593006542887.jpg"></p><h2 id="å¸¸è§çš„åˆ†æå§¿åŠ¿"><a href="#å¸¸è§çš„åˆ†æå§¿åŠ¿" class="headerlink" title="å¸¸è§çš„åˆ†æå§¿åŠ¿"></a>å¸¸è§çš„åˆ†æå§¿åŠ¿</h2><h3 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h3><p>Objective-Cä¼šä½¿ç”¨åˆ°Blockï¼Œè€ŒBlockç”±äºå…¶å®ç°åŸç†ï¼Œä¼šç”Ÿæˆå¯¹åº”çš„Cæ–¹æ³•ï¼ŒHopperç›®å‰åŸç”Ÿè§£æçš„Blockè¯­æ³•å¹¶ä¸æ˜¯å¾ˆç›´è§‚ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªç®€å•çš„è¯´æ˜ã€‚</p><p>å…¶å®Hopperåç¼–è¯‘å‡ºæ¥å°±æ˜¯Blockå®ç°çš„åŸç†ï¼Œå¦‚æœå¯¹äºBlockå®ç°åŸç†ä¸æ¸…æ¥šï¼Œå»ºè®®å¯ä»¥å…ˆçœ‹ä¸€é<a href="https://blog.devtang.com/2013/07/28/a-look-inside-blocks/">ã€Šè¿™ä¸ªæ•™ç¨‹ã€‹</a></p><h3 id="ç®€å•Block"><a href="#ç®€å•Block" class="headerlink" title="ç®€å•Block"></a>ç®€å•Block</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>HopperåŸç”Ÿåç¼–è¯‘å¦‚ä¸‹ï¼Œå®é™…Blockä»£ç ä¼šå•ç‹¬åœ¨å¦ä¸€ä¸ªCæ–¹æ³•ä¸­ï¼Œåœ¨<code>block implemented at:</code>æç¤ºå¯¹åº”çš„æ–¹æ³•ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async([objc_retainAutoreleaseReturnValue(*__dispatch_main_q) retain], ^ &#123;<span class="comment">/* block implemented at ___29-[ViewController viewDidLoad]_block_invoke */</span> &#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> ___29-[ViewController viewDidLoad]_block_invoke(<span class="type">void</span> * _block) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, <span class="number">0x1</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•è·å˜é‡"><a href="#æ•è·å˜é‡" class="headerlink" title="æ•è·å˜é‡"></a>æ•è·å˜é‡</h3><p>å¦‚æœBlockæ•è·äº†å˜é‡ï¼Œé‚£ä¹ˆæ ¹æ®Blockçš„å®ç°åŸç†ï¼Œå¯ä»¥çŸ¥é“è¿™äº›å˜é‡åœ¨Blockä¸­å¯è§çš„å˜é‡éƒ½æ˜¯è¢«å€¼å®è´ï¼Œå¯¹äºNSObjectå°±æ˜¯æŒ‡é’ˆ</p><p>å¦‚æœä½¿ç”¨<code>__block</code>ä¿®é¥°ï¼Œé‚£ä¹ˆä¼šä¿ç•™åŸå§‹çš„å˜é‡çš„æŒ‡é’ˆï¼Œå¯¹äºNSObjectå°±æ˜¯å¯¹è±¡æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªç®€å•è¯†åˆ«ã€‚</p><p>æ¯”å¦‚å¯¹äºè¿™æ ·ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NSObject *obj = [NSObject new];</span><br><span class="line">__block NSObject *obj2 = [NSObject new];</span><br><span class="line">[self testBlock:^(<span class="type">int</span> value)&#123;</span><br><span class="line">    NSLog(@<span class="string">&quot;%@&quot;</span>, obj);</span><br><span class="line">    obj2 = nil;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>å®é™…åç¼–è¯‘å‡ºæ¥çš„ç»“æœé•¿è¿™æ ·ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> ___29-[ViewController viewDidLoad]_block_invoke(<span class="type">int</span> arg0, <span class="type">int</span> arg1) &#123;</span><br><span class="line">    NSLog(@<span class="string">&quot;%@&quot;</span>, *(arg0 + <span class="number">0x20</span>));</span><br><span class="line">    rax = objc_storeStrong(*(*(arg0 + <span class="number">0x28</span>) + <span class="number">0x8</span>) + <span class="number">0x28</span>, <span class="number">0x0</span>);</span><br><span class="line">    <span class="keyword">return</span> rax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„<code>arg0</code>å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œæœ€åå‚æ•°å¯¹åº”çš„æ˜¯<code>block_impl_0</code>å®ç°ç»“æ„ä½“ï¼Œå¯ä»¥å¿½ç•¥ã€‚</p><h2 id="CGRectMakeç­‰inlineçš„Cæ–¹æ³•"><a href="#CGRectMakeç­‰inlineçš„Cæ–¹æ³•" class="headerlink" title="CGRectMakeç­‰inlineçš„Cæ–¹æ³•"></a>CGRectMakeç­‰inlineçš„Cæ–¹æ³•</h2><p>ä¸€äº›å¸¦æœ‰inlineæ•°å€¼è®¡ç®—çš„æ–¹æ³•ï¼Œä¼šè¢«è‹¹æœçš„clangåœ¨ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯ä½ çœ‹åˆ°çš„å¤´æ–‡ä»¶çš„æ ·å­ï¼Œè¿™ç§å°±éœ€è¦æˆ‘ä»¬æšä¸¾å‡ºæ¥ï¼Œäººè‚‰è¿˜åŸå›ä»–çš„å®ç°ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><p>è¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CGRect rect = CGRectMake(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">NSLog(@<span class="string">&quot;%@&quot;</span>, NSStringFromCGRect(rect));</span><br></pre></td></tr></table></figure><p>åç¼–è¯‘ç»“æœï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">intrinsic_movsd(xmm1, *double_value_1);</span><br><span class="line">intrinsic_movsd(xmm2, *double_value_2);</span><br><span class="line">intrinsic_movsd(xmm3, *double_value_3);</span><br><span class="line">_CGRectMake(&amp;var_30, _cmd, rdx, rcx);</span><br><span class="line">NSLog(@<span class="string">&quot;%@&quot;</span>, [NSStringFromCGRect(*(&amp;var_30 + <span class="number">0x10</span>), *(&amp;var_30 + <span class="number">0x18</span>)) retain]);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ‰<code>mov</code>ä¹‹ç±»çš„æ±‡ç¼–å‘½ä»¤è°ƒç”¨ï¼Œå…¶å®è¿™å°±æ˜¯ä¸ºäº†å‹æ ˆå…¶å®å¤§éƒ¨åˆ†åœºæ™¯æˆ‘ä»¬åªè¦ç†Ÿæ‚‰ç®€å•çš„<code>mov</code> <code>add</code> <code>sub</code> <code>mul</code>å‡ ä¸ªåŸºæœ¬çš„æ±‡ç¼–å‘½ä»¤çš„æ„ä¹‰å³å¯ã€‚</p><h2 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h2><p>Swiftä½œä¸ºAppleä¸€è‡´åŠ›æ¨çš„ä¸‹ä¸€ä»£å®˜æ–¹ç¼–ç¨‹è¯­è¨€ï¼Œéšç€iOS 13çš„å‘å¸ƒï¼Œç°åœ¨å·²ç»å¯ä»¥ä½œä¸ºç¬¬ä¸€ä¼˜å…ˆçš„SDKæ”¯æŒè¯­è¨€äº†ï¼ŒiOS 13ä¸Šå‡ºç°äº†4ä¸ªSwift Onlyçš„åº“ï¼Œå› æ­¤å¯¹äºSwiftç›¸å…³çš„åç¼–è¯‘éœ€æ±‚ï¼Œä¹Ÿä¼šæ…¢æ…¢å‡ºç°ã€‚ç„¶è€Œï¼Œä¸åŒäºåŠ¨æ€æ€§å¼ºçš„Objective-Cä»£ç ï¼ŒSwiftå¤©ç”Ÿçš„é™æ€å¼ºç±»å‹è¯­è¨€ç‰¹æ€§ï¼Œé€ æˆäº†ç›¸å½“é«˜çš„åç¼–è¯‘éš¾åº¦ï¼ˆå ªæ¯”C++å¼€O2ä¼˜åŒ–ï¼‰ï¼Œåœ¨è¿™é‡ŒåŸºæœ¬ä¸ç»†è®²ï¼Œåªæ˜¯å¤§æ¦‚è¯´ä¸€ä¸‹ç›®å‰çš„çŠ¶å†µã€‚</p><p>Hopperä»v4å¼€å§‹æ”¯æŒäº†å¯¹Swiftç¬¦å·çš„ç¬¦å·åŒ–ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨swiftæ¥åè§£å†³mangledçš„ç¬¦å·åã€‚</p><p>ç”±äºSwiftæ”¯æŒå®Œæ•´çš„å‘½åç©ºé—´ï¼ŒæŸ¥è¯¢ç¬¦å·éœ€è¦å¸¦ä¸Šå®Œæ•´çš„ç¬¦å·</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/06/13/15604313892455.jpg"></p><p>åŒæ—¶ï¼ŒSwiftç”±äºclangçš„ä¼˜åŒ–ï¼Œä¼šè®²å¾ˆå¤šç¼–è¯‘å™¨æ£€æŸ¥åˆ°çš„é¢‘ç¹çš„ä»£ç è°ƒç”¨ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºä¸€ä¸ªä»¥<code>sub</code>å¼€å¤´çš„å‡½æ•°ï¼Œä»¥å‡å°‘äºŒè¿›åˆ¶å¤§å°ã€‚</p><p>å¯¹äºSwifté<code>@objc</code>å’Œ<code>dynamic</code>çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¼šç±»ä¼¼äºC++çš„è™šå‡½æ•°è¡¨ï¼Œå®é™…ä¸Šçš„è°ƒç”¨éƒ½æ˜¯ç¼–è¯‘å™¨å±•å¼€çš„åœ°å€åç§»ï¼Œè€Œä¸åƒObjective-Cé‚£æ ·æœ‰ç¬¦å·å¯æŸ¥ã€‚è¿™ç§æ—¶å€™æˆ‘ä»¬éœ€è¦å°±æ˜¯ç±»ä¼¼C++åç¼–è¯‘é‚£æ ·ï¼Œé€šè¿‡åˆ†æSwift classæˆ–è€…structçš„å±æ€§ï¼Œæ¥å¯¹ç…§åç§»é‡å¾—çŸ¥è°ƒç”¨ã€‚</p><p>å¯¹äºSwiftçš„ä¼šè§¦å‘è¿è¡Œæ€çš„ä¸€äº›è¯­æ³•ï¼Œéœ€è¦ä½ å¯¹Swiftè¯­è¨€å®ç°æœ‰äº†è§£ï¼Œæ¯”å¦‚Protocol Extension Whereå­å¥ï¼Œä¼šç”ŸæˆProtocol Witnessï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Hooperä¸­æœç´¢åˆ°å®ƒ</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/06/13/15604319451736.jpg"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç›®å‰çš„Hopperå¯¹Swiftæœ‰ç›¸åº”çš„æ”¯æŒï¼Œä½†å—é™äºSwiftçš„è¯­è¨€æ€§è´¨å¾ˆéš¾ç›´è§‚é˜…è¯»ï¼Œå¿…è¦æ—¶å€™è¿˜æ˜¯éœ€è¦ä¸€äº›æ±‡ç¼–ï¼Œä»¥åŠä¼ ç»ŸC++çš„åç¼–è¯‘åˆ†ææ¨¡å¼å»å¯¹å¾…å®ƒ</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ç¯‡æ•™ç¨‹åŸºæœ¬ä¸Šæ˜¯ä»æˆ‘ä¸ªäººçš„ä½¿ç”¨ç»éªŒæ¥ä»‹ç»ï¼Œä»¥å·¥å…·å’Œæµç¨‹ä¸ºä¸»ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç»™ç›®æ ‡iOSå¹³å°ï¼Œä¸”ä¸æ˜¯ä¸“æ”»äºŒè¿›åˆ¶å®‰å…¨çš„äººæ¥é˜…è¯»ã€‚</p><p>å…¶å®å¯¹å¤§éƒ¨åˆ†iOSå¹³å°å¼€å‘è€…ï¼Œæœ€ä¸»è¦çš„ç›®çš„ï¼Œå…¶å®æ˜¯ä¸ºåœ¨å‘ç°ä¸€äº›iOS SDKè¡¨ç°å¥‡æ€ªçš„è¡Œä¸ºï¼Œæˆ–è€…Crashæ—¶ï¼Œèƒ½å¤Ÿæœ‰ä¸€å®šçš„åˆ†æå’Œåˆ¤æ–­èƒ½åŠ›ï¼Œå»å°è¯•å®šä½åŸå› ï¼Œç»•è¿‡é—®é¢˜ï¼Œå¹¶æœ€ç»ˆèƒ½å¤Ÿæœ‰åº•æ°”ï¼Œå»å‘Appleæäº¤Bug Reportã€‚</p><p>åç¼–è¯‘æœ¬èº«å°±æ˜¯äºŒè¿›åˆ¶å®‰å…¨ä¸­çš„ç°è‰²åœ°å¸¦ï¼Œè€Œä¸”è¿˜æœ‰ç±»ä¼¼äºŒè¿›åˆ¶åŠ å›ºç­‰æ”»é˜²æ¨¡å¼ï¼Œå¹¶ä¸æ˜¯ä¸‡èƒ½æ–¹å¼å»äº†è§£ä¸€ä¸ªç¨‹åºè¿è¡Œçš„æ–¹å¼ã€‚è¿˜éœ€è¦é…åˆè‡ªå·±çš„ç¼–å†™ä»£ç ç»éªŒï¼Œæ‰èƒ½æ›´å¥½åœ°è§£å†³é—®é¢˜</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://github.com/bartcone/reverse-engineering-blog">https://github.com/bartcone/reverse-engineering-blog</a></li><li><a href="http://stevenygard.com/projects/class-dump/">http://stevenygard.com/projects/class-dump/</a></li><li><a href="https://worthdoingbadly.com/dscextract/">https://worthdoingbadly.com/dscextract/</a></li><li><a href="http://iphonedevwiki.net/index.php/Dyld_shared_cache">http://iphonedevwiki.net/index.php/Dyld_shared_cache</a></li><li><a href="http://www.toves.org/books/arm/">http://www.toves.org/books/arm/</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Hopperç®€ä»‹&quot;&gt;&lt;a href=&quot;#Hopperç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;Hopperç®€ä»‹&quot;&gt;&lt;/a&gt;Hopperç®€ä»‹&lt;/h1&gt;&lt;p&gt;Hopperï¼Œå…¨ç§°Hopper Disassemblerï¼Œæ˜¯ä¸€ä¸ªmacOSå’ŒLinuxå¹³å°ä¸Šçš„åæ±‡ç¼–IDEã€‚æä¾›äº†è¯¸å¦‚ä¼ªä»£ç ï¼Œå­ç¨‹åºï¼Œè„šæœ¬ï¼ŒDebuggerï¼ŒHexç¼–è¾‘ç­‰ç­‰ä¸€äº›åˆ—å·¥å…·ã€‚ç›¸æ¯”äºå…¶ä»–çŸ¥åçš„åæ±‡ç¼–å·¥å…·å¦‚&lt;a href=&quot;https://www.hex-rays.com/products/ida/&quot;&gt;IDA&lt;/a&gt;ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯å¯¹å¹³å°ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯Objective-Cçš„åæ±‡ç¼–æœ‰ä¼˜åŒ–ï¼Œæä¾›éå¸¸è´´è¿‘åŸå§‹ä»£ç çš„ä¼ªä»£ç ï¼ˆIDAç›®å‰åˆ™ä¼šæ˜¯ä¿ç•™è¯¸å¦‚objc_msgSendçš„ä¼ªä»£ç ï¼‰ï¼Œå¹¶ä¸”æ–°ç‰ˆæœ¬ä¹Ÿå¯¹Swiftæä¾›äº†ä¸€å®šçš„åæ±‡ç¼–ç¬¦å·ä¼˜åŒ–ï¼Œå› æ­¤ä½œä¸ºæ¢ç©¶iOSå¹³å°ä¸Šçš„SDKå®ç°ï¼Œå¯ä»¥è¯´æ˜¯ä¸€åˆ©å™¨ã€‚&lt;/p&gt;
&lt;h1 id=&quot;Hopperå®‰è£…&quot;&gt;&lt;a href=&quot;#Hopperå®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;Hopperå®‰è£…&quot;&gt;&lt;/a&gt;Hopperå®‰è£…&lt;/h1&gt;&lt;p&gt;Hopperæœ¬èº«ç›®å‰æ˜¯æ”¶è´¹çš„è½¯ä»¶ï¼Œæä¾›äº†å…è´¹çš„ä½¿ç”¨ï¼ˆ30åˆ†é’Ÿï¼‰ã€‚å®˜æ–¹ä¸‹è½½åœ°å€ä¸ºï¼š&lt;a href=&quot;https://www.hopperapp.com/&quot;&gt;https://www.hopperapp.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Macç‰ˆæœ¬åè§£å‹ï¼Œæ‹–åˆ°Applicationä¸‹å³å¯ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¸ªäººä½¿ç”¨ï¼Œä»·æ ¼ä¸è²ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸ªäººæ¯”è¾ƒæ¨èç¬¬ä¸€ç§&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="Objective-C" scheme="http://dreampiggy.com/tags/Objective-C/"/>
    
    <category term="é€†å‘" scheme="http://dreampiggy.com/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="Hopper" scheme="http://dreampiggy.com/tags/Hopper/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ­¥æ­¥å¸¦ä½ å¼€å‘macOS QuickLook Plugin</title>
    <link href="http://dreampiggy.com/2019/04/16/%E4%B8%80%E6%AD%A5%E6%AD%A5%E5%B8%A6%E4%BD%A0%E5%BC%80%E5%8F%91macOS-QuickLook-Plugin/"/>
    <id>http://dreampiggy.com/2019/04/16/%E4%B8%80%E6%AD%A5%E6%AD%A5%E5%B8%A6%E4%BD%A0%E5%BC%80%E5%8F%91macOS-QuickLook-Plugin/</id>
    <published>2019-04-16T15:02:11.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<h2 id="QuickLookç®€ä»‹"><a href="#QuickLookç®€ä»‹" class="headerlink" title="QuickLookç®€ä»‹"></a>QuickLookç®€ä»‹</h2><p>QuickLook æ˜¯macOSä¸Šæä¾›çš„ä¸€é¡¹å¿«é€Ÿå±•ç¤ºæ–‡æ¡£é¢„è§ˆçš„åŠŸèƒ½ï¼Œåªéœ€è¦æŒ‰ä¸‹ç©ºæ ¼å°±å¯ä»¥å¿«é€ŸæŸ¥çœ‹å„ç§æ–‡ä»¶æ ¼å¼çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡æœ¬ï¼Œä»£ç ï¼Œå›¾ç‰‡ï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘ç­‰ç­‰ã€‚</p><p>ç”±äºQuickLookéœ€è¦æ”¯æŒä¸æ–­æ‰©å±•çš„æ–‡ä»¶æ ¼å¼ï¼Œå› æ­¤macOSä¸“é—¨æä¾›äº†ä¸€ä¸ªQuickLook Pluginï¼Œèƒ½è®©å¼€å‘è€…å¯¹è‡ªå·±çš„æ–‡ä»¶æ ¼å¼æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„å®Œæ•´çš„UIæ˜¾ç¤ºï¼Œä¸å¿…ä¾èµ–macOSç³»ç»Ÿæ›´æ–°æ¥æ”¯æŒç¼¤çº·å¤æ‚çš„æ ¼å¼ã€‚</p><p>ä¹‹å‰ä¸€æ®µæ—¶é—´ï¼Œå‡ºäºå…´è¶£åšäº†ä¸€ä¸ª<a href="https://aomediacodec.github.io/av1-avif/">AVIF (AV1 Image File Format)</a>çš„è§£ç å™¨å°è£…ï¼ŒAV1ä½œä¸ºç°åœ¨æµè¡Œçš„HEVC(H.265)æ½œåœ¨æœªæ¥ç«äº‰è€…ï¼Œæœ‰ç€å¼€æºï¼Œæ— ä¸“åˆ©é™åˆ¶ï¼Œæ›´é«˜çš„å‹ç¼©æ¯”ç­‰ç­‰ä¼˜åŠ¿ï¼Œæ¯”èµ·HEVCæ™šè¯ç”Ÿäº†5å¹´ã€‚</p><p>ç›®å‰AVIFè™½ç„¶å‘å¸ƒäº†ç¬¬ä¸€ç‰ˆè§„èŒƒï¼Œä½†æ˜¯ç¼ºå°‘ç›¸åº”çš„å‘¨è¾¹å·¥å…·é“¾çš„æ”¯æŒï¼Œåœ¨macOSä¸Šæƒ³è¦æ‰¾ä¸€ä¸ªç®€å•çš„Image Vieweréƒ½æ²¡æ‰¾åˆ°ï¼Œè°ƒè¯•èµ·æ¥å¼‚å¸¸å›°éš¾ï¼Œå› æ­¤æŠ½ç©ºé¡ºä¾¿åšäº†ä¸€ä¸ªç®€å•çš„Quick Look Pluginï¼Œæ¥è®©è‡ªå·±èƒ½ç›´æ¥ç©ºæ ¼é¢„è§ˆAVIFå›¾åƒã€‚</p><p>åœ¨åšQuickLook Pluginçš„è¿‡ç¨‹ä¸­ï¼Œæ„Ÿè§‰æœ‰ä¸€äº›å°å‘éœ€è¦è®°ä¸‹æ¥ï¼Œå› æ­¤è¿™ç¯‡æ–‡ç« ï¼Œç›®æ ‡å°±æ˜¯ä¸€ä¸ªç®€å•çš„å…¥é—¨æ•™ç¨‹ï¼Œè®²è§£å¦‚ä½•åšä¸€ä¸ªQuickLook Pluginï¼Œæ¥å¯¹è‡ªå·±å–œçˆ±ä½†åˆä¸è¢«ç³»ç»Ÿæ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒæ”¯æŒã€‚</p><h2 id="QuickLook-Pluginå·¥ç¨‹"><a href="#QuickLook-Pluginå·¥ç¨‹" class="headerlink" title="QuickLook Pluginå·¥ç¨‹"></a>QuickLook Pluginå·¥ç¨‹</h2><p>è™½ç„¶è‹¹æœæä¾›äº†å®Œå–„çš„QuickLook Pluginå¼€å‘æ–‡æ¡£ï¼Œå‚è€ƒï¼š<a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/Quicklook_Programming_Guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40005020-CH1-SW1">Quick Look Programming Guide</a></p><p>ä½†æ˜¯æ–‡æ¡£å·²ç»ç¨æ˜¾è¿‡æ—¶ï¼Œé‡åˆ°çš„ä¸€ä¸ªå‘ç‚¹ä¹Ÿæ²¡æœ‰æç¤ºï¼Œå› æ­¤è¿™é‡Œæ›´è¯¦ç»†ç›´è§‚çš„ä»‹ç»ä¸€ä¸‹QuickLookå¼€å‘çš„æµç¨‹ã€‚</p><ul><li>æ–°å»ºXcodeå·¥ç¨‹ï¼Œé€‰æ‹©è¿™ä¸ª<code>Quick Look Plug-In</code>æ¨¡æ¿</li></ul><p>![å±å¹•å¿«ç…§ 2019-04-16 ä¸Šåˆ11.45.25](<a href="http://dreampiggy-image.test.upcdn.net/image/2019/04/16/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7">http://dreampiggy-image.test.upcdn.net/image/2019/04/16/å±å¹•å¿«ç…§</a> 2019-04-16 ä¸Šåˆ11.45.25.png)</p><ul><li>æ‰“å¼€ä½ çš„æ¨¡ç‰ˆï¼Œä½ ä¼šå‘ç°å¦‚ä¸‹çš„ç»“æ„</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Project</span><br><span class="line">- GenerateThumbnailForURL.c // ç”¨æ¥æä¾›Finderç¼©ç•¥å›¾çš„ä»£ç </span><br><span class="line">- GeneratePreviewForURL.c // ç”¨æ¥ç”ŸæˆPreviewç”¨çš„ç»˜åˆ¶ä»£ç </span><br><span class="line">- main.c // æ’ä»¶å…¥å£æ–‡ä»¶ï¼Œä¸è¦ä¿®æ”¹å®ƒ</span><br><span class="line">- Info.plist // æè¿°æ’ä»¶æ”¯æŒçš„UTIç±»å‹çš„ï¼Œåé¢ä¼šè®²</span><br></pre></td></tr></table></figure><p>QuickLook Pluginæ”¯æŒä¸¤ç§æƒ…å½¢çš„åŠŸèƒ½å±•ç¤ºï¼šä¸€ä¸ªæ˜¯å¯¹æ–‡ä»¶ï¼ŒæŒ‰ä¸‹ç©ºæ ¼æ¥å±•ç¤ºçš„çª—å£é¢„è§ˆï¼Œåœ¨ä½¿ç”¨Option+ç©ºæ ¼è¿›è¡Œå…¨å±é¢„è§ˆæ—¶å€™ä¹Ÿä¼šå±•ç¤ºï¼Œåé¢éƒ½ç§°ä½œPreview</p><p>å¦ä¸€ä¸ªæ˜¯ç”¨æ¥ç»™Finderï¼Œæ¥æä¾›ä¸€ä¸ªç¼©ç•¥å›¾å±•ç¤ºï¼Œè¿™æ ·ä¸€äº›å›¾åƒæ ¼å¼ï¼Œè§†é¢‘æ ¼å¼ï¼Œåœ¨Finderä¸­å°±èƒ½ç›´æ¥çœ‹åˆ°å¯¹åº”çš„ç¼©ç•¥å›¾ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåƒµç¡¬çš„é»˜è®¤å›¾æ ‡ã€‚åæ–‡éƒ½ç§°ä½œThumbnail</p><p>ç”±äºQuickLookçš„æ ¸å¿ƒï¼Œæ˜¯å¸Œæœ›å¯¹<strong>æŒ‡å®šçš„æ–‡ä»¶æ ¼å¼</strong>ï¼Œæä¾›ä¸€ä¸ªå±•ç¤ºçš„UIå’Œç¼©ç•¥å›¾ã€‚é‚£ä¹ˆåœ¨ç»§ç»­è¿›ä¸€æ­¥å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å¾—é¦–å…ˆæ¸…æ¥šè‡ªå·±éœ€è¦çš„æ–‡ä»¶æ ¼å¼æ˜¯ä»€ä¹ˆï¼Œå¹¶äº†è§£UTIçš„æ¦‚å¿µã€‚å¦‚æœè¿™ä¸€æ­¥éª¤å¤„ç†çš„æœ‰é—®é¢˜ï¼Œä½ çš„QuickLook Pluginæ˜¯æ— æ³•æŒ‰é¢„æœŸçš„æƒ³æ³•ï¼Œè¢«è°ƒç”¨çš„ã€‚</p><h2 id="ç»‘å®šæ–‡ä»¶æ ¼å¼å’ŒUTI"><a href="#ç»‘å®šæ–‡ä»¶æ ¼å¼å’ŒUTI" class="headerlink" title="ç»‘å®šæ–‡ä»¶æ ¼å¼å’ŒUTI"></a>ç»‘å®šæ–‡ä»¶æ ¼å¼å’ŒUTI</h2><p>åœ¨ç»§ç»­ä¸‹ä¸€æ­¥ä¹‹å‰ï¼Œä½ éœ€è¦å¯¹ä½ æƒ³æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œé€‰æ‹©ä¸€ä¸ªUTI (<a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/understanding_utis/understand_utis_intro/understand_utis_intro.html#//apple_ref/doc/uid/TP40001319">Uniform Type Identifiers</a>).</p><p>QuickLookï¼Œåœ¨ç”¨æˆ·æŒ‰ä¸‹ç©ºæ ¼å¼€å§‹Previewçš„æ—¶å€™ï¼Œä¼šæ ¹æ®æ¯ä¸ªQuickLook Pluginæ³¨å†Œçš„UTIï¼Œä¾æ¬¡å»è¯¢é—®ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªè¿”å›æˆåŠŸçš„ï¼Œæœ€åæ¥åˆ¤å®šé€‰æ‹©å“ªä¸ªPluginè¿›è¡Œå±•ç¤ºã€‚</p><p>å»ºç«‹å¥½æ¨¡ç‰ˆä¹‹åï¼Œæ‰“å¼€<code>Info.plist</code>ï¼Œåœ¨é¡¶å±‚çš„<code>LSItemContentTypes</code>é¡¹é‡Œé¢ï¼Œæ·»åŠ ä½ çš„Pluginæ‰€èƒ½æ”¯æŒçš„UTIï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¼šæŒ‰ç…§å…ˆåé¡ºåºåŒ¹é…ï¼Œä¸€èˆ¬å»ºè®®åªå†™è‡ªå·±èƒ½å‡†ç¡®è¯†åˆ«çš„UTIï¼Œå¦‚æœæ˜¯ä¸€ä¸ªé€šé…çš„Pluginï¼ˆå¦‚é€šç”¨å›¾ç‰‡é¢„è§ˆï¼Œé€šç”¨ä»£ç é¢„è§ˆï¼‰ï¼Œå¯ä»¥ä½¿ç”¨UTIç»§æ‰¿å…³ç³»çš„çˆ¶çº§(<code>public.image</code>, <code>public.source-code</code>ç­‰ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleDocumentTypes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleTypeRole<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>QLGenerator<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>LSItemContentTypes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>public.avif<span class="tag">&lt;/<span class="name">string</span>&gt;</span> <span class="comment">&lt;!--Here!--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®å¥½Pluginæ”¯æŒçš„UTIä¹‹åï¼Œä½ è¿˜éœ€è¦æ ¹æ®å…·ä½“UTIçš„åˆ†é…æ¥æºï¼Œæ¥ä½¿ç”¨å¯¼å…¥æˆ–è€…å¯¼å‡ºã€‚</p><h3 id="æ‰¾å‡ºå·²æœ‰çš„UTI"><a href="#æ‰¾å‡ºå·²æœ‰çš„UTI" class="headerlink" title="æ‰¾å‡ºå·²æœ‰çš„UTI"></a>æ‰¾å‡ºå·²æœ‰çš„UTI</h3><p>ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶å¯¹åº”çš„UTL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mdls test.avif</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¾“å‡ºçš„<code>kMDItemContentType</code>ï¼Œå¦‚æœæ˜¯ä»¥<code>dyn</code>å¼€å¤´ï¼Œè¡¨æ˜æ²¡æœ‰è¢«æ³¨å†Œè¿‡ï¼Œè€Œæ˜¯ç³»ç»Ÿåˆ†é…çš„ä¸€ä¸ªåŠ¨æ€UTIï¼ˆç”¨äºä»»æ„ä¸æ”¯æŒçš„ç±»å‹å’Œä»£ç å…¼å®¹ï¼Œå‚è€ƒ<a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/understanding_utis/understand_utis_conc/understand_utis_conc.html#//apple_ref/doc/uid/TP40001319-CH202-BCGCDHIJ">Dynamic Type Identifiers</a>ï¼‰</p><p>å¦åˆ™ï¼Œå½¢å¦‚<code>public.png</code>è¿™ç§ï¼Œæ ‡ç¤ºæ˜¯ä¸€ä¸ªå·²æœ‰çš„UTIï¼Œå¯ä»¥å¯¼å…¥æ¥ç›´æ¥ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kMDItemContentType =&quot;dyn.ah62d4rv4ge80c7xmq2&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ‰§ç€çš„äººï¼Œæƒ³äº†è§£å…·ä½“çš„æ¯ä¸€ä¸ªUTIï¼Œæ˜¯ç”±ç³»ç»Ÿæˆ–è€…è¿˜æ˜¯æŸä¸ªç¬¬ä¸‰æ–¹Appæ³¨å†Œçš„ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œå¯¼å‡ºå®Œæ•´çš„ç³»ç»ŸUTIæŠ¥è¡¨ï¼Œæ¥è¿›è¡Œæœç´¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -dump</span><br></pre></td></tr></table></figure><h3 id="UTIå®šä¹‰"><a href="#UTIå®šä¹‰" class="headerlink" title="UTIå®šä¹‰"></a>UTIå®šä¹‰</h3><p>ä¸€ä¸ªUTIå¯¹åº”ä¸€æ®µXMLçš„å®šä¹‰ï¼Œå…¶ä¸­å£°æ˜äº†å®ƒçš„ç±»å‹ï¼ˆç»§æ‰¿å…³ç³»ï¼‰ï¼ŒUTIå­—ç¬¦ä¸²ï¼Œç®€ä»‹åç§°ï¼Œæ‰©å±•åï¼Œæ ‡å‡†é“¾æ¥ç­‰ç­‰ï¼ŒåŸºæœ¬çš„æ ¼å¼å¦‚ä¸‹ï¼Œå¾ˆå®¹æ˜“ç†è§£ã€‚è¿™é‡Œæ˜¯è‡ªå·±å®šä¹‰çš„ä¸€ä¸ªAVIFæ ¼å¼çš„æè¿°</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UTTypeConformsTo<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>public.image<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UTTypeDescription<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>AVIF image<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UTTypeIdentifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>public.avif<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UTTypeReferenceURL<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>https://aomediacodec.github.io/av1-avif/<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UTTypeTagSpecification<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>public.filename-extension<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>avif<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>public.mime-type<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>image/avif<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¯¼å…¥UTI"><a href="#å¯¼å…¥UTI" class="headerlink" title="å¯¼å…¥UTI"></a>å¯¼å…¥UTI</h3><p>å¦‚æœä½ æƒ³æ”¯æŒQuickLookçš„æ–‡ä»¶æ ¼å¼ï¼Œå·²ç»æœ‰äº†ç³»ç»Ÿåˆ†é…çš„UTIï¼Œæˆ–è€…ç¬¬ä¸‰æ–¹Appå®šä¹‰å¥½çš„UTIï¼Œé‚£ä¹ˆä½ è¦åšçš„ï¼Œå°±æ˜¯å¯¼å…¥ä¸€ä¸ªUTIã€‚</p><p>å¦‚æœè¦å¯¼å…¥UTIï¼Œä½ éœ€è¦åœ¨<code>Info.plist</code>ä¸­ï¼Œä½¿ç”¨<code>UTImportedTypeDeclarations</code>è¿™ä¸ªé¡¹ï¼Œæ¥å¯¼å…¥å¯¹åº”çš„UTIæè¿°å†…å®¹ï¼Œå€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„æ¯é¡¹éƒ½æ˜¯ä¸Šé¢æåˆ°çš„UTIå®šä¹‰ã€‚</p><p>PSï¼šå¯¹äºå¯¼å…¥UTIæ¥è¯´ï¼Œä½ å…¶å®å¹¶ä¸éœ€è¦å®Œæ•´çš„æŠŠåˆ«äººçš„å£°æ˜æŠ„è¿‡æ¥ï¼Œåªè¦å­˜åœ¨<code>UTTypeIdentifier</code>é¡¹å³å¯ï¼Œä½†æ˜¯è¿™æ ·å†™èƒ½æ›´æ¸…æ™°äº†è§£å¯¹åº”çš„æ ¼å¼æè¿°ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>UTImportedTypeDeclarations<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UTTypeIdentifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>public.png<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--...--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¯¼å‡ºUTI"><a href="#å¯¼å‡ºUTI" class="headerlink" title="å¯¼å‡ºUTI"></a>å¯¼å‡ºUTI</h3><p>åä¹‹ï¼Œå¦‚æœä½ æƒ³æ”¯æŒçš„QuickLookçš„æ–‡ä»¶æ ¼å¼ï¼Œä¸å­˜åœ¨å·²æœ‰çš„UTIï¼Œé‚£ä¹ˆä½ éœ€è¦æ–°å¢ä¸€ä¸ªå¹¶å¯¼å‡ºã€‚</p><p>å¦‚æœè¦å¯¼å‡ºUTIï¼Œä½ éœ€è¦åœ¨<code>Info.plist</code>ä¸­ï¼Œä½¿ç”¨<code>UTExportedTypeDeclarations</code>è¿™ä¸ªé¡¹ï¼Œæ¥å¯¼å‡ºå¯¹åº”çš„UTIæè¿°å†…å®¹ï¼Œå€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„æ¯é¡¹éƒ½æ˜¯ä¸Šé¢æåˆ°çš„UTIå®šä¹‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>UTExportedTypeDeclarations<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UTTypeIdentifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>public.avif<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--...--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="QuickLook-Pluginå’Œå¯¼å‡ºUTI"><a href="#QuickLook-Pluginå’Œå¯¼å‡ºUTI" class="headerlink" title="QuickLook Pluginå’Œå¯¼å‡ºUTI"></a>QuickLook Pluginå’Œå¯¼å‡ºUTI</h3><p>å€¼å¾—æ³¨æ„çš„ä¸€ä¸ªå‘ç‚¹ï¼ŒmacOSç³»ç»Ÿæ³¨å†ŒUTIè§„åˆ™ï¼Œä¼šæ³¨å†Œå½“å‰ç¡¬ç›˜ä¸Šæ‰€æœ‰çš„<code>.app</code>åç¼€çš„AppåŒ…ï¼Œé‡Œé¢æ‰€å«æœ‰çš„å¯¼å‡ºUTIï¼Œè€Œé—æ†¾çš„æ˜¯ï¼Œä½œä¸ºQuickLook Pluginï¼Œæœ€åç¼–è¯‘å¾—åˆ°çš„äº§ç‰©ï¼Œä¸æ˜¯ä»¥<code>.app</code>ä¸ºåç¼€åçš„ï¼Œè€Œæ˜¯ä¸€ä¸ª<code>.qlgenerator</code>ã€‚</p><p>å› æ­¤ï¼Œè¿™å°±å¯¼è‡´ï¼Œå¦‚æœä½ æ–°å¢äº†ä¸€ä¸ªUTIï¼Œä½†æ˜¯ä½ çš„QuickLook Pluginï¼Œæ²¡æœ‰ä»»ä½•å®¿ä¸»Appæ¥æä¾›å¯¼å‡ºUTIï¼Œæœ€ç»ˆmacOSä¼šä¸è®¤è¿™ä¸ªUTIï¼Œå› æ­¤ä½ çš„QuickLook Pluginä¸ä¼šè¢«è°ƒç”¨ã€‚è¿™å¯èƒ½æ˜¯è‹¹æœæ—©æœŸè®¤ä¸ºï¼ŒQuickLook Pluginæ˜¯å’Œä¸€ä¸ªAppç»‘å®šçš„ï¼ˆå¦‚Keynoteå’ŒKeynote QuickLookæ’ä»¶çš„å…³ç³»ï¼‰ï¼Œç‹¬ç«‹å­˜åœ¨çš„QuickLook Pluginå¹¶æ²¡æœ‰ç‰¹åˆ«å¤„ç†â€¦â€¦</p><p>è¿™ä¸ªå‘èŠ±è´¹äº†ä¸€äº›æ—¶é—´ï¼Œç»è¿‡ä¸€ç•ªStackOverflowå’ŒGitHubæœç´¢ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†ä¸€ä¸ªéå¸¸èªæ˜ï¼ˆTrickï¼‰çš„è§£å†³æ–¹æ¡ˆï¼š</p><p>æ„é€ ä¸€ä¸ªä¸´æ—¶å ä½çš„<code>Dummy.app</code>åŒ…ï¼Œä¸“é—¨ç”¨äºå¯¼å‡ºUTIï¼Œåœ¨æ‰“åŒ…çš„æ—¶å€™ç›´æ¥å°†è¿™ä¸ª<code>Dummy.app</code>æ‹·è´åˆ°å¯¹åº”QuickLook Pluginçš„åŒ…ä¸­å³å¯</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨macOSè‡ªå¸¦çš„<code>Script Editor.app</code>ï¼Œæ¥åˆ›å»ºä¸€ä¸ªç©ºå£³Appï¼š</p><ol><li>æ‰“å¼€<code>Script Editor</code>ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡æ¡£</li><li>ç›´æ¥Saveï¼Œç±»å‹é€‰æ‹©<code>Application</code>ï¼Œåç§°éšä¾¿å†™ä¸€ä¸ª<code>Dummy.app</code>ï¼Œå¯¼å‡º</li><li>ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ‰“å¼€<code>Dummy.app/Contents/Info.plist</code></li><li>å‚è€ƒä¸Šæ–‡æåˆ°çš„UTIå¯¼å‡ºæ–¹å¼ï¼Œæ·»åŠ å¯¹åº”çš„<code>UTExportedTypeDeclarations</code>é¡¹ç›®</li><li>å°†è¿™ä¸ª<code>Dummy.app</code>ï¼Œæ”¾åˆ°å·¥ç¨‹ä¸‹ï¼Œç›´æ¥æ‹–è¿›æ¥å½“ä½œèµ„æºï¼Œæ·»åŠ åˆ°<code>Copy Bundle Resource</code>è¿‡ç¨‹ä¸­</li></ol><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/04/16/%E6%9C%AA%E5%91%BD%E5%90%8D3.png" alt="æœªå‘½å3"></p><p>è¿™æ ·ä¸€æ³¢æ“ä½œä»¥åï¼Œä½ æœ€åæ„å»ºå¾—åˆ°çš„QuickLook Pluginï¼Œå°±èƒ½è‡ªå¸¦ä¸€ä¸ªå¯¼å‡ºçš„UTIï¼Œç„¶åè¢«ç³»ç»Ÿè¯†åˆ«ï¼Œæœ€ç»ˆè¢«çœŸæ­£åŠ è½½ã€‚</p><h2 id="ç”¨äºPreviewçš„ä»£ç ç»˜åˆ¶å®ç°"><a href="#ç”¨äºPreviewçš„ä»£ç ç»˜åˆ¶å®ç°" class="headerlink" title="ç”¨äºPreviewçš„ä»£ç ç»˜åˆ¶å®ç°"></a>ç”¨äºPreviewçš„ä»£ç ç»˜åˆ¶å®ç°</h2><p>å‡†å¤‡å¥½ä¸Šè¿°UTIçš„é…ç½®åï¼Œç°åœ¨å†æ¥çœ‹çœ‹ä»£ç ã€‚é¦–å…ˆæˆ‘ä»¬ä¾§é‡çœ‹ä¸€ä¸‹ç”¨äºæä¾›Previewçš„UIçš„ä»£ç ã€‚</p><p>å¯¹åº”çš„æ–‡ä»¶æ˜¯<code>GeneratePreviewForURL.c</code>ã€‚å¦‚æœè¦ä½¿ç”¨Objective-Cï¼Œæˆ–è€…C++ä»£ç ï¼Œä½ å¯ä»¥æ›´æ”¹å¯¹åº”çš„æ–‡ä»¶åä¸º<code>.m</code>æˆ–è€…<code>.cpp</code>å³å¯ï¼Œä»¥ä¸‹ç¤ºä¾‹æ˜¯ä»¥Objective-Cä»£ç ä¸ºä¸»</p><p>å…¥å£è°ƒç”¨å‡½æ•°åŸå‹ä¸ºä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GeneratePreviewForURL(<span class="type">void</span> *thisInterface, QLPreviewRequestRef preview, CFURLRef url, CFStringRef contentTypeUTI, CFDictionaryRef options)</span><br></pre></td></tr></table></figure><p>å…¶å®å¯¹äºå¤§å¤šæ•°QuickLookæ’ä»¶ï¼Œæˆ‘ä»¬å…³æ³¨çš„åŸºæœ¬ä¸Šåªæœ‰è¿™ä¸ª<code>url</code>å‚æ•°ï¼Œä»–å¯¹åº”çš„æ˜¯æ–‡ä»¶çš„File URLï¼Œå¯ä»¥æ‹¿åˆ°å¯¹åº”è¢«é€‰ä¸­çš„æ–‡ä»¶Data Bufferã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *path = [(__bridge <span class="built_in">NSURL</span> *)url path];</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfFile:path];</span><br></pre></td></tr></table></figure><p>ä¸‹ä¸€æ­¥å°±æ˜¯ç»˜åˆ¶å’Œæ¸²æŸ“æˆ‘ä»¬çš„UIï¼ŒQuickLookæ”¯æŒä¸¤ç§æ–¹å¼æ¸²æŸ“ï¼š</p><ul><li>ä½¿ç”¨Core Graphicsè‡ªå®šä¹‰ç»˜åˆ¶</li><li>ä½¿ç”¨é¢„ç½®æ”¯æŒçš„æ•°æ®æ ¼å¼ï¼ŒåŠ¨æ€ç”ŸæˆData</li></ul><h3 id="ä½¿ç”¨Core-Graphicsç»˜åˆ¶"><a href="#ä½¿ç”¨Core-Graphicsç»˜åˆ¶" class="headerlink" title="ä½¿ç”¨Core Graphicsç»˜åˆ¶"></a>ä½¿ç”¨Core Graphicsç»˜åˆ¶</h3><p>è¿™é‡Œå‡è®¾å·²ç»äº†è§£Core Graphicsç»˜åˆ¶çš„åŸºæœ¬çŸ¥è¯†ï¼Œå¦‚æœæœ‰ä¸äº†è§£è¯·æå‰æŸ¥é˜…è‹¹æœçš„æ•™ç¨‹ï¼š<a href="https://developer.apple.com/library/archive/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/Introduction/Introduction.html">Quartz 2D Programming Guide</a>.</p><p>åœ¨æ‹¿åˆ°Dataä»¥åï¼Œè¯¥æ€ä¹ˆç»˜åˆ¶å–å†³äºä½ çš„QuickLookæ’ä»¶çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘æƒ³åšçš„ä¸€ä¸ªAVIFå›¾åƒé¢„è§ˆQuick Lookæ’ä»¶ï¼Œé‚£ä¹ˆå°±å¸Œæœ›è§¦å‘è§£ç ï¼Œä»¥æ‹¿åˆ°CGImageå’ŒBitmap Bufferæ¥ç»˜åˆ¶ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGImageRef</span> cgImgRef = [<span class="built_in">AVIFDecoder</span> createAVIFImageWithData:data];</span><br></pre></td></tr></table></figure><p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦è·å–ä¸€ä¸ªCGContextæ¥ç»˜åˆ¶ï¼Œä½¿ç”¨<a href="https://developer.apple.com/documentation/quicklook/1402613-qlpreviewrequestcreatecontext?language=objc">QLPreviewRequestCreateContext</a>ï¼Œä¼ å…¥å…¥å£å‡½æ•°é€ä¼ è¿›æ¥çš„<code>preview</code>ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªCGContextï¼Œæ¥ä½œä¸ºä¸Šä¸‹æ–‡è¿›è¡Œç»˜åˆ¶ã€‚åŒæ—¶ï¼Œè¿˜éœ€è¦äº†è§£ç»˜åˆ¶çš„å¤§å°ï¼Œæ ‡é¢˜ç­‰ç­‰é€‰é¡¹ï¼Œæ¥æä¾›åˆé€‚çš„æ¸²æŸ“UIã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> width = <span class="built_in">CGImageGetWidth</span>(cgImgRef);</span><br><span class="line"><span class="built_in">CGFloat</span> height = <span class="built_in">CGImageGetHeight</span>(cgImgRef);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add image dimensions to title</span></span><br><span class="line"><span class="built_in">NSString</span> *newTitle = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;%@ (%d x %d)&quot;</span>, [path lastPathComponent], (<span class="type">int</span>)width, (<span class="type">int</span>)height];</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSDictionary</span> *newOpt = @&#123;(<span class="built_in">NSString</span> *)kQLPreviewPropertyDisplayNameKey : newTitle,</span><br><span class="line">    (<span class="built_in">NSString</span> *)kQLPreviewPropertyWidthKey : @(width),</span><br><span class="line">    (<span class="built_in">NSString</span> *)kQLPreviewPropertyHeightKey : @(height)&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Draw image</span></span><br><span class="line"><span class="built_in">CGContextRef</span> ctx = QLPreviewRequestCreateContext(preview, <span class="built_in">CGSizeMake</span>(width, height), <span class="literal">YES</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">CGContextDrawImage</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">0</span>,<span class="number">0</span>,width,height), cgImgRef);</span><br><span class="line">QLPreviewRequestFlushContext(preview, ctx);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cleanup</span></span><br><span class="line"><span class="built_in">CGImageRelease</span>(cgImgRef);</span><br><span class="line"><span class="built_in">CGContextRelease</span>(ctx);</span><br></pre></td></tr></table></figure><p>è¿™æ ·åŸºæœ¬å°±å®Œæˆäº†ï¼Œæˆ‘ä»¬ç»˜åˆ¶äº†ä¸€ä¸ªå®Œæ•´çš„å›¾åƒåˆ°CGContextä¸Šï¼ŒQuickLookä¼šæ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œå¤§å°æ˜¯æˆ‘ä»¬æŒ‡å®šçš„å›¾åƒå¤§å°ã€‚</p><p><img src="https://raw.githubusercontent.com/dreampiggy/AVIFQuickLook/master/Screenshot/Preview.png"></p><p>å¦‚æœä½ çš„QuickLookæ’ä»¶ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå¼‚æ­¥çš„å¤„ç†å’Œç­‰å¾…ï¼ŒåŒæ—¶å¯ä»¥å®ç°è¿™ä¸ªå–æ¶ˆçš„å…¥å£å‡½æ•°ï¼Œæ¥å‡å°‘CPUå ç”¨ï¼Œä¼˜åŒ–ä¸€ä¸‹ç”¨æˆ·ä½“éªŒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void CancelPreviewGeneration(void *thisInterface, QLPreviewRequestRef preview)</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚è¯´ï¼Œå¯¹äºå¤§å›¾åƒè§£å—ï¼Œå¯ä»¥ä¸­æ–­è§£ç æå‰é‡Šæ”¾å†…å­˜ã€‚</p><h3 id="ä½¿ç”¨é¢„ç½®ç±»å‹ç”Ÿæˆæ•°æ®æ¸²æŸ“"><a href="#ä½¿ç”¨é¢„ç½®ç±»å‹ç”Ÿæˆæ•°æ®æ¸²æŸ“" class="headerlink" title="ä½¿ç”¨é¢„ç½®ç±»å‹ç”Ÿæˆæ•°æ®æ¸²æŸ“"></a>ä½¿ç”¨é¢„ç½®ç±»å‹ç”Ÿæˆæ•°æ®æ¸²æŸ“</h3><p>QuickLook Previewè¿˜æœ‰å¦ä¸€ç§æ¸²æŸ“æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨QuickLooké¢„ç½®çš„æ–‡ä»¶ç±»å‹æ”¯æŒï¼Œæ¥æä¾›ç›¸åº”çš„æ•°æ®ã€‚å¯¹åº”æ–‡æ¡£ï¼š<a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/Quicklook_Programming_Guide/Articles/QLDynamicGeneration.html#//apple_ref/doc/uid/TP40005020-CH15-SW5">Dynamically Generating Previews</a></p><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨<a href="https://developer.apple.com/documentation/quicklook/1402661-qlpreviewrequestsetdatarepresent?language=objc">QLPreviewRequestSetDataRepresentation</a>ï¼Œæ¥æä¾›ä¸€ä¸ªé¢„ç½®æ”¯æŒæ ¼å¼çš„Data Bufferç»™QuickLookã€‚</p><p>æ”¯æŒçš„æ ¼å¼æœ‰ï¼š</p><ul><li>Image: ç³»ç»ŸImage/IOè§£ç åº“æ”¯æŒçš„å›¾åƒå‹ç¼©æ ¼å¼</li><li>PDFï¼šPDFæ•°æ®</li><li>HTMLï¼šWebKitæ”¯æŒçš„HTMLå­—ç¬¦ä¸²ï¼Œæ³¨æ„å¦‚æœæœ‰æœ¬åœ°çš„CSSï¼Œéœ€è¦ä½¿ç”¨<code>kQLPreviewPropertyAttachmentDataKey</code>å¸¦ä¸ŠCSSçš„æ•°æ®</li><li>XMLï¼šWebKitæ”¯æŒçš„XMLå­—ç¬¦ä¸²</li><li>RTFï¼šmacOSæ”¯æŒçš„å¯Œæ–‡æœ¬æ ¼å¼ï¼ˆNSAttributedStringå¯ä»¥è½¬æ¢çš„åˆ°ï¼‰</li><li>Textï¼šçº¯æ–‡æœ¬å­—ç¬¦ä¸²</li><li>Movieï¼šç³»ç»ŸCoreVideoåº“æ”¯æŒçš„è§†é¢‘å‹ç¼©æ ¼å¼</li><li>Audioï¼šç³»ç»ŸCoreAudioåº“æ”¯æŒçš„éŸ³é¢‘å‹ç¼©æ ¼å¼</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSImage</span> *image;</span><br><span class="line"><span class="built_in">NSData</span> *imageData = [image TIFFRepresentation];</span><br><span class="line">QLPreviewRequestSetDataRepresentation(preview, (__bridge <span class="built_in">CFDataRef</span>)data, kUTTypeImage, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure><h3 id="åœ¨å…¶ä»–Appä¸­ä½¿ç”¨Preview"><a href="#åœ¨å…¶ä»–Appä¸­ä½¿ç”¨Preview" class="headerlink" title="åœ¨å…¶ä»–Appä¸­ä½¿ç”¨Preview"></a>åœ¨å…¶ä»–Appä¸­ä½¿ç”¨Preview</h3><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¾—ç›ŠäºmacOSå®Œæ•´çš„è½¯ä»¶ç”Ÿæ€ï¼Œä½ çš„QuickLook Pluginçš„Preview UIï¼Œä¸ä»…ä»…ä¼šå‡ºç°åœ¨Finderä¸­ç©ºæ ¼å¼¹å‡ºçš„é¢„è§ˆï¼Œç”šè‡³äºXcodeå’Œä¸€äº›ç¬¬ä¸‰æ–¹Appå†…ç½®çš„é¢„è§ˆï¼ˆå³ç”¨åˆ°äº†<a href="https://developer.apple.com/documentation/quartz/qlpreviewpanel">QLPreviewPanel</a>æ¥å±•ç¤ºUIçš„åœ°æ–¹ï¼‰ï¼Œéƒ½èƒ½è§¦å‘ä½ çš„æ’ä»¶ï¼Œæ‰€ä»¥å¯ä»¥è¯´æ˜¯éå¸¸èˆ’æœã€‚</p><p>åœ¨Xcodeä¸­ç¼©ç•¥å›¾å¦‚ä¸‹ï¼š</p><p>![å±å¹•å¿«ç…§ 2019-04-16 ä¸‹åˆ1.49.04](<a href="http://dreampiggy-image.test.upcdn.net/image/2019/04/16/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7">http://dreampiggy-image.test.upcdn.net/image/2019/04/16/å±å¹•å¿«ç…§</a> 2019-04-16 ä¸‹åˆ1.49.04.png)</p><h2 id="ç”¨äºThumbnailçš„ä»£ç ç»˜åˆ¶å®ç°"><a href="#ç”¨äºThumbnailçš„ä»£ç ç»˜åˆ¶å®ç°" class="headerlink" title="ç”¨äºThumbnailçš„ä»£ç ç»˜åˆ¶å®ç°"></a>ç”¨äºThumbnailçš„ä»£ç ç»˜åˆ¶å®ç°</h2><p>è¯´å®Œäº†å…³äºPreviewçš„å®ç°ä»£ç ï¼Œç°åœ¨å†æ¥çœ‹çœ‹å…³äºå¦‚ä½•ç”ŸæˆFinderç”¨åˆ°çš„æ–‡ä»¶ç¼©ç•¥å›¾</p><p>Thumbnailä¹Ÿæ”¯æŒä¸¤ç§æ¨¡å¼</p><ol><li>ä½¿ç”¨åŒPreviewçš„ï¼ŒåŸºäºCore Graphicsç»˜åˆ¶é€»è¾‘</li><li>æ›´ä¸ºç®€å•çš„APIï¼Œä½¿ç”¨CGImageæˆ–è€…Image Data</li></ol><p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œå’Œä¸Šæ–‡ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ç¬¬äºŒç§æ–¹å¼ã€‚æˆ‘ä»¬åªéœ€è¦æä¾›ä¸€ä¸ªCGImageï¼Œæˆ–è€…ä¸€ä¸ªImage/IOæ”¯æŒçš„å›¾åƒæ ¼å¼çš„Image Dataå³å¯</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœæ˜¯åŸç”Ÿæ”¯æŒçš„æ ¼å¼ï¼Œä½¿ç”¨QLThumbnailRequestSetImageWithData</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦åˆ™ï¼Œè‡ªå·±è§£ç å™¨è¾“å‡ºä¸€ä¸ªCGImageï¼Œç„¶åä¼ è¿›å»</span></span><br><span class="line"><span class="built_in">CGImageRef</span> cgImgRef;</span><br><span class="line"><span class="keyword">if</span> (cgImgRef) &#123;</span><br><span class="line">    QLThumbnailRequestSetImage(thumbnail, cgImgRef, <span class="literal">nil</span>);</span><br><span class="line">    <span class="built_in">CGImageRelease</span>(cgImgRef);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    QLThumbnailRequestSetImageAtURL(thumbnail, url, <span class="literal">nil</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹åº”åœ¨Finderä¸­ç¼©ç•¥å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/dreampiggy/AVIFQuickLook/master/Screenshot/Thumbnails.png"></p><h2 id="è°ƒè¯•QuickLookæ’ä»¶"><a href="#è°ƒè¯•QuickLookæ’ä»¶" class="headerlink" title="è°ƒè¯•QuickLookæ’ä»¶"></a>è°ƒè¯•QuickLookæ’ä»¶</h2><p>ä½œä¸ºä¸€ä¸ªæ’ä»¶ï¼Œè¦è°ƒè¯•èµ·æ¥æ¯”èµ·ä¸€èˆ¬çš„Appè¦éº»çƒ¦ä¸€äº›ã€‚ä¸è¿‡å¥½åœ¨macOSæä¾›äº†ä¸€ä¸ªä¸“é—¨çš„QuickLookè°ƒè¯•å‘½ä»¤ï¼Œè‹¹æœä¹Ÿæœ‰ä¸“é—¨æ–‡æ¡£ä»‹ç»</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ï¼Œä»¥<code>public.avif</code>çš„UTIï¼Œå¯¹<code>test.avif</code>æ–‡ä»¶ï¼Œè§¦å‘ä¸€æ¬¡Quick Lookçš„Previewï¼Œæ¥æŸ¥çœ‹æ¸²æŸ“æ˜¯å¦æ­£ç¡®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qlmanage -d2 -p test.avif -c public.avif</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œä¸ºäº†èƒ½å¤ŸDebugå•æ­¥è°ƒè¯•ï¼Œæˆ‘ä»¬ä½¿ç”¨Xcodeçš„Debug Schemeï¼Œé€šè¿‡å°†<code>Execulable</code>æ”¹æˆ<code>/usr/bin/qlmanage</code>ï¼Œåœ¨Argumentsä¸­å¡«å†™æˆä¸Šè¿°çš„å‚æ•°ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/04/16/%E6%9C%AA%E5%91%BD%E5%90%8D.png" alt="æœªå‘½å"></p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/04/16/%E6%9C%AA%E5%91%BD%E5%90%8D2.png" alt="æœªå‘½å2"></p><p>è¿™æ ·ï¼Œä½ å¯ä»¥ç»™ä½ çš„å¯¹åº”ä»£ç ä¸‹ä¸Šæ–­ç‚¹ï¼Œå½“ä½ å†æ¬¡ç‚¹å‡»Runæ¥è¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘å•æ­¥è°ƒè¯•ï¼Œæ£€æŸ¥å­˜åœ¨çš„é—®é¢˜ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ•´ä½“çœ‹ä¸‹æ¥ï¼ŒQuickLook Pluginçš„å¼€å‘æµç¨‹å¹¶æ²¡æœ‰å¤šä¹ˆå¤æ‚ï¼Œå…¶å®ä½ è¦åšçš„å°±æ˜¯ç”¨å·²æœ‰çš„Core Graphicsç»˜åˆ¶çŸ¥è¯†ï¼Œå¹¶ä¸æ¶‰åŠåˆ°AppKitç›¸å…³æ¦‚å¿µï¼Œå¯¹äºiOSå¼€å‘è€…ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚</p><p>å…¶ä¸­çš„å‘ï¼Œä¸»è¦åœ¨äºæ²¡æœ‰æ–‡æ¡£è¯´æ˜æ–°å¢UTIï¼Œéœ€è¦ç»‘å®šä¸€ä¸ªAppï¼Œè€Œä¸æ˜¯QuickLook Pluginæœ¬èº«èƒ½å¤Ÿå£°æ˜çš„ï¼Œå¯¹åº”ä¹Ÿä»‹ç»äº†ä¸€ä¸ªèªæ˜çš„æ–¹å¼ç»•è¿‡è¿™ä¸€é™åˆ¶ã€‚å¸Œæœ›èƒ½å¸®åŠ©åˆ°æœ‰åŒæ ·éœ€æ±‚çš„äººã€‚</p><p>è‡ªå·±çš„AVIF QuickLook Pluginä¹Ÿç»ˆäºå®Œå·¥ï¼Œæ¬¢è¿æœ‰å…´è¶£çš„äººå°è¯•ï¼Œå¹¶ä¸”ç»™ä¸€ç‚¹Starï¼š</p><ul><li><a href="https://github.com/dreampiggy/AVIFQuickLook">AVIFQuickLook</a>ï¼šé¢„è§ˆAVIFå›¾åƒ</li></ul><p>è¿™é‡Œè¿˜æœ‰ä¸€äº›æ¨èå’Œè‡ªå·±ç”¨åˆ°çš„QuickLook Pluginï¼Œä¹Ÿåˆ—ä¸¾å‡ºæ¥ï¼Œèƒ½å¤§å¤§æå‡æ—¥å¸¸ä½¿ç”¨æ•ˆç‡å“¦</p><ul><li><a href="https://github.com/Nyx0uf/qlImageSize">qlImageSize</a>ï¼šé¢„è§ˆWebPå’ŒBPGå›¾åƒï¼Œæ˜¾ç¤ºå›¾åƒå…ƒä¿¡æ¯</li><li><a href="https://github.com/toland/qlmarkdown">qlmarkdown</a>ï¼šé¢„è§ˆMarkdown</li><li><a href="https://github.com/ealeksandrov/ProvisionQL">ProvisionQL</a>ï¼šé¢„è§ˆipaåŒ…ï¼Œä»¥åŠmobileprovisionè¯ä¹¦ä¿¡æ¯</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;QuickLookç®€ä»‹&quot;&gt;&lt;a href=&quot;#QuickLookç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;QuickLookç®€ä»‹&quot;&gt;&lt;/a&gt;QuickLookç®€ä»‹&lt;/h2&gt;&lt;p&gt;QuickLook æ˜¯macOSä¸Šæä¾›çš„ä¸€é¡¹å¿«é€Ÿå±•ç¤ºæ–‡æ¡£é¢„è§ˆçš„åŠŸèƒ½ï¼Œåªéœ€è¦æŒ‰ä¸‹ç©ºæ ¼å°±å¯ä»¥å¿«é€ŸæŸ¥çœ‹å„ç§æ–‡ä»¶æ ¼å¼çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡æœ¬ï¼Œä»£ç ï¼Œå›¾ç‰‡ï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºQuickLookéœ€è¦æ”¯æŒä¸æ–­æ‰©å±•çš„æ–‡ä»¶æ ¼å¼ï¼Œå› æ­¤macOSä¸“é—¨æä¾›äº†ä¸€ä¸ªQuickLook Pluginï¼Œèƒ½è®©å¼€å‘è€…å¯¹è‡ªå·±çš„æ–‡ä»¶æ ¼å¼æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„å®Œæ•´çš„UIæ˜¾ç¤ºï¼Œä¸å¿…ä¾èµ–macOSç³»ç»Ÿæ›´æ–°æ¥æ”¯æŒç¼¤çº·å¤æ‚çš„æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰ä¸€æ®µæ—¶é—´ï¼Œå‡ºäºå…´è¶£åšäº†ä¸€ä¸ª&lt;a href=&quot;https://aomediacodec.github.io/av1-avif/&quot;&gt;AVIF (AV1 Image File Format)&lt;/a&gt;çš„è§£ç å™¨å°è£…ï¼ŒAV1ä½œä¸ºç°åœ¨æµè¡Œçš„HEVC(H.265)æ½œåœ¨æœªæ¥ç«äº‰è€…ï¼Œæœ‰ç€å¼€æºï¼Œæ— ä¸“åˆ©é™åˆ¶ï¼Œæ›´é«˜çš„å‹ç¼©æ¯”ç­‰ç­‰ä¼˜åŠ¿ï¼Œæ¯”èµ·HEVCæ™šè¯ç”Ÿäº†5å¹´ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰AVIFè™½ç„¶å‘å¸ƒäº†ç¬¬ä¸€ç‰ˆè§„èŒƒï¼Œä½†æ˜¯ç¼ºå°‘ç›¸åº”çš„å‘¨è¾¹å·¥å…·é“¾çš„æ”¯æŒï¼Œåœ¨macOSä¸Šæƒ³è¦æ‰¾ä¸€ä¸ªç®€å•çš„Image Vieweréƒ½æ²¡æ‰¾åˆ°ï¼Œè°ƒè¯•èµ·æ¥å¼‚å¸¸å›°éš¾ï¼Œå› æ­¤æŠ½ç©ºé¡ºä¾¿åšäº†ä¸€ä¸ªç®€å•çš„Quick Look Pluginï¼Œæ¥è®©è‡ªå·±èƒ½ç›´æ¥ç©ºæ ¼é¢„è§ˆAVIFå›¾åƒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åšQuickLook Pluginçš„è¿‡ç¨‹ä¸­ï¼Œæ„Ÿè§‰æœ‰ä¸€äº›å°å‘éœ€è¦è®°ä¸‹æ¥ï¼Œå› æ­¤è¿™ç¯‡æ–‡ç« ï¼Œç›®æ ‡å°±æ˜¯ä¸€ä¸ªç®€å•çš„å…¥é—¨æ•™ç¨‹ï¼Œè®²è§£å¦‚ä½•åšä¸€ä¸ªQuickLook Pluginï¼Œæ¥å¯¹è‡ªå·±å–œçˆ±ä½†åˆä¸è¢«ç³»ç»Ÿæ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒæ”¯æŒã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="macOS" scheme="http://dreampiggy.com/tags/macOS/"/>
    
    <category term="QuickLook" scheme="http://dreampiggy.com/tags/QuickLook/"/>
    
    <category term="AVIF" scheme="http://dreampiggy.com/tags/AVIF/"/>
    
  </entry>
  
  <entry>
    <title>ä¸»æµå›¾ç‰‡åŠ è½½åº“æ‰€ä½¿ç”¨çš„é¢„è§£ç ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆ</title>
    <link href="http://dreampiggy.com/2019/01/18/%E4%B8%BB%E6%B5%81%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E5%BA%93%E6%89%80%E4%BD%BF%E7%94%A8%E7%9A%84%E9%A2%84%E8%A7%A3%E7%A0%81%E7%A9%B6%E7%AB%9F%E5%B9%B2%E4%BA%86%E4%BB%80%E4%B9%88/"/>
    <id>http://dreampiggy.com/2019/01/18/%E4%B8%BB%E6%B5%81%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E5%BA%93%E6%89%80%E4%BD%BF%E7%94%A8%E7%9A%84%E9%A2%84%E8%A7%A3%E7%A0%81%E7%A9%B6%E7%AB%9F%E5%B9%B2%E4%BA%86%E4%BB%80%E4%B9%88/</id>
    <published>2019-01-18T14:09:27.000Z</published>
    <updated>2022-05-09T07:27:55.183Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸»æµå›¾ç‰‡åŠ è½½åº“æ‰€ä½¿ç”¨çš„é¢„è§£ç ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆ"><a href="#ä¸»æµå›¾ç‰‡åŠ è½½åº“æ‰€ä½¿ç”¨çš„é¢„è§£ç ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆ" class="headerlink" title="ä¸»æµå›¾ç‰‡åŠ è½½åº“æ‰€ä½¿ç”¨çš„é¢„è§£ç ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆ"></a>ä¸»æµå›¾ç‰‡åŠ è½½åº“æ‰€ä½¿ç”¨çš„é¢„è§£ç ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆ</h1><blockquote><p>å¾ˆå¤šå›¾ç‰‡åº“ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼å«åšForce-Decodeï¼ŒDecode For Displayä¹‹ç±»çš„æ„Ÿå¿µï¼Œå¾ˆå¤šäººå¯èƒ½å¯¹è¿™ä¸ªè¿‡ç¨‹åˆ°åº•æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ä¸æ¸…æ¥šï¼Œè¿™é‡Œå†™ä¸€ä¸ªæ–‡ç« æ¥è¯´æ˜å®ƒã€‚</p></blockquote><p>è¿™é‡Œåˆ—ä¸¾äº†å„ä¸ªå›¾ç‰‡åº“å„è‡ªçš„è¯´æ³•ï¼Œå…¶å®è®²çš„éƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ä¸€ä¸ªæ¦‚å¿µã€‚</p><ul><li><a href="https://github.com/SDWebImage/SDWebImage/">SDWebImage</a>ï¼šä½¿ç”¨äº†<code>forceDecode</code>, <code>decompressImages</code>çš„æ¦‚å¿µ</li><li><a href="https://github.com/ibireme/YYWebImage">YYWebImage</a>ï¼šä½¿ç”¨äº†<code>decodeForDisplay</code>çš„æ¦‚å¿µ</li><li><a href="https://github.com/onevcat/Kingfisher">Kingfisher</a>ï¼šä½¿ç”¨äº†<code>backgroundDecode</code>çš„æ¦‚å¿µ</li></ul><h1 id="ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¿‡ç¨‹ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜"><a href="#ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¿‡ç¨‹ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¿‡ç¨‹ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜"></a>ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¿‡ç¨‹ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜</h1><p>ä¸ºäº†è§£é‡Šè¿™ä¸ªè¿‡ç¨‹å…·ä½“çš„è§£å†³é—®é¢˜ï¼Œéœ€è¦è‡³å°‘äº†è§£è‹¹æœçš„ç³»ç»Ÿè§£ç å™¨çš„å·¥ä½œæµç¨‹ã€‚</p><h2 id="Image-IOå’Œæƒ°æ€§è§£ç "><a href="#Image-IOå’Œæƒ°æ€§è§£ç " class="headerlink" title="Image/IOå’Œæƒ°æ€§è§£ç "></a>Image/IOå’Œæƒ°æ€§è§£ç </h2><p><a href="https://developer.apple.com/documentation/imageio">Image/IOåº“</a>æ˜¯è‹¹æœæä¾›çš„ï¼Œè·¨æ‰€æœ‰Appleå¹³å°çš„ç³»ç»Ÿè§£ç å™¨ï¼Œæ”¯æŒå¸¸è§çš„å„ç§å›¾åƒæ ¼å¼ï¼ˆJPEG/PNG/TIFF/GIF/HEIF/BMPç­‰ï¼‰çš„ç¼–ç å’Œè§£ç ã€‚åŒæ—¶ï¼Œæœ‰ä¸°å¯Œçš„æ¥å£æ¥å’Œè¯¸å¦‚Core Graphicsåº“åä½œã€‚</p><p>å¸¸è§çš„ç½‘ç»œå›¾åƒè§£ç ï¼Œç”±äºæ‹¿åˆ°çš„æ˜¯ä¸€ä¸ªå‹ç¼©æ ¼å¼ï¼Œè‚¯å®šéœ€è¦æƒ³åŠæ³•è½¬æ¢åˆ°å¯¹åº”çš„UIImageã€‚UIImageå¯ä»¥åˆ†ä¸ºCGImage-basedå’ŒCIImage-basedï¼Œåè€…ç›¸å¯¹å¼€é”€å¤§ä¸€äº›ï¼Œä¸»è¦æ˜¯ç”¨ä½œæ»¤é•œç­‰å¤„ç†ï¼Œä¸æ¨èä½¿ç”¨ã€‚æ‰€ä»¥åŸºæœ¬ä¸Šå„ç§å›¾ç‰‡åº“è§£ç ï¼Œä¸ºäº†è§£ç å‹ç¼©æ ¼å¼ï¼Œå¾—åˆ°ä¸€ä¸ªCGImageï¼Œéƒ½æ˜¯ç”¨äº†Image/IOçš„è¿™ä¸ªAPIï¼š</p><p><a href="https://developer.apple.com/documentation/imageio/1465011-cgimagesourcecreateimageatindex?language=objc">CGImageSourceCreateImageAtIndex</a></p><p>å®é™…ä¸Šï¼ŒImage/IOï¼Œé™¤äº†è°ƒç”¨å…·ä½“çš„è§£ç å™¨äº§ç”Ÿå›¾åƒçš„Bitmapä»¥å¤–ï¼Œä¸ºäº†å’ŒCore Graphicsåº“åä½œï¼Œä¹Ÿç›´æ¥ä»¥CGImageè¿™ä¸ªæ•°æ®ç»“æ„æ¥ä¼ é€’ï¼Œä½†æ˜¯ä»–é‡‡å–äº†ä¸€ç§æƒ°æ€§è§£ç çš„åˆ›å»ºæ–¹å¼ã€‚å› æ­¤è¿™é‡Œé¦–å…ˆè¦äº†è§£CGImageåˆå§‹åŒ–çš„æ¥å£å’Œå¯¹åº”çš„è¡Œä¸ºï¼š</p><p><a href="https://developer.apple.com/documentation/coregraphics/1455149-cgimagecreate?language=objc">CGImageCreate</a></p><p>è¿™é‡Œé¢å…¶ä»–å‚æ•°éƒ½å¥½ç†è§£ï¼Œå…·ä½“çœ‹ä¸€ä¸ª<code>provider</code>å‚æ•°ï¼Œè¿™é‡Œé¢éœ€è¦ä¼ å…¥ä¸€ä¸ª<code>CGDataProviderRef</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…³äºæè¿°æ€ä¹ˆæ ·å»è·å–è¿™ä¸ªBitmap BufferäºŒè¿›åˆ¶æ•°æ®çš„ç»“æ„ã€‚å†æ¥çœ‹çœ‹CGDataProviderçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œè¿™æ—¶å€™å‘ç°å®ƒæœ‰å¤šç§åˆå§‹åŒ–æ–¹å¼ï¼Œå†³å®šäº†åé¢çš„è¡Œä¸ºã€‚</p><ul><li><a href="https://developer.apple.com/documentation/coregraphics/cgdataprovider/1805224-cgdataprovidercreate">CGDataProviderCreate</a></li></ul><p>è¿™ä¸ªæ–¹æ³•ï¼Œå…è®¸æ¥å—ä¸€ä¸ª<code>CGDataProviderCallbacks</code>å‚æ•°ï¼Œçœ‹è¯´æ˜ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªcallbacksæ˜¯ä¸€ç³»åˆ—å‡½æ•°æŒ‡é’ˆå›è°ƒï¼Œç›®çš„æ˜¯æä¾›ä¸€ä¸ªsequential-accessçš„è®¿é—®æ¨¡å¼ï¼ŒåŒæ—¶Data Bufferä¼šè¢«copyå‡ºå»ã€‚åŒæ—¶ï¼Œç”±äºä¼ å…¥çš„æ˜¯callbacksï¼Œå¯ä»¥åšåˆ°ä¸ç«‹å³æä¾›Data Bufferï¼Œè€Œæ˜¯åœ¨æœªæ¥éœ€è¦çš„æ—¶å€™å†è§¦å‘ã€‚</p><ul><li><a href="https://developer.apple.com/documentation/coregraphics/1408282-cgdataprovidercreatedirect?language=objc">CGDataProviderCreateDirect</a></li></ul><p>è¿™ä¸ªæ–¹æ³•ï¼Œç±»ä¼¼äº<code>CGDataProviderCreate</code>ï¼Œä½†æ˜¯æ³¨æ˜äº†è¿™ä¸ªcallbacksç”Ÿæˆçš„Data Bufferä¸ä¼šè¢«Copyï¼ŒCore Graphicsåªä¼šç›´æ¥è®¿é—®è¿”å›çš„Data BufferæŒ‡é’ˆï¼Œéœ€è¦è‡ªå·±ç®¡ç†å¥½å†…å­˜ã€‚</p><ul><li><a href="https://developer.apple.com/documentation/coregraphics/1408288-cgdataprovidercreatewithdata?language=objc">CGDataProviderCreateWithData</a></li></ul><p>è¿™ä¸ªæ–¹æ³•ï¼Œéœ€è¦æä¾›ä¸€ä¸ªCFDataï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šCopyè¿™ä¸ªCFDataã€‚åœ¨Releaseçš„åŒæ—¶ç”±Core Graphicsè‡ªåŠ¨é‡Šæ”¾CFDataçš„å†…å­˜ï¼Œå¼€å‘è€…ä¸éœ€è¦ç®¡ç†å†…å­˜ã€‚</p><p>å‰©ä½™çš„å…·ä½“åˆå§‹åŒ–æ–¹æ³•å¯ä»¥çœ‹æ–‡æ¡£è¯´æ˜ï¼Œæ€»è€Œè¨€ä¹‹ï¼ŒCGDataProvideræä¾›äº†å„ç§å„æ ·çš„è®¿é—®æ¨¡å¼ï¼Œå¦‚ç›´æ¥è®¿é—®ï¼Œæ‹·è´è®¿é—®ï¼Œæƒ°æ€§è®¿é—®ç­‰ã€‚è€Œç°åœ¨é—®é¢˜å°±æ¥äº†ï¼Œå‰é¢è¯´åˆ°ï¼ŒImage/IOåˆ›å»ºCGImageçš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æä¾›ä¸€ä¸ªDataProvideræ¥æŒ‡æ˜å›¾åƒçš„Bitmap Bufferæ•°æ®ä»å“ªé‡Œè·å–ï¼Œå®ƒæ˜¯å…·ä½“ç”¨äº†ä»€ä¹ˆæ–¹å¼å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä½¿ç”¨äº†ä¸€ä¸ªç§æœ‰API<code>CGImageCreateWithImageProvider</code>ï¼Œç»è¿‡æŸ¥çœ‹ï¼Œè¿™ä¸ªæ–¹å¼å®é™…ç±»ä¼¼<code>CGDataProviderCreateDirect</code>ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¸€ç»„callbacksï¼Œæä¾›äº†ä¸€ä¸ªç›´æ¥è®¿é—®ï¼Œå…è®¸æƒ°æ€§æä¾›Data Bufferçš„æ–¹å¼ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼ŒImage/IOï¼Œå…¶å®é‡‡å–çš„æ˜¯ä¸€ç§æƒ°æ€§è§£ç æ–¹å¼ã€‚è§£ç å™¨åªé¢„å…ˆæ‰«æä¸€éå‹ç¼©æ ¼å¼çš„å®¹å™¨ï¼Œæå–å…ƒä¿¡æ¯ï¼Œä½†æ˜¯ä¸äº§ç”Ÿæœ€ç»ˆçš„Bitmap Bufferï¼Œè€Œæ˜¯é€šè¿‡æƒ°æ€§å›è°ƒçš„æ–¹å¼ï¼Œæ‰ç”ŸæˆBitmap Bufferã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/01/18/15477913743261.jpg"></p><p>æ¢å¥è¯è¯´ï¼Œé€šè¿‡æ‰€æœ‰<code>CGImageSourceCreateImageAtIndex</code>è¿™ç§APIç”Ÿæˆçš„CGImageï¼Œå…¶å®å®ƒçš„backing storeï¼ˆå°±æ˜¯Bitmapï¼‰è¿˜æ²¡æœ‰ç«‹å³åˆ›å»ºï¼Œä»–åªæ˜¯ä¸€ä¸ªåŒ…å«äº†ä¸€äº›å…ƒä¿¡æ¯çš„ç©ºå£³Imageã€‚è¿™ä¸ªCGImageï¼Œåœ¨æœ€ç»ˆéœ€è¦è·å–å®ƒçš„Bitmap Bufferçš„æ—¶å€™ï¼ˆå³ï¼Œé€šè¿‡ç›¸åº”çš„APIï¼Œå¦‚<code>CGDataProviderCopyData</code>ï¼Œ<code>CGDataProviderRetainBytePtr</code>ï¼‰ï¼Œæ‰ä¼šè§¦å‘æœ€åçš„Bitmap Bufferçš„åˆ›å»ºå’Œå†…å­˜åˆ†é…ã€‚</p><h2 id="Image-IOå’ŒForce-Decode"><a href="#Image-IOå’ŒForce-Decode" class="headerlink" title="Image/IOå’ŒForce Decode"></a>Image/IOå’ŒForce Decode</h2><p>ç†è§£åˆ°ä¸Šé¢Image/IOçš„æƒ°æ€§è§£ç è¡Œä¸ºï¼Œç†è§£äº†ä¸Šé¢ä¸€ç‚¹ï¼Œç°åœ¨è¯´æ˜Force Decodeæ‰€è§£å†³çš„é—®é¢˜ã€‚</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒiOSåº”ç”¨çš„æ¸²æŸ“æ¨¡å¼ï¼Œæ˜¯å®Œå…¨åŸºäºCore Animationå’ŒCALayerçš„ï¼ˆmacOSä¸Šå¯é€‰ï¼Œå¦è¯´ï¼‰ã€‚å› æ­¤ï¼Œå½“ä¸€ä¸ªUIImageViewéœ€è¦æŠŠå›¾ç‰‡å‘ˆç°åˆ°è®¾å¤‡çš„å±å¹•ä¸Šæ—¶å€™ï¼Œå…¶å®å®ƒçš„Pipelineæ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ä¸€æ¬¡Runloopå®Œç»“ -&gt; </li><li>Core Animationæäº¤æ¸²æŸ“æ ‘CA::render::commit -&gt;</li><li>éå†æ‰€æœ‰Layerçš„contents -&gt;</li><li>UIImageViewçš„contentsæ˜¯CGImage -&gt;</li><li>æ‹·è´CGImageçš„Bitmap Bufferåˆ°Surfaceï¼ˆMetalæˆ–è€…OpenGL ES Textureï¼‰ä¸Š -&gt;</li><li>Surfaceï¼ˆMetalæˆ–è€…OpenGL ESï¼‰æ¸²æŸ“åˆ°ç¡¬ä»¶ç®¡çº¿ä¸Š</li></ol><p>è¿™ä¸ªæµç¨‹çœ‹èµ·æ¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æ³¨æ„ï¼ŒCore Animationåº“è‡ªèº«ï¼Œè™½ç„¶æ”¯æŒå¼‚æ­¥çº¿ç¨‹æ¸²æŸ“ï¼ˆåœ¨macOSä¸Šå¯ä»¥æ‰‹åŠ¨å¼€å¯ï¼‰ï¼Œä½†æ˜¯UIKitçš„è¿™å¥—å†…å»ºçš„pipelineï¼Œå…¨éƒ¨éƒ½æ˜¯å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹çš„ã€‚</p><p>å› æ­¤ï¼Œå½“ä¸€ä¸ªCGImageï¼Œæ˜¯é‡‡å–äº†æƒ°æ€§è§£ç ï¼ˆé€šè¿‡Image/IOç”Ÿæˆå‡ºæ¥çš„ï¼‰ï¼Œé‚£ä¹ˆå°†ä¼šåœ¨ä¸»çº¿ç¨‹è§¦å‘å…ˆå‰æåˆ°çš„æƒ°æ€§è§£ç callbackï¼ˆå®é™…ä¸ŠCore Animationçš„è°ƒç”¨ï¼Œè§¦å‘äº†ä¸€ä¸ª<code>CGDataProviderRetainBytePtr</code>ï¼‰ï¼Œè¿™æ—¶å€™Image/IOçš„å…·ä½“è§£ç å™¨ï¼Œä¼šæ ¹æ®å…ˆå‰çš„å›¾åƒå…ƒä¿¡æ¯ï¼Œå»åˆ†é…å†…å­˜ï¼Œåˆ›å»ºBitmap Bufferï¼Œè¿™ä¸€æ­¥éª¤ä¹Ÿå‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ã€‚</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/01/18/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-01-18%20%E4%B8%8B%E5%8D%881.44.45.png" alt="å±å¹•å¿«ç…§ 2019-01-18 ä¸‹åˆ1.44.45"></p><p>è¿™ä¸ªæµç¨‹å¸¦æ¥çš„é—®é¢˜åœ¨äºï¼Œä¸»çº¿ç¨‹è¿‡å¤šçš„é¢‘ç¹æ“ä½œï¼Œä¼šé€ æˆæ¸²æŸ“å¸§ç‡çš„ä¸‹é™ã€‚å®éªŒå¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡åŸç”Ÿè¿™ä¸€å¥—æµç¨‹ï¼Œå¯¹äºä¸€ä¸ª1000*1000çš„PNGå›¾ç‰‡ï¼Œç¬¬ä¸€æ¬¡æ»šåŠ¨å¸§ç‡å¤§æ¦‚ä¼šé™ä½5-6å¸§ï¼ˆiPhone 5Sä¸Šå½“å¹´æœ‰äººçš„æµ‹è¯•ï¼‰ã€‚åç»­å¸§ç‡ä¸å—å½±å“ï¼Œå› ä¸ºæ˜¯æƒ°æ€§è§£ç ï¼Œè§£ç å®Œæˆåçš„Bitmap Bufferä¼šå¤ç”¨ã€‚</p><p>æ‰€ä»¥ï¼Œæœ€æ—©ä¸çŸ¥æ˜¯å“ªä¸ªå›¢é˜Ÿçš„äººï¼ˆå¯èƒ½æ˜¯<a href="https://github.com/path/FastImageCache">FastImageCache</a>ï¼Œä¸ç¡®å®šï¼‰å‘ç°ï¼Œå¹¶æå‡ºäº†å¦ä¸€ç§æ–¹æ¡ˆï¼šé€šè¿‡é¢„å…ˆè°ƒç”¨è·å–Bitmapï¼Œå¼ºåˆ¶Image/IOäº§ç”Ÿçš„CGImageè§£ç ï¼Œè¿™æ ·åˆ°æœ€ç»ˆæ¸²æŸ“çš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹å°±ä¸ä¼šè§¦å‘ä»»ä½•é¢å¤–æ“ä½œï¼Œå¸¦æ¥æ˜æ˜¾çš„å¸§ç‡æå‡ã€‚åé¢çš„ä¸€ç³»åˆ—å›¾ç‰‡åº“ï¼Œéƒ½äº’ç›¸æ•ˆä»¿ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>å…·ä½“åˆ°è§£å†³æ–¹æ¡ˆä¸Šï¼Œç›®å‰ä¸»æµçš„æ–¹å¼ï¼Œæ˜¯é€šè¿‡CGContextå¼€ä¸€ä¸ªé¢å¤–çš„ç”»å¸ƒï¼Œç„¶åé€šè¿‡<code>CGContextDrawImage</code>æ¥ç”»ä¸€éåŸå§‹çš„ç©ºå£³CGImageï¼Œç”±äºåœ¨<code>CGContextDrawImage</code>çš„æ‰§è¡Œä¸­ï¼Œä¼šè§¦å‘åˆ°<code>CGDataProviderRetainBytePtr</code>ï¼Œå› æ­¤è¿™æ—¶å€™Image/IOå°±ä¼šç«‹å³è§£ç å¹¶åˆ†é…Bitmapå†…å­˜ã€‚å¾—åˆ°çš„äº§ç‰©ç”¨æ¥çœŸæ­£äº§å‡ºä¸€ä¸ªCGImage-basedçš„UIImageï¼Œäº¤ç”±UIImageViewæ¸²æŸ“ã€‚</p><h2 id="ForceDecodeçš„ä¼˜ç¼ºç‚¹"><a href="#ForceDecodeçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="ForceDecodeçš„ä¼˜ç¼ºç‚¹"></a>ForceDecodeçš„ä¼˜ç¼ºç‚¹</h2><p>ä¸Šé¢è§£é‡Šäº†ForceDecodeå…·ä½“è§£å†³çš„é—®é¢˜ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªæ–¹æ¡ˆè‚¯å®šå­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼Œä¸ç„¶è‹¹æœç ”å‘å›¢é˜Ÿæ—©å·²ç»æ”¹å˜äº†è¿™å¥—Pipelineæµç¨‹äº†</p><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul><li>å¯ä»¥æå‡ï¼Œå›¾åƒç¬¬ä¸€æ¬¡æ¸²æŸ“åˆ°å±å¹•ä¸Šæ—¶å€™çš„æ€§èƒ½å’Œæ»šåŠ¨å¸§ç‡</li></ul><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul><li>æå‰è§£ç ä¼šç«‹å³åˆ†é…Bitmap Bufferçš„å†…å­˜ï¼Œå¢åŠ äº†å†…å­˜å‹åŠ›ã€‚ä¸¾ä¾‹å­å¯¹äºä¸€å¼ å¤§å›¾ï¼ˆ2048*2048åƒç´ ï¼Œ32ä½è‰²ï¼‰æ¥è¯´ï¼Œå°±ä¼šç«‹å³åˆ†é…16MB(2048 * 2048 * 4 Bytes)çš„å†…å­˜ã€‚</li></ul><p>ç”±æ­¤å¯è§ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‹¿ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ã€‚ä½†æ˜¯å®é™…ä¸Šï¼ŒiOSè®¾å¤‡æ—©æœŸçš„å†…å­˜éƒ½æ˜¯éå¸¸æœ‰é™çš„ï¼ŒUIKitæ•´å¥—æ¸²æŸ“æœºåˆ¶å¾ˆå¤šåœ°æ–¹é‡‡å–çš„éƒ½æ˜¯æ—¶é—´æ¢ç©ºé—´ï¼Œå› æ­¤æœ€ç»ˆè‹¹æœæ²¡æœ‰ä½¿ç”¨è¿™å¥—Pipelineï¼Œè€Œæ˜¯ä¾èµ–äºé«˜æ€§èƒ½çš„ç¡¬ä»¶è§£ç å™¨+å…¶ä»–ä¼˜åŒ–ï¼Œæ¥ä¿è¯å†…å­˜å¼€é”€ç¨³å®šã€‚å½“ç„¶ï¼Œä½œä¸ºå›¾ç‰‡åº“å’Œå¼€å‘è€…ï¼Œè¿™å°±å±äºä»è€…è§ä»çš„ç­–ç•¥äº†ã€‚å¦‚å¤§é‡å°å›¾æ¸²æŸ“çš„æ—¶å€™ï¼Œå¼€å¯Force Decodeèƒ½æ˜æ˜¾æå‡å¸§ç‡ï¼ŒåŒæ—¶å†…å­˜å¼€é”€ä¹Ÿæ¯”è¾ƒç¨³å®šã€‚</p><h2 id="WebPå’Œè½¯ä»¶è§£ç "><a href="#WebPå’Œè½¯ä»¶è§£ç " class="headerlink" title="WebPå’Œè½¯ä»¶è§£ç "></a>WebPå’Œè½¯ä»¶è§£ç </h2><p>å½“æˆ‘ä»¬è¯´å®ŒImage/IOç³»ç»Ÿåº“å’ŒForce Decodeå…³ç³»åï¼Œå†æ¥çœ‹çœ‹å¦ä¸€ç§æƒ…å½¢ã€‚è¿‘äº›å¹´æ¥ï¼Œä¸€äº›æ–°å…´çš„å›¾åƒå‹ç¼©æ ¼å¼ï¼Œå¦‚<a href="https://developers.google.com/speed/webp/">WebP</a>ï¼Œå¾—ç›Šäºå¼€æºï¼Œé«˜å‹ç¼©ç‡ï¼Œæ›´å¥½çš„åŠ¨å›¾æ”¯æŒï¼Œå¾—åˆ°äº†å¾ˆå¤šå¼€å‘è€…é’çã€‚</p><p>ç„¶è€Œï¼Œè¿™äº›å›¾åƒæ ¼å¼ï¼Œå¹¶æ²¡æœ‰è¢«iOSç³»ç»Ÿè§£ç å™¨æ‰€æ”¯æŒï¼Œä¹Ÿæ²¡æœ‰å¯¹åº”çš„ç¡¬ä»¶è§£ç ã€‚å› æ­¤ï¼Œç°æœ‰çš„å›¾ç‰‡åº“åœ¨æ”¯æŒæ–°å›¾åƒæ ¼å¼çš„æ—¶å€™ï¼Œéƒ½é‡‡å–äº†ä½¿ç”¨CPUè¿›è¡Œè½¯ä»¶è§£ç æ¥å¤„ç†ã€‚è¿™äº›è½¯ä»¶è§£ç å™¨ï¼Œå¤§éƒ¨åˆ†æ˜¯ä¸ºäº†è·¨å¹³å°è€Œå®ç”¨çš„ï¼Œå› æ­¤ï¼Œä¸€èˆ¬éƒ½æœ‰ä¸€ä¸ªæ¥å£ç›´æ¥äº§å‡ºä¸€ä¸ªBitmap Bufferæ¥ç”¨äºæ¸²æŸ“ã€‚å¦‚WebPçš„å®˜æ–¹è§£ç å™¨libwebpï¼Œå°±æœ‰è¿™æ ·ä¸€ä¸ªæ¥å£ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WEBP_EXTERN VP8StatusCode <span class="title function_">WebPDecode</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* data, <span class="type">size_t</span> data_size, WebPDecoderConfig* config)</span>;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æˆ‘ä»¬çŸ¥é“CGImageå’ŒCGDataProviderçš„ä¸åŒåˆå§‹åŒ–æ–¹å¼ï¼Œå¼€å‘è€…é¢ä¸´è¿™æ ·çš„æ¥å£ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š</p><ol><li>ä½¿ç”¨CGDataProviderCreateWithDataï¼Œç›´æ¥æŠŠäº§å‡ºçš„Bitmap bufferå­˜å‚¨åˆ°CGImageä¸­</li><li>å‚è€ƒImage/IOï¼Œä½¿ç”¨CGDataProviderCreateDirectï¼Œä½¿ç”¨æƒ°æ€§è§£ç </li></ol><p>å½“ç„¶ï¼Œä¸ºäº†æœ€å¤§ç¨‹åº¦çš„åˆ©ç”¨è‹¹æœç³»ç»Ÿçš„é‚£å¥—Pipelineå’Œç°æœ‰ä»£ç æµç¨‹ï¼Œç¬¬ä¸€ç›´è§‰çš„ä½¿ç”¨æ–¹å¼å½“ç„¶æ˜¯æ–¹æ¡ˆ2ã€‚ç„¶è€Œï¼Œç†æƒ³æ˜¯ä¸°æ»¡çš„ï¼Œç°å®æ˜¯éª¨æ„Ÿçš„ã€‚ä¹‹æ‰€ä»¥Image/IOèƒ½å¤Ÿé‡‡å–æƒ°æ€§è§£ç è¿™ä¸€å¥—æµç¨‹ï¼Œæœ€å¤§çš„åŸå› åœ¨äº<strong>Image/IOçš„åŸç”Ÿå›¾åƒæ ¼å¼éƒ½æ˜¯ç¡¬ä»¶è§£ç ï¼Œä¸”è§£ç é€Ÿåº¦è¶³å¤Ÿå¿«</strong></p><p>åŒæ ·çš„æ–¹å¼ï¼Œå¥—ç”¨åˆ°WebPä¸Šï¼Œåè€Œä¼šå¸¦æ¥æ›´å¤§çš„é—®é¢˜ã€‚é¦–å…ˆï¼ŒWebPæ ¼å¼è‡ªèº«çš„å‹ç¼©ç®—æ³•é‡‡å–äº†VP8ï¼Œæ¯”èµ·JPEG/GIFçš„å‹ç¼©ç®—æ³•è¦å¤æ‚çš„å¤šï¼Œå¼€é”€å¤§ã€‚ç¬¬äºŒï¼Œlibwebpåªæœ‰è½¯ä»¶è§£ç çš„å®ç°ï¼Œæ— æ³•åˆ©ç”¨ç¡¬ä»¶æ¥åŠ å¿«è§£ç é€Ÿåº¦ã€‚</p><p>æ³¨ï¼šYYçš„ä½œè€…æœ‰ä¸“é—¨è·‘è¿‡æµ‹è¯•ï¼Œå¯¹äºiPhone 6ä¸Šï¼ŒåŒæ ·å‹ç¼©æ¯”çš„æœ‰æŸJPEGå’ŒWebPç›¸æ¯”ï¼Œè§£ç é€Ÿåº¦æ…¢å¤§æ¦‚50%-100%ï¼Œæ— æŸçš„PNGå’ŒWebPç›¸æ¯”æ¯”è¾ƒæ¥è¿‘ã€‚å‚è€ƒï¼š<a href="https://blog.ibireme.com/wp-content/uploads/2015/11/image_benchmark.xlsx">https://blog.ibireme.com/wp-content/uploads/2015/11/image_benchmark.xlsx</a></p><p>æ‰€ä»¥ï¼Œä¸»æµå›¾ç‰‡åº“æœ€ç»ˆçš„é€‰æ‹©æ–¹å¼ï¼Œéƒ½æ˜¯æ–¹æ¡ˆ1ï¼Œå³ç«‹å³ç”Ÿæˆäº†ä¸€ä¸ªå«æœ‰Bitmap Bufferçš„CGImageã€‚è¿™æ ·ï¼Œåˆ°æœ€ç»ˆUIImageViewæ¸²æŸ“çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼šæœ‰é¢å¤–çš„ä¸»çº¿ç¨‹è§£ç çš„å¼€é”€ï¼Œé™¤äº†éœ€è¦æå‰åˆ†é…å†…å­˜ä»¥å¤–åˆ«çš„è¿˜å¥½ã€‚</p><h2 id="WebPè½¯ä»¶è§£ç å’ŒForce-Decode"><a href="#WebPè½¯ä»¶è§£ç å’ŒForce-Decode" class="headerlink" title="WebPè½¯ä»¶è§£ç å’ŒForce Decode"></a>WebPè½¯ä»¶è§£ç å’ŒForce Decode</h2><p>å‰é¢è¯´åˆ°ï¼Œå¯¹äºWebPç­‰éç¡¬ä»¶è§£ç å™¨æ”¯æŒçš„å›¾ç‰‡å‹ç¼©æ ¼å¼ï¼Œå¤§å¤šæ•°å›¾ç‰‡åº“é‡‡å–äº†æ–¹æ¡ˆ1ã€‚ä½†æ˜¯ç°æœ‰çš„ä¸€äº›å›¾ç‰‡åº“ï¼ˆå¦‚SDWebImage/YYWebImageï¼‰ï¼Œä»ç„¶å¯¹è¿™ä¸ªéç©ºå£³çš„CGImageï¼Œæ‰§è¡Œäº†Force Decodeçš„è¿‡ç¨‹ï¼ŒæŒ‰ç†è®ºä¸Šè¯´å·²ç»æœ‰äº†Bitmap Bufferï¼Œä¸ä¼šè§¦å‘ä¸»çº¿ç¨‹è§£ç ï¼Œè¿™åˆæ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p><p>è¿™ä¸ªåŸå› ï¼Œæ˜¯æºäºå…ˆå‰çš„Force Decodeçš„å®ç°æœºåˆ¶ï¼Œåˆ©ç”¨åˆ°äº†<code>CGContextDrawImage</code>è¿™ä¸ªæ¥å£ã€‚</p><p><code>CGContextDrawImage</code>ï¼Œå†…éƒ¨å®ç°éå¸¸å¤æ‚ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªCGImageæ¥è¯´ï¼Œä»–åªæ˜¯Bitmap Buffer+å›¾åƒå…ƒä¿¡æ¯çš„åˆé›†ï¼Œä½†æ˜¯ä¸€ä¸ªCGContextï¼Œæ˜¯æœ‰ä¸€ä¸ªå›ºå®šçš„ColorSpaceï¼Œæ¸²æŸ“æ¨¡å¼ç­‰ç­‰ä¿¡æ¯ï¼Œæ˜¯å’Œå…·ä½“çš„ä¸Šä¸‹æ–‡ç›¸å…³çš„ã€‚</p><p>å› æ­¤ï¼Œå½“é€šè¿‡è¿™ä¸ªAPIç”»åœ¨ä¸€ä¸ªç”»å¸ƒä¸Šæ—¶ï¼Œä¼šè§¦å‘å¾ˆå¤šç»†èŠ‚çš„é€»è¾‘ï¼Œè¿™é‡Œä¸¾å‡ ä¸ªæ¯”è¾ƒæœ‰å½±å“çš„ã€‚</p><ol><li>é¦–å…ˆä¼šæ ¹æ®CGImageçš„ColorSpaceè½¬æ¢åˆ°CGContextçš„ColorSpaceï¼ˆæ¯”å¦‚è¯´CGImageä½¿ç”¨äº†sRGBï¼ŒCGContextç”¨äº†P3+å®½è‰²åŸŸï¼‰ï¼Œéœ€è¦å»å¯¹Bitmapçš„æ¯ä¸ªåƒç´ åšè½¬æ¢ï¼›å¦‚æœBitmapæ’åˆ—ï¼ˆå¦‚CGImageé‡‡å–RGB888ï¼ŒCGContexté‡‡å–BGRA8888ï¼‰ä¸åŒï¼Œä¹Ÿä¼šä»¥CGContextä¸ºå‡†è¿›è¡Œè½¬æ¢ã€‚</li><li>CGContextå¦‚æœæœ‰Blend Modeï¼Œä¹Ÿä¼šåœ¨æ­¤æµç¨‹ä¸­åšAlphaåˆæˆã€‚</li><li>å¦‚æœCGContextå’Œå¤§å°å’ŒCGImageä¸åŒï¼Œä¼šè§¦å‘å¯¹åº”çš„é‡é‡‡æ ·è¿‡ç¨‹ï¼Œå¼€å‘è€…å¯ä»¥æ§åˆ¶é‡é‡‡æ ·çš„è´¨é‡é«˜ä½</li><li>è¿˜æœ‰ä¸€ä¸ªå…³äºå†…å­˜ç®¡ç†çš„ï¼Œç”±äºCGContextç›®æ ‡å°±æ˜¯ä¸ºäº†åšæ¸²æŸ“å±‚ï¼Œå› æ­¤å®ƒä¾èµ–è¿™ä¸ªå‡è®¾ï¼Œå½“ä½ è°ƒç”¨<code>CGContextDrawImage</code>çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠŠå–åˆ°çš„Bitmap Bufferï¼Œç«‹é©¬æäº¤åˆ°render serverè¿›ç¨‹ä¸Šï¼ˆé€šè¿‡mmapï¼‰ï¼Œè¿™æ ·æœ€ååœ¨æ¸²æŸ“Pipelineï¼ˆå‰æ–‡æåˆ°ï¼‰ä¸­ï¼Œå°±å¯ä»¥çœå»ç¬¬5æ­¥ï¼ˆæ‹·è´CGImageçš„Bitmap Bufferåˆ°Surfaceï¼ˆMetalæˆ–è€…OpenGL ES Textureï¼‰ä¸Šï¼‰ã€‚è§ä¸‹ï¼š</li></ol><p><img src="http://dreampiggy-image.test.upcdn.net/image/2019/01/18/Lark20190118-134314.png"></p><p>å…¶å®å¯¹äºå¤§éƒ¨åˆ†å›¾ç‰‡åº“çš„Force Decodeæ¥è¯´ï¼Œå› ä¸ºéƒ½å¼€çš„æ˜¯ä¸€ä¸ªå’ŒCGImageåŒå¤§å°çš„ç©ºç™½ç”»å¸ƒï¼Œè¿™é‡Œä¸»è¦æ˜¯ç¬¬1å’Œç¬¬4é¡¹ä¼šå½±å“åˆ°æ€§èƒ½ã€‚ä¸€äº›å›¾ç‰‡åº“ï¼Œå› æ­¤ä¾æ—§ä¿ç•™äº†Force Decodeçš„æµç¨‹ï¼Œä¹Ÿæœ‰å„ç§å„æ ·çš„å…·ä½“ç¼˜ç”±ã€‚</p><h2 id="WebPè½¯ä»¶è§£ç è¿›è¡ŒForce-Decodeçš„ä¼˜ç¼ºç‚¹"><a href="#WebPè½¯ä»¶è§£ç è¿›è¡ŒForce-Decodeçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="WebPè½¯ä»¶è§£ç è¿›è¡ŒForce Decodeçš„ä¼˜ç¼ºç‚¹"></a>WebPè½¯ä»¶è§£ç è¿›è¡ŒForce Decodeçš„ä¼˜ç¼ºç‚¹</h2><p>äº†è§£äº†ä¸ºä»€ä¹ˆå¯¹äºWebPç­‰è½¯ä»¶è§£ç ï¼Œä¾ç„¶ä½¿ç”¨Force Decodeçš„ç¼˜ç”±ï¼Œå†æ¥çœ‹çœ‹è¿™ç§Caseä¸‹çš„ä¼˜ç¼ºç‚¹</p><h3 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li>èƒ½å¤Ÿæå‰æŠŠBitmap Bufferè½¬ç§»åˆ°æ¸²æŸ“è¿›ç¨‹ä¸Šï¼Œå‡å°‘äº†æœªæ¥æ¸²æŸ“æ—¶çš„å†…å­˜æ‹·è´æ“ä½œï¼ˆè™½ç„¶æ¯”èµ·è§£ç æ¥è¯´ï¼Œè¿™éƒ¨åˆ†æ—¶é—´ç›¸å½“çš„å°ï¼‰</li><li>å¦‚æœåŸå§‹è§£ç å‡ºæ¥çš„Bitmap Bufferï¼ŒiOSç¡¬ä»¶å±å¹•ä¸ç›´æ¥æ”¯æŒï¼ˆå¦‚RGB888ï¼ŒCMYKï¼‰ï¼Œä¼šæå‰è½¬æ¢å¥½ï¼Œé¿å…æ¸²æŸ“æ—¶ä¸»çº¿ç¨‹çš„è½¬æ¢</li><li>ï¼ˆï¼Ÿï¼‰å¯ä»¥ä»Xcodeè§†è§‰ä¸Šçœ‹èµ·æ¥Appå ç”¨å†…å­˜å˜å°ï¼Œå› ä¸ºBitmap Bufferæå‰æ‹·è´åˆ°renderè¿›ç¨‹äº†</li></ol><h3 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol><li>åœ¨å·²ç»æœ‰Bitmap Bufferçš„æƒ…å†µä¸‹ï¼Œå†å¼€ä¸€ä¸ªç”»å¸ƒï¼Œå¹¶è§¦å‘Drawï¼Œå¤§å›¾ä¼šå‡ºç°ä¸€ä¸ªä¸´æ—¶çš„å†…å­˜å³°å€¼ï¼ˆçº¦250%~300%åŸå§‹Bitmap Bufferçš„å ç”¨ï¼‰</li></ol><p>å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ã€‚å½“ç„¶ï¼Œè¿™ä¸ªç­–ç•¥çš„ä¼˜åŠ¿æ²¡æœ‰Image/IOé‚£æ ·å¤§ï¼Œå› ä¸ºå®é™…ä¸Šè½¬æ¢å’Œæ‹·è´å†…å­˜çš„æ€§èƒ½å¼€é”€ï¼Œæ¯”èµ·è§£ç å’Œåˆ›å»ºBitmap Bufferéƒ½æ˜¯éå¸¸ä½çš„ã€‚ä½†æ˜¯ä¸€äº›å›¾ç‰‡åº“æŠŠè¿™ä¸ªé€‰æ‹©æƒåˆ©äº¤ç»™äº†ç”¨æˆ·ï¼Œè€Œè‡ªå·±ä¸åšè¿™ä¸ªç­–ç•¥é€‰æ‹©ã€‚</p><p>PSå°è½¶é—»ï¼šSDWebImageå…¶å®æœ€æ—©åªæœ‰å¯¹Image/IOçš„é‚£ä¸ªForceDecodeæµç¨‹ï¼Œåæ¥åœ¨4.0åŠ å…¥WebPæ”¯æŒçš„æ—¶å€™ï¼Œä¹Ÿä¸æ¸…æ¥šè¿™ä¸ªæµç¨‹å½±å“ï¼Œé¡ºä¾¿å°±ä¸€å—ä½¿ç”¨è¿™å¥—æµç¨‹äº†ã€‚å¯ä»¥è¯´æ˜¯æ‰€è°“çš„è¯¯æ‰“è¯¯æ’ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ç¯‡æ–‡ç« åŸºæœ¬ä»‹ç»äº†Image/IOçš„æƒ°æ€§è§£ç æµç¨‹ï¼Œä»¥åŠForce Decodeè¿™å¥—æµç¨‹å®ƒæ‰€è§£å†³çš„é—®é¢˜ï¼Œä»¥åŠä¼˜ç¼ºç‚¹ã€‚æ— è®ºå¯¹å›¾ç‰‡åº“ä½œè€…ï¼Œè¿˜æ˜¯å›¾ç‰‡åº“è¿›é˜¶ä½¿ç”¨è€…ï¼Œéƒ½è§£é‡Šäº†ç›¸å…³çš„ç–‘é—®ã€‚å¸Œæœ›å¯¹å›¾ç‰‡ç¼–è§£ç æ–¹å‘æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å¤šå¤šå­¦ä¹ äº¤æµã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ä¸»æµå›¾ç‰‡åŠ è½½åº“æ‰€ä½¿ç”¨çš„é¢„è§£ç ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#ä¸»æµå›¾ç‰‡åŠ è½½åº“æ‰€ä½¿ç”¨çš„é¢„è§£ç ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;ä¸»æµå›¾ç‰‡åŠ è½½åº“æ‰€ä½¿ç”¨çš„é¢„è§£ç ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;ä¸»æµå›¾ç‰‡åŠ è½½åº“æ‰€ä½¿ç”¨çš„é¢„è§£ç ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆ&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å¾ˆå¤šå›¾ç‰‡åº“ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼å«åšForce-Decodeï¼ŒDecode For Displayä¹‹ç±»çš„æ„Ÿå¿µï¼Œå¾ˆå¤šäººå¯èƒ½å¯¹è¿™ä¸ªè¿‡ç¨‹åˆ°åº•æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ä¸æ¸…æ¥šï¼Œè¿™é‡Œå†™ä¸€ä¸ªæ–‡ç« æ¥è¯´æ˜å®ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™é‡Œåˆ—ä¸¾äº†å„ä¸ªå›¾ç‰‡åº“å„è‡ªçš„è¯´æ³•ï¼Œå…¶å®è®²çš„éƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ä¸€ä¸ªæ¦‚å¿µã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/SDWebImage/SDWebImage/&quot;&gt;SDWebImage&lt;/a&gt;ï¼šä½¿ç”¨äº†&lt;code&gt;forceDecode&lt;/code&gt;, &lt;code&gt;decompressImages&lt;/code&gt;çš„æ¦‚å¿µ&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ibireme/YYWebImage&quot;&gt;YYWebImage&lt;/a&gt;ï¼šä½¿ç”¨äº†&lt;code&gt;decodeForDisplay&lt;/code&gt;çš„æ¦‚å¿µ&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/onevcat/Kingfisher&quot;&gt;Kingfisher&lt;/a&gt;ï¼šä½¿ç”¨äº†&lt;code&gt;backgroundDecode&lt;/code&gt;çš„æ¦‚å¿µ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¿‡ç¨‹ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¿‡ç¨‹ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¿‡ç¨‹ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¿‡ç¨‹ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜&lt;/h1&gt;&lt;p&gt;ä¸ºäº†è§£é‡Šè¿™ä¸ªè¿‡ç¨‹å…·ä½“çš„è§£å†³é—®é¢˜ï¼Œéœ€è¦è‡³å°‘äº†è§£è‹¹æœçš„ç³»ç»Ÿè§£ç å™¨çš„å·¥ä½œæµç¨‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="Image" scheme="http://dreampiggy.com/tags/Image/"/>
    
  </entry>
  
  <entry>
    <title>CocoaPodsçš„èµ„æºç®¡ç†å’ŒAsset Catalogä¼˜åŒ–</title>
    <link href="http://dreampiggy.com/2018/11/26/CocoaPods%E7%9A%84%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8CAsset%20Catalog%E4%BC%98%E5%8C%96/"/>
    <id>http://dreampiggy.com/2018/11/26/CocoaPods%E7%9A%84%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8CAsset%20Catalog%E4%BC%98%E5%8C%96/</id>
    <published>2018-11-26T17:54:17.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å…³äºCocoaPodsçš„èµ„æºç®¡ç†è¡Œä¸ºï¼Œå¯¹äºPodåº“ä½œè€…æ˜¯å¿…é¡»äº†è§£çš„çŸ¥è¯†ã€‚åŒæ—¶ä»‹ç»äº†CocoaPodsä½¿ç”¨Asset Catalogçš„æ³¨æ„äº‹é¡¹ã€‚å¦‚æœå·²ç»äº†è§£æŸæ–¹é¢çŸ¥è¯†ï¼Œå¯ä»¥å¤§è‡´ç•¥è¿‡ç›´æ¥çœ‹ç»“è®ºã€‚</p></blockquote><h2 id="Asset-Catalogå’ŒApp-Thinning"><a href="#Asset-Catalogå’ŒApp-Thinning" class="headerlink" title="Asset Catalogå’ŒApp Thinning"></a>Asset Catalogå’ŒApp Thinning</h2><p>Asset Catalogï¼Œæ˜¯Xcodeæä¾›çš„ä¸€é¡¹å›¾ç‰‡èµ„æºç®¡ç†æ–¹å¼ã€‚æ¯ä¸ªAssetè¡¨ç¤ºä¸€ä¸ªå›¾ç‰‡èµ„æºï¼Œä½†æ˜¯å¯ä»¥å¯¹åº”ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®é™…PNGå›¾ï¼Œæ¯”å¦‚å¯ä»¥æä¾›<code>@1x</code>, <code>@2x</code>, <code>@3x</code>å¤šå¼ å°ºå¯¸çš„å›¾ä»¥é€‚é…ï¼›åœ¨macOSä¸Šï¼Œè¿˜å¯ä»¥é€šè¿‡æŒ‡å®šæ—¥é—´å’Œå¤œé—´ä¸åŒAppearancesçš„ä¸¤å¥—å›¾ç‰‡ã€‚</p><p>è¿™ç§èµ„æºï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šè¢«å‹ç¼©ï¼Œç„¶ååœ¨Appè¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡APIåŠ¨æ€æ ¹æ®è®¾å¤‡scale factorï¼ˆMacä¸Šæ—¥å¤œé—´è®¾ç½®ï¼‰æ¥é€‰æ‹©å¯¹åº”çš„çœŸå®çš„å›¾ç‰‡æ¸²æŸ“ã€‚</p><p><a href="https://help.apple.com/xcode/mac/current/#/devbbdc5ce4f">App Thinning</a>ï¼Œæ˜¯è‹¹æœå¹³å°ï¼ˆiOS/tvOS/watchOSï¼‰ä¸Šçš„ä¸€ä¸ªç”¨äºä¼˜åŒ–AppåŒ…ä¸‹è½½èµ„æºå¤§å°çš„æ–¹æ¡ˆã€‚åœ¨AppåŒ…æäº¤ä¸Šä¼ åˆ°App Storeåï¼Œè‹¹æœåå°æœåŠ¡å™¨ï¼Œä¼šå¯¹ä¸åŒçš„è®¾å¤‡ï¼Œæ ¹æ®è®¾å¤‡çš„scale factorï¼Œé‡æ–°æŠŠAppåŒ…è¿›è¡Œç²¾ç®€ï¼Œè¿™æ ·ä¸åŒè®¾å¤‡ä»App Storeä¸‹è½½éœ€è¦çš„å®¹é‡ä¸åŒï¼Œ3xè®¾å¤‡ä¸éœ€è¦åŒæ—¶ä¸‹è½½1xå’Œ2xçš„å›¾ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™å¥—æœºåˆ¶ç›´æ¥åŸºäºAsset Catalogï¼Œæ¢è¨€ä¹‹ï¼Œåªæœ‰åœ¨Asset Catalogä¸­å¼•å…¥çš„å›¾ç‰‡ï¼Œæ‰å¯ä»¥åˆ©ç”¨è¿™å¥—App Thinningã€‚ç›´æ¥æ‹·è´åˆ°App Bundleä¸­çš„æ•£è½å›¾ç‰‡ï¼Œæ‰€æœ‰è®¾å¤‡è¿˜æ˜¯éƒ½ä¼šå…¨éƒ¨ä¸‹è½½ã€‚å› æ­¤å¦‚ä½•å°½é‡æå‡Asset Catalogåˆ©ç”¨ç‡ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„åŒ…å¤§å°ä¼˜åŒ–ç‚¹ã€‚</p><h2 id="CocoaPodsçš„èµ„æºç®¡ç†"><a href="#CocoaPodsçš„èµ„æºç®¡ç†" class="headerlink" title="CocoaPodsçš„èµ„æºç®¡ç†"></a>CocoaPodsçš„èµ„æºç®¡ç†</h2><p>CocoaPodsæ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·ï¼Œå®ƒå®Œå…¨åŸºäºPodsçš„specæ–‡ä»¶è§„åˆ™ï¼Œåœ¨Podfileå¼•å…¥åï¼Œç”Ÿæˆå¯¹åº”æ„å»ºXcode Targetã€‚ä¹Ÿå°±æ˜¯å®ƒæ˜¯ä¸€ä¸ªå£°æ˜å¼æ„å»ºå·¥å…·ï¼ˆåŒºåˆ«äºMakefileè¿™ç§è¿‡ç¨‹å¼çš„æ„å»ºå·¥å…·ï¼‰ã€‚å¯¹äºèµ„æºçš„ç®¡ç†ï¼Œç›®å‰æœ‰ä¸¤ä¸ªæ–¹å¼è¿›è¡Œå£°æ˜å¹¶å¼•å…¥ï¼Œå³<code>resources</code>å’Œ<code>resource_bundles</code>ï¼Œå‚è€ƒ<a href="https://guides.cocoapods.org/syntax/podspec.html">podspec syntax</a></p><p>è™½ç„¶Podspecä¸­åŒ…å«æ‰€æœ‰å¾…æ„å»ºåº“çš„å£°æ˜ï¼Œä½†äºCocoaPodsä¹Ÿä¼šæ ¹æ®Podfileçš„é…ç½®ï¼ŒåŠ¨æ€è°ƒæ•´æœ€ç»ˆçš„Xcodeå·¥ç¨‹çš„é…ç½®ï¼Œæ ¹æ®æ˜¯å¦å¼€å¯<code>use_framework!</code>ï¼Œä»¥ä¸‹çš„èµ„æºå£°æ˜æœ€ç»ˆçš„è¡Œä¸ºæœ‰æ‰€ä¸åŒï¼Œè¿™é‡Œåˆ†å¼€ä»‹ç»ã€‚</p><h3 id="ä¸ä½¿ç”¨use-framework"><a href="#ä¸ä½¿ç”¨use-framework" class="headerlink" title="ä¸ä½¿ç”¨use_framework!"></a>ä¸ä½¿ç”¨use_framework!</h3><p>å½“ä¸ä½¿ç”¨use_framework!æ—¶ï¼Œæœ€ç»ˆå¯¹Podåº“ï¼Œä¼šåˆ›å»ºå•ç‹¬çš„é™æ€é“¾æ¥åº“<code>.a</code>çš„Targetï¼Œç„¶åCocoaPodsä¼šå¯¹ä¸»å·¥ç¨‹App Targetå¢åŠ è‡ªå·±å†™çš„è„šæœ¬æ¥å¸®åŠ©æˆ‘ä»¬æ‹·è´Podçš„èµ„æºã€‚</p><ul><li><code>resources</code>å­—æ®µ</li></ul><p>å¯¹åº”å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢å¯ä»¥ä½¿ç”¨ç±»ä¼¼<code>A/*.png</code>é€šé…ç¬¦åŒ¹é…ã€‚æ‰€æœ‰åŒ¹é…åˆ°çš„èµ„æºï¼Œå¦‚å›¾ç‰‡ã€‚</p><p>åœ¨<code>pod install</code>å®Œæˆåï¼ŒCocoaPodsä¼šæ’å…¥ä¸€ä¸ªç”Ÿæˆçš„è„šæœ¬[CP] Copy Bundle Resourceï¼ˆæ³¨æ„ï¼Œè¿™å¹¶éXcodeæœ¬èº«æ„å»ºè¿‡ç¨‹ï¼‰ï¼Œæ‹·è´åˆ°ç¼–è¯‘å®Œæˆåçš„App Main Bundleçš„æ ¹è·¯å¾„ä¸‹ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåŒ¹é…åˆ°äº†ä¸€ä¸ª<code>A/1.png</code>å’Œ<code>A/2.plist</code>ï¼Œè¿™ä¸ª<code>1.png</code>å’Œ<code>2.plist</code>ï¼Œæœ€ç»ˆä¼šå‡ºç°åœ¨ipaåŒ…çš„å±•å¼€æ ¹è·¯å¾„ä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| Info.plist</span><br><span class="line">| 1.png</span><br><span class="line">| 2.plist</span><br><span class="line">| News</span><br><span class="line">| xxx</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ol><li>æœ€ç®€å•æš´åŠ›ï¼Œè€Œä¸”ç”±äºå›ºå®šäº†èµ„æºçš„è·¯å¾„åœ¨æ ¹è·¯å¾„ä¸Šï¼Œå¦‚æœå…ˆå‰åœ¨ä¸»å·¥ç¨‹ç›®å½•ä¸­ä½¿ç”¨çš„ä»£ç ï¼Œä¸éœ€è¦æ›´æ”¹ä¸€è¡Œå³å¯ç»§ç»­ä½¿ç”¨ï¼ˆåŸå› æ˜¯ä¸»å·¥ç¨‹çš„ä½ æ‹–ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶å¤¹ï¼ŒXcodeçš„æ„å»ºè¿‡ç¨‹é»˜è®¤å°±æ˜¯æŠŠèµ„æºæ”¾åˆ°App Main Bundleçš„æ ¹è·¯å¾„ä¸Šçš„ï¼‰ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>ä¸¥é‡çš„å‘½åå†²çªé—®é¢˜ï¼Œç”±äºé€šé…ç¬¦ä¼šæ‹·è´æ‰€æœ‰æ–‡ä»¶åˆ°æ ¹è·¯å¾„ï¼Œå› æ­¤å¦‚æœå‡ºç°å¦‚ä¸‹ <code>A/1.png, B/1.png</code>ä¸¤ä¸ªæ–‡ä»¶åŒæ—¶åŒ¹é…ï¼ˆBæ˜¯å¦ä¸€ä¸ªåº“çš„æ–‡ä»¶å¤¹ï¼‰ï¼Œå°†ä¼šå‡ºç°å†²çªï¼ŒCocoaPodsé‡‡å–çš„æ–¹å¼æ˜¯æš´åŠ›åˆå¹¶ï¼Œä¼šæœ‰ä¸€ä¸ªè¢«æ›¿æ¢æ‰ã€‚å› æ­¤ï¼Œè¿™è¦æ±‚æ‰€æœ‰èµ„æºæ–‡ä»¶å‘½åæœ¬èº«ï¼ŒåŠ å…¥ç‰¹å®šçš„å‰ç¼€ä»¥é¿å…å†²çªã€‚ç±»ä¼¼çš„ä¸æ­¢æ˜¯å›¾ç‰‡ï¼Œæ‰€æœ‰èµ„æºå¦‚<code>bundle</code>, <code>js</code>, <code>css</code>éƒ½å¯èƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œéš¾ä»¥æ’æŸ¥ã€‚è€Œä¸”ç”±äºè¿™ç§æ‹·è´åˆ°æ ¹è·¯å¾„çš„æœºåˆ¶ï¼Œè¿™ä¸ªé—®é¢˜ä¸å¯ä»æ ¹æºé¿å…ã€‚</li><li>æ— æ³•äº«ç”¨ä»»ä½•Xcodeçš„ä¼˜åŒ–ï¼ŒXcodeå¯¹äºæ‰€æœ‰å†…å»ºçš„Copy Bundle Resourceä¸­æ·»åŠ çš„PNG/JPEGå›¾ç‰‡ï¼Œä¼šè¿›è¡Œä¸€æ¬¡å‹ç¼©å‡å°‘å¤§å°ï¼ˆæ³¨æ„ï¼Œè¿™å’ŒApp Thinningä¸ä¸€æ ·ï¼‰ã€‚è€ŒCocoaPodsè¿™ç§ä½¿ç”¨è‡ªå·±çš„Shellè„šæœ¬æš´åŠ›æ‹·è´ï¼Œæºæ–‡ä»¶å’ŒBundleçš„æ–‡ä»¶æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</li></ol><ul><li><code>resource_bundles</code>å­—æ®µ</li></ul><p>å¯¹åº”å‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé‡Œé¢çš„Keyè¡¨ç¤ºä½ æ‰€å¸Œæœ›çš„ä¸€ç»„èµ„æºçš„èµ„æºåï¼Œå¸¸è§å€¼æ˜¯<code>åº“å+Resource</code>ï¼ŒValueæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢å’Œ<code>resources</code>ä¸€æ ·å…è®¸é€šé…ç¬¦åŒ¹é…èµ„æºã€‚</p><p>å½“<code>pod install</code>å®Œæˆåï¼ŒCocoaPodsä¼šå¯¹æ‰€æœ‰çš„Podsä¸­å£°æ˜äº†<code>resource_bundles</code>èµ„æºï¼Œä»¥Keyä¸ºåç§°å»ºç«‹ä¸€ä¸ªå•ç‹¬çš„Bundle Targetï¼Œç„¶åæ ¹æ®ValueåŒ¹é…çš„å€¼ï¼ŒæŠŠè¿™äº›å›¾ç‰‡èµ„æºå…¨éƒ¨åŠ åˆ°è¿™ä¸ªTargetçš„Xcodeå†…å»ºCopy Bundle Resourceè¿‡ç¨‹ä¸­ã€‚ç„¶åé€šè¿‡ä¸€ä¸ªShellè„šæœ¬æ·»åŠ åˆ°App Main Bundleä¸­ã€‚å‡è®¾æˆ‘ä»¬è¿™æ ·å†™ <code>&#39;DemoLibResource&#39; =&gt; [A/1.png, &#39;A/2.plist&#39;]</code>åŒ¹é…åˆ°äº†ä¸€ä¸ª<code>1.png</code>å’Œ<code>2.plist</code>ï¼Œä¼šæ˜¯ä»¥è¿™ä¸ªTargetå»ºç«‹ä¸€ä¸ªBundleçˆ¶æ–‡ä»¶å¤¹ã€‚ç„¶åè¿™äº›Bundleçˆ¶æ–‡ä»¶å¤¹ï¼Œæ‹·è´åˆ°App Main Bundleæ ¹è·¯å¾„ä¸‹ï¼Œæœ€åå¾—åˆ°è¿™æ ·ä¸€ä¸ªipaç»“æ„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">| Info.plist</span><br><span class="line">| DemoLibResource.bundle</span><br><span class="line">|- 1.png</span><br><span class="line">|- 2.plist</span><br><span class="line">| News</span><br><span class="line">| xxx</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ol><li>è§£å†³äº†å‘½åå†²çªé—®é¢˜ï¼Œç”±äºä½¿ç”¨äº†ä¸€çº§çš„Keyå€¼ï¼Œä½œä¸ºä¸€ä¸ªå•ç‹¬çš„çˆ¶æ–‡ä»¶å¤¹éš”ç¦»ï¼Œä¸åŒçš„Podsåº“ä¸å¤ªå¯èƒ½å‡ºç°å‘½åå†²çªï¼ˆéµå®ˆ<code>åº“å+Resource</code>ï¼Œåˆ™åº“ä¹‹é—´ä¸ä¼šä¸å‡ºç°åŒæ ·çš„Keyå€¼ï¼‰ã€‚</li><li>èƒ½åˆ©ç”¨Xcodeæœ¬èº«çš„ä¼˜åŒ–è¿‡ç¨‹ï¼Œç”±äºå•ç‹¬æ„å»ºäº†ä¸€ä¸ªTargetï¼Œä½¿ç”¨XcodeåŸç”Ÿçš„Copy Bundle Resourceè¿‡ç¨‹ï¼ŒPNGå›¾ç‰‡ç­‰ä¼šè‡ªåŠ¨äº«å—å‹ç¼©</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>ç”±äºæœ€ç»ˆèµ„æºäº§ç‰©å¢åŠ äº†ä¸€çº§Resource Keyçš„çˆ¶æ–‡ä»¶å¤¹ï¼Œå¦‚æœæœ‰å…ˆå‰ä¾èµ–Main Bundleè·¯å¾„ä½ç½®çš„åŠ è½½ä»£ç ï¼Œéœ€è¦è¿›è¡Œæ›´æ–°ã€‚å…¸å‹çš„ç”¨æ³•å¦‚<code>NSBundle.mainBundle pathForResource:ofType:</code>å–æœ¬åœ°Bundleä¸­ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œè¿™æ—¶å€™éœ€è¦æ›´æ–°ä¸º<code>[NSBundle bundleWithPath:] pathForResource:ofType:</code>çš„ä»£ç è°ƒç”¨ã€‚å¯¹äº<code>UIImage imageNamed:</code>æ–¹æ³•ï¼Œå®ƒä¹Ÿæ”¯æŒBundleï¼Œçœ‹æƒ…å†µéœ€è¦æ›´æ–°ã€‚</li></ol><p>ä¸¾ä¾‹å­è¯´æ˜ï¼ŒåŸæ¥ä½¿ç”¨æ–¹å¼ä¸º:</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›´æ¥è®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="built_in">NSString</span> *plistPath = [<span class="built_in">NSBundle</span>.mainBundle pathForResource:<span class="string">@&quot;test&quot;</span> ofType:<span class="string">@&quot;plist&quot;</span>];</span><br><span class="line"><span class="comment">// è·å–Bundleä¸­çš„UIImageï¼Œåªæ˜¯ç¤ºä¾‹ï¼Œæ¨èä½¿ç”¨Asset Catalogæ›¿ä»£è¿™ç§è£¸çš„å›¾ç‰‡å¼•ç”¨</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@&quot;1&quot;</span>];</span><br></pre></td></tr></table></figure><p>ç°åœ¨éœ€è¦æ›´æ–°ä¸ºï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·¯å¾„å˜åŒ–ï¼Œè¿™æ­¥éª¤å¯ä»¥å°è£…åº“çº§åˆ«çš„å·¥å…·æ–¹æ³•ï¼Œæˆ–è€…å®ï¼ŒStaticå¯¹è±¡ï¼Œéƒ½è¡Œ</span></span><br><span class="line"><span class="comment">// ç”±äºé‡‡å–äº†Static Libraryè€Œæ²¡æœ‰ä½¿ç”¨use_framework!ï¼Œå› æ­¤æ­¤æ—¶[NSBundle bundleForClass:]å’ŒmainBundleæ˜¯ç›¸åŒçš„ï¼ŒåŸå› æ˜¯ç±»å…¶å®åœ¨mainBundleçš„äºŒè¿›åˆ¶ä¸­ï¼Œè€Œä¸æ˜¯Frameworkä¸­ã€‚ä½†æ˜¯ä¸ºäº†ä»£ç ç»Ÿä¸€ï¼Œå»ºè®®éƒ½ä½¿ç”¨bundleForClass:ï¼ˆåé¢è®²ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSString *bundlePath = [NSBundle.mainBundle.resourcePath stringByAppendingPathComponent:@&quot;DemoLibResource.bunbdle&quot;]; // è™½ç„¶ä¹Ÿèƒ½Workï¼Œä¸ºäº†ç»Ÿä¸€ä»£ç ï¼ˆå¼€å¯use_framework!ï¼‰ç”¨ä¸‹é¢çš„æ›´å¥½</span></span><br><span class="line"><span class="built_in">NSString</span> *bundlePath = [[<span class="built_in">NSBundle</span> bundleForClass:DemoLib.class].resourcePath stringByAppendingPathComponent:<span class="string">@&quot;DemoLibResource.bunbdle&quot;</span>];</span><br><span class="line"><span class="built_in">NSBundle</span> *bundle = [<span class="built_in">NSBundle</span> bundleWithPath:bundlePath];</span><br><span class="line"><span class="comment">// ç›´æ¥è®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="built_in">NSString</span> *plistPath = [bundle pathForResource:<span class="string">@&quot;test&quot;</span> ofType:<span class="string">@&quot;plist&quot;</span>];</span><br><span class="line"><span class="comment">// è·å–Bundleä¸­çš„UIImageï¼Œåªæ˜¯ç¤ºä¾‹ï¼Œæ¨èä½¿ç”¨Asset Catalogæ›¿ä»£è¿™ç§è£¸çš„å›¾ç‰‡å¼•ç”¨</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@&quot;1&quot;</span> inBundle:bundle compatibleWithTraitCollection:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure><p>æ€»ä½“æ¥è¯´ï¼Œç»“åˆä¼˜ç¼ºç‚¹ï¼Œå¤§éƒ¨åˆ†çš„ç»„ä»¶åº“ï¼Œå¯¹äºé€šç”¨èµ„æºçš„å¼•ç”¨ï¼Œåº”å½“é¿å…ä½¿ç”¨<code>resources</code>ï¼Œè€Œè½¬ä¸ºä½¿ç”¨<code>resource_bundles</code>å£°æ˜ã€‚èƒ½å¤Ÿä»æºå¤´ä¸Šé¿å…å†²çªã€‚æ”¹åŠ¨æˆæœ¬ä¹Ÿä¸ç®—å¤§ï¼Œå°è£…ä¸ªåº“å†…éƒ¨çš„å·¥å…·æ–¹æ³•/å®æ›¿æ¢ä¸‹å³å¯ã€‚</p><p>Tipsï¼šå¦‚æœåœ¨ä½¿ç”¨<code>resource_bundles</code>çš„æƒ…å†µä¸‹ï¼Œæˆ‘è¿˜æƒ³é¿å…Xcodeçš„å›¾ç‰‡ä¼˜åŒ–ç­–ç•¥ï¼ˆå¦‚æ— æŸçš„å›¾ç‰‡ç­‰ï¼‰ï¼Œè¿™æ—¶å€™å¯ä»¥é‡‡å–å°†å›¾ç‰‡æ”¾å…¥ä¸€ä¸ªè‡ªå·±å»ºç«‹çš„Bundleæ–‡ä»¶å¤¹ä¸­ï¼Œç„¶å<code>resource_bundles</code>å¼•å…¥è¿™ä¸ªBundleæœ¬èº«ï¼Œæ³¨æ„è·¯å¾„éœ€è¦å†åŠ ä¸€å±‚ã€‚</p><h2 id="ä½¿ç”¨use-framework"><a href="#ä½¿ç”¨use-framework" class="headerlink" title="ä½¿ç”¨use_framework!"></a>ä½¿ç”¨use_framework!</h2><p>å½“ä½¿ç”¨äº†use_framework!ä¹‹åï¼ŒCocoaPodsä¼šå¯¹æ¯ä¸ªPodå•ç‹¬å»ºç«‹ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“çš„Targetï¼Œæ¯ä¸ªPodæœ€åä¼šç›´æ¥ä»¥Frameworké›†æˆåˆ°Appä¸­ã€‚è€Œèµ„æºæ–¹é¢ï¼Œç”±äºFrameworkæœ¬èº«å°±èƒ½æ‰¿è½½èµ„æºï¼Œæ‰€æœ‰çš„èµ„æºéƒ½ä¼šè¢«æ‹·è´åˆ°Frameworkæ–‡ä»¶å¤¹ä¸­è€Œä¸å†ä½¿ç”¨å•ç‹¬çš„è„šæœ¬å¤„ç†ã€‚</p><ul><li><code>resources</code></li></ul><p>åœ¨ä½¿ç”¨<code>resources</code>å£°æ˜æ—¶ï¼ŒåŒä¸ä½¿ç”¨use_framework!ç›¸æ¯”ï¼Œæ”¹åŠ¨çš„ç‚¹åœ¨äºè¿™äº›Podåº“èµ„æºçš„è·¯å¾„ã€‚æ­¤æ—¶ï¼Œè¿™äº›Podåº“èµ„æºä¼šè¢«æ‹·è´åˆ°Podåº“è‡ªå·±çš„Fraemworkæ ¹è·¯å¾„ä¸‹ï¼Œè€Œä¸åœ¨App Main Bundleçš„æ ¹è·¯å¾„ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">| Info.plist</span><br><span class="line">| Frameworks</span><br><span class="line">|- DemoLib.framework</span><br><span class="line">|-- 1.png</span><br><span class="line">|-- 2.plist</span><br><span class="line">| News</span><br><span class="line">| xxx</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ol><li>è™½ç„¶åœ¨ä¸ä½¿ç”¨use_framework!çš„æƒ…å†µä¸‹ï¼Œè¿™ç§å£°æ˜ä¼šé€ æˆå‘½åå†²çªã€‚ä½†æ˜¯åœ¨ä½¿ç”¨use_framework!çš„æƒ…å†µä¸‹ï¼Œç”±äºèµ„æºæœ¬èº«è¢«æ‹·è´åˆ°Frameworkä¸­ï¼Œå·²ç»èƒ½æœ€å¤§ç¨‹åº¦å‡å°‘å†²çªï¼Œå› æ­¤è¿™æ—¶å€™ä¸€èˆ¬ä¸éœ€è¦è€ƒè™‘åç§°å†²çªé—®é¢˜</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>åœ¨use_framework!çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿä¿è¯ä»£ç ä¸€è¡Œä¸æ”¹ï¼Œä½†æ˜¯ä½¿ç”¨use_framework!åå°±ä¸è¡Œäº†ã€‚åŸå› åœ¨äºæ­¤æ—¶Bundleèµ„æºè·¯å¾„å·²ç»å‘ç”Ÿå˜åŒ–ï¼Œåˆ°Frameworkè‡ªèº«çš„æ–‡ä»¶å¤¹ä¸­è€Œä¸æ˜¯App Main Bundleä¸­ï¼Œéœ€è¦è¿›è¡Œæ›´æ–°ã€‚è¿™ä¸ªæ›´æ–°çš„è·¯å¾„å’Œ<code>resource_bundles</code>ä¸åŒï¼Œä¸éœ€è¦é¢å¤–æ‹¼æ¥ä¸€å±‚Keyå€¼çš„åç§°ã€‚ç›´æ¥ä½¿ç”¨bundleForClasså³å¯ï¼Œæ¯”è¾ƒç®€å•</li></ol><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨bundleforClassæ›¿ä»£mainBundleå³å¯</span></span><br><span class="line"><span class="built_in">NSBundle</span> *bundle = [<span class="built_in">NSBundle</span> bundleForClass:DemoLib.class];</span><br><span class="line"><span class="comment">// ç›´æ¥è®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="built_in">NSString</span> *plistPath = [bundle pathForResource:<span class="string">@&quot;test&quot;</span> ofType:<span class="string">@&quot;plist&quot;</span>];</span><br><span class="line"><span class="comment">// è·å–Bundleä¸­çš„UIImageï¼Œåªæ˜¯ç¤ºä¾‹ï¼Œæ¨èä½¿ç”¨Asset Catalogæ›¿ä»£è¿™ç§è£¸çš„å›¾ç‰‡å¼•ç”¨</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@&quot;1&quot;</span> inBundle:bundle compatibleWithTraitCollection:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure><ul><li><code>resource_bundles</code></li></ul><p>åœ¨ä½¿ç”¨<code>resource_bundles</code>å£°æ˜æ—¶ï¼ŒåŒä¸ä½¿ç”¨use_framework!ç›¸æ¯”ï¼Œæ”¹åŠ¨çš„ç‚¹åœ¨äºå¯¹åº”è¿™äº›Keyç”Ÿæˆçš„Bundleçš„ä½ç½®ã€‚æ­¤æ—¶ï¼Œè¿™äº›ç”Ÿæˆçš„Bundleçˆ¶æ–‡ä»¶å¤¹ï¼Œä¼šæ”¾å…¥Podåº“è‡ªå·±çš„Frameworkçš„æ ¹è·¯å¾„ä¸‹ã€‚è€Œæ¯ä¸ªPodåº“Frameworkæœ¬èº«ï¼Œåœ¨App Main Bundleçš„<code>Frameworks</code>æ–‡ä»¶å¤¹ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">| Info.plist</span><br><span class="line">| Frameworks</span><br><span class="line">|- DemoLib.framework</span><br><span class="line">|-- DemoLibResource.bundle</span><br><span class="line">|--- 1.png</span><br><span class="line">|--- 2.plist</span><br><span class="line">| News</span><br><span class="line">| xxx</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼šåŒä¸Š<br>ç¼ºç‚¹ï¼šåŒä¸Šã€‚ä½†æœ‰ç‚¹åŒºåˆ«ï¼Œåœ¨äºBundleçš„è·¯å¾„å˜åŒ–ã€‚æ­¤æ—¶ï¼Œ<code>NSBundle bundleForClass:</code>ä¸å†ç­‰ä»·äºmainBundleäº†ï¼Œå› æ­¤å¯¹åº”ä»£ç æ›´æ–°ç¤ºä¾‹é‡Œé¢ï¼Œä¸€å®šä¸èƒ½ç”¨mainBundleè€Œè¦ç”¨bundleForClassæ›¿ä»£ã€‚ä¼ å…¥çš„Classæ˜¯å“ªä¸€ä¸ªPodåº“çš„Classï¼Œå°±ä¼šå–åˆ°å¯¹åº”Podåº“Frameworké‡Œé¢çš„Bundleæ–‡ä»¶å¤¹ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†æŠ„ä¸€éï¼Œå®³æ€•å¿˜è®°äº†ï¼Œæ­¤æ—¶ä¸èƒ½ç”¨mainBundleçš„resourcePathå»æ‹¼æ¥</span></span><br><span class="line"><span class="built_in">NSString</span> *bundlePath = [[<span class="built_in">NSBundle</span> bundleForClass:DemoLib.class].resourcePath stringByAppendingPathComponent:<span class="string">@&quot;DemoLibResource.bunbdle&quot;</span>];</span><br><span class="line"><span class="built_in">NSBundle</span> *bundle = [<span class="built_in">NSBundle</span> bundleWithPath:bundlePath];</span><br></pre></td></tr></table></figure><h2 id="CocoaPodsä¸Asset-Catalogå›¾ç‰‡èµ„æº"><a href="#CocoaPodsä¸Asset-Catalogå›¾ç‰‡èµ„æº" class="headerlink" title="CocoaPodsä¸Asset Catalogå›¾ç‰‡èµ„æº"></a>CocoaPodsä¸Asset Catalogå›¾ç‰‡èµ„æº</h2><p>å‰é¢èŠ±äº†å¤§ç¯‡ç« è¯´äº†å…³äºCocoaPodså¤„ç†é€šç”¨çš„èµ„æºå¼•ç”¨çš„æ–¹å¼ï¼Œæ˜¯ä¸ºäº†ä¸šåŠ¡åº“ä½œè€…èƒ½æœ‰æ¸…æ™°è®¤è¯†åˆ°ï¼Œåœ¨ä»ä¸»å·¥ç¨‹æ²‰åº“ä»£ç åï¼Œéœ€è¦æ€ä¹ˆæ ·æ›´æ”¹æ¥å¤„ç†èµ„æºã€‚</p><p>ç°åœ¨å›åˆ°æ­£é¢˜è¯´ä¸€ä¸‹Podåº“ä¸­çš„Assets Catalogéœ€è¦æ€ä¹ˆæ ·å¤„ç†ä»¥åˆ©ç”¨App Thinningã€‚Assets Catalogçš„å¥½å¤„éƒ½æœ‰å•¥å·²ç»è¯´è¿‡äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°½é‡ä¿è¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼˜å…ˆä½¿ç”¨Assets Catalogè€Œéå°†å›¾ç‰‡æ‹·è´è‡³App Bunldeä¸­ï¼ˆè™½ç„¶Xcodeä¼šå‹ç¼©ä¼˜åŒ–ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æ— è®ºå¦‚ä½•éƒ½æ— æ³•åˆ©ç”¨App Thinningï¼‰ã€‚</p><p>Assets Catalogæœ¬èº«çš„æ–‡ä»¶å¤¹<code>xcassets</code>ä¸€å®šä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆçš„AppåŒ…ä¸­ï¼Œå®ƒåœ¨ç¼–è¯‘æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªäºŒè¿›åˆ¶äº§ç‰©<code>Assets.car</code>ï¼Œè€Œè¿™ä¸ªäºŒè¿›åˆ¶ç›®å‰åªèƒ½ç”±UIKitçš„æ–¹æ³•ï¼Œå»è¯»å–äº§ç”Ÿä¸€ä¸ªUIImageå†…å­˜å¯¹è±¡ï¼Œå…¶ä»–ä»£ç æ— æ³•ç›´æ¥è®¿é—®åŸå§‹çš„å›¾ç‰‡æ–‡ä»¶è·¯å¾„å’ŒImageDataã€‚åŒæ—¶ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼Œ<a href="https://developer.apple.com/documentation/uikit/uiimage/1624154-imagenamed?language=objc">UIImage imageNamed:inBundle:compatibleWithTraitCollection:</a> å®é™…ä¸Šï¼Œä¼šä¼˜å…ˆå»æŸ¥æ‰¾æŒ‡å®šBundleï¼ˆ<code>UIImage imageNamed:</code>å³ä¸ºmainBundleï¼‰çš„è·¯å¾„ä¸‹çš„<code>Assets.car</code>æ–‡ä»¶å¹¶å±•å¼€ï¼Œç„¶åæ‰¾ä¸åˆ°å†å»å¯»æ‰¾Bundleè·¯å¾„ä¸‹åŒåçš„å›¾ç‰‡æ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œä»APIä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªå›¾ç‰‡å…·ä½“æ˜¯åœ¨æ•£è½åœ¨Bundleæ ¹è·¯å¾„ä¸‹ï¼Œè¿˜æ˜¯åœ¨è¢«ç¼–è¯‘åˆ°Bundleè·¯å¾„ä¸‹çš„<code>Assets.car</code>ä¸­ï¼Œä»£ç åº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚</p><p>å€¼å¾—è¯´æ˜çš„æ˜¯ï¼ŒCocoaPodsä¸ä¼šè‡ªåŠ¨æ ¹æ®ä½ åœ¨Specä¸­çš„å£°æ˜ï¼Œåˆ›å»ºAsset Catalogï¼Œä½ å¿…é¡»é€šè¿‡Xcodeæ‰‹åŠ¨åˆ›å»ºï¼Œæ·»åŠ ï¼Œç„¶ååœ¨Specä¸­å¼•å…¥å®ƒã€‚ç±»ä¼¼è¿™æ ·ã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spec.resources = [<span class="string">&#x27;A/DemoLib.xcassets&#x27;</span>]</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™äº›çŸ¥è¯†ï¼Œæˆ‘ä»¬å°±ç»“åˆå‰é¢çš„CocoaPodsèµ„æºå¤„ç†ç­–ç•¥ï¼Œä»¥åŠUIKitçš„è¡Œä¸ºï¼Œå†æ¥å›é¡¾ä¸Šè¿°è¿™äº›å£°æ˜çš„è¡Œä¸ºï¼Œä»¥åŠæˆ‘ä»¬åº”è¯¥æ€ä¹ˆæ ·ä»ä»£ç ä¸Šå»ä½¿ç”¨ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ç»Ÿä¸€éƒ½ä»¥ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ä¸¾ä¾‹å­ï¼Œå‡è®¾è¿™ä¸ªAsset Catalogä¸­å«æœ‰<code>1.png</code>, <code>1@2x.png</code>, <code>1@3x.png</code>.</p><h3 id="ä¸ä½¿ç”¨use-framework-1"><a href="#ä¸ä½¿ç”¨use-framework-1" class="headerlink" title="ä¸ä½¿ç”¨use_framework!"></a>ä¸ä½¿ç”¨use_framework!</h3><ul><li><code>resources</code></li></ul><p>ä¸åŒäºæ™®é€šèµ„æºé‚£ç§æš´åŠ›æ‹·è´çš„æ–¹å¼ï¼ŒCocoaPodsè¿™ä¸‹æ²¡æ³•æš´åŠ›æ‹·è´è¿™ä¸ªç¼–è¯‘äº§ç‰©çš„<code>Assets.car</code>åˆ°æ ¹è·¯å¾„äº†ï¼Œå› ä¸ºå®ƒä¼šç›´æ¥è¦†ç›–æ‰Appæœ¬èº«çš„ç¼–è¯‘äº§ç‰©ã€‚æ‰€ä»¥ï¼ŒCocoaPodsé‡‡å–çš„æ–¹æ¡ˆï¼Œæ˜¯åˆå¹¶Asset Catalogã€‚é¦–å…ˆä¼šç¼–è¯‘å¾—åˆ°å·¥ç¨‹Appçš„<code>Assets.car</code>ï¼Œç„¶åé€šè¿‡ä¾¿åˆ©æ‰€æœ‰Podçš„<code>resources</code>å¼•å…¥çš„<code>xcassets</code>ï¼Œä½¿ç”¨atoolå·¥å…·è¿›è¡Œå¤šä¸ªAsset Catalogåˆå¹¶ï¼Œæœ€åè¾“å‡ºåˆ°App Main Bundleæ ¹è·¯å¾„ä¸‹çš„<code>Asset.car</code>é‡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| Info.plist</span><br><span class="line">| Assets.car (ç¼–è¯‘è¿›å»äº†1.pngï¼‰</span><br><span class="line">| News</span><br><span class="line">| xxx</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ol><li>ç»§æ‰¿äº†æ™®é€šèµ„æºçš„å¤„ç†æ–¹å¼ï¼Œç”±äºé‡‡å–äº†Asset Catalogåˆå¹¶ï¼ŒåŸæ¥ä¸»å·¥ç¨‹ä»£ç ä¸éœ€è¦æ›´æ”¹ä¸€è¡Œå¯ç»§ç»­ä½¿ç”¨ã€‚ç›¸å½“äºåº“çš„Assets Catalogèµ„æºç›´æ¥æ·»åŠ åˆ°ä¸»å·¥ç¨‹Assets Catalogä¸­</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>ä¸€è´¯çš„å‘½åå†²çªé—®é¢˜ï¼Œç”±äºAsset Catalogè¿˜ä¼šå’Œä¸»å·¥ç¨‹ä»¥åŠå…¶ä»–Podåº“è¿›è¡Œåˆå¹¶ï¼Œä¸€æ—¦å‡ºç°äº†é‡åçš„èµ„æºï¼Œæœ€ç»ˆç¼–è¯‘äº§ç‰©<code>Assets.car</code>ä¼šæ ¹æ®åˆå¹¶é¡ºåºæ›¿æ¢æ‰ä¹‹å‰çš„ã€‚å› æ­¤è¿˜æ˜¯å¾—æ¯ä¸ªAsset Catalogä¸­èµ„æºåä¹Ÿå¾—æ·»åŠ å‰ç¼€</li></ol><ul><li><code>resource_bundles</code></li></ul><p>ç±»ä¼¼å¯¹äºæ™®é€šèµ„æºçš„å¤„ç†ï¼Œå¦‚æœä½¿ç”¨<code>resource_bundles</code>ï¼Œå¯¹äºæ¯ä¸ªKeyç”Ÿæˆçš„Bundleçˆ¶æ–‡ä»¶å¤¹ï¼Œä¼šæŠŠç”Ÿæˆçš„<code>Assets.car</code>æ‹·è´åˆ°è¿™ä¸ªBundleçˆ¶æ–‡ä»¶å¤¹ä¸­ã€‚å¦‚æœå½“å‰Podåº“å¼•ç”¨äº†å¤šä¸ªxcassetæ–‡ä»¶ï¼Œå¯¹å¼•ç”¨çš„è¿™å‡ ä¸ªåšåˆå¹¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| Info.plist</span><br><span class="line">| DemoLibResource.bundle</span><br><span class="line">|- Assets.carï¼ˆå«æœ‰1.pngï¼‰</span><br><span class="line">| News</span><br><span class="line">| xxx</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼šåŒæ™®é€šèµ„æº<br>ç¼ºç‚¹ï¼šåŒæ™®é€šèµ„æºã€‚ä»£ç ä½¿ç”¨æ–¹é¢ï¼Œç”±äºä¹‹å‰æåˆ°çš„UIImage APIï¼Œå¯¹äºåŒè·¯å¾„ä¸‹çš„<code>Assets.car</code>ç¼–è¯‘äº§ç‰©ï¼Œå’Œæ•£è½çš„æ™®é€šå›¾ç‰‡åï¼Œä»£ç ä½¿ç”¨æ–¹å¼æ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤è¿™é‡Œä¹Ÿæ²¡æœ‰é¢å¤–çš„å˜åŒ–ã€‚</p><h3 id="ä½¿ç”¨use-framework-1"><a href="#ä½¿ç”¨use-framework-1" class="headerlink" title="ä½¿ç”¨use_framework!"></a>ä½¿ç”¨use_framework!</h3><ul><li><code>resources</code></li></ul><p>åœ¨ä½¿ç”¨use_framework!çš„æƒ…å†µä¸‹ï¼Œå¯¹åº”ç¼–è¯‘äº§ç‰©<code>Assets.car</code>ä¼šè¢«æ‹·è´åˆ°Podåº“Frameworkçš„æ ¹è·¯å¾„ä¸‹ï¼Œå…¶ä»–çš„è¡Œä¸ºç±»ä¼¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">| Info.plist</span><br><span class="line">| Frameworks</span><br><span class="line">|- DemoLib.framework</span><br><span class="line">|-- Assets.car</span><br><span class="line">| News</span><br><span class="line">| xxx</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼šåŒæ™®é€šèµ„æº<br>ç¼ºç‚¹ï¼šåŒæ™®é€šèµ„æºï¼Œä»£ç ä½¿ç”¨æ–¹é¢ä¹ŸåŒæ™®é€šèµ„æºçš„æƒ…å½¢</p><ul><li><code>resource_bundles</code></li></ul><p>åœ¨ä½¿ç”¨use_framework!çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šåˆ›å»ºKeyä¸ºåç§°çš„çˆ¶Bundleæ–‡ä»¶å¤¹ï¼Œæ‹·è´åˆ°Podåº“Frameworkæ ¹è·¯å¾„ä¸‹ï¼Œç„¶åå¯¹åº”ç¼–è¯‘äº§ç‰©<code>Assets.car</code>æ”¾åˆ°äº†è¿™ä¸ªè‡ªåŠ¨ç”ŸæˆBundleæ–‡ä»¶å¤¹ä¸‹ï¼Œå…¶ä»–è¡Œä¸ºç±»ä¼¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">| Info.plist</span><br><span class="line">| Frameworks</span><br><span class="line">|- DemoLib.framework</span><br><span class="line">|-- DemoLibResource.bundle</span><br><span class="line">|--- Assets.car</span><br><span class="line">| News</span><br><span class="line">| xxx</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼šåŒæ™®é€šèµ„æº<br>ç¼ºç‚¹ï¼šåŒæ™®é€šèµ„æºï¼Œä»£ç ä½¿ç”¨æ–¹é¢ä¹ŸåŒæ™®é€šèµ„æºçš„æƒ…å½¢</p><h2 id="æœ€ä½³å®è·µå’Œæ€»ç»“"><a href="#æœ€ä½³å®è·µå’Œæ€»ç»“" class="headerlink" title="æœ€ä½³å®è·µå’Œæ€»ç»“"></a>æœ€ä½³å®è·µå’Œæ€»ç»“</h2><p>å¯ä»¥çœ‹å‡ºï¼ŒCocoaPodsï¼Œå¯¹å¾…æ™®é€šèµ„æºå’ŒAsset Catalogéƒ½æ”¯æŒï¼Œå”¯ä¸€çš„è¡Œä¸ºä¸åŒçš„ç‚¹ï¼Œåœ¨äºæ™®é€šèµ„æºå¦‚æœå‘ç”Ÿé‡åï¼Œä¸ä¼šè¿›è¡Œåˆå¹¶è€Œæ˜¯ç›´æ¥æ›¿æ¢ã€‚ä½†æ˜¯Asset Catalogå¦‚æœå‡ºç°å¤šä¸ªå¼•ç”¨ï¼Œä¼šè¿›è¡Œåˆå¹¶ã€‚</p><p>è™½ç„¶è¡¨é¢çœ‹èµ·æ¥ï¼Œæˆ‘ä»¬åˆ†æäº†æ€»å…±ä¼šæœ‰ <strong>ä½¿ç”¨resourceè¿˜æ˜¯resource_bundle</strong> * <strong>æ˜¯å¦ä½¿ç”¨use_framework!</strong> * <strong>æ™®é€šèµ„æºè¿˜æ˜¯Asset Catalog</strong>ï¼Œ8ç§æƒ…å½¢ã€‚ä½†æ˜¯å®é™…ä¸Šä»ä¸–çºªä»£ç ä½¿ç”¨ä¸Šï¼Œç”±äºAsset Catalogå’Œæ™®é€šå›¾ç‰‡APIå¯ä»¥ç»Ÿä¸€ï¼ŒåŒæ—¶åŠ¨æ€/é™æ€çš„Bundleä½ç½®ä¹Ÿå¯ä»¥ç»Ÿä¸€å¤„ç†ï¼Œå®é™…ä¸Šåªæœ‰ä¸¤ç§Caseï¼š</p><h3 id="ä½¿ç”¨resource-bundleï¼šæ¨èï¼Œé¿å…å‘½åå†²çª"><a href="#ä½¿ç”¨resource-bundleï¼šæ¨èï¼Œé¿å…å‘½åå†²çª" class="headerlink" title="ä½¿ç”¨resource_bundleï¼šæ¨èï¼Œé¿å…å‘½åå†²çª"></a>ä½¿ç”¨resource_bundleï¼šæ¨èï¼Œé¿å…å‘½åå†²çª</h3><p>æ¨èåšæ³•ï¼Œå¯¹äºæ¯ä¸ªéœ€è¦å¼•å…¥èµ„æºçš„åº“ï¼Œä»¥<code>åº“å+Resource</code>ä¸ºKeyï¼ˆä¸å¼ºåˆ¶ï¼Œæ¨èï¼‰ï¼Œç„¶åå¼•å…¥èµ„æºï¼ŒAsset Catalogã€‚ä»£ç å¿…é¡»æ›´æ–°ï¼Œä»¥ä½¿ç”¨å¯¹åº”çš„Bundleåæ¥è·å–ã€‚å‚è€ƒä¸Šé¢çš„ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *bundlePath = [[<span class="built_in">NSBundle</span> bundleForClass:DemoLib.class].resourcePath stringByAppendingPathComponent:<span class="string">@&quot;DemoLibResource.bunbdle&quot;</span>];</span><br><span class="line"><span class="built_in">NSBundle</span> *bundle = [<span class="built_in">NSBundle</span> bundleWithPath:bundlePath];</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨resourceï¼šä¸æ¨èï¼Œå› ä¸ºä¼šå¯¼è‡´å‘½åå†²çªã€‚"><a href="#ä½¿ç”¨resourceï¼šä¸æ¨èï¼Œå› ä¸ºä¼šå¯¼è‡´å‘½åå†²çªã€‚" class="headerlink" title="ä½¿ç”¨resourceï¼šä¸æ¨èï¼Œå› ä¸ºä¼šå¯¼è‡´å‘½åå†²çªã€‚"></a>ä½¿ç”¨resourceï¼šä¸æ¨èï¼Œå› ä¸ºä¼šå¯¼è‡´å‘½åå†²çªã€‚</h3><p>é™¤éä½ èƒ½ä¿è¯åˆ†æ‰€æœ‰èµ„æºéƒ½å·²åŠ å…¥å‰ç¼€ï¼Œè€Œä¸”ç›®å‰ä»£ç ä¸å¥½æ›´æ”¹çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¿æŒç»§ç»­ä½¿ç”¨ä¸»å·¥ç¨‹çš„ç›´æ¥è®¿é—®mainBundleçš„ä»£ç ï¼›å…¶ä»–çš„ä»»ä½•æƒ…å†µï¼Œä½¿ç”¨<code>NSBundle bundleForClass:</code>æ¥è·å–Bundleï¼Œç„¶ååŠ è½½è·¯å¾„ï¼Œæˆ–è€…ä½¿ç”¨<code>UIImage imageNamed:inBundle:compatibleWithTraitCollection</code>åŠ è½½å›¾ç‰‡ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSBundle</span> *bundle = [<span class="built_in">NSBundle</span> bundleForClass:DemoLib.class];</span><br></pre></td></tr></table></figure><p>å¯¹äºPodåº“å¼€å‘è€…ï¼Œéœ€è¦å°½é‡ä½¿ç”¨<code>resource_bundle</code>æ¥å¤„ç†èµ„æºï¼ŒåŒæ—¶ï¼ŒPodè‡ªèº«ä»£ç å¯èƒ½éœ€è¦æ›´æ–°ï¼Œä»¥ä½¿ç”¨æ­£ç¡®çš„æ–¹å¼åŠ è½½å›¾ç‰‡æˆ–è€…å…¶ä»–Bundleèµ„æºã€‚å¹¶ä¸”ï¼Œå¯¹äºå›¾ç‰‡èµ„æºï¼Œå¦‚æœæ— ç‰¹æ®Šç”¨å¤„ï¼Œå»ºè®®éƒ½å»ºç«‹Asset Catalogä»¥åˆ©ç”¨App Thinningã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å…³äºCocoaPodsçš„èµ„æºç®¡ç†è¡Œä¸ºï¼Œå¯¹äºPodåº“ä½œè€…æ˜¯å¿…é¡»äº†è§£çš„çŸ¥è¯†ã€‚åŒæ—¶ä»‹ç»äº†CocoaPodsä½¿ç”¨Asset Catalogçš„æ³¨æ„äº‹é¡¹ã€‚å¦‚æœå·²ç»äº†è§£æŸæ–¹é¢çŸ¥è¯†ï¼Œå¯ä»¥å¤§è‡´ç•¥è¿‡ç›´æ¥çœ‹ç»“è®ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Asset-Catalogå’ŒApp-Thinning&quot;&gt;&lt;a href=&quot;#Asset-Catalogå’ŒApp-Thinning&quot; class=&quot;headerlink&quot; title=&quot;Asset Catalogå’ŒApp Thinning&quot;&gt;&lt;/a&gt;Asset Catalogå’ŒApp Thinning&lt;/h2&gt;&lt;p&gt;Asset Catalogï¼Œæ˜¯Xcodeæä¾›çš„ä¸€é¡¹å›¾ç‰‡èµ„æºç®¡ç†æ–¹å¼ã€‚æ¯ä¸ªAssetè¡¨ç¤ºä¸€ä¸ªå›¾ç‰‡èµ„æºï¼Œä½†æ˜¯å¯ä»¥å¯¹åº”ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®é™…PNGå›¾ï¼Œæ¯”å¦‚å¯ä»¥æä¾›&lt;code&gt;@1x&lt;/code&gt;, &lt;code&gt;@2x&lt;/code&gt;, &lt;code&gt;@3x&lt;/code&gt;å¤šå¼ å°ºå¯¸çš„å›¾ä»¥é€‚é…ï¼›åœ¨macOSä¸Šï¼Œè¿˜å¯ä»¥é€šè¿‡æŒ‡å®šæ—¥é—´å’Œå¤œé—´ä¸åŒAppearancesçš„ä¸¤å¥—å›¾ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§èµ„æºï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šè¢«å‹ç¼©ï¼Œç„¶ååœ¨Appè¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡APIåŠ¨æ€æ ¹æ®è®¾å¤‡scale factorï¼ˆMacä¸Šæ—¥å¤œé—´è®¾ç½®ï¼‰æ¥é€‰æ‹©å¯¹åº”çš„çœŸå®çš„å›¾ç‰‡æ¸²æŸ“ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://help.apple.com/xcode/mac/current/#/devbbdc5ce4f&quot;&gt;App Thinning&lt;/a&gt;ï¼Œæ˜¯è‹¹æœå¹³å°ï¼ˆiOS/tvOS/watchOSï¼‰ä¸Šçš„ä¸€ä¸ªç”¨äºä¼˜åŒ–AppåŒ…ä¸‹è½½èµ„æºå¤§å°çš„æ–¹æ¡ˆã€‚åœ¨AppåŒ…æäº¤ä¸Šä¼ åˆ°App Storeåï¼Œè‹¹æœåå°æœåŠ¡å™¨ï¼Œä¼šå¯¹ä¸åŒçš„è®¾å¤‡ï¼Œæ ¹æ®è®¾å¤‡çš„scale factorï¼Œé‡æ–°æŠŠAppåŒ…è¿›è¡Œç²¾ç®€ï¼Œè¿™æ ·ä¸åŒè®¾å¤‡ä»App Storeä¸‹è½½éœ€è¦çš„å®¹é‡ä¸åŒï¼Œ3xè®¾å¤‡ä¸éœ€è¦åŒæ—¶ä¸‹è½½1xå’Œ2xçš„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œè¿™å¥—æœºåˆ¶ç›´æ¥åŸºäºAsset Catalogï¼Œæ¢è¨€ä¹‹ï¼Œåªæœ‰åœ¨Asset Catalogä¸­å¼•å…¥çš„å›¾ç‰‡ï¼Œæ‰å¯ä»¥åˆ©ç”¨è¿™å¥—App Thinningã€‚ç›´æ¥æ‹·è´åˆ°App Bundleä¸­çš„æ•£è½å›¾ç‰‡ï¼Œæ‰€æœ‰è®¾å¤‡è¿˜æ˜¯éƒ½ä¼šå…¨éƒ¨ä¸‹è½½ã€‚å› æ­¤å¦‚ä½•å°½é‡æå‡Asset Catalogåˆ©ç”¨ç‡ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„åŒ…å¤§å°ä¼˜åŒ–ç‚¹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="CocoaPods" scheme="http://dreampiggy.com/tags/CocoaPods/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¹³å°å›¾ç‰‡ç¼–è§£ç å…¥é—¨æ•™ç¨‹ï¼ˆvImageç¯‡ï¼‰</title>
    <link href="http://dreampiggy.com/2017/11/12/iOS%E5%B9%B3%E5%8F%B0%E5%9B%BE%E7%89%87%E7%BC%96%E8%A7%A3%E7%A0%81%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%88vImage%E7%AF%87%EF%BC%89/"/>
    <id>http://dreampiggy.com/2017/11/12/iOS%E5%B9%B3%E5%8F%B0%E5%9B%BE%E7%89%87%E7%BC%96%E8%A7%A3%E7%A0%81%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%88vImage%E7%AF%87%EF%BC%89/</id>
    <published>2017-11-12T10:32:45.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ•™ç¨‹ï¼Œæ˜¯ç³»åˆ—æ•™ç¨‹çš„ç¬¬ä¸‰ç¯‡ï¼Œå‰ç¯‡åä¸ºiOSå¹³å°å›¾ç‰‡ç¼–è§£ç å…¥é—¨æ•™ç¨‹ï¼ˆç¬¬ä¸‰æ–¹ç¼–è§£ç ç¯‡ï¼‰ã€‚ç”±äºvImageå·²ç»å±äºè¾ƒä¸ºåº•å±‚æ¡†æ¶ï¼Œè¿™ä¸€ç¯‡å°†ä¸ä¼šç‰¹åˆ«ç€é‡å›¾ç‰‡å°è£…æ ¼å¼çš„ç¼–è§£ç ï¼Œä¼šä»‹ç»ä¸€äº›Bitmapçº§åˆ«çš„æ“ä½œï¼ŒåŒ…æ‹¬äº†å›¾åƒçš„è‰²å½©è½¬æ¢ï¼ŒAlphaåˆæˆã€åŸºæœ¬å‡ ä½•å˜æ¢ç­‰å®é™…ç”¨æ³•ã€‚ç”±äºæ•™ç¨‹ä¾§é‡æ˜¯å›¾åƒæ ¼å¼ï¼Œæ‰€ä»¥ä¸ä¼šä»‹ç»vImageå¼ºå¤§çš„Convolutionç­‰çŸ¥è¯†ï¼Œè¿™æ–¹é¢æ¶‰åŠåˆ°æ•°å­—å›¾åƒå¤„ç†çš„å¤æ‚çŸ¥è¯†ï¼Œä¸æ˜¯æ•™ç¨‹çš„ç›®æ ‡</p></blockquote><h1 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h1><p><a href="https://developer.apple.com/library/content/documentation/Performance/Conceptual/vImage/Introduction/Introduction.html">vImage</a>æ˜¯Appleçš„Accelerateåº“çš„ä¸€éƒ¨åˆ†ï¼Œä¾§é‡äºé«˜æ€§èƒ½çš„å›¾åƒBitmapçº§åˆ«çš„å¤„ç†ã€‚åº“æœ¬èº«å…¨éƒ¨æ˜¯Cçš„æ¥å£ï¼Œè€Œä¸”ä¸åŒäºCoreç³»åˆ—çš„ï¼ˆCore Graphics/Core Foundationï¼‰Cæ¥å£ï¼Œæ˜¯æ¯”è¾ƒè´´è¿‘ä¼ ç»ŸCè¯­è¨€çš„æ¥å£ï¼Œä¸ä¼šæœ‰XXXRefè¿™ç§è´´å¿ƒçš„å®šä¹‰ï¼Œè€Œä¸”å¾ˆå¤šæ¥å£éœ€è¦è‡ªå·±æ‰‹åŠ¨åˆ†é…å†…å­˜ã€‚</p><p>vImageæŒ‰ç…§åŠŸèƒ½ï¼Œå¯ä»¥åˆ†ä¸ºAlpha Compositingï¼ˆAlphaåˆæˆï¼‰ã€Geometryï¼ˆå‡ ä½•å˜æ¢ï¼‰ã€Conversionï¼ˆè‰²å½©è½¬æ¢ï¼‰ã€Convolutionï¼ˆå·ç§¯ï¼Œç”¨äºå›¾åƒæ»¤é•œï¼‰Morphologyï¼ˆå½¢æ€å­¦å¤„ç†ï¼‰ç­‰ã€‚è¿™é‡Œä¸»è¦ä»‹ç»çš„ï¼Œå°±æ˜¯è‰²å½©è½¬æ¢ï¼ŒAlphaåˆæˆï¼Œä»¥åŠå‡ ä½•å˜æ¢çš„å†…å®¹ã€‚</p><p>é¦–å…ˆéœ€è¦å¯¹vImageçš„åŸºæœ¬æ¥å£æœ‰æ‰€äº†è§£ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><code>vImage_Buffer</code>: å¯¹åº”Bitmapçš„æ•°æ®ï¼Œåªæœ‰æœ€åŸºæœ¬çš„widthã€heightã€rowBytes(stride)ä»¥åŠdata</li><li><code>vImage_CGImageFormat</code>: æ¯ä¸ªvImageçš„åŠŸèƒ½ï¼Œä¼šæä¾›ä¸åŒè‰²å½©æ ¼å¼çš„ç±»ä¼¼æ¥å£ï¼Œæ¯”å¦‚ä¼šæœ‰ARGB8888ï¼ŒPlanar8çš„åŒæ ·åŠŸèƒ½ã€‚è¿™é‡ŒARGB8888æŒ‡çš„æ˜¯ARGBæ’åˆ—ï¼Œæ¯é€šé“å 8ä¸ªBitï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªPiexelå 32Bitã€‚è€ŒvImageè¿˜æœ‰ä¸€ä¸ªå¸¸è§çš„è‰²å½©æ ¼å¼Plane8ï¼ŒæŒ‡çš„æ˜¯åªæœ‰ä¸€ä¸ªé€šé“ï¼ˆå¹³é¢ï¼‰ï¼ŒæŒ‰ç…§é¡ºåºæ’åˆ—ï¼Œæ¯”å¦‚<code>&#123;R, R, R, R&#125;</code>è¿™æ ·ï¼Œæ›´æ–¹ä¾¿è¿›è¡Œè®¡ç®—</li><li><code>vImage_Flags</code>: æ¯ä¸ªvImageæ¥å£ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª<code>flags </code>å‚æ•°æ¥æ§åˆ¶ä¸€äº›é€‰é¡¹ï¼Œæ¯”å¦‚è¯´å¯ä»¥è‡ªå·±å®šä¹‰å†…å­˜åˆ†é…ï¼ŒèƒŒæ™¯è‰²å¡«å……ç­–ç•¥ï¼Œé‡é‡‡æ ·ç­–ç•¥ç­‰ï¼Œé»˜è®¤çš„æ˜¯<code>kvImageNoFlags</code></li><li><code>vImage_Error</code>: æ¯ä¸ªvImageçš„æ¥å£ï¼Œéƒ½ä¼šè¿”å›è¿™ä¸ªresultï¼Œæ¥è®©ç”¨æˆ·ç¡®è®¤æ˜¯å¦æˆåŠŸï¼Œä»¥åŠå¤±è´¥çš„åŸå› ï¼Œåœ¨Debugä¸‹æ¯”è¾ƒæœ‰å¸®åŠ©</li></ul><p>ä¸ºäº†ç»Ÿä¸€æœŸé—´ï¼Œä»¥ä¸‹çš„å†…å®¹ï¼Œéƒ½æ˜¯åŸºäºARGB8888è‰²å½©æ ¼å¼çš„è¾“å…¥æ¥è¯´æ˜çš„ã€‚å…¶ä»–çš„æƒ…å†µå¤„ç†ï¼Œå‚è€ƒåŒåæ¥å£çš„ä¸åŒæ ¼å¼å³å¯ã€‚</p><h1 id="è‰²å½©è½¬æ¢"><a href="#è‰²å½©è½¬æ¢" class="headerlink" title="è‰²å½©è½¬æ¢"></a>è‰²å½©è½¬æ¢</h1><p>è‰²å½©è½¬æ¢æŒ‡çš„æ˜¯å°†å›¾åƒçš„Bitmapæ ¼å¼ï¼Œä»ä¸€ä¸ªè‰²å½©æ ¼å¼ï¼Œæ¯”å¦‚ARGB8888ï¼Œè½¬æ¢åˆ°å¦ä¸€ä¸ªè‰²å½©æ ¼å¼ï¼Œæ¯”å¦‚è¯´RGB888çš„åŠŸèƒ½ã€‚å¯¹äºRGBæ¥è¯´ï¼Œä¸€èˆ¬æ¥è¯´å°±æ˜¯é€šé“çš„å¢åŠ å’Œå‡å°‘ã€‚å½“ç„¶è¿˜æœ‰RGBè½¬ä¸ºPlanar8çš„æƒ…å†µã€‚</p><p>vImageå¯¹è¿™äº›è‰²å½©è½¬æ¢çš„åŠŸèƒ½ï¼Œç»Ÿä¸€æä¾›äº†æ–¹æ³•<code>vImageConvert_AtoB</code>ï¼Œæ¯”å¦‚ARGB8888è½¬RGB888ï¼Œå°±å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¥å¤„ç†ã€‚é¡ºä¾¿é€šè¿‡è¿™ä¸ªä»£ç ï¼Œæ¥ç®€å•äº†è§£vImageçš„APIçš„åŸºæœ¬ç”¨æ³•ã€‚</p><p>å…ˆæ¥å®šä¹‰å‡ ä¸ªç®€å•çš„ç»“æ„ä½“ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬é¦–å…ˆç›´æ¥å®šä¹‰å¥½ARGB8888çš„formatç»“æ„ä½“ï¼Œåç»­éœ€è¦å¤šæ¬¡ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">static</span> vImage_CGImageFormat vImageFormatARGB8888 = (vImage_CGImageFormat) &#123;</span><br><span class="line">    .bitsPerComponent = <span class="number">8</span>, <span class="comment">// 8ä½</span></span><br><span class="line">    .bitsPerPixel = <span class="number">32</span>, <span class="comment">// ARGB4é€šé“ï¼Œ4*8</span></span><br><span class="line">    .colorSpace = <span class="literal">NULL</span>, <span class="comment">// é»˜è®¤å°±æ˜¯sRGB</span></span><br><span class="line">    .bitmapInfo = kCGImageAlphaFirst | kCGBitmapByteOrderDefault, <span class="comment">// è¡¨ç¤ºARGB</span></span><br><span class="line">    .version = <span class="number">0</span>, <span class="comment">// æˆ–è®¸ä»¥åä¼šæœ‰ç‰ˆæœ¬åŒºåˆ†ï¼Œç°åœ¨éƒ½æ˜¯0</span></span><br><span class="line">    .decode = <span class="literal">NULL</span>, <span class="comment">// å’Œ`CGImageCreate`çš„decodeå‚æ•°ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥åšè‰²å½©èŒƒå›´æ˜ å°„çš„ï¼ŒNULLå°±æ˜¯[0, 1.0]</span></span><br><span class="line">    .renderingIntent = kCGRenderingIntentDefault, <span class="comment">// å’Œ`CGImageCreate`çš„intentå‚æ•°ä¸€æ ·ï¼Œå½“è‰²å½©ç©ºé—´è¶…è¿‡åå¦‚ä½•å¤„ç†</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// RGB888çš„formatç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">static</span> vImage_CGImageFormat vImageFormatRGB888 = (vImage_CGImageFormat) &#123;</span><br><span class="line">    .bitsPerComponent = <span class="number">8</span>, <span class="comment">// 8ä½</span></span><br><span class="line">    .bitsPerPixel = <span class="number">24</span>, <span class="comment">// RGB3é€šé“ï¼Œ3*8</span></span><br><span class="line">    .colorSpace = <span class="literal">NULL</span>,</span><br><span class="line">    .bitmapInfo = kCGImageAlphaNone | kCGBitmapByteOrderDefault, <span class="comment">// è¡¨ç¤ºRGB</span></span><br><span class="line">    .version = <span class="number">0</span>,</span><br><span class="line">    .decode = <span class="literal">NULL</span>,</span><br><span class="line">    .renderingIntent = kCGRenderingIntentDefault,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å­—èŠ‚å¯¹é½ä½¿ç”¨ï¼ŒvImageå¦‚æœä¸æ˜¯64å­—èŠ‚å¯¹é½çš„ï¼Œä¼šæœ‰é¢å¤–å¼€é”€</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> size_t vImageByteAlign(size_t size, size_t alignment) &#123;</span><br><span class="line">    <span class="keyword">return</span> ((size + (alignment - <span class="number">1</span>)) / alignment) * alignment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼Œå°±æ˜¯å®Œæ•´çš„è½¬æ¢ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">CGImageRef</span>)nonAlphaImageWithImage:(<span class="built_in">CGImageRef</span>)aImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆï¼Œæˆ‘ä»¬å£°æ˜inputå’Œoutputçš„buffer</span></span><br><span class="line">    __block vImage_Buffer a_buffer = &#123;&#125;, output_buffer = &#123;&#125;;</span><br><span class="line">    @onExit &#123;</span><br><span class="line">        <span class="comment">// ç”±äºvImageçš„APIéœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼</span></span><br><span class="line">        <span class="comment">// ä¸ºäº†æ–¹ä¾¿é”™è¯¯å¤„ç†æ¸…ç†å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨clang attibuteçš„cleanupï¼ˆè¿™é‡Œæ˜¯libextobjcçš„å®ï¼‰</span></span><br><span class="line">        <span class="comment">// å¦‚æœä¸è¿™æ ·ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨gotoï¼Œå®šä¹‰ä¸€ä¸ªfail:çš„labelï¼Œæ‰€æœ‰return NULLæ”¹æˆ`goto fail`;</span></span><br><span class="line">        <span class="keyword">if</span> (a_buffer.data) free(a_buffer.data);</span><br><span class="line">        <span class="keyword">if</span> (output_buffer.data) free(output_buffer.data);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªbufferï¼Œå¯ä»¥ç”¨vImageæä¾›çš„CGImageçš„ä¾¿æºæ„é€ æ–¹æ³•ï¼Œé‡Œé¢éœ€è¦ä¼ å…¥åŸå§‹æ•°æ®æ‰€éœ€è¦çš„formatï¼Œè¿™é‡Œå°±æ˜¯ARGB8888</span></span><br><span class="line">    vImage_Error a_ret = vImageBuffer_InitWithCGImage(&amp;a_buffer, &amp;vImageFormatARGB8888, <span class="literal">NULL</span>, aImage, kvImageNoFlags);</span><br><span class="line">    <span class="comment">// æ‰€æœ‰vImageçš„æ–¹æ³•ä¸€èˆ¬éƒ½æœ‰ä¸€ä¸ªresultï¼Œåˆ¤æ–­æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (a_ret != kvImageNoError) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">// æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦å¯¹output bufferå¼€è¾Ÿå†…å­˜ï¼Œè¿™é‡Œç”±äºæ˜¯RGB888ï¼Œå¯¹åº”çš„rowBytesæ˜¯3 * widthï¼Œæ³¨æ„è¿˜éœ€è¦64å­—èŠ‚å¯¹é½ï¼Œå¦åˆ™vImageå¤„ç†ä¼šæœ‰é¢å¤–çš„å¼€é”€ã€‚</span></span><br><span class="line">    output_buffer.width = a_buffer.width;</span><br><span class="line">    output_buffer.height = a_buffer.height;</span><br><span class="line">    output_buffer.rowBytes = vImageByteAlign(output_buffer.width * <span class="number">3</span>, <span class="number">64</span>);</span><br><span class="line">    output_buffer.data = malloc(output_buffer.rowBytes * output_buffer.height);</span><br><span class="line">    <span class="comment">// è¿™é‡Œä½¿ç”¨vImageçš„convertæ–¹æ³•ï¼Œè½¬æ¢è‰²å½©æ ¼å¼</span></span><br><span class="line">    vImage_Error ret = vImageConvert_ARGB8888toRGB888(&amp;a_buffer, &amp;output_buffer, kvImageNoFlags);</span><br><span class="line">    <span class="keyword">if</span> (ret != kvImageNoError) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">// æ­¤æ—¶å·²ç»output bufferå·²ç»è½¬æ¢å®Œæˆï¼Œè¾“å‡ºå›CGImage</span></span><br><span class="line">    <span class="built_in">CGImageRef</span> outputImage = vImageCreateCGImageFromBuffer(&amp;output_buffer, &amp;vImageFormatRGB888, <span class="literal">NULL</span>, <span class="literal">NULL</span>, kvImageNoFlags, &amp;ret);</span><br><span class="line">    <span class="keyword">if</span> (ret != kvImageNoError) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> outputImage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»»æ„è‰²å½©æ ¼å¼è½¬æ¢"><a href="#ä»»æ„è‰²å½©æ ¼å¼è½¬æ¢" class="headerlink" title="ä»»æ„è‰²å½©æ ¼å¼è½¬æ¢"></a>ä»»æ„è‰²å½©æ ¼å¼è½¬æ¢</h2><p>é™¤äº†ä¸€ç³»åˆ—<code>vImageConvert_AtoB</code>çš„è½¬æ¢ï¼ŒvImageè¿˜æä¾›äº†ä¸€ä¸ªéå¸¸æŠ½è±¡çš„æ¥å£ï¼Œå«åš<code>vImageConvert_AnyToAny</code>ï¼Œåªéœ€è¦ä½ æä¾›ä¸€ä¸ªinput formatï¼Œä¸€ä¸ªoutput formatï¼Œå°±å¯ä»¥ç›´æ¥è½¬æ¢ã€‚è¿™ä¸ªæ¥å£æ¯”è¾ƒå¼ºå¤§ï¼Œä¸ä»…èƒ½å¤Ÿhandleræ‰€æœ‰æ”¯æŒçš„è‰²å½©æ ¼å¼ï¼Œè€Œä¸”è¿˜èƒ½æ”¯æŒ<code>CVImageBuffer</code>ï¼ˆé€šè¿‡è¿™ä¸ª<code>vImageConverter</code>æ¥æ„é€ ï¼‰ã€‚æ‰€ä»¥ä¸€èˆ¬å¦‚æœåšåº“å°è£…ï¼Œåšä¸€äº›è‰²å½©è½¬æ¢çš„caseçš„æ—¶å€™ï¼Œå°±å¯ä»¥è¯•ç€ç”¨è¿™ä¸ªæ¥å£ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬ä¹‹å‰çš„ARGB8888ToRGB888çš„è‰²å½©è½¬æ¢ï¼Œå¯ä»¥è¿™æ ·å†™ï¼Œæ›´ä¸ºé€šç”¨ã€‚ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vImageConverterRef converter = vImageConverter_CreateWithCGImageFormat(&amp;vImageFormatARGB8888, &amp;vImageFormatRGB888, <span class="literal">NULL</span>, kvImageNoFlags, &amp;ret);</span><br><span class="line"><span class="keyword">if</span> (ret != kvImageNoError) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">ret = vImageConvert_AnyToAny(converter, &amp;a_buffer, &amp;output_buffer, <span class="literal">NULL</span>, kvImageNoFlags);</span><br></pre></td></tr></table></figure><h1 id="Alphaåˆæˆ"><a href="#Alphaåˆæˆ" class="headerlink" title="Alphaåˆæˆ"></a>Alphaåˆæˆ</h1><p><img src="https://raw.githubusercontent.com/dreampiggy/vImageProcessor/master/Example/Screenshot/Screenshot1.png" alt="Alphaåˆæˆ"></p><p><a href="https://en.wikipedia.org/wiki/Alpha_compositing">Alphaåˆæˆ</a>æŒ‡çš„æ˜¯å°†ä¸¤å¼ å«æœ‰Alphaé€šé“çš„å›¾ï¼ˆè¢«Blendçš„å«åšbottomï¼ŒBlendçš„å«åštopï¼‰ï¼Œé€šè¿‡ä¸€å®šçš„å…¬å¼åˆæˆæˆä¸ºä¸€å¼ æ–°çš„å«Alphaé€šé“çš„å›¾ï¼Œä¸€èˆ¬æ¥è¯´ç”¨äºç»™å›¾åƒæ·»åŠ é®ç½©ã€è¦†ç›–ç­‰ï¼Œå¸¸è§çš„å›¾åƒå¤„ç†è½¯ä»¶éƒ½æœ‰è¿™ä¸ªåŠŸèƒ½ã€‚å…¶å®æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒAlphaåˆæˆï¼Œå°±æ˜¯å¯¹å›¾åƒçš„æ¯ä¸€ä¸ªåƒç´ å€¼ï¼Œè¿›è¡Œè¿™æ ·ä¸€ä¸ªè®¡ç®—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resultAlpha = (topAlpha * <span class="number">255</span> + (<span class="number">255</span> - topAlpha)</span><br><span class="line">                 * bottomAlpha + <span class="number">127</span>) / <span class="number">255</span></span><br><span class="line">resultColor = (topAlpha * topColor + (((<span class="number">255</span> - topAlpha)</span><br><span class="line">                 * bottomAlpha + <span class="number">127</span>) / <span class="number">255</span>) * bottomColor +  <span class="number">127</span>)</span><br><span class="line">                    / resultAlpha</span><br></pre></td></tr></table></figure><p>å…¬å¼çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå› æ­¤è¿™é‡Œé¡ºä¾¿å¯ä»¥ä»‹ç»ä¸€ä¸‹å…³äº<a href="https://segmentfault.com/a/1190000002990030">premultiplied-alpha</a>çš„æ¦‚å¿µï¼Œç›´è§‚åœ°è¯´ï¼Œå°±æ˜¯å°†<code>(r, g, b, a)</code>é¢„å…ˆä¹˜ä»¥äº†å¯¹åº”çš„alphaé€šé“çš„å€¼ï¼Œæˆä¸º<code>(r * a, g * a, b * a, a)</code>ã€‚è¿™ä¸ªå¸¦æ¥çš„å¥½å¤„ï¼Œå°±æ˜¯Alphaåˆæˆçš„æ—¶å€™ï¼Œå¯ä»¥å°‘ä¸€æ¬¡ä¹˜æ³•ï¼Œè€Œä¸”ç®€åŒ–äº†è®¡ç®—ï¼Œæˆä¸ºè¿™æ ·å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">resultColor = (topColor + (((<span class="number">255</span> - topAlpha)</span><br><span class="line">                 * bottomAlpha + <span class="number">127</span>) / <span class="number">255</span>) * bottomColor +  <span class="number">127</span>)</span><br></pre></td></tr></table></figure><p>åœ¨vImageä¸­ï¼Œå·²ç»æä¾›äº†ä¸€ä¸ªæ¥å£æ¥ä¸“é—¨å¤„ç†Alphaåˆæˆï¼Œé’ˆå¯¹nonpremultipliedçš„ï¼Œæ˜¯<code>vImageAlphaBlend_ARGB8888</code>ï¼Œè€Œé’ˆå¯¹premultipliedï¼Œæ˜¯<code>vImagePremultipliedAlphaBlend_ARGB8888</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ¥å£è¦æ±‚çš„ä¸¤ä¸ªbufferï¼Œå®½åº¦å’Œé«˜åº¦å¿…é¡»ç›¸ç­‰ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯¹äºColorå’ŒImageçš„é®ç½©ï¼Œéœ€è¦è¿›è¡Œå¤„ç†ï¼Œä¿è¯è¿™ä¸¤ä¸ªbufferæ»¡è¶³è¦æ±‚ã€‚</p><h2 id="Alpha-Blend-Color"><a href="#Alpha-Blend-Color" class="headerlink" title="Alpha Blend Color"></a>Alpha Blend Color</h2><p>è¿™ä¸ªç”¨å¤„ï¼Œä¸€èˆ¬æ˜¯ç”¨æ¥åšå›¾åƒçš„é®ç½©çš„ï¼Œå¯ä»¥å¯¹å›¾åƒæ•´ä½“ç›–ä¸€å±‚æœ‰é€æ˜åº¦çš„é¢œè‰²ï¼Œæ¯”å¦‚è¯´å¤œé—´æ¨¡å¼ï¼Œçº¯è‰²æ»¤é•œç­‰ã€‚æ ¹æ®ä¸Šé¢è¯´çš„ï¼Œå¦‚æœéœ€è¦å¯¹ä¸€ä¸ªBitmapä½¿ç”¨vImageè¿›è¡ŒAlpha Blendï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ä¸¤ä¸ªbufferçš„å®½åº¦å’Œé«˜åº¦ç›¸åŒï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨<code>vImageBufferFill_ARGB8888</code>å¡«å……æ•´ä¸ªColoræ¥æ„é€ ä¸€ä¸ªä¸è¾“å…¥å›¾åƒBufferç›¸åŒå®½é«˜çš„æ–°bufferï¼Œç„¶åç”¨å®ƒæ¥è¿›è¡ŒAlpha Blendã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGImageRef</span> aImage; <span class="comment">// è¾“å…¥çš„bottom Image</span></span><br><span class="line"><span class="built_in">CGColorRef</span> color; <span class="comment">// è¾“å…¥çš„color</span></span><br><span class="line">__block vImage_Buffer a_buffer = &#123;&#125;, b_buffer = &#123;&#125;, output_buffer = &#123;&#125;; <span class="comment">// åˆ†åˆ«æ˜¯bottom bufferï¼Œtop bufferå’Œæœ€åçš„output buffer</span></span><br><span class="line">Pixel_8888 pixel_color = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="type">double</span> *components = <span class="built_in">CGColorGetComponents</span>(color);</span><br><span class="line"><span class="keyword">const</span> size_t components_size = <span class="built_in">CGColorGetNumberOfComponents</span>(color);</span><br><span class="line"><span class="comment">// å¯¹CGColorè¿›è¡Œè½¬æ¢åˆ°Pixel_8888</span></span><br><span class="line"><span class="keyword">if</span> (components_size == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="comment">// white, alpha</span></span><br><span class="line">    pixel_color[<span class="number">0</span>] = components[<span class="number">1</span>] * <span class="number">255</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// red, green, blue, (alpha)</span></span><br><span class="line">    pixel_color[<span class="number">0</span>] = components_size == <span class="number">3</span> ? <span class="number">255</span> : components[<span class="number">3</span>] * <span class="number">255</span>;</span><br><span class="line">    pixel_color[<span class="number">1</span>] = components[<span class="number">0</span>] * <span class="number">255</span>;</span><br><span class="line">    pixel_color[<span class="number">2</span>] = components[<span class="number">1</span>] * <span class="number">255</span>;</span><br><span class="line">    pixel_color[<span class="number">3</span>] = components[<span class="number">2</span>] * <span class="number">255</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¡«å……coloråˆ°top buffer</span></span><br><span class="line">vImage_Error b_ret = vImageBufferFill_ARGB8888(&amp;b_buffer, pixel_color , kvImageNoFlags);</span><br><span class="line"><span class="keyword">if</span> (b_ret != kvImageNoError) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">// Alpha Blend</span></span><br><span class="line">vImage_Error ret = vImageAlphaBlend_ARGB8888(&amp;b_buffer, &amp;a_buffer, &amp;output_buffer, kvImageNoFlags);</span><br></pre></td></tr></table></figure><h2 id="Alpha-Blend-Image"><a href="#Alpha-Blend-Image" class="headerlink" title="Alpha Blend Image"></a>Alpha Blend Image</h2><p>ä¸Šé¢è¯´åˆ°äº†å…³äºColorçš„Alpha Blendï¼Œä¸åŒäºColorè¿™ç§éœ€è¦å¡«å……å…¨éƒ¨å®½åº¦ï¼Œå¦‚æœå¯¹äºä¸€ä¸ªImageéœ€è¦è¿›è¡ŒAlpha Blendï¼Œæˆ‘ä»¬å¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯éœ€è¦åˆ¶å®šä¸€ä¸ªèµ·å§‹ç‚¹çš„ï¼Œå› ä¸ºä¸èƒ½ä¿è¯æ‰€æœ‰è¾“å…¥çš„ä¸¤ä¸ªImageçš„å®½é«˜ç›¸åŒã€‚å› æ­¤è®¾è®¡çš„æ—¶å€™ï¼Œå¯ä»¥ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªpointå‚æ•°ï¼Œä»¥è¿™ä¸ªåæ ‡ç‚¹å¼€å§‹æ¥ç»˜åˆ¶Alpha Blendï¼Œç±»ä¼¼äºå¾ˆå¤šå›¾åƒç¼–è¾‘è½¯ä»¶æä¾›çš„å›¾å±‚åŠŸèƒ½ã€‚</p><p>ç”±äºvImageçš„Alpha Blendéœ€è¦ä¸¤ä¸ªç­‰å®½é«˜çš„Bufferï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹ç”¨æˆ·æä¾›çš„Top Imageè¿›è¡Œå¤„ç†ï¼Œé€šè¿‡å¹³ç§»å˜æ¢ç§»åŠ¨åˆ°æŒ‡å®šçš„Pointä»¥åï¼Œå¡«å……å…¶ä½™éƒ¨åˆ†ä¸ºClear Colorã€‚æœ€åè¿›è¡ŒAlpha Blendå³å¯ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGImageRef</span> aImage, bImage; <span class="comment">// è¾“å…¥çš„bottom Imageå’Œtop Image</span></span><br><span class="line">__block vImage_Buffer a_buffer = &#123;&#125;, b_buffer = &#123;&#125;, c_buffer = &#123;&#125;, output_buffer = &#123;&#125;;</span><br><span class="line"><span class="comment">//c bufferæŒ‡çš„æ˜¯å°†top Imageè¿›è¡Œå¤„ç†åçš„ä¸´æ—¶bufferï¼Œä½¿å¾—å®½é«˜åŒbottom imageç›¸åŒ</span></span><br><span class="line"><span class="comment">// è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†çº¿æ€§å˜æ¢çš„å¹³ç§»å˜æ¢ï¼Œä»¥(0,0)æ”¾ç½®top imageï¼Œç„¶ååç§»pointä¸ªåƒç´ ç‚¹ï¼Œå…¶ä½™éƒ¨åˆ†å¡«å……clear colorï¼Œå³å¯å¾—åˆ°è¿™ä¸ªå¤„ç†åçš„c buffer</span></span><br><span class="line"><span class="built_in">CGAffineTransform</span> transform = <span class="built_in">CGAffineTransformMakeTranslation</span>(point.x, point.y);</span><br><span class="line">vImage_CGAffineTransform cg_transform = *((vImage_CGAffineTransform *)&amp;transform);</span><br><span class="line">Pixel_8888 clear_color = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">vImage_Error c_ret = vImageAffineWarpCG_ARGB8888(&amp;b_buffer, &amp;c_buffer, <span class="literal">NULL</span>, &amp;cg_transform, clear_color, kvImageBackgroundColorFill);</span><br><span class="line"><span class="keyword">if</span> (c_ret != kvImageNoError) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">// ç•¥è¿‡output bufferåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">// å°†bottom imageå’Œå¤„ç†åçš„c bufferè¿›è¡ŒAlpha Blend</span></span><br><span class="line">vImage_Error ret = vImageAlphaBlend_ARGB8888(&amp;c_buffer, &amp;a_buffer, &amp;output_buffer, kvImageNoFlags);</span><br></pre></td></tr></table></figure><h1 id="å‡ ä½•å˜æ¢"><a href="#å‡ ä½•å˜æ¢" class="headerlink" title="å‡ ä½•å˜æ¢"></a>å‡ ä½•å˜æ¢</h1><p>å‡ ä½•å˜æ¢ï¼ŒæŒ‡çš„æ˜¯å°†ä¸€ä¸ªåŸå§‹çš„Bitmapï¼Œé€šè¿‡çº¿æ€§æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå®ç°æ¯”å¦‚å¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ã€é”™åˆ‡ç­‰æ“ä½œçš„å›¾åƒå¤„ç†æŠ€æœ¯ã€‚</p><p>å¯èƒ½å¤§éƒ¨åˆ†äººå·²ç»çŸ¥é“äº†ï¼ˆä¹‹å‰ä¹Ÿè¯´è¿‡ï¼‰ï¼ŒCore Graphicsçš„åæ ‡ç³»ç»Ÿï¼Œå’ŒUIKitçš„åæ ‡ç³»ç»Ÿï¼Œåœ¨Yåæ ‡ä¸Šæ˜¯ç›¸åçš„ã€‚UIKitçš„ä½¿ç”¨çš„æ˜¯Yè½´æ­£å‘å‚ç›´å‘ä¸‹çš„å·¦æ‰‹ç³»ï¼Œè€ŒCore Graphicså’Œæ™®é€šçš„å³æ‰‹ç³»ç›´è§’åæ ‡ç³»ç›¸åŒã€‚vImageä¹Ÿéµå®ˆäº†å³æ‰‹ç³»ï¼Œå› æ­¤ä¹‹åä»‹ç»çš„å˜æ¢éƒ½æ˜¯æŒ‰ç…§å³æ‰‹ç³»çš„ï¼Œå¦‚æœæƒ³å¤„ç†UIKitçš„åæ ‡ç³»ï¼Œè‡ªå·±è½¬æ¢ä¸€ä¸‹å³å¯ï¼ˆä¸€èˆ¬å°±æ˜¯å–<code>image.height - offsetY</code>å³å¯ï¼‰</p><p>å…³äºè¦ä»‹ç»çš„çš„è¿™äº›å‡ ä½•å˜æ¢ï¼Œè™½ç„¶éƒ½æœ€åå¯ä»¥ç»Ÿä¸€åˆ°åˆ°çº¿æ€§å˜æ¢ä¸Šï¼Œåªä¸è¿‡æ•ˆç‡ä¸Šå¯èƒ½ç›¸æ¯”å•ç‹¬çš„æ–¹æ³•æ¥è¯´æœ‰æ‰€æŸè€—ï¼Œå› æ­¤å•ç‹¬å¯¹æ¯ä¸ªåŠŸèƒ½æ‰€éœ€è¦çš„vImageæ¥å£è¿›è¡Œäº†ä»‹ç»ã€‚å…³äºçº¿æ€§å˜æ¢ä¸å¤ªç†è§£çš„ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ä¹‹å‰çš„ä¸€ç¯‡æ•™ç¨‹ï¼š<a href="http://dreampiggy.com/2016/09/27/core-graphicsfang-she-bian-huan/">Core Graphicsä»¿å°„å˜æ¢çŸ¥è¯†</a></p><h2 id="ç¼©æ”¾"><a href="#ç¼©æ”¾" class="headerlink" title="ç¼©æ”¾"></a>ç¼©æ”¾</h2><p><img src="https://raw.githubusercontent.com/dreampiggy/vImageProcessor/master/Example/Screenshot/Screenshot2.png" alt="ç¼©æ”¾"></p><p>ç¼©æ”¾æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªå¤„ç†è¿‡ç¨‹ï¼Œä½†æ˜¯ç”±äºç¼©æ”¾ä¹‹åï¼Œä¹‹å‰çš„åŒä¸€ä¸ªåƒç´ ç‚¹ï¼Œç°åœ¨å¯èƒ½ä¼šæ˜ å°„åˆ°4ä¸ªæˆ–è€…æ›´å¤šåƒç´ ç‚¹ï¼Œæˆ–è€…æ˜¯åŸæœ¬4ä¸ªåƒç´ ç‚¹ï¼Œç°åœ¨éœ€è¦æ˜ å°„åˆ°1ä¸ªåƒç´ ç‚¹ã€‚è¿™å°±ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªå«åš<a href="https://en.wikipedia.org/wiki/Image_scaling">å›¾åƒé‡é‡‡æ ·</a>çš„è¿‡ç¨‹ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯å¯¹æ¯ä¸€ä¸ªåƒç´ ï¼Œæ‰€åœ¨çš„Bitmapçš„å­çŸ©é˜µï¼ˆæ¯”å¦‚3x3ï¼‰ï¼Œé€šè¿‡ä¸€å®šçš„ç®—æ³•è®¡ç®—ï¼Œå¾—åˆ°å¯¹åº”çš„ç¼©æ”¾ä»¥åçš„ä¸­å¿ƒåƒç´ çš„å€¼ã€‚åŒæ—¶ï¼Œè¿™ä¸ªåƒç´ å€¼å¯èƒ½å˜æˆæµ®ç‚¹æ•°ï¼Œè¿˜éœ€è¦è¿›è¡Œå¤„ç†ï¼Œæœ€åå¡«åˆ°é‡‡æ ·åçš„Bitmapç›¸åº”çš„ä½ç½®ä¸Šã€‚å¸¸è§çš„ç®€å•å¤„ç†æœ‰æœ€é‚»è¿‘ç®—æ³•ã€åŒçº¿æ€§ç®—æ³•ã€åŒç«‹æ–¹ç®—æ³•ç­‰ã€‚</p><p>vImageé»˜è®¤ä½¿ç”¨çš„æ˜¯<a href="https://en.wikipedia.org/wiki/Lanczos_resampling">Lanczos Algorithm</a>ï¼Œå…·ä½“çš„ä»‹ç»å¯ä»¥å‚è€ƒWikipediaå’ŒDSPç›¸å…³çš„ä¹¦ç±ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç›´è§‚çš„å¯¹æ¯”è¡¨ç°<a href="https://clouard.users.greyc.fr/Pantheon/experiments/rescaling/index-en.html">ç½‘é¡µ</a>ã€‚å¦‚æœæƒ³è¦æ›´é«˜ç”»è´¨çš„ç®—æ³•ï¼Œå¯ä»¥æä¾›<code>kvImageHighQualityResampling</code>å‚æ•°ï¼Œæ¥ä½¿ç”¨<code>Lanczos5</code>ç®—æ³•ã€‚æˆ–è€…å¯ä»¥ä½¿ç”¨ä¹‹åè¦è°ˆçš„ç›¸å¯¹åº•å±‚ä¸€ç‚¹çš„é”™åˆ‡APIï¼Œæ¥è‡ªå®šä¹‰ä½ çš„é‡é‡‡æ ·è¿‡ç¨‹ã€‚</p><p>vImageæä¾›äº†è‡ªå¸¦çš„<code>vImageScale_ARGB8888</code>æ–¹æ³•ï¼Œè¿™é‡Œå°±ç®€å•ä¸¾ä¸ªä¾‹å­ï¼ˆä¹‹å‰é‡å¤ä»£ç çš„éƒ½ç•¥è¿‡ï¼‰ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGSize</span> size; <span class="comment">// ç›®æ ‡å¤§å°</span></span><br><span class="line">output_buffer.width = MAX(size.width, <span class="number">0</span>);</span><br><span class="line">output_buffer.height = MAX(size.height, <span class="number">0</span>);</span><br><span class="line">output_buffer.rowBytes = vImageByteAlign(output_buffer.width * <span class="number">4</span>, <span class="number">64</span>);</span><br><span class="line">output_buffer.data = malloc(output_buffer.rowBytes * output_buffer.height);</span><br><span class="line"><span class="keyword">if</span> (!output_buffer.data) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">// è¿›è¡Œç¼©æ”¾ï¼Œè¾“å‡ºåˆ°output bufferä¸­</span></span><br><span class="line">vImage_Error ret = vImageScale_ARGB8888(&amp;a_buffer, &amp;output_buffer, <span class="literal">NULL</span>, kvImageHighQualityResampling);</span><br></pre></td></tr></table></figure><h2 id="è£å‰ª"><a href="#è£å‰ª" class="headerlink" title="è£å‰ª"></a>è£å‰ª</h2><p>è£å‰ªæ˜¯æŒ‡çš„å°†åŸå§‹Bitmapï¼Œåªè£å‡ºæ¥æŒ‡å®šçŸ©å½¢å¤§å°çš„éƒ¨åˆ†ï¼Œå…¶ä½™éƒ¨åˆ†ç›´æ¥ä¸¢å¼ƒçš„è¿‡ç¨‹ã€‚è™½ç„¶vImageæ²¡æœ‰æä¾›ç›´æ¥çš„APIæ¥å¤„ç†è¿™ä¸ªæµç¨‹ï¼ˆå½“ç„¶ä½ æ˜¯å¯ä»¥ç”¨vecLibçš„æ–¹æ³•ï¼Œç›´æ¥å¯¹Bitmapè¿›è¡ŒçŸ©é˜µæ“ä½œï¼Œä½†æ˜¯æœ‰ç‚¹è¿‡äºå°é¢˜å¤§åšäº†ï¼‰ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¹³ç§»å˜æ¢èƒ½å¤Ÿæå®šçš„äº‹æƒ…ã€‚æˆ‘ä»¬åªéœ€è¦å¯¹è¾“å…¥ç›®æ ‡çš„åæ ‡çš„<code>CGRect</code>è¿›è¡Œè½¬æ¢ï¼Œå°†åŸå§‹å›¾åƒå¹³ç§»ä¹‹åï¼Œå†é™åˆ¶è¾“å‡ºçš„Bitmapçš„å¤§å°ï¼Œè¿™æ ·å¹³ç§»è¶…å‡ºéƒ¨åˆ†å°±ä¼šè‡ªåŠ¨è¢«è£æ‰ã€‚ä¸éœ€é¢å¤–çš„å¤„ç†ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGRect</span> rect; <span class="comment">// è¾“å…¥çš„ç›®æ ‡rect</span></span><br><span class="line">output_buffer.width = MAX(<span class="built_in">CGRectGetWidth</span>(rect), <span class="number">0</span>); <span class="comment">// è¾“å‡ºå®½åº¦</span></span><br><span class="line">output_buffer.height = MAX(<span class="built_in">CGRectGetHeight</span>(rect), <span class="number">0</span>); <span class="comment">// è¾“å‡ºé«˜åº¦</span></span><br><span class="line">output_buffer.rowBytes = vImageByteAlign(output_buffer.width * <span class="number">4</span>, <span class="number">64</span>);</span><br><span class="line">output_buffer.data = malloc(output_buffer.rowBytes * output_buffer.height);</span><br><span class="line"><span class="keyword">if</span> (!output_buffer.data) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å¹³ç§»æ¥å¤„ç†ï¼ŒXè½´Yè½´åˆ†åˆ«å¹³ç§»è´Ÿå‘çš„minXï¼ŒminYå³å¯</span></span><br><span class="line"><span class="built_in">CGFloat</span> tx = <span class="built_in">CGRectGetMinX</span>(rect);</span><br><span class="line"><span class="built_in">CGFloat</span> ty = <span class="built_in">CGRectGetMinY</span>(rect);</span><br><span class="line"><span class="built_in">CGAffineTransform</span> transform = <span class="built_in">CGAffineTransformMakeTranslation</span>(-tx, -ty);</span><br><span class="line">vImage_CGAffineTransform cg_transform = *((vImage_CGAffineTransform *)&amp;transform);</span><br><span class="line">Pixel_8888 clear_color = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">vImage_Error ret = vImageAffineWarpCG_ARGB8888(&amp;a_buffer, &amp;output_buffer, <span class="literal">NULL</span>, &amp;cg_transform, clear_color, kvImageBackgroundColorFill);</span><br></pre></td></tr></table></figure><h2 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h2><p>é•œåƒé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†å›¾åƒæ²¿ç€æŸä¸ªè½´è¿›è¡Œç¿»è½¬ï¼Œæ¯”å¦‚æ²¿Xè½´å°±æ˜¯æ°´å¹³é•œåƒï¼ŒåŒä¸€ä¸ªåƒç´ ç‚¹ï¼Œå¯¹åº”çš„Xåæ ‡ä¸å˜ï¼ŒYåæ ‡å˜ä¸ºé«˜åº¦å‡å»æœ¬èº«çš„Yåæ ‡å³å¯ã€‚</p><p>vImageå¯¹åº”çš„APIï¼Œæ˜¯<code>vImageVerticalReflect_ARGB8888</code>å’Œ<code>vImageHorizontalReflect_ARGB8888</code>ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚ç›´æ¥ä¸Šä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BOOL</span> horizontal;</span><br><span class="line">__block vImage_Buffer a_buffer = &#123;&#125;, output_buffer = &#123;&#125;;</span><br><span class="line"><span class="comment">// çœç•¥</span></span><br><span class="line">vImage_Error ret;</span><br><span class="line"><span class="keyword">if</span> (horizontal) &#123;</span><br><span class="line">    <span class="comment">// æ°´å¹³é•œåƒ</span></span><br><span class="line">    ret = vImageHorizontalReflect_ARGB8888(&amp;a_buffer, &amp;output_buffer, kvImageHighQualityResampling);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å‚ç›´é•œåƒ</span></span><br><span class="line">    ret = vImageVerticalReflect_ARGB8888(&amp;a_buffer, &amp;output_buffer, kvImageHighQualityResampling);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a>æ—‹è½¬</h2><p>æ—‹è½¬ä¹Ÿæ˜¯éå¸¸å¸¸è§ä¸€ä¸ªå›¾åƒå‡ ä½•å‡ ä½•å˜åŒ–ã€‚å…·ä½“åæ ‡çš„å˜åŒ–å°±æ˜¯å¯¹æ—‹è½¬çš„è§’åº¦ï¼Œæ±‚å¯¹åº”ä¸‰è§’å‡½æ•°åˆ°Xè½´å’ŒYè½´çš„æŠ•å½±ç»“æœï¼Œæ¯”è¾ƒç›´è§‚ã€‚</p><p>vImageå¯¹æ—‹è½¬ä¹Ÿæä¾›äº†ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„APIï¼Œè§’åº¦æ˜¯å¼§åº¦å€¼ï¼ŒæŒ‰ç…§é¡ºæ—¶é’ˆæ–¹å‘è¿›è¡Œã€‚å¦å¤–ï¼Œç”±äºè¾“å‡ºçš„Bufferçš„å¤§å°ä¼šé™åˆ¶å›¾åƒå¤§å°ï¼Œè€Œæ—‹è½¬åå¯èƒ½è¶…å‡ºåŸå›¾å¤§å°ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¾“å‡ºçš„å¤§å°ä¹Ÿè®¡ç®—å‡ºå¯¹åº”çš„æ–°çš„å¤§å°ã€‚ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> radians; <span class="comment">//æ—‹è½¬çš„å¼§åº¦</span></span><br><span class="line"><span class="built_in">CGSize</span> size = <span class="built_in">CGSizeMake</span>(a_buffer.width, a_buffer.height);</span><br><span class="line"><span class="comment">// è¿™é‡Œç›´æ¥å€Ÿç”¨CGçš„æ–¹æ³•æ¥è®¡ç®—æ—‹è½¬åçš„å¤§å°ï¼Œæ–¹ä¾¿</span></span><br><span class="line"><span class="built_in">CGAffineTransform</span> transform = <span class="built_in">CGAffineTransformMakeRotation</span>(radians);</span><br><span class="line">size = <span class="built_in">CGSizeApplyAffineTransform</span>(size, transform);    output_buffer.width = ABS(size.width);</span><br><span class="line">output_buffer.height = ABS(size.height);</span><br><span class="line">output_buffer.rowBytes = vImageByteAlign(output_buffer.width * <span class="number">4</span>, <span class="number">64</span>);</span><br><span class="line">output_buffer.data = malloc(output_buffer.rowBytes * output_buffer.height);</span><br><span class="line"><span class="keyword">if</span> (!output_buffer.data) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">Pixel_8888 clear_color = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">// æ—‹è½¬æ“ä½œï¼Œå¤šä½™éƒ¨åˆ†å¡«å……Clear Color</span></span><br><span class="line">vImage_Error ret = vImageRotate_ARGB8888(&amp;a_buffer, &amp;output_buffer, <span class="literal">NULL</span>, radians, clear_color, kvImageBackgroundColorFill | kvImageHighQualityResampling);</span><br></pre></td></tr></table></figure><h2 id="é”™åˆ‡"><a href="#é”™åˆ‡" class="headerlink" title="é”™åˆ‡"></a>é”™åˆ‡</h2><p><img src="https://raw.githubusercontent.com/dreampiggy/vImageProcessor/master/Example/Screenshot/Screenshot3.png" alt="é”™åˆ‡"></p><p><a href="https://en.wikipedia.org/wiki/Shear_mapping">é”™åˆ‡</a>æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿æ€§å˜æ¢ï¼Œç›´è§‚çš„ä»‹ç»å¯ä»¥ä»Wikipediaä¸Šçœ‹ï¼Œä¹Ÿå¯ä»¥å‚è€ƒä¹‹å‰çš„å¦ä¸€ç¯‡æ•™ç¨‹ã€‚ä¸»è¦çš„å‚æ•°æœ‰ä¸€ä¸ªmå€¼ï¼Œè¡¨ç¤ºå¯¹åº”å‚è€ƒåæ ‡çš„ç¼©æ”¾å€æ•°ã€‚</p><p>åœ¨vImageä¸­ï¼Œé”™åˆ‡å˜æ¢æ˜¯ç›¸å¯¹åº•å±‚çš„æ¥å£ï¼Œå®é™…ä¸Šï¼Œçº¿æ€§å˜æ¢æ˜¯é€šè¿‡è¿™ä¸‰ä¸ªæ¥å£ï¼ˆé”™åˆ‡ã€æ—‹è½¬ã€é•œåƒï¼‰æ¥å®ç°çš„ã€‚é”™åˆ‡çš„æ¥å£ï¼Œæ¯”å¦‚æ°´å¹³é”™åˆ‡å¯¹åº”çš„æ˜¯<code>vImageHorizontalShear_ARGB8888</code>ï¼Œå‚æ•°ç®—æ˜¯æœ€å¤šçš„ä¸€ä¸ªï¼Œç¨å¾®è¯¦ç»†ä»‹ç»ä¸€ä¸‹ï¼š</p><ul><li><code>srcOffsetToROI_X</code>: é”™åˆ‡å®šä½ç‚¹æ°´å¹³åç§»é‡ï¼Œå…·ä½“æŒ‡çš„å°±æ˜¯å·¦ä¸Šè§’é‚£ä¸ªåƒç´ ç‚¹ï¼Œåœ¨ç»è¿‡æ—‹è½¬çš„æ˜ å°„åï¼Œæ°´å¹³åç§»çš„è·ç¦»ï¼Œä¼šå½±å“æœ€åå›¾åƒï¼ˆé™¤å»Bufferçš„å®½åº¦é™åˆ¶ï¼‰çš„æ•´ä½“å®½åº¦</li><li><code>srcOffsetToROI_Y</code>: é”™åˆ‡å®šä½ç‚¹çš„å‚ç›´åç§»é‡ï¼Œç±»ä¼¼æ°´å¹³å€¼</li><li><code>xTranslate</code>: é”™åˆ‡å®Œæˆåçš„æ°´å¹³å¹³ç§»è·ç¦»</li><li><code>shearSlope</code>: é”™åˆ‡çš„å¼§åº¦å€¼ï¼Œé¡ºæ—¶é’ˆ</li><li><code>filter</code>: ç”¨æ¥è‡ªå®šä¹‰é‡é‡‡æ ·çš„æ–¹æ³•ï¼Œä¸€èˆ¬ç”¨è‡ªå¸¦çš„<code>vImageNewResamplingFilter</code>ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆæ„é€ å¯¹åº”çš„é‡é‡‡æ ·è¿‡ç¨‹ã€‚ä¼šç”¨åˆ°ä¸€ä¸ªscaleå‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ªé‡é‡‡æ ·å¯¹åº”çš„ç¼©æ”¾å€æ•°ï¼Œä¹Ÿå°±æ˜¯é”™åˆ‡çš„må€¼</li><li><code>backgroundColor</code>: èƒŒæ™¯å¡«å……è‰²</li></ul><p>å¯¹åº”çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGVector</span> offset; <span class="comment">// å®šä½ç‚¹åç§»é‡</span></span><br><span class="line"><span class="built_in">CGFloat</span> translation; <span class="comment">// æ°´å¹³å¹³ç§»é‡</span></span><br><span class="line"><span class="built_in">CGFloat</span> slope; <span class="comment">// æ—‹è½¬å¼§åº¦</span></span><br><span class="line"><span class="built_in">CGFloat</span> scale; <span class="comment">// å¯¹åº”é”™åˆ‡çš„må€¼</span></span><br><span class="line">output_buffer.width = MAX(a_buffer.width - offset.dx, <span class="number">0</span>); <span class="comment">//è¿™é‡Œéœ€è¦åŒæ—¶å‡å»æ°´å¹³å®šä½ç‚¹çš„åç§»</span></span><br><span class="line">output_buffer.height = MAX(a_buffer.height - offset.dy, <span class="number">0</span>); <span class="comment">// åŒç†</span></span><br><span class="line">output_buffer.rowBytes = vImageByteAlign(output_buffer.width * <span class="number">4</span>, <span class="number">64</span>);</span><br><span class="line">output_buffer.data = malloc(output_buffer.rowBytes * output_buffer.height);</span><br><span class="line"><span class="keyword">if</span> (!output_buffer.data) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">Pixel_8888 clear_color = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">// è¿™é‡Œç¤ºä¾‹å°±ç”¨é»˜è®¤çš„é‡é‡‡æ ·æ–¹æ³•</span></span><br><span class="line">ResamplingFilter resampling_filter = vImageNewResamplingFilter(scale, kvImageHighQualityResampling);</span><br><span class="line">vImage_Error ret;</span><br><span class="line"><span class="keyword">if</span> (horizontal) &#123;</span><br><span class="line">    <span class="comment">// æ°´å¹³é”™åˆ‡</span></span><br><span class="line">    ret = vImageHorizontalShear_ARGB8888(&amp;a_buffer, &amp;output_buffer, offset.dx, offset.dy, translation, slope, resampling_filter, clear_color, kvImageBackgroundColorFill);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å‚ç›´é”™åˆ‡</span></span><br><span class="line">    ret = vImageVerticalShear_ARGB8888(&amp;a_buffer, &amp;output_buffer, offset.dx, offset.dy, translation, slope, resampling_filter, clear_color, kvImageBackgroundColorFill);</span><br><span class="line">&#125;</span><br><span class="line">vImageDestroyResamplingFilter(resampling_filter);</span><br></pre></td></tr></table></figure><h2 id="çº¿æ€§å˜æ¢"><a href="#çº¿æ€§å˜æ¢" class="headerlink" title="çº¿æ€§å˜æ¢"></a>çº¿æ€§å˜æ¢</h2><p>æœ€åå†æ¥è¯´é€šç”¨çš„çº¿æ€§å˜æ¢å§ï¼Œè¿™ä¸ªå…¶å®åœ¨ä¹‹å‰çš„åŠŸèƒ½ä¸­å·²ç»ç”¨åˆ°è¿‡äº†ï¼ŒvImageæœ‰å…¼å®¹Core Graphicsçš„<code>CGAffineTransform</code>çš„ç»“æ„ä½“<code>vImage_CGAffineTransform</code>ï¼Œä¸¤ä¸ªç»“æ„ä½“å¯¹åº”çš„å†…å­˜å¸ƒå±€æ˜¯ä¸€æ ·çš„ï¼Œç›´æ¥å¼ºåˆ¶è½¬æ¢è¿‡å»å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å•ç‹¬èµ‹ä¸€éã€‚å…³äºé€šç”¨çº¿æ€§å˜æ¢çš„å†…å®¹å°±ä¸å†èµ˜è¿°äº†ï¼Œæœ‰å…´è¶£å¯ä»¥æŸ¥çœ‹ç›¸å…³èµ„æ–™ï¼Œæˆ–è€…ä¹‹å‰çš„æ•™ç¨‹ï¼š<a href="http://dreampiggy.com/2016/09/27/core-graphicsfang-she-bian-huan/">Core Graphicsä»¿å°„å˜æ¢çŸ¥è¯†</a></p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGAffineTransform</span> transform; <span class="comment">// è¾“å…¥çš„CGå˜æ¢çŸ©é˜µ</span></span><br><span class="line">vImage_CGAffineTransform cg_transform = *((vImage_CGAffineTransform *)&amp;transform); <span class="comment">// ç»“æ„ä¸€æ ·ï¼Œç›´æ¥å¼ºè½¬</span></span><br><span class="line">Pixel_8888 clear_color = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">// çº¿æ€§å˜æ¢</span></span><br><span class="line">vImage_Error ret = vImageAffineWarpCG_ARGB8888(&amp;a_buffer, &amp;output_buffer, <span class="literal">NULL</span>, &amp;cg_transform, clear_color, kvImageBackgroundColorFill | kvImageHighQualityResampling);</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>vImageæ˜¯ä¸€ä¸ªæ¯”è¾ƒåº•å±‚çš„å›¾åƒBitmapå¤„ç†çš„åº“ï¼Œåœ¨è¿™é‡Œä»‹ç»äº†å…³äºè‰²å½©è½¬æ¢ã€Alphaåˆæˆã€å‡ ä½•å˜æ¢ç­‰åŸºæœ¬çŸ¥è¯†ã€‚ç›¸æ¯”äºç®€å•çš„Core Graphicsçš„å¤„ç†ï¼Œèƒ½å¤Ÿæä¾›æ›´ä¸ºå¤æ‚çš„å‚æ•°æ§åˆ¶ï¼Œå¹¶ä¸”å¸¦æ¥è¾ƒé«˜çš„æ€§èƒ½ã€‚å¯¹äºå¾ˆå¤šå›¾åƒå¯†é›†å¤„ç†è½¯ä»¶å¤„ç†æ¥è¯´ï¼Œç”¨Core Graphicsæ˜¾çš„æ¯”è¾ƒä½æ•ˆï¼Œå› æ­¤å¯ä»¥è€ƒè™‘vImageã€‚</p><p>ä½†æ˜¯vImageå¼ºå¤§ä¹‹å¤„è¿œä¸åœ¨è¿™é‡Œï¼Œé‡Œé¢è¿˜åŒ…å«äº†ç±»ä¼¼å›¾åƒå·ç§¯ï¼Œå½¢æ€å¤„ç†ç­‰ï¼Œå¯ä»¥å¯¹å¤æ‚æ»¤é•œè¿›è¡Œæ”¯æŒï¼Œç±»ä¼¼äº<a href="https://github.com/BradLarson/GPUImage">GPUImage</a>ã€‚è¿™äº›åŠŸèƒ½éƒ½éœ€è¦æ•°å­—å›¾åƒå¤„ç†ç›¸å…³çŸ¥è¯†ï¼Œåœ¨è¿™ç§æ•™ç¨‹ç³»åˆ—å°±ä¸ä¼šä»‹ç»äº†ã€‚</p><p>å¯¹äºè¿™ç¯‡æ•™ç¨‹çš„ç¤ºä¾‹ä»£ç ï¼Œå…¶å®æˆ‘å†™äº†ä¸ªéå¸¸ç®€å•çš„åº“ï¼Œæ”¾åˆ°GitHubä¸Šäº†ï¼š<a href="https://github.com/dreampiggy/vImageProcessor">vImageProcessor</a>ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»å‚è€ƒä¸€ä¸‹ï¼Œå¸Œæœ›èƒ½å¤Ÿç”¨äºè‡ªå·±çš„å›¾ç‰‡å¤„ç†ç›¸å…³æ¡†æ¶ä¸­ã€‚</p><p>ç”±äºè‡ªå·±å®Œå…¨æ˜¯ä¸šä½™å…´è¶£ï¼Œå·¥ä½œå’Œå›¾åƒå¤„ç†åŸºæœ¬ä¸ç›¸å…³ï¼Œå¹¶ä¸æ‰“ç®—æ·±å…¥å­¦ä¹ æ•°å­—å›¾åƒå¤„ç†çš„çŸ¥è¯†ï¼Œå› æ­¤è¿™ä¸ªæ•™ç¨‹å¯èƒ½å°±ä¼šæš‚æ—¶å‘Šä¸€æ®µè½äº†ã€‚æœ€åï¼Œä¹‹æ‰€ä»¥å†™è¿™ç¯‡æ•™ç¨‹ï¼Œæ˜¯å› ä¸ºè‡ªå·±æƒ³è¦å‚è€ƒä¸€ä¸‹vImageçš„æ•™ç¨‹ï¼Œå´å‘ç°åªä¼šæœå‡ºæ¥ä¸€å †äº’ç›¸æŠ„è¢­çš„å†…å®¹ï¼Œè€Œä¸”å¤§éƒ¨åˆ†éƒ½æ˜¯å…³äºå›¾åƒæ»¤é•œçš„ï¼Œå¯¹äºå›¾åƒå¤„ç†æœ¬èº«ä¸ä¼šå¤ªå¤šä»‹ç»ã€‚æˆ‘å¸Œæœ›è¿™ç³»åˆ—æ•™ç¨‹ï¼Œèƒ½ç»™åŒæ ·å¯¹å›¾åƒç¼–è§£ç ã€å›¾åƒå¤„ç†æœ‰ä¸€ç‚¹å…´è¶£çš„äººï¼Œæä¾›ä¸€ä¸ªç›¸å¯¹ç®€å•ä¸”æ¸…æ™°çš„å…¥é—¨æ¦‚è§ˆå§ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ•™ç¨‹ï¼Œæ˜¯ç³»åˆ—æ•™ç¨‹çš„ç¬¬ä¸‰ç¯‡ï¼Œå‰ç¯‡åä¸ºiOSå¹³å°å›¾ç‰‡ç¼–è§£ç å…¥é—¨æ•™ç¨‹ï¼ˆç¬¬ä¸‰æ–¹ç¼–è§£ç ç¯‡ï¼‰ã€‚ç”±äºvImageå·²ç»å±äºè¾ƒä¸ºåº•å±‚æ¡†æ¶ï¼Œè¿™ä¸€ç¯‡å°†ä¸ä¼šç‰¹åˆ«ç€é‡å›¾ç‰‡å°è£…æ ¼å¼çš„ç¼–è§£ç ï¼Œä¼šä»‹ç»ä¸€äº›Bitmapçº§åˆ«çš„æ“ä½œï¼ŒåŒ…æ‹¬äº†å›¾åƒçš„è‰²å½©è½¬æ¢ï¼ŒAlphaåˆæˆã€åŸºæœ¬å‡ ä½•å˜æ¢ç­‰å®é™…ç”¨æ³•ã€‚ç”±äºæ•™ç¨‹ä¾§é‡æ˜¯å›¾åƒæ ¼å¼ï¼Œæ‰€ä»¥ä¸ä¼šä»‹ç»vImageå¼ºå¤§çš„Convolutionç­‰çŸ¥è¯†ï¼Œè¿™æ–¹é¢æ¶‰åŠåˆ°æ•°å­—å›¾åƒå¤„ç†çš„å¤æ‚çŸ¥è¯†ï¼Œä¸æ˜¯æ•™ç¨‹çš„ç›®æ ‡&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;åŸºæœ¬ä»‹ç»&quot;&gt;&lt;a href=&quot;#åŸºæœ¬ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;åŸºæœ¬ä»‹ç»&quot;&gt;&lt;/a&gt;åŸºæœ¬ä»‹ç»&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/library/content/documentation/Performance/Conceptual/vImage/Introduction/Introduction.html&quot;&gt;vImage&lt;/a&gt;æ˜¯Appleçš„Accelerateåº“çš„ä¸€éƒ¨åˆ†ï¼Œä¾§é‡äºé«˜æ€§èƒ½çš„å›¾åƒBitmapçº§åˆ«çš„å¤„ç†ã€‚åº“æœ¬èº«å…¨éƒ¨æ˜¯Cçš„æ¥å£ï¼Œè€Œä¸”ä¸åŒäºCoreç³»åˆ—çš„ï¼ˆCore Graphics/Core Foundationï¼‰Cæ¥å£ï¼Œæ˜¯æ¯”è¾ƒè´´è¿‘ä¼ ç»ŸCè¯­è¨€çš„æ¥å£ï¼Œä¸ä¼šæœ‰XXXRefè¿™ç§è´´å¿ƒçš„å®šä¹‰ï¼Œè€Œä¸”å¾ˆå¤šæ¥å£éœ€è¦è‡ªå·±æ‰‹åŠ¨åˆ†é…å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;vImageæŒ‰ç…§åŠŸèƒ½ï¼Œå¯ä»¥åˆ†ä¸ºAlpha Compositingï¼ˆAlphaåˆæˆï¼‰ã€Geometryï¼ˆå‡ ä½•å˜æ¢ï¼‰ã€Conversionï¼ˆè‰²å½©è½¬æ¢ï¼‰ã€Convolutionï¼ˆå·ç§¯ï¼Œç”¨äºå›¾åƒæ»¤é•œï¼‰Morphologyï¼ˆå½¢æ€å­¦å¤„ç†ï¼‰ç­‰ã€‚è¿™é‡Œä¸»è¦ä»‹ç»çš„ï¼Œå°±æ˜¯è‰²å½©è½¬æ¢ï¼ŒAlphaåˆæˆï¼Œä»¥åŠå‡ ä½•å˜æ¢çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆéœ€è¦å¯¹vImageçš„åŸºæœ¬æ¥å£æœ‰æ‰€äº†è§£ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªæ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vImage_Buffer&lt;/code&gt;: å¯¹åº”Bitmapçš„æ•°æ®ï¼Œåªæœ‰æœ€åŸºæœ¬çš„widthã€heightã€rowBytes(stride)ä»¥åŠdata&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vImage_CGImageFormat&lt;/code&gt;: æ¯ä¸ªvImageçš„åŠŸèƒ½ï¼Œä¼šæä¾›ä¸åŒè‰²å½©æ ¼å¼çš„ç±»ä¼¼æ¥å£ï¼Œæ¯”å¦‚ä¼šæœ‰ARGB8888ï¼ŒPlanar8çš„åŒæ ·åŠŸèƒ½ã€‚è¿™é‡ŒARGB8888æŒ‡çš„æ˜¯ARGBæ’åˆ—ï¼Œæ¯é€šé“å 8ä¸ªBitï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªPiexelå 32Bitã€‚è€ŒvImageè¿˜æœ‰ä¸€ä¸ªå¸¸è§çš„è‰²å½©æ ¼å¼Plane8ï¼ŒæŒ‡çš„æ˜¯åªæœ‰ä¸€ä¸ªé€šé“ï¼ˆå¹³é¢ï¼‰ï¼ŒæŒ‰ç…§é¡ºåºæ’åˆ—ï¼Œæ¯”å¦‚&lt;code&gt;&amp;#123;R, R, R, R&amp;#125;&lt;/code&gt;è¿™æ ·ï¼Œæ›´æ–¹ä¾¿è¿›è¡Œè®¡ç®—&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vImage_Flags&lt;/code&gt;: æ¯ä¸ªvImageæ¥å£ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª&lt;code&gt;flags &lt;/code&gt;å‚æ•°æ¥æ§åˆ¶ä¸€äº›é€‰é¡¹ï¼Œæ¯”å¦‚è¯´å¯ä»¥è‡ªå·±å®šä¹‰å†…å­˜åˆ†é…ï¼ŒèƒŒæ™¯è‰²å¡«å……ç­–ç•¥ï¼Œé‡é‡‡æ ·ç­–ç•¥ç­‰ï¼Œé»˜è®¤çš„æ˜¯&lt;code&gt;kvImageNoFlags&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vImage_Error&lt;/code&gt;: æ¯ä¸ªvImageçš„æ¥å£ï¼Œéƒ½ä¼šè¿”å›è¿™ä¸ªresultï¼Œæ¥è®©ç”¨æˆ·ç¡®è®¤æ˜¯å¦æˆåŠŸï¼Œä»¥åŠå¤±è´¥çš„åŸå› ï¼Œåœ¨Debugä¸‹æ¯”è¾ƒæœ‰å¸®åŠ©&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="Image" scheme="http://dreampiggy.com/tags/Image/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¹³å°å›¾ç‰‡ç¼–è§£ç å…¥é—¨æ•™ç¨‹ï¼ˆç¬¬ä¸‰æ–¹ç¼–è§£ç ç¯‡ï¼‰</title>
    <link href="http://dreampiggy.com/2017/10/30/iOS%E5%B9%B3%E5%8F%B0%E5%9B%BE%E7%89%87%E7%BC%96%E8%A7%A3%E7%A0%81%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%88%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BC%96%E8%A7%A3%E7%A0%81%E7%AF%87%EF%BC%89/"/>
    <id>http://dreampiggy.com/2017/10/30/iOS%E5%B9%B3%E5%8F%B0%E5%9B%BE%E7%89%87%E7%BC%96%E8%A7%A3%E7%A0%81%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%88%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BC%96%E8%A7%A3%E7%A0%81%E7%AF%87%EF%BC%89/</id>
    <published>2017-10-30T18:05:14.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ•™ç¨‹ï¼Œæ˜¯ç³»åˆ—æ•™ç¨‹çš„ç¬¬äºŒç¯‡ï¼Œå‰ç¯‡åä¸ºã€ŠiOSå¹³å°å›¾ç‰‡ç¼–è§£ç å…¥é—¨æ•™ç¨‹ï¼ˆImage/IOç¯‡ï¼‰ã€‹ã€‚è¿™ç¯‡ä¸»è¦è®²ç¬¬ä¸‰æ–¹è§£ç å™¨å¦‚ä½•åœ¨iOSå¹³å°ä¸Šå¤„ç†ï¼ˆå’ŒImage/IOçš„å‡ å¤§è¦ç‚¹ä¸€ä¸€å¯¹åº”ï¼‰ï¼Œæ›´ä¼šä»‹ç»ä¸€äº›åŸºæœ¬çš„Bitmapæ¦‚å¿µï¼Œæ€»ç»“é€šç”¨çš„å¤„ç†æ–¹æ³•ï¼Œæ¯•ç«Ÿæˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸”</p></blockquote><h1 id="ç¬¬ä¸‰æ–¹ç¼–è§£ç "><a href="#ç¬¬ä¸‰æ–¹ç¼–è§£ç " class="headerlink" title="ç¬¬ä¸‰æ–¹ç¼–è§£ç "></a>ç¬¬ä¸‰æ–¹ç¼–è§£ç </h1><p>å¯¹äºå›¾ç‰‡ç¼–è§£ç æ¥è¯´ï¼ŒAppleè‡ªå¸¦çš„Image/IOç¡®å®éå¸¸çš„æ˜“ç”¨ï¼Œä½†æ˜¯å¯¹äºImage/IOä¸æ”¯æŒçš„å›¾åƒæ ¼å¼å°±èƒ½æ— èƒ½ä¸ºåŠ›äº†ã€‚æˆªæ­¢åˆ°iOS 11ï¼ŒImage/IOä¸æ”¯æŒWebPï¼ŒBPGï¼Œå¯¹äºä¸€äº›éœ€è¦ä¾èµ–WebPçš„ä¸šåŠ¡å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼ˆWebPçš„ä¼˜ç‚¹å°±ä¸å†ä»‹ç»äº†ï¼‰ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥è‡ªå·±é›†æˆç¬¬ä¸‰æ–¹çš„å›¾ç‰‡è§£ç å™¨ï¼Œå»æ”¯æŒè¿™äº›éœ€è¦çš„çš„æ ¼å¼ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±æƒ³è¦æ”¯æŒçš„å›¾åƒæ ¼å¼ï¼Œé€‰æ‹©ç›¸å¯¹åº”çš„ç¼–è§£ç å™¨ï¼Œè¿›è¡Œç¼–è§£ç ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥WebPçš„è§£ç åº“<a href="https://developers.google.com/speed/webp/docs/api">libwebp</a>ä¸ºä¾‹å­ï¼Œå…¶ä»–è§£ç å™¨éœ€è¦æ ¹æ®å¯¹åº”è§£ç å™¨çš„APIå¤„ç†ï¼ŒåŸºæœ¬æ¦‚å¿µç±»ä¼¼ã€‚</p><h1 id="è§£ç "><a href="#è§£ç " class="headerlink" title="è§£ç "></a>è§£ç </h1><p>ä¸åƒImage/IOé‚£æ ·å°è£…äº†æ•´å¥—æµç¨‹ï¼Œç¬¬ä¸‰æ–¹è§£ç çš„å…³é”®ä¹‹å¤„ï¼Œå°±æ˜¯åœ¨äºè·å–åˆ°å›¾åƒçš„<a href="https://en.wikipedia.org/wiki/Raster_graphics">Bitmap</a>æ•°æ®ï¼Œé€šå¸¸æƒ…å†µå°±æ˜¯<a href="https://en.wikipedia.org/wiki/RGBA_color_space">RGBA</a>çš„çŸ¢é‡è¡¨ç¤ºã€‚</p><p>ç®€å•è§£é‡Šä¸€ä¸‹ï¼ŒBitmapå¯ä»¥ç†è§£ä¸ºè¿ç»­æ’åˆ—åƒç´ ï¼ˆPixelï¼‰çš„äºŒç»´æ•°ç»„ï¼Œä¸€ä¸ªåƒç´ åŒ…æ‹¬4ä¸ªé€šé“(Components)çš„ç‚¹ï¼Œæ¯ä¸ªç‚¹çš„ä½æ•°å«åšè‰²æ·±ï¼ˆå¸¸è§çš„32ä½è‰²ï¼ŒæŒ‡çš„å°±æ˜¯1ä¸ªåƒç´ æœ‰4é€šé“ï¼Œæ¯ä¸ªé€šé“8ä½ï¼‰ï¼Œè€Œåƒç´ çš„é€šé“æ’åˆ—é¡ºåºæŒ‰ç…§å¯¹åº”çš„RGBA Modeé¡ºåºæ’åˆ—ï¼Œæ¯”å¦‚è¯´RGBA8888ï¼ˆå¤§ç«¯åºï¼‰ï¼Œå°±æ˜¯è¿™æ ·ä¸€ä¸²è¿ç»­çš„å€¼ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;uint8_t red, uint8_t green, uint8_t blue, uint8_t alpha, uint8_t red, uint8_t green, uint8_t blue, uint8_t alpha...&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œåœ¨å†…å­˜ä¸­ï¼Œä¸€èˆ¬å°±å¯ä»¥ç”¨<code>uint8_t bitmap[width * components * 8][height]</code>æ¥è¡¨ç¤ºã€‚</p><p>æœ‰äº†è¿™æ ·çš„çŸ¥è¯†ï¼Œå¯¹ç…§ç€å°±èƒ½çœ‹æ‡‚CGImageçš„BitmapInfoæ‰€è¡¨ç¤ºçš„ä¿¡æ¯äº†ã€‚</p><p><img src="https://developer.apple.com/library/content/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/Art/colorformatrgba32.gif" alt="Bitmapçš„è¡¨ç¤º"></p><h2 id="é™æ€å›¾"><a href="#é™æ€å›¾" class="headerlink" title="é™æ€å›¾"></a>é™æ€å›¾</h2><p>åªè¦Bitmapæ•°æ®åˆ°æ‰‹ï¼Œåé¢çš„è¿‡ç¨‹å…¶å®éƒ½å¤§åŒå°å¼‚ã€‚ç¬¬ä¸‰æ–¹è§£ç å™¨ä¸»è¦å¤„ç†å›¾åƒç¼–ç æ•°æ®åˆ°åŸå§‹Bitmapçš„è§£ç è¿‡ç¨‹ï¼Œåç»­å°±å¯ä»¥é€šè¿‡å›ºå®šçš„æ–¹å¼æ¥å¾—åˆ°CGImageæˆ–è€…UIImageï¼Œç”¨äºä¸Šå±‚UIç»„ä»¶çš„æ¸²æŸ“ã€‚</p><ol><li>ç¬¬ä¸‰æ–¹è§£ç å™¨è·å–å›¾åƒBitmap</li><li>é€šè¿‡Bitmapåˆ›å»ºCGImage</li><li>CGImageé‡ç»˜ï¼ˆå¯é€‰ï¼‰</li><li>ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†</li></ol><h3 id="1-ç¬¬ä¸‰æ–¹è§£ç å™¨è·å–å›¾åƒBitmap"><a href="#1-ç¬¬ä¸‰æ–¹è§£ç å™¨è·å–å›¾åƒBitmap" class="headerlink" title="1. ç¬¬ä¸‰æ–¹è§£ç å™¨è·å–å›¾åƒBitmap"></a>1. ç¬¬ä¸‰æ–¹è§£ç å™¨è·å–å›¾åƒBitmap</h3><p>æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œå¯ä»¥é€‰æ‹©å¯¹åº”çš„ç¼–ç å™¨ï¼Œæ¥è·å–å›¾åƒBitmapã€‚è¿™é‡Œæˆ‘ä»¬ä»¥WebPçš„è§£ç åº“<a href="https://developers.google.com/speed/webp/docs/api">libwebp</a>ä¸ºä¾‹å­ï¼Œå…¶ä»–è§£ç å™¨éœ€è¦æ ¹æ®å¯¹åº”è§£ç å™¨çš„APIå¤„ç†ï¼ŒåŸºæœ¬æ¦‚å¿µç±»ä¼¼ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSData</span> *data; <span class="comment">// å¾…è§£ç çš„å›¾åƒäºŒè¿›åˆ¶æ•°æ®</span></span><br><span class="line"></span><br><span class="line">WebPData webpData;</span><br><span class="line">WebPDataInit(&amp;webpData);</span><br><span class="line">webpData.bytes = data.bytes;</span><br><span class="line">webpData.size = data.length;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–Configï¼Œç”¨äºå­˜å‚¨å›¾åƒçš„Bitmapï¼Œå¤§å°ç­‰ä¿¡æ¯</span></span><br><span class="line">WebPDecoderConfig config;</span><br><span class="line"><span class="keyword">if</span> (!WebPInitDecoderConfig(&amp;config)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿè§£ç </span></span><br><span class="line"><span class="keyword">if</span> (WebPGetFeatures(webpData.bytes, webpData.size, &amp;config.input) != VP8_STATUS_OK) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾å®šè¾“å‡ºçš„Bitmapè‰²å½©ç©ºé—´ï¼Œæœ‰Alphaé€šé“é€‰æ‹©RGBAï¼Œæ²¡æœ‰é€‰æ‹©RGB </span></span><br><span class="line"><span class="type">bool</span> has_alpha = config.input.has_alpha;</span><br><span class="line">config.output.colorspace = has_alpha ? MODE_rgbA : MODE_RGB;</span><br><span class="line">config.options.use_threads = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœŸæ­£å¼€å§‹è§£ç ï¼Œè¾“å‡ºRGBAæ•°æ®åˆ°Configçš„outputä¸­</span></span><br><span class="line"><span class="keyword">if</span> (WebPDecode(webpData.bytes, webpData.size, &amp;config) != VP8_STATUS_OK) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å›¾åƒçš„å¤§å°</span></span><br><span class="line"><span class="type">int</span> width = config.input.width;</span><br><span class="line"><span class="type">int</span> height = config.input.height;</span><br><span class="line"><span class="keyword">if</span> (config.options.use_scaling) &#123;</span><br><span class="line">    width = config.options.scaled_width;</span><br><span class="line">    height = config.options.scaled_height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//RGBAçŸ¢é‡å’Œå¯¹åº”çš„å¤§å°</span></span><br><span class="line">uint8_t *rgba = config.output.u.RGBA.rgb;</span><br><span class="line">size_t rgbaSize = config.output.u.RGBA.size;</span><br></pre></td></tr></table></figure><p>æˆªæ­¢åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šè°ƒç”¨é€šè¿‡ç¬¬ä¸‰æ–¹è§£ç åº“çš„æ¥å£ï¼Œå°±å®Œæˆäº†è·å–Bitmapçš„å·¥ä½œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»¥RGBAæ¥è¯´ï¼Œæœ€å°‘éœ€è¦çŸ¥é“ä»¥ä¸‹ä¿¡æ¯ï¼šå›¾åƒRGBAæ•°ç»„ï¼Œæ•°ç»„å¤§å°ï¼Œå›¾åƒå®½åº¦ã€é«˜åº¦ã€æ˜¯å¦å«æœ‰Alphaé€šé“è¿™å‡ ä¸ªï¼Œä»¥ä¾¿å¼€å§‹ä¸‹ä¸€æ­¥çš„åˆ›å»ºCGImageçš„è¿‡ç¨‹</p><h3 id="2-é€šè¿‡Bitmapåˆ›å»ºCGImage"><a href="#2-é€šè¿‡Bitmapåˆ›å»ºCGImage" class="headerlink" title="2. é€šè¿‡Bitmapåˆ›å»ºCGImage"></a>2. é€šè¿‡Bitmapåˆ›å»ºCGImage</h3><p>æœ‰äº†å›¾åƒçš„Bitmapæ•°æ®ä¹‹åï¼Œå¯ä»¥é€šè¿‡<code>CGImageCreate</code>æ¥ç”ŸæˆCGImageã€‚å¯¹äºRGBAçš„è¾“å…¥ï¼Œéœ€è¦çš„å‚æ•°åŸºæœ¬æ¯”è¾ƒå›ºå®šï¼Œä»¥ä¸‹ä»£ç åŸºæœ¬ä¸Šå¯ä»¥å‚è€ƒæ¥å¤ç”¨ã€‚ï¼ˆéœ€è¦æ³¨æ„ï¼ŒiOSä¸Šåªæ”¯æŒ<a href="https://segmentfault.com/a/1190000002990030">premultiplied-alpha</a>ï¼ŒmacOSå¯ä»¥æ”¯æŒépremultiplied-alphaï¼‰</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡RGBAæ•°ç»„ï¼Œåˆ›å»ºä¸€ä¸ªDataProviderã€‚æœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œç”¨æ¥åœ¨åˆ›å»ºå®Œæˆåæ¸…ç†å†…å­˜ç”¨çš„</span></span><br><span class="line"><span class="built_in">CGDataProviderRef</span> provider = <span class="built_in">CGDataProviderCreateWithData</span>(<span class="literal">NULL</span>, rgba, rgbaSize, FreeImageData);</span><br><span class="line"><span class="comment">// ç›®æ ‡è‰²å½©ç©ºé—´ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨çš„å°±æ˜¯RGBA</span></span><br><span class="line"><span class="built_in">CGColorSpaceRef</span> colorSpaceRef = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line"><span class="comment">// Bitmapæ•°æ®ï¼Œå¦‚æœå«æœ‰Alphaé€šé“ï¼Œè®¾ç½®Premultiplied Alphaã€‚æ²¡æœ‰å°±å¿½ç•¥Alphaé€šé“</span></span><br><span class="line"><span class="built_in">CGBitmapInfo</span> bitmapInfo = has_alpha ? kCGBitmapByteOrder32Big | kCGImageAlphaPremultipliedLast : kCGBitmapByteOrder32Big | kCGImageAlphaNoneSkipLast;</span><br><span class="line"><span class="comment">// é€šé“æ•°ï¼Œæœ‰alphaå°±æ˜¯4ï¼Œæ²¡æœ‰å°±æ˜¯3</span></span><br><span class="line">size_t components = has_alpha ? <span class="number">4</span> : <span class="number">3</span>;</span><br><span class="line"><span class="comment">// è¿™ä¸ªæ˜¯ç”¨æ¥åšè‰²å½©ç©ºé—´å˜æ¢çš„æŒ‡ç¤ºï¼Œå¦‚æœè¶…å‡ºè‰²å½©ç©ºé—´ï¼Œæ¯”å¦‚P3è½¬RGBAï¼Œé»˜è®¤ä¼šè¿›è¡Œå…¼å®¹è½¬æ¢</span></span><br><span class="line"><span class="built_in">CGColorRenderingIntent</span> renderingIntent = kCGRenderingIntentDefault;</span><br><span class="line"><span class="comment">// æ¯è¡Œå­—èŠ‚æ•°ï¼ˆRGBAæ•°ç»„å°±æ˜¯è¿ç»­æ’åˆ—çš„å¤šç»´æ•°ç»„ï¼Œä¸€è¡Œå°±æ˜¯å®½åº¦*é€šé“æ•°ï¼‰ï¼Œåˆå«åšstrideï¼Œå› ä¸ºBitmapæœ¬è´¨å°±æ˜¯Pixel(uint_8)çš„äºŒç»´æ•°ç»„ï¼Œéœ€è¦çŸ¥é“ä½•æ—¶åˆ†è¡Œ</span></span><br><span class="line">size_t bytesPerRow = components * width;</span><br><span class="line"><span class="comment">// åˆ›å»ºCGImageï¼Œå‚æ•°åˆ†åˆ«æ„ä¹‰ä¸ºï¼šå®½åº¦ï¼Œé«˜åº¦ï¼Œæ¯é€šé“çš„Bitæ•°ï¼ˆRGBAè‡ªç„¶æ˜¯256ï¼Œå¯¹åº”8Bitï¼‰ï¼Œæ¯è¡Œå­—èŠ‚æ•°ï¼Œè‰²å½©ç©ºé—´ï¼ŒBitmapä¿¡æ¯ï¼Œæ•°æ®Providerï¼Œè§£ç æ•°ç»„ï¼ˆè¿™ä¸ªä¼ NULLå³å¯ï¼Œå…¶ä»–å€¼çš„è¯ï¼Œä¼šå°†ç»è¿‡å˜æ¢æ¯”å¦‚premultiplied-alphaä¹‹åçš„Bitmapå†™å›è¿™ä¸ªæ•°ç»„ï¼‰ï¼Œæ˜¯å¦è¿‡æ»¤æ’å€¼ï¼ˆè¿™ä¸ªä¸€èˆ¬ä¸ç”¨å¼€ï¼Œå¯ä»¥åœ¨ä¸“é—¨çš„å›¾åƒé”åŒ–é‡Œé¢æï¼‰ï¼Œè‰²å½©ç©ºé—´å˜æ¢æŒ‡ç¤º</span></span><br><span class="line"><span class="built_in">CGImageRef</span> imageRef = <span class="built_in">CGImageCreate</span>(width, height, <span class="number">8</span>, components * <span class="number">8</span>, bytesPerRow, colorSpaceRef, bitmapInfo, provider, <span class="literal">NULL</span>, <span class="literal">NO</span>, renderingIntent);</span><br><span class="line"><span class="comment">// åˆ«å¿˜äº†æ¸…ç†DataProviderï¼Œæ­¤æ—¶ä¼šè°ƒç”¨ä¹‹å‰ä¼ å…¥çš„æ¸…ç†å‡½æ•°</span></span><br><span class="line"><span class="built_in">CGDataProviderRelease</span>(provider);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="type">void</span> FreeImageData(<span class="type">void</span> *info, <span class="keyword">const</span> <span class="type">void</span> *data, size_t size) &#123;</span><br><span class="line">    free((<span class="type">void</span> *)data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-CGImageé‡ç»˜"><a href="#3-CGImageé‡ç»˜" class="headerlink" title="3. CGImageé‡ç»˜"></a>3. CGImageé‡ç»˜</h3><p>è¿™ä¸€æ­¥å…¶å®æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯å»ºè®®éƒ½åŠ ä¸Šè¿™ä¸€æ­¥éª¤ã€‚è™½ç„¶æˆ‘ä»¬ä¹‹å‰é€šè¿‡RGBAåˆ›å»ºäº†CGImageï¼Œä½†æ˜¯å®é™…ä¸Šï¼ŒCALayerå’Œä¸Šå±‚çš„UIImageViewè¿™äº›æ¸²æŸ“çš„æ—¶å€™ï¼Œè¦æ±‚çš„è‰²å½©æ˜¯é™å®šçš„ï¼Œä¸ç„¶ä¼šæœ‰é¢å¤–çš„å†…å­˜å’Œæ¸²æŸ“æ¶ˆè€—ï¼Œæˆ‘ä»¬è§£ç å‡ºæ¥çš„rgbaçš„æ ¼å¼å¯èƒ½å¹¶ä¸æ˜¯æŒ‰ç…§è¿™æ ·çš„è‰²å½©ç©ºé—´æ’åˆ—ï¼Œå› æ­¤å»ºè®®è¿›è¡Œä¸€æ¬¡é‡ç»˜ï¼Œå³å°†CGImageé‡ç»˜åˆ°ä¸€ä¸ªCGBitmapContextä¹‹ä¸Šã€‚è¿™ä¸ªä»£ç æ¯”è¾ƒç®€å•ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGImageRef</span> imageRef;</span><br><span class="line">size_t canvasWidth = <span class="built_in">CGImageGetWidth</span>(imageRef)</span><br><span class="line">size_t canvasHeight = <span class="built_in">CGImageGetHeight</span>(imageRef)</span><br><span class="line"><span class="built_in">CGBitmapInfo</span> bitmapInfo;</span><br><span class="line"><span class="keyword">if</span> (! has_alpha) &#123;</span><br><span class="line">    bitmapInfo = kCGBitmapByteOrder32Big | kCGImageAlphaNoneSkipLast;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    bitmapInfo = kCGBitmapByteOrder32Big | kCGImageAlphaPremultipliedLast;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°æ„æ€å¾ˆç®€å•ï¼Œç”±äºæ²¡æœ‰æ•°æ®ï¼Œå¯¹äºRGBAå¯ä»¥è‡ªåŠ¨è®¡ç®—bytesPerRow</span></span><br><span class="line"><span class="built_in">CGContextRef</span> canvas = <span class="built_in">CGBitmapContextCreate</span>(<span class="literal">NULL</span>, canvasWidth, canvasHeight, <span class="number">8</span>, <span class="number">0</span>, <span class="built_in">CGColorSpaceCreateDeviceRGB</span>(), bitmapInfo);</span><br><span class="line"><span class="keyword">if</span> (!canvas) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="built_in">CGImageRef</span> imageRef = image.CGImage;</span><br><span class="line">size_t width = <span class="built_in">CGImageGetWidth</span>(imageRef);</span><br><span class="line">size_t height = <span class="built_in">CGImageGetHeight</span>(imageRef);</span><br><span class="line"><span class="comment">// ç”»CGImageä¸Šå»</span></span><br><span class="line"><span class="built_in">CGContextDrawImage</span>(canvas, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, width, height), imageRef);</span><br><span class="line"><span class="built_in">CGImageRef</span> newImageRef = <span class="built_in">CGBitmapContextCreateImage</span>(canvas);</span><br></pre></td></tr></table></figure><h3 id="4-ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†"><a href="#4-ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†" class="headerlink" title="4. ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†"></a>4. ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†</h3><p>æœ‰äº†æœ€ç»ˆçš„ç”¨äºæ˜¾ç¤ºCGImageï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªUIImageæ¥ç»™UIç»„ä»¶æ˜¾ç¤ºäº†ã€‚æ³¨æ„å¦‚æœéœ€è¦æœ‰ç‰¹æ®Šçš„scaleï¼Œorientationå¤„ç†ï¼ˆæ¯”å¦‚è¯´å›¾åƒå¯èƒ½æœ‰é¢å¤–çš„EXIF Orientationä¿¡æ¯ï¼‰ï¼Œéœ€è¦åœ¨è¿™ä¸€æ­¥åŠ ä¸Šã€‚<br>ç”±äºæ˜¯Cæ¥å£ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†å†…å­˜ï¼Œé™¤äº†CGImageç›¸å…³çš„ï¼Œä¹Ÿéœ€è¦æ¸…ç†ç¬¬ä¸‰æ–¹åº“è‡ªå·±çš„å†…å­˜åˆ†é…ã€‚å¯¹äºé”™è¯¯æå‰è¿”å›çš„æ¸…ç†å†…å­˜ï¼Œçµæ´»è¿ç”¨<code>__attribute__((cleanup))</code>ï¼Œè®¾ç½®ä¸€ä¸ªè¿”å›å‡½æ•°å‰æ¸…ç†çš„Blockï¼Œå¯ä»¥å‡å°‘çŠ¯é”™çš„å¯èƒ½æ€§</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithCGImage:imageRef scale:<span class="number">1</span> orientation:<span class="built_in">UIImageOrientationUp</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å„ç§æ¸…ç†ï¼Œçœç•¥</span></span><br><span class="line"><span class="built_in">CGImageRelease</span>(newImageRef);</span><br><span class="line"><span class="built_in">CGContextRelease</span>(canvas);</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€å›¾"><a href="#åŠ¨æ€å›¾" class="headerlink" title="åŠ¨æ€å›¾"></a>åŠ¨æ€å›¾</h2><p>åŠ¨æ€å›¾çš„è§£ç è¿‡ç¨‹ï¼Œå…¶å®å¾ˆç›´è§‚çš„æƒ³ï¼Œæˆ‘ä»¬ç›®æ ‡å°±æ˜¯éœ€è¦å¯¹æ‰€æœ‰åŠ¨å›¾å¸§ï¼Œéƒ½æ‹¿åˆ°Bitmapï¼Œè§£ç åˆ°CGImageå’ŒUIImageå°±è¡Œäº†ã€‚è¿™æ ·æƒ³çš„è¯ï¼Œå…¶å®æ­¥éª¤å°±æ¯”è¾ƒæ˜ç¡®äº†ã€‚</p><p>æ­¥éª¤ï¼š</p><ol><li>ç¬¬ä¸‰æ–¹è§£ç å™¨ç”Ÿæˆæ¯å¸§çš„Bitmap</li><li>é‡å¤é™æ€å›¾çš„2-3</li><li>ç”ŸæˆåŠ¨å›¾UIImageï¼ˆå‚è€ƒImage/IOï¼‰</li></ol><h3 id="1-ç¬¬ä¸‰æ–¹è§£ç å™¨ç”Ÿæˆæ¯å¸§çš„Bitmap"><a href="#1-ç¬¬ä¸‰æ–¹è§£ç å™¨ç”Ÿæˆæ¯å¸§çš„Bitmap" class="headerlink" title="1. ç¬¬ä¸‰æ–¹è§£ç å™¨ç”Ÿæˆæ¯å¸§çš„Bitmap"></a>1. ç¬¬ä¸‰æ–¹è§£ç å™¨ç”Ÿæˆæ¯å¸§çš„Bitmap</h3><p>ä¸åŒè§£ç å™¨å¯èƒ½å¯¹äºåŠ¨å›¾æœ‰ç‰¹æ®Šçš„è§£ç è¿‡ç¨‹ï¼Œæ‹¿libwebpä¸¾ä¾‹æ¥è¯´ï¼Œlibwebpçš„åŠ¨å›¾ï¼Œéœ€è¦ç”¨åˆ°å®ƒçš„demuxæ¨¡å—ï¼Œå…¶ä»–è§£ç å™¨è‡ªè¡Œå‚è€ƒå¯¹åº”çš„APIã€‚</p><p>åŒæ—¶ï¼Œè¿™é‡Œéœ€è¦é¢å¤–ä»‹ç»ä¸€äº›æ¦‚å¿µã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒåŠ¨å›¾æ ¼å¼çš„è¯ä¸ä¼šç›´æ¥å°†æ¯å¸§åŸå§‹çš„Bitmapéƒ½ç¼–ç åˆ°æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å¾—åˆ°çš„æ–‡ä»¶è¿‡äºåºå¤§ï¼ˆå¸§æ•° * æ¯å¸§Bitmapï¼‰ã€‚å› æ­¤ï¼Œä¼šæœ‰Dispose Methodçš„æ–¹å¼ï¼ˆå¯ä»¥å‚è€ƒWebPè§„èŒƒ<a href="https://developers.google.com/speed/webp/docs/riff_container">Disposal method (D): 1 bit</a>ï¼Œ<a href="https://blog.ibireme.com/2015/11/02/mobile_image_benchmark/">ç§»åŠ¨ç«¯å›¾ç‰‡æ ¼å¼è°ƒç ”</a>ï¼‰ã€‚ç®€å•ç‚¹æ¥è¯´ï¼Œå¯¹äºåŠ¨å›¾æ¥è¯´ï¼Œæ¯ä¸€å¸§æœ‰ä¸€ä¸ªå‚è€ƒç”»å¸ƒï¼Œåœ¨å‰ä¸€å¸§ç”»å®Œä»¥åï¼Œåä¸€å¸§å¯ä»¥åˆ©ç”¨å‰ä¸€å¸§å·²ç”»å¥½çš„å›¾åƒï¼Œä»…ä»…æ”¹å˜å‰åå˜åŒ–çš„éƒ¨åˆ†ï¼Œä»è€Œå‡å°æ•´ä½“å¤§å°ã€‚å› æ­¤æˆ‘ä»¬åˆ›å»ºåŠ¨å›¾æ—¶ï¼Œéœ€è¦å‡†å¤‡å¥½ä¸€ä¸ªCGBitmapContextå½“ä½œç”»å¸ƒï¼Œæ ¹æ®Disposal Methodï¼ˆå¦‚æœä¸ºNoneï¼Œä¸æ¸…ç©ºcanvasï¼›å¦‚æœä¸ºBackgroundï¼Œæ¸…ç©ºä¸ºBackground Colorï¼Œä¸€èˆ¬å°±æ˜¯ç›´æ¥æ¸…ç©ºæˆé€æ˜ï¼‰</p><p>æœ‰äº†æ‰€æœ‰å¸§çš„Bitmapåï¼Œè½¬æˆCGImageï¼ŒUIImageï¼Œæœ€åç”ŸæˆåŠ¨å›¾UIImageï¼Œè¿™ä¸ªåœ¨ç³»åˆ—å‰ç¯‡å·²ç»ä»‹ç»è¿‡äº†ï¼Œä¸å†èµ˜è¿°</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)decodeWebP &#123;</span><br><span class="line"><span class="comment">// å‰æœŸå‡†å¤‡ä»£ç ï¼Œç›´æ¥ç•¥è¿‡ï¼Œå‡è®¾å·²ç»åˆ›å»ºå¥½canvas</span></span><br><span class="line">WebPDemuxer *demuxer;</span><br><span class="line">WebPIterator iter;</span><br><span class="line"><span class="keyword">if</span> (!WebPDemuxGetFrame(demuxer, <span class="number">1</span>, &amp;iter)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSMutableArray</span>&lt;<span class="built_in">UIImage</span> *&gt; *images = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line"><span class="type">double</span> durations[frameCount];</span><br><span class="line">    </span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> drawnWebpImageWithCanvas:canvas iterator:iter];</span><br><span class="line">        <span class="type">int</span> duration = iter.duration;</span><br><span class="line">        [images addObject:image];</span><br><span class="line">        durations[frame_num] = duration;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125; <span class="keyword">while</span> (WebPDemuxNextFrame(&amp;iter));</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºUIImageåŠ¨å›¾ï¼Œå’ŒImage/IOçš„ç›¸åŒï¼Œè¿™é‡Œå°±ç›´æ¥å°è£…æˆæ–¹æ³•ï¼Œç•¥è¿‡</span></span><br><span class="line"><span class="built_in">UIImage</span> *animatedImage = [<span class="keyword">self</span> animatedImageWithImages:images durations:durations];</span><br><span class="line">    </span><br><span class="line"><span class="comment">// æ¸…ç†â€¦â€¦ç•¥</span></span><br><span class="line">WebPDemuxReleaseIterator(&amp;iter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)drawnWebpImageWithCanvas:(<span class="built_in">CGContextRef</span>)canvas iterator:(WebPIterator)iter &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ˜¯è°ƒç”¨çš„å‰é¢é™æ€å›¾ç»˜åˆ¶çš„æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> rawWebpImageWithData:iter.fragment];</span><br><span class="line">    <span class="keyword">if</span> (!image) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    size_t canvasWidth = <span class="built_in">CGBitmapContextGetWidth</span>(canvas);</span><br><span class="line">    size_t canvasHeight = <span class="built_in">CGBitmapContextGetHeight</span>(canvas);</span><br><span class="line">    <span class="built_in">CGSize</span> size = <span class="built_in">CGSizeMake</span>(canvasWidth, canvasHeight);</span><br><span class="line">    <span class="built_in">CGFloat</span> tmpX = iter.x_offset;</span><br><span class="line">    <span class="built_in">CGFloat</span> tmpY = size.height - iter.height - iter.y_offset;</span><br><span class="line">    <span class="built_in">CGRect</span> imageRect = <span class="built_in">CGRectMake</span>(tmpX, tmpY, iter.width, iter.height);</span><br><span class="line">    <span class="comment">// Blend</span></span><br><span class="line">    <span class="type">BOOL</span> shouldBlend = iter.blend_method == WEBP_MUX_BLEND;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœBlendModeå¼€å¯ï¼Œè¯¥å¸§åº”å½“æ··åˆç”»ç”»å¸ƒä¸Šï¼Œå¦åˆ™ï¼Œåº”è¯¥è¦†ç›–ï¼Œä¹Ÿå°±æ˜¯æ¸…ç©ºæŒ‡å®šèŒƒå›´åå†é‡ç”»</span></span><br><span class="line">    <span class="keyword">if</span> (!shouldBlend) &#123;</span><br><span class="line">        <span class="built_in">CGContextClearRect</span>(canvas, imageRect);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CGContextDrawImage</span>(canvas, imageRect, image.CGImage);</span><br><span class="line">    <span class="built_in">CGImageRef</span> newImageRef = <span class="built_in">CGBitmapContextCreateImage</span>(canvas);</span><br><span class="line">    </span><br><span class="line">    image = [<span class="built_in">UIImage</span> imageWithCGImage:newImageRef];</span><br><span class="line">    <span class="built_in">CGImageRelease</span>(newImageRef);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Disposeå¦‚æœæ˜¯Backgroundï¼Œè¡¨ç¤ºè§£ç ä¸‹ä¸€å¸§éœ€è¦æ¸…ç©ºç”»å¸ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (iter.dispose_method == WEBP_MUX_DISPOSE_BACKGROUND) &#123;</span><br><span class="line">        <span class="built_in">CGContextClearRect</span>(canvas, imageRect);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¸è¿›å¼è§£ç "><a href="#æ¸è¿›å¼è§£ç " class="headerlink" title="æ¸è¿›å¼è§£ç "></a>æ¸è¿›å¼è§£ç </h2><p>æ¸è¿›å¼è§£ç çš„æ¦‚å¿µï¼Œåœ¨ç³»åˆ—å‰ç¯‡ä¸­å·²ç»ä»‹ç»è¿‡äº†ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç¬¬ä¸‰æ–¹è§£ç å™¨æ”¯æŒæ¸è¿›å¼è§£ç çš„æ¥å£éƒ½æ¯”è¾ƒç±»ä¼¼ï¼Œé€šè¿‡æä¾›äºŒè¿›åˆ¶æµä¸æ–­è¿›è¡ŒUpdateï¼Œæ¯æ¬¡èƒ½å¤Ÿå¾—åˆ°å½“å‰è§£ç çš„éƒ¨åˆ†çš„Bitmapï¼Œæœ€åå¯ä»¥æ‹¿åˆ°å®Œæ•´çš„Bitmapã€‚ä¹‹ååªéœ€è¦å‚è€ƒé™æ€å›¾å¯¹åº”æ­¥éª¤å³å¯ã€‚</p><p>è¿™é‡Œè¿˜æ˜¯ä»¥libwebpçš„æ¥å£ä¸ºä¾‹ï¼Œlibwebpéœ€è¦ä½¿ç”¨å®ƒçš„WebPIDecoderæ¥å£ï¼Œæ¥ä¸“é—¨è¿›è¡Œæ¸è¿›å¼è§£ç ã€‚æ³¨æ„ï¼Œlibwebpæ¸è¿›å¼è§£ç å‡ºæ¥çš„Bitmapä¸ä¼šå°†æœªè§£ç çš„éƒ¨åˆ†è‡ªåŠ¨å¡«ç©ºï¼Œä¼šä¿ç•™éšæœºçš„å†…å­˜åœ°å€ç½®ï¼Œè¦ä¹ˆæ‰‹åŠ¨æ¸…ç©ºï¼Œè¦ä¹ˆç”»çš„æ—¶å€™ä»…ä»…ç”»è§£ç å‡ºæ¥çš„é«˜åº¦éƒ¨åˆ†ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSData</span> *data; <span class="comment">// è¾“å…¥çš„åŸå§‹å›¾åƒæ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®</span></span><br><span class="line"><span class="built_in">UIImage</span> *image;</span><br><span class="line">WebPIDecoder *idec = WebPINewRGB(MODE_rgbA, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (!idec) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œéœ€è¦æ›´æ–°å…¨éƒ¨çš„æ•°æ®ï¼Œå½“ç„¶libwebpä¹Ÿæœ‰ä»…ä»…æ›´æ–°æ–°å¢æ•°æ®ï¼ˆéå…¨éƒ¨ï¼‰çš„æ¥å£</span></span><br><span class="line">VP8StatusCode status = WebPIUpdate(idec, data.bytes, data.length);</span><br><span class="line"><span class="keyword">if</span> (status != VP8_STATUS_OK &amp;&amp; status != VP8_STATUS_SUSPENDED) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="type">int</span> width = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> height = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> last_y = <span class="number">0</span>; <span class="comment">// å·²ç»è§£ç å‡ºæ¥çš„Bitmapæ•°æ®çš„é«˜åº¦ï¼Œå³å¯¹åº”æœ‰æ•ˆBitmapçš„è¡Œæ•°</span></span><br><span class="line"><span class="type">int</span> stride = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// ç„¶åå¯ä»¥æ‹¿åˆ°Bitmapæ•°æ®å’Œç›¸åº”çš„å›¾åƒä¿¡æ¯äº†</span></span><br><span class="line">uint8_t *rgba = WebPIDecGetRGB(_idec, &amp;last_y, &amp;width, &amp;height, &amp;stride);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å’Œé™å›¾è§£ç çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œæ„é€ ä¸€ä¸ªDataProviderï¼Œç•¥è¿‡</span></span><br><span class="line"><span class="built_in">CGDataProviderRef</span> provider;</span><br><span class="line"><span class="built_in">CGBitmapInfo</span> bitmapInfo = kCGBitmapByteOrder32Big | kCGImageAlphaPremultipliedLast;</span><br><span class="line">size_t components = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œè¯´ä¸€ä¸ªå‘ï¼Œlibwebpä¸èƒ½ä¿è¯last_yä»¥ä¸‹çš„æ•°æ®æ˜¯å…¨ç©ºçš„ï¼Œæ‰€ä»¥ä¸€å®šæ³¨æ„ï¼Œä»…ä»…è§£ç last_yèŒƒå›´å†…çš„Bitmap</span></span><br><span class="line"><span class="built_in">CGImageRef</span> imageRef = <span class="built_in">CGImageCreate</span>(width, last_y, <span class="number">8</span>, components * <span class="number">8</span>, components * width, <span class="built_in">CGColorSpaceCreateDeviceRGB</span>(), bitmapInfo, provider, <span class="literal">NULL</span>, <span class="literal">NO</span>, kCGRenderingIntentDefault);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºäº†èƒ½å¾—åˆ°å®Œæ•´çš„å›¾ç‰‡é«˜åº¦ï¼Œåˆ›å»ºä¸€ä¸ªcanvasæ¥ç”»å›¾ï¼Œä¸ç”»çš„éƒ¨åˆ†ä¿æŒé€æ˜çŠ¶æ€å³å¯</span></span><br><span class="line"><span class="built_in">CGContextRef</span> canvas = <span class="built_in">CGBitmapContextCreate</span>(<span class="literal">NULL</span>, width, height, <span class="number">8</span>, <span class="number">0</span>, <span class="built_in">CGColorSpaceCreateDeviceRGB</span>(), bitmapInfo);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»…ä»…ç”»last_yé«˜åº¦çš„å›¾åƒï¼ˆä¸æ˜¯å…¨éƒ¨ï¼‰ï¼Œæ³¨æ„CoreGraphicsçš„åæ ‡ç³»ç»Ÿæ˜¯å³æ‰‹ç³»çš„ï¼Œä¸UIKitçš„åæ ‡ç›¸å</span></span><br><span class="line"><span class="built_in">CGContextDrawImage</span>(canvas, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, height - last_y, width, last_y), imageRef);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹¿åˆ°CGImage</span></span><br><span class="line"><span class="built_in">CGImageRef</span> newImageRef = <span class="built_in">CGBitmapContextCreateImage</span>(canvas);</span><br><span class="line"><span class="comment">// åˆ›å»ºUIImage</span></span><br><span class="line">image = [[<span class="built_in">UIImage</span> alloc] initWithCGImage:newImageRef];</span><br><span class="line"><span class="comment">// å„ç§æ¸…ç†ï¼Œçœç•¥</span></span><br></pre></td></tr></table></figure><h1 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h1><p>ç¼–ç è¿‡ç¨‹å…¶å®æ¯”è§£ç è¿‡ç¨‹è¦ç®€å•å¾—å¤šï¼Œå› ä¸ºå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå¸¦çš„æ¥å£ï¼Œç›´æ¥æ‹¿åˆ°å½“å‰UIImageçš„Bitmapæ•°æ®ï¼Œå› æ­¤åªè¦å°†Bitmapäº¤ç»™ç¬¬ä¸‰æ–¹ç¼–ç åº“æ¥è¿›è¡Œç¼–ç ï¼Œæœ€åè¾“å‡ºæ•°æ®å³å¯ã€‚</p><h2 id="é™æ€å›¾-1"><a href="#é™æ€å›¾-1" class="headerlink" title="é™æ€å›¾"></a>é™æ€å›¾</h2><p>é™æ€å›¾çš„è¿‡ç¨‹å…¶å®å°±å¯ä»¥ç›´æ¥åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>UIImageè·å–Bitmap</li><li>è°ƒç”¨ç¼–ç å™¨è¿›è¡Œç¼–ç </li></ol><h3 id="1-UIImageè·å–Bitmap"><a href="#1-UIImageè·å–Bitmap" class="headerlink" title="1. UIImageè·å–Bitmap"></a>1. UIImageè·å–Bitmap</h3><p>UIImageæœ¬èº«èƒ½å¤Ÿç›´æ¥é€šè¿‡æ–¹æ³•æ‹¿åˆ°å¯¹åº”çš„CGImageï¼Œè¿™æ ·åªéœ€è¦è°ƒç”¨<code>CGImageGetDataProvider</code>å°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„Bitmapæ•°æ®çš„DataProvideräº†ï¼Œç›´æ¥ä¸Šä»£ç å§ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImage</span> *image;</span><br><span class="line"><span class="built_in">NSData</span> *webpData; <span class="comment">// Bitmapæ•°æ®çš„å®¹å™¨</span></span><br><span class="line"><span class="built_in">CGImageRef</span> imageRef = image.CGImage;</span><br><span class="line">    </span><br><span class="line">size_t width = <span class="built_in">CGImageGetWidth</span>(imageRef);</span><br><span class="line">size_t height = <span class="built_in">CGImageGetHeight</span>(imageRef);    </span><br><span class="line">size_t bytesPerRow = <span class="built_in">CGImageGetBytesPerRow</span>(imageRef); <span class="comment">// å¤§éƒ¨åˆ†ç¼–ç å™¨éœ€è¦çŸ¥é“bytesPerRowï¼Œæˆ–è€…å«åšstride</span></span><br><span class="line"><span class="built_in">CGDataProviderRef</span> dataProvider = <span class="built_in">CGImageGetDataProvider</span>(imageRef);</span><br><span class="line"><span class="built_in">CFDataRef</span> dataRef = <span class="built_in">CGDataProviderCopyData</span>(dataProvider);</span><br><span class="line">uint8_t *rgba = (uint8_t *)<span class="built_in">CFDataGetBytePtr</span>(dataRef);</span><br></pre></td></tr></table></figure><h3 id="2-è°ƒç”¨ç¼–ç å™¨è¿›è¡Œç¼–ç "><a href="#2-è°ƒç”¨ç¼–ç å™¨è¿›è¡Œç¼–ç " class="headerlink" title="2. è°ƒç”¨ç¼–ç å™¨è¿›è¡Œç¼–ç "></a>2. è°ƒç”¨ç¼–ç å™¨è¿›è¡Œç¼–ç </h3><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥libwebpæ¥å¯¹WebPè¿›è¡Œç¼–ç ï¼Œlibwebpå¯¹äºé™æ€å›¾ç‰‡çš„ç¼–ç éå¸¸ç®€å•ï¼ˆåŠ¨æ€å›¾ç‰‡éœ€è¦è°ƒç”¨å¦ä¸€å¥—muxçš„APIï¼Œåœ¨åŠ¨å›¾ç« èŠ‚è®²ï¼‰</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">uint8_t *data = <span class="literal">NULL</span>; <span class="comment">//ç¼–ç è¾“å‡ºçš„äºŒè¿›åˆ¶æ•°æ®</span></span><br><span class="line"><span class="type">float</span> quality = <span class="number">100.0</span>; <span class="comment">// libwebpå¯ä»¥é€‰æ‹©ç¼–ç è´¨é‡ï¼Œå½±å“è¾“å‡ºæ–‡ä»¶å¤§å°å’Œç¼–ç é€Ÿåº¦</span></span><br><span class="line">size_t size = WebPEncodeRGBA(rgba, (<span class="type">int</span>)width, (<span class="type">int</span>)height, (<span class="type">int</span>)bytesPerRow, quality, &amp;data);</span><br><span class="line"><span class="built_in">CFRelease</span>(dataRef); <span class="comment">// ç¼–ç åæ¸…ç†Bitmapæ•°æ®</span></span><br><span class="line">rgba = <span class="literal">NULL</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (size) &#123;</span><br><span class="line">    <span class="comment">// success</span></span><br><span class="line">    webpData = [<span class="built_in">NSData</span> dataWithBytes:data length:size];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (data) &#123;</span><br><span class="line">    WebPFree(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€å›¾-1"><a href="#åŠ¨æ€å›¾-1" class="headerlink" title="åŠ¨æ€å›¾"></a>åŠ¨æ€å›¾</h2><p>å¯¹äºåŠ¨æ€å›¾æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯å°†å¤šå¸§çš„Bitmapè¾“å…¥åˆ°ç¼–ç å™¨å³å¯ã€‚å¯¹äºlibwebpçš„åŠ¨æ€å›¾ç¼–ç ï¼Œéœ€è¦åˆ©ç”¨åˆ°å®ƒçš„muxæ¨¡å—ï¼Œå®ƒèƒ½å¤Ÿå°†å¤šä¸ªç¼–ç æˆWebPçš„äºŒè¿›åˆ¶æµï¼Œæœ€åmuxåˆå¹¶ä¸€æ¬¡ï¼Œæœ€ç»ˆå¾—åˆ°äº†åŠ¨æ€WebPã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨ä¹‹å‰çš„é™æ€å›¾ç¼–ç çš„æ­¥éª¤ï¼Œåªéœ€è¦ä¾æ¬¡éå†å–å›¾å¹¶ç¼–ç ï¼Œæœ€åä½¿ç”¨muxå¤„ç†å³å¯ã€‚</p><p>æ­¥éª¤ï¼š</p><ol><li>éå†æ¯å¸§Bitmapï¼Œç¼–ç </li></ol><h3 id="1-éå†æ¯å¸§Bitmapï¼Œç¼–ç "><a href="#1-éå†æ¯å¸§Bitmapï¼Œç¼–ç " class="headerlink" title="1. éå†æ¯å¸§Bitmapï¼Œç¼–ç "></a>1. éå†æ¯å¸§Bitmapï¼Œç¼–ç </h3><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSData</span> *data;</span><br><span class="line"><span class="built_in">NSArray</span>&lt;<span class="built_in">UIImgae</span> *&gt; *images;</span><br><span class="line"><span class="type">double</span> durations[frameCount];</span><br><span class="line"><span class="type">int</span> loopCount;</span><br><span class="line"><span class="comment">// åˆ›å»ºmux</span></span><br><span class="line">WebPMux *mux = WebPMuxNew();</span><br><span class="line"><span class="keyword">if</span> (!mux) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éå†å¸¦ç¼–ç çš„æ¯å¸§</span></span><br><span class="line"><span class="keyword">for</span> (size_t i = <span class="number">0</span>; i &lt; framesCount; i++) &#123;</span><br><span class="line">    <span class="built_in">NSData</span> *webpData = [<span class="keyword">self</span> encodedWebpDataWithImage:images[i]]; <span class="comment">// å•å¸§ç¼–ç åæ•°æ®</span></span><br><span class="line">    <span class="type">int</span> duration = (<span class="type">int</span>)durations[i] * <span class="number">1000</span>; <span class="comment">// å•å¸§æŒç»­æ—¶é•¿</span></span><br><span class="line">    <span class="comment">// è®¾ç½®WebPæ¯å¸§å±æ€§ï¼ŒåŒ…æ‹¬Dataï¼ŒBlendï¼ŒDisposalç­‰</span></span><br><span class="line">    WebPMuxFrameInfo frame = &#123;.bitstream.bytes = webpData.bytes <span class="comment">//çœç•¥&#125;</span></span><br><span class="line">    <span class="keyword">if</span> (WebPMuxPushFrame(mux, &amp;frame, <span class="number">0</span>) != WEBP_MUX_OK) &#123;</span><br><span class="line">        WebPMuxDelete(mux);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®åŠ¨å›¾æœ¬èº«çš„å±æ€§</span></span><br><span class="line">WebPMuxAnimParams params;</span><br><span class="line">params.bgcolor = <span class="number">0</span>, params.loop_count = loopCount;</span><br><span class="line">WebPMuxSetAnimationParams(mux, &amp;params);</span><br><span class="line"></span><br><span class="line">WebPData outputData;</span><br><span class="line"><span class="comment">// æœ€åè¿›è¡Œç¼–ç ï¼Œæ‹¿åˆ°è¾“å‡ºçš„äºŒè¿›åˆ¶</span></span><br><span class="line">WebPMuxError error = WebPMuxAssemble(mux, &amp;outputData);</span><br><span class="line">WebPMuxDelete(mux);</span><br><span class="line"><span class="keyword">if</span> (error != WEBP_MUX_OK) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line">data = [<span class="built_in">NSData</span> dataWithBytes:outputData.bytes length:outputData.size];</span><br><span class="line">WebPDataClear(&amp;outputData);</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç¬¬ä¸‰æ–¹ç¼–è§£ç å…¶å®ç›¸å¯¹äºImage/IOæ¥è¯´ï¼Œä¸»è¦éš¾åº¦å…¶å®åœ¨äºéœ€è¦è·å–çš„Bitmapã€‚å¼€å‘è€…éœ€è¦ä¸€ç‚¹åŸºæœ¬çš„å›¾åƒçŸ¥è¯†ï¼Œå†è€…å°±æ˜¯è¦èƒ½ä¼šç”¨ç¬¬ä¸‰æ–¹ç¼–è§£ç å™¨çš„æ¥å£ï¼ˆä¸€èˆ¬æ¥è¯´ç¬¬ä¸‰æ–¹ç¼–è§£ç å™¨å°±æ˜¯Cæˆ–è€…C++å†™çš„ï¼Œä¸OCå’ŒSwiftäº¤äº’ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œè‡³å°‘ä¸ç”¨åƒJava JNIé‚£æ ·è°ƒç”¨ï¼‰ã€‚ä¹‹ååªè¦æŒ‰ç…§é€šç”¨çš„æ­¥éª¤ï¼Œå»ç¼–ç å’Œè§£ç å³å¯ã€‚</p><p>åˆ°è¿™é‡Œçš„è¯ï¼Œä¸€èˆ¬çš„å¤§éƒ¨åˆ†æ ¼å¼çš„ç¼–è§£ç å°±åŸºæœ¬æ²¡æœ‰é—®é¢˜äº†ã€‚å½“ç„¶ï¼Œå…³äºè¿›é˜¶çš„æ–¹é¢ï¼Œæ¯”å¦‚å›¾åƒçš„ç¼–è§£ç æ€§èƒ½ä¼˜åŒ–ï¼Œè¿›é˜¶çš„å›¾åƒå¤„ç†ï¼ˆBitmapçš„å‡ ä½•å˜åŒ–ï¼ŒAlphaåˆæˆï¼Œä½æ•°è½¬æ¢ç­‰ç­‰ï¼‰è¿™å°±éœ€è¦ç”¨åˆ°æ›´ä½å±‚çš„åº“vImageäº†ï¼Œä¼šåœ¨ä¹‹åçš„ç³»åˆ—æ•™ç¨‹ä¸­è¿›è¡Œä»‹ç»ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ•™ç¨‹ï¼Œæ˜¯ç³»åˆ—æ•™ç¨‹çš„ç¬¬äºŒç¯‡ï¼Œå‰ç¯‡åä¸ºã€ŠiOSå¹³å°å›¾ç‰‡ç¼–è§£ç å…¥é—¨æ•™ç¨‹ï¼ˆImage/IOç¯‡ï¼‰ã€‹ã€‚è¿™ç¯‡ä¸»è¦è®²ç¬¬ä¸‰æ–¹è§£ç å™¨å¦‚ä½•åœ¨iOSå¹³å°ä¸Šå¤„ç†ï¼ˆå’ŒImage/IOçš„å‡ å¤§è¦ç‚¹ä¸€ä¸€å¯¹åº”ï¼‰ï¼Œæ›´ä¼šä»‹ç»ä¸€äº›åŸºæœ¬çš„Bitmapæ¦‚å¿µï¼Œæ€»ç»“é€šç”¨çš„å¤„ç†æ–¹æ³•ï¼Œæ¯•ç«Ÿæˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;ç¬¬ä¸‰æ–¹ç¼–è§£ç &quot;&gt;&lt;a href=&quot;#ç¬¬ä¸‰æ–¹ç¼–è§£ç &quot; class=&quot;headerlink&quot; title=&quot;ç¬¬ä¸‰æ–¹ç¼–è§£ç &quot;&gt;&lt;/a&gt;ç¬¬ä¸‰æ–¹ç¼–è§£ç &lt;/h1&gt;&lt;p&gt;å¯¹äºå›¾ç‰‡ç¼–è§£ç æ¥è¯´ï¼ŒAppleè‡ªå¸¦çš„Image/IOç¡®å®éå¸¸çš„æ˜“ç”¨ï¼Œä½†æ˜¯å¯¹äºImage/IOä¸æ”¯æŒçš„å›¾åƒæ ¼å¼å°±èƒ½æ— èƒ½ä¸ºåŠ›äº†ã€‚æˆªæ­¢åˆ°iOS 11ï¼ŒImage/IOä¸æ”¯æŒWebPï¼ŒBPGï¼Œå¯¹äºä¸€äº›éœ€è¦ä¾èµ–WebPçš„ä¸šåŠ¡å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼ˆWebPçš„ä¼˜ç‚¹å°±ä¸å†ä»‹ç»äº†ï¼‰ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥è‡ªå·±é›†æˆç¬¬ä¸‰æ–¹çš„å›¾ç‰‡è§£ç å™¨ï¼Œå»æ”¯æŒè¿™äº›éœ€è¦çš„çš„æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±æƒ³è¦æ”¯æŒçš„å›¾åƒæ ¼å¼ï¼Œé€‰æ‹©ç›¸å¯¹åº”çš„ç¼–è§£ç å™¨ï¼Œè¿›è¡Œç¼–è§£ç ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥WebPçš„è§£ç åº“&lt;a href=&quot;https://developers.google.com/speed/webp/docs/api&quot;&gt;libwebp&lt;/a&gt;ä¸ºä¾‹å­ï¼Œå…¶ä»–è§£ç å™¨éœ€è¦æ ¹æ®å¯¹åº”è§£ç å™¨çš„APIå¤„ç†ï¼ŒåŸºæœ¬æ¦‚å¿µç±»ä¼¼ã€‚&lt;/p&gt;
&lt;h1 id=&quot;è§£ç &quot;&gt;&lt;a href=&quot;#è§£ç &quot; class=&quot;headerlink&quot; title=&quot;è§£ç &quot;&gt;&lt;/a&gt;è§£ç &lt;/h1&gt;&lt;p&gt;ä¸åƒImage/IOé‚£æ ·å°è£…äº†æ•´å¥—æµç¨‹ï¼Œç¬¬ä¸‰æ–¹è§£ç çš„å…³é”®ä¹‹å¤„ï¼Œå°±æ˜¯åœ¨äºè·å–åˆ°å›¾åƒçš„&lt;a href=&quot;https://en.wikipedia.org/wiki/Raster_graphics&quot;&gt;Bitmap&lt;/a&gt;æ•°æ®ï¼Œé€šå¸¸æƒ…å†µå°±æ˜¯&lt;a href=&quot;https://en.wikipedia.org/wiki/RGBA_color_space&quot;&gt;RGBA&lt;/a&gt;çš„çŸ¢é‡è¡¨ç¤ºã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="Image" scheme="http://dreampiggy.com/tags/Image/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¹³å°å›¾ç‰‡ç¼–è§£ç å…¥é—¨æ•™ç¨‹ï¼ˆImage/IOç¯‡ï¼‰</title>
    <link href="http://dreampiggy.com/2017/10/30/iOS%E5%B9%B3%E5%8F%B0%E5%9B%BE%E7%89%87%E7%BC%96%E8%A7%A3%E7%A0%81%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%88Image:IO%E7%AF%87%EF%BC%89/"/>
    <id>http://dreampiggy.com/2017/10/30/iOS%E5%B9%B3%E5%8F%B0%E5%9B%BE%E7%89%87%E7%BC%96%E8%A7%A3%E7%A0%81%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%88Image:IO%E7%AF%87%EF%BC%89/</id>
    <published>2017-10-30T17:32:29.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ•™ç¨‹æ˜¯ç³»åˆ—æ•™ç¨‹çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦æ˜¯é¢å‘äºæ²¡æœ‰æ€ä¹ˆæ¥è§¦è¿‡iOSå¹³å°ä¸Šå›¾åƒç¼–è§£ç çš„äººçš„ï¼Œä¸ä¼šæ¶‰åŠåˆ°å¤šåª’ä½“å¤„ç†ä¸­çš„æ•°å­—ä¿¡å·å¤„ç†ã€å›¾åƒç¼–ç çš„æ·±å…¥çŸ¥è¯†ã€‚è¿™æ˜¯ç³»åˆ—æœ€ç®€å•çš„ä¸€ç¯‡ï¼Œä¹‹åä¼šæœ‰å…³äºç¬¬ä¸‰æ–¹ç¼–è§£ç ï¼Œä»¥åŠvImageçš„å¦ä¸¤ç¯‡æ•™ç¨‹ã€‚</p></blockquote><h1 id="Image-IO"><a href="#Image-IO" class="headerlink" title="Image/IO"></a>Image/IO</h1><p>Image/IOæ˜¯Appleæä¾›çš„ä¸€å¥—ç”¨äºå›¾ç‰‡ç¼–ç è§£ç çš„ç³»ç»Ÿåº“ï¼Œå¯¹å¤–æ˜¯ä¸€å±‚éå¸¸ç›´è§‚æ˜“ç”¨çš„Cçš„æ¥å£ã€‚ä¸Šå±‚çš„UIKitï¼ŒCore Imageï¼Œè¿˜æœ‰Core Graphicsä¸­çš„CGImageå¤„ç†ï¼Œéƒ½æ˜¯ä¾èµ–Image/IOåº“çš„ã€‚å› æ­¤ï¼ŒæŒæ¡Image/IOçš„åŸºæœ¬ç¼–è§£ç æ“ä½œï¼Œå¯¹ä¸€äº›å›¾åƒç›¸å…³çš„æ•°æ®å¤„ç†æ˜¯éå¸¸å¿…è¦çš„ã€‚è¿™ç¯‡æ•™ç¨‹å°±ä¸»è¦ä»ç®€å•çš„ç”¨æ³•ï¼Œè¯´æ˜Image/IOçš„ç”¨æ³•ï¼Œå®Œæ•´çš„æ–‡æ¡£ï¼Œå¯ä»¥å‚è€ƒ<a href="https://developer.apple.com/documentation/imageio">Apple Image/IO</a></p><h1 id="è§£ç "><a href="#è§£ç " class="headerlink" title="è§£ç "></a>è§£ç </h1><p>è§£ç ï¼ŒæŒ‡çš„æ˜¯è®²å·²ç»ç¼–ç è¿‡çš„å›¾åƒå°è£…æ ¼å¼çš„æ•°æ®ï¼Œè½¬æ¢ä¸ºå¯ä»¥è¿›è¡Œæ¸²æŸ“çš„å›¾åƒæ•°æ®ã€‚å…·ä½“æ¥è¯´ï¼ŒiOSå¹³å°ä¸Šå°±æŒ‡çš„æ˜¯å°†ä¸€ä¸ªè¾“å…¥çš„äºŒè¿›åˆ¶Dataï¼Œè½¬æ¢ä¸ºä¸Šå±‚UIç»„ä»¶æ¸²æŸ“æ‰€ç”¨çš„UIImageå¯¹è±¡ã€‚</p><p>Image/IOçš„è§£ç ï¼Œæ”¯æŒäº†å¸¸è§çš„å›¾åƒæ ¼å¼ï¼ŒåŒ…æ‹¬PNGï¼ˆåŒ…æ‹¬APNGï¼‰ã€JPEGã€GIFã€BMPã€TIFFï¼ˆå…·ä½“çš„ï¼Œå¯ä»¥é€šè¿‡<code>CGImageSourceCopyTypeIdentifiers</code>æ¥æ‰“å°å‡ºæ¥ï¼Œä¸åŒå¹³å°ä¸å®Œå…¨ä¸€è‡´ï¼‰ã€‚åœ¨iOS 11ä¹‹åå¦å¤–æ”¯æŒäº†HEICï¼ˆå³ä½¿ç”¨äº†HEVCç¼–ç çš„HEIFæ ¼å¼ï¼‰ã€‚</p><p>å¯¹äºè§£ç æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸ºé™æ€å›¾ï¼ˆæ¯”å¦‚JPEGï¼ŒPNGï¼‰å’ŒåŠ¨æ€å›¾ï¼ˆæ¯”å¦‚GIFï¼ŒAPNGï¼‰çš„ä¸¤ç§ï¼Œåˆ†åˆ«è¿›è¡Œè¯´æ˜ä¸€ä¸‹è§£ç çš„è¿‡ç¨‹ã€‚</p><h2 id="é™æ€å›¾"><a href="#é™æ€å›¾" class="headerlink" title="é™æ€å›¾"></a>é™æ€å›¾</h2><p>é™æ€å›¾çš„è§£ç ï¼ŒåŸºæœ¬å¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>åˆ›å»ºCGImageSource</li><li>è¯»å–å›¾åƒæ ¼å¼å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰</li><li>è§£ç å¾—åˆ°CGImage</li><li>ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†</li></ol><h3 id="1-åˆ›å»ºImageSource"><a href="#1-åˆ›å»ºImageSource" class="headerlink" title="1. åˆ›å»ºImageSource"></a>1. åˆ›å»ºImageSource</h3><p>CGImageSouceï¼Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå¾…è§£ç æ•°æ®çš„è¾“å…¥ã€‚ä¹‹åçš„ä¸€ç³»åˆ—æ“ä½œï¼ˆè¯»å–å…ƒæ•°æ®ï¼Œè§£ç ï¼‰éƒ½éœ€è¦åˆ°è¿™ä¸ªSourceï¼Œä¸è§£ç æµç¨‹ä¸€ä¸€å¯¹åº”ã€‚</p><p>CGImageSourceå¯ä»¥é€šè¿‡ä¸åŒçš„å‡ ä¸ªæ¥å£æ„é€ ï¼ˆè¿™é‡Œå…ˆå¿½ç•¥æ¸è¿›å¼è§£ç çš„æ¥å£ï¼‰ï¼š</p><ul><li><code>CGImageSourceCreateWithData</code>ï¼š ä»ä¸€ä¸ªå†…å­˜ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆCGDataï¼‰ä¸­åˆ›å»ºImageSourceï¼Œç›¸å¯¹æ¥è¯´æœ€ä¸ºå¸¸ç”¨çš„ä¸€ä¸ª</li><li><code>CGImageSourceCreateWithURL</code>ï¼š ä»ä¸€ä¸ªURLï¼ˆæ”¯æŒç½‘ç»œå›¾çš„HTTP URLï¼Œæˆ–è€…æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„fileURLï¼‰åˆ›å»ºImageSourceï¼Œ</li><li><code>CGImageSourceCreateWithDataProvider</code>ï¼šä»ä¸€ä¸ªDataProvideä¸­åˆ›å»ºImageSourceï¼ŒDataProvideræä¾›äº†å¾ˆå¤šç§è¾“å…¥ï¼ŒåŒ…æ‹¬å†…å­˜ï¼Œæ–‡ä»¶ï¼Œç½‘ç»œï¼Œæµç­‰ã€‚å¾ˆå¤šCGçš„æ¥å£ä¼šç”¨åˆ°è¿™ä¸ªæ¥é¿å…å¤šä¸ªé¢å¤–çš„æ¥å£ã€‚</li></ul><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGImageSourceRef</span> source = <span class="built_in">CGImageSourceCreateWithData</span>((__bridge <span class="built_in">CFDataRef</span>)data, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (!source) &#123; <span class="comment">// ä¸€èˆ¬è¿™æ—¶å€™éƒ½æ˜¯è¾“å…¥å›¾åƒæ•°æ®çš„æ ¼å¼ä¸æ”¯æŒ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-è¯»å–å›¾åƒæ ¼å¼å…ƒæ•°æ®"><a href="#2-è¯»å–å›¾åƒæ ¼å¼å…ƒæ•°æ®" class="headerlink" title="2. è¯»å–å›¾åƒæ ¼å¼å…ƒæ•°æ®"></a>2. è¯»å–å›¾åƒæ ¼å¼å…ƒæ•°æ®</h3><p>åˆ›å»ºå¥½CGImageSourceä¹‹åï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥ç«‹å³è§£ç ã€‚ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è·å–ä¸€äº›ç›¸å…³çš„å›¾åƒä¿¡æ¯ï¼ŒåŒ…æ‹¬å›¾åƒçš„æ ¼å¼ï¼Œå›¾åƒæ•°é‡ï¼Œ<a href="https://en.wikipedia.org/wiki/Exif">EXIFå…ƒæ•°æ®</a>ç­‰ã€‚åœ¨çœŸæ­£è§£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°è¿™äº›æ•°æ®ï¼Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œä¹‹åå†å¼€å§‹è§£ç è¿‡ç¨‹ã€‚</p><p>å…¶ä¸­ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥ç›´æ¥åœ¨CGImageSourceä¸Šè·å–ï¼š</p><ul><li>å›¾åƒæ ¼å¼ï¼š<code>CGImageSourceGetType</code></li><li>å›¾åƒæ•°é‡ï¼ˆåŠ¨å›¾ï¼‰ï¼š<code>CGImageSourceGetCount</code></li></ul><p>å…¶ä»–çš„ï¼Œéœ€è¦é€šè¿‡è·å–å±æ€§åˆ—è¡¨æ¥æŸ¥è¯¢ã€‚å¯¹äºå›¾åƒå®¹å™¨çš„å±æ€§ï¼ˆEXIFç­‰ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>CGImageSourceCopyProperties</code>å³å¯ï¼Œç„¶åæ ¹æ®ä¸åŒçš„Keyå»è·å–å¯¹åº”çš„ä¿¡æ¯ã€‚</p><p>å…¶å®è‹¹æœè¿˜æœ‰ä¸€å¥—<code>CGImageSourceCopyMetadataAtIndex</code>ï¼Œå¯¹åº”çš„æ•°æ®ä¸æ˜¯å­—å…¸ï¼Œè€Œæ˜¯ä¸€ä¸ª<code>CGImageMetadata</code>ï¼Œå†é€šè¿‡å…¶ä»–æ–¹æ³•å»å–ã€‚è¿™å¥—APIä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¯»å–æ•°æ®å’Œå‰è€…æ˜¯å®Œå…¨å…¼å®¹ä¸€è‡´çš„ï¼Œä¼˜ç‚¹æ˜¯èƒ½å¤Ÿè¿›è¡Œè‡ªå®šä¹‰æ‰©å±•ï¼ˆæ¯”å¦‚è¯´ä½ æœ‰éæ ‡å‡†çš„å›¾åƒä¿¡æ¯æƒ³è‡ªå·±æ·»åŠ å’Œåˆ é™¤ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ä½¿ç”¨å‰è€…å°±è¶³å¤Ÿäº†ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGImageSourceRef</span> source;</span><br><span class="line"><span class="built_in">NSDictionary</span> *properties = (__bridge <span class="built_in">NSDictionary</span> *)<span class="built_in">CGImageSourceCopyProperties</span>(source, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">NSUInteger</span> fileSize = [properties[kCGImagePropertyFileSize] unsignedIntegerValue]; <span class="comment">// æ²¡ä»€ä¹ˆç”¨çš„æ–‡ä»¶å¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSDictionary</span> *exifProperties = properties[(__bridge <span class="built_in">NSString</span> *)kCGImagePropertyExifDictionary]; <span class="comment">// EXIFä¿¡æ¯</span></span><br><span class="line"><span class="built_in">NSString</span> *exifCreateTime = exirProperties[(__bridge <span class="built_in">NSString</span> *)kCGImagePropertyExifDateTimeOriginal]; <span class="comment">// EXIFæ‹æ‘„æ—¶é—´</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå‰é¢è¿™ä¸ªæŒ‡çš„æ˜¯å›¾åƒå®¹å™¨çš„å±æ€§ï¼Œè€ŒçœŸæ­£çš„è·å–å›¾åƒçš„å…ƒä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨<code>CGImageSourceCopyPropertiesAtIndex</code>ï¼Œå¯¹äºé™æ€å›¾æ¥è¯´ï¼Œindexå§‹ç»ˆä¼ 0å³å¯ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSDictionary</span> *imageProperties = (__bridge <span class="built_in">NSDictionary</span> *) <span class="built_in">CGImageSourceCopyPropertiesAtIndex</span>(source, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">NSUInteger</span> width = [imageProperties[(__bridge <span class="built_in">NSString</span> *)kCGImagePropertyPixelWidth] unsignedIntegerValue]; <span class="comment">//å®½åº¦ï¼Œåƒç´ å€¼</span></span><br><span class="line"><span class="built_in">NSUInteger</span> height = [imageProperties[(__bridge <span class="built_in">NSString</span> *)kCGImagePropertyPixelHeight] unsignedIntegerValue]; <span class="comment">//é«˜åº¦ï¼Œåƒç´ å€¼</span></span><br><span class="line"><span class="type">BOOL</span> hasAlpha = [imageProperties[(__bridge <span class="built_in">NSString</span> *)kCGImagePropertyHasAlpha] boolValue]; <span class="comment">//æ˜¯å¦å«æœ‰Alphaé€šé“</span></span><br><span class="line"><span class="built_in">CGImagePropertyOrientation</span> exifOrientation = [imageProperties[(__bridge <span class="built_in">NSString</span> *)kCGImagePropertyOrientation] integerValue]; <span class="comment">// è¿™é‡Œä¹Ÿèƒ½ç›´æ¥æ‹¿åˆ°EXIFæ–¹å‘ä¿¡æ¯ï¼Œå’Œå‰é¢çš„ä¸€æ ·ã€‚å¦‚æœæ˜¯iOS 7ï¼Œå°±ç”¨NSIntegerå–å§ :)</span></span><br></pre></td></tr></table></figure><h3 id="3-è§£ç å¾—åˆ°CGImage"><a href="#3-è§£ç å¾—åˆ°CGImage" class="headerlink" title="3. è§£ç å¾—åˆ°CGImage"></a>3. è§£ç å¾—åˆ°CGImage</h3><p>é€šè¿‡Image/IOè§£ç åˆ°CGImageç¡®å®éå¸¸ç®€å•ï¼Œæ•´ä¸ªè§£ç åªéœ€è¦ä¸€ä¸ªæ–¹æ³•<code>CGImageSourceCreateImageAtIndex</code>ã€‚å¯¹äºé™æ€å›¾æ¥è¯´ï¼Œindexå§‹ç»ˆæ˜¯0ï¼Œè°ƒç”¨ä¹‹åä¼šç«‹å³å¼€å§‹è§£ç ï¼Œç›´åˆ°è§£ç å®Œæˆã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒImage/IOæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œä¸”åŸºæœ¬ä¸Šä¹Ÿéƒ½æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤ç¡®ä¿å¤§å›¾åƒæ–‡ä»¶çš„è§£ç æœ€å¥½ä¸è¦æ”¾åˆ°ä¸»çº¿ç¨‹ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGImageRef</span> imageRef = <span class="built_in">CGImageSourceCreateImageAtIndex</span>(source, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure><h3 id="4-ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†"><a href="#4-ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†" class="headerlink" title="4. ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†"></a>4. ç”Ÿæˆä¸Šå±‚çš„UIImageï¼Œæ¸…ç†</h3><p>è§£ç å¾—åˆ°CGImageåï¼Œå°±åŸºæœ¬å®Œæˆäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ„é€ å¯¹åº”çš„UIImageç”¨äºUIç»„ä»¶æ¸²æŸ“ã€‚å…¶ä¸­UIImageçš„orientationï¼Œå¯ä»¥é€šè¿‡ä¹‹å‰çš„EXIFå…ƒä¿¡æ¯è·å¾—ï¼ˆæ³¨æ„ï¼Œéœ€è¦è½¬æ¢EXIFçš„æ–¹å‘ï¼Œåˆ°UIImageOrientationçš„æ–¹å‘ï¼‰ã€‚ç„¶åå°±å®Œæˆäº†ï¼Œæ¯”è¾ƒç®€å•ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UIImageOrientationå’ŒCGImagePropertyOrientationæšä¸¾å®šä¹‰é¡ºåºä¸åŒï¼Œå°è£…ä¸€ä¸ªæ–¹æ³•æä¸€ä¸ªswitch caseå°±è¡Œ</span></span><br><span class="line"><span class="built_in">UIImageOrientation</span> imageOrientation = [<span class="keyword">self</span> imageOrientationFromExifOrientation:exifOrientation];</span><br><span class="line"><span class="built_in">UIImage</span> *image = [[<span class="built_in">UIImage</span> imageWithCGImage:imageRef scale:[<span class="built_in">UIScreen</span> mainScreen].scale orientation:imageOrientation];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸…ç†ï¼Œéƒ½æ˜¯CæŒ‡é’ˆï¼Œé¿å…å†…å­˜æ³„æ¼</span></span><br><span class="line"><span class="built_in">CGImageRelease</span>(imageRef);</span><br><span class="line"><span class="built_in">CFRelease</span>(source)</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€å›¾"><a href="#åŠ¨æ€å›¾" class="headerlink" title="åŠ¨æ€å›¾"></a>åŠ¨æ€å›¾</h2><p>å‰é¢çš„æƒ…å†µï¼Œä¸»è¦ä»‹ç»äº†æ˜¯é™æ€å›¾ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå–çš„indexéƒ½æ˜¯0çš„æƒ…å†µ ï¼‰ã€‚å¯¹äºåŠ¨æ€å›¾æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>CGImageSourceGetCount</code>æ¥è·å–åŠ¨å›¾çš„å¸§æ•°ï¼Œä¹‹åå°±æ¯”è¾ƒç®€å•äº†ï¼Œé€šè¿‡å¾ªç¯éå†æ¯ä¸€å¸§ï¼Œé‡å¤2-4æ­¥éª¤ç”Ÿæˆå¯¹åº”çš„UIImageï¼Œæœ€åé€šè¿‡UIImageè‡ªå¸¦çš„<code>animatedImageWithImages:duration:</code>æ¥ç”Ÿæˆä¸€å¼ åŠ¨å›¾å³å¯ã€‚ä½†æ˜¯å…³äºè¿™é‡Œæœ‰å‘ï¼Œåœ¨ä¸‹é¢è¯´æ˜ã€‚</p><p>æ­¥éª¤ï¼š</p><ol><li>é™æ€å›¾çš„æ­¥éª¤1</li><li>éå†æ‰€æœ‰å›¾åƒå¸§ï¼Œé‡å¤é™æ€å›¾çš„æ­¥éª¤2-4</li><li>ç”ŸæˆåŠ¨å›¾UIImage</li></ol><h3 id="1-ç”ŸæˆåŠ¨å›¾UIImage"><a href="#1-ç”ŸæˆåŠ¨å›¾UIImage" class="headerlink" title="1. ç”ŸæˆåŠ¨å›¾UIImage"></a>1. ç”ŸæˆåŠ¨å›¾UIImage</h3><p>ç”±äºéå†å¾ˆç®€å•ï¼Œå°±ä¸é‡å¤äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ä¸€ä¸ªGIFä¸ºä¾‹ï¼Œç®€å•è¯´æ˜ä¸€ä¸‹è§£ç è¿‡ç¨‹ï¼Œç›´è§‚æ˜“æ‡‚ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSUInteger</span> frameCount = <span class="built_in">CGImageSourceGetCount</span>(source); <span class="comment">//å¸§æ•°</span></span><br><span class="line"><span class="built_in">NSMutableArray</span> &lt;<span class="built_in">UIImage</span> *&gt; *images = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line"><span class="type">double</span> totalDuration = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (size_t i = <span class="number">0</span>; i &lt; frameCount; i++) &#123;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *frameProperties = (__bridge <span class="built_in">NSDictionary</span> *) <span class="built_in">CGImageSourceCopyPropertiesAtIndex</span>(source, i, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">NSDictionary</span> *gifProperties = frameProperties[(<span class="built_in">NSString</span> *)kCGImagePropertyGIFDictionary]; <span class="comment">// GIFå±æ€§å­—å…¸</span></span><br><span class="line">    <span class="type">double</span> duration = [gifProperties[(<span class="built_in">NSString</span> *)kCGImagePropertyGIFUnclampedDelayTime] doubleValue]; <span class="comment">// GIFåŸå§‹çš„å¸§æŒç»­æ—¶é•¿ï¼Œç§’æ•°</span></span><br><span class="line">    <span class="built_in">CGImagePropertyOrientation</span> exifOrientation = [frameProperties[(__bridge <span class="built_in">NSString</span> *)kCGImagePropertyOrientation] integerValue]; <span class="comment">// æ–¹å‘</span></span><br><span class="line">    <span class="built_in">CGImageRef</span> imageRef = <span class="built_in">CGImageSourceCreateImageAtIndex</span>(source, i, <span class="literal">NULL</span>); <span class="comment">// CGImage</span></span><br><span class="line">    <span class="built_in">UIImageOrientation</span> imageOrientation = [<span class="keyword">self</span> imageOrientationFromExifOrientation:exifOrientation];</span><br><span class="line">    <span class="built_in">UIImage</span> *image = [[<span class="built_in">UIImage</span> imageWithCGImage:imageRef scale:[<span class="built_in">UIScreen</span> mainScreen].scale orientation:imageOrientation];</span><br><span class="line">    totalDuration += duration;</span><br><span class="line">    [images addObject:image];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€åç”ŸæˆåŠ¨å›¾</span></span><br><span class="line"><span class="built_in">UIImage</span> *animatedImage = [<span class="built_in">UIImage</span> animatedImageWithImages:images duration:totalDuration];</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¤„ç†çš„è¯ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹åŸºæœ¬æ˜¯å¯ä»¥æ¥å—çš„ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå‘ï¼šUIImageè¿™ä¸ªanimatedImagesçš„æ¥å£ï¼Œåªä¼šæ ¹æ®ä½ ä¼ å…¥çš„imagesçš„æ•°é‡ï¼Œå¹³å‡åˆ†é…ä¼ å…¥çš„totalDurationçš„å±•ç¤ºæ—¶é•¿ã€‚ä½†æ˜¯å¤§éƒ¨åˆ†åŠ¨å›¾æ ¼å¼ï¼ˆGIFï¼ŒAPNGï¼ŒWebPç­‰ç­‰ï¼‰ï¼Œéƒ½æ˜¯ä¸åŒå¸§ä¸åŒæ—¶é•¿çš„ï¼Œè¿™å°±ä¼šå¯¼è‡´æœ€åçœ‹åˆ°çš„åŠ¨å›¾æ¯å¸§æ—¶é•¿ä¹±æ‰ã€‚</p><p>å¯¹äºè¿™ä¸ªçš„è§£å†³æ–¹å¼ä¹Ÿæœ‰ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡å¯¹ç‰¹å®šå›¾åƒå¸§é‡å¤ç‰¹å®šæ¬¡æ•°ï¼Œä»¥å¡«å……æ»¡æ•´ä¸ªåº”è¯¥æ’­æ”¾çš„æ—¶é•¿ã€‚å…¶å®å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰å¸§çš„æ—¶é•¿ï¼Œæ±‚ä¸€ä¸ªæœ€å¤§å…¬çº¦æ•°<code>gcd</code>ï¼Œè¿™æ ·çš„è¯ï¼Œåªéœ€è¦æ¯å¸§é‡å¤æ’­æ”¾<code>duration / gcd</code>æ¬¡æ•°ï¼Œæœ€ç»ˆçš„æ€»æ—¶é•¿å„å¸§<code>repeat * duraion</code>çš„å’Œï¼Œå°±å¯ä»¥å®ç°è¿™ä¸ªäº†ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹æˆ‘å‚ä¸ç»´æŠ¤çš„<a href="https://github.com/rs/SDWebImage/blob/4.1.2/SDWebImage/UIImage%2BWebP.m#L281=L294">SDWebImageçš„ä»£ç </a>ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSUInteger</span> durations[frameCount];</span><br><span class="line"><span class="built_in">NSUInteger</span> <span class="keyword">const</span> gcd = gcdArray(frameCount, durations);</span><br><span class="line"><span class="keyword">for</span> (size_t i = <span class="number">0</span>; i &lt; frameCount; i++) &#123;</span><br><span class="line">    <span class="built_in">NSUInteger</span> duration = durations[i];</span><br><span class="line">    <span class="built_in">NSUInteger</span> repeatCount = duration / gcd;</span><br><span class="line">    <span class="keyword">for</span> (size_t j = <span class="number">0</span>; j &lt; repeatCount; j++) &#123;</span><br><span class="line">        [animatedImages addObject:image];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¸è¿›å¼è§£ç "><a href="#æ¸è¿›å¼è§£ç " class="headerlink" title="æ¸è¿›å¼è§£ç "></a>æ¸è¿›å¼è§£ç </h2><p>æ¸è¿›å¼è§£ç ï¼ˆProgressive Decodingï¼‰ï¼Œå³ä¸éœ€è¦å®Œæ•´çš„å›¾åƒæµæ•°æ®ï¼Œå…è®¸è§£ç éƒ¨åˆ†å¸§ï¼ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¼šæ˜¯å›¾åƒçš„éƒ¨åˆ†åŒºåŸŸï¼‰ï¼Œå¯¹éƒ¨åˆ†ä½¿ç”¨äº†æ¸è¿›å¼ç¼–ç çš„æ ¼å¼ï¼ˆå‚è€ƒï¼š<a href="https://en.wikipedia.org/wiki/Interlacing_(bitmaps">æ¸è¿›å¼ç¼–ç </a>ï¼‰ï¼Œåˆ™æ›´å¯ä»¥è§£ç å‡ºç›¸å¯¹æ¨¡ç³Šä½†å®Œæ•´çš„å›¾åƒã€‚</p><p>æ¯”å¦‚è¯´ï¼ŒJPEGæ”¯æŒä¸‰ç§æ–¹å¼çš„æ¸è¿›å¼ç¼–ç ï¼ŒåŒ…æ‹¬Baselineï¼Œinterlacedï¼Œä»¥åŠprogressiveï¼ˆå‚è€ƒï¼š<a href="https://blog.ibireme.com/2015/11/02/ios_image_tips/">iOS å¤„ç†å›¾ç‰‡çš„ä¸€äº›å° Tip</a>)</p><table><thead><tr><th align="center">Baseline</th><th align="center">Interlaced</th><th align="center">Progressive</th></tr></thead><tbody><tr><td align="center"><img src="https://blog.ibireme.com/wp-content/uploads/2015/11/image_baseline.gif"></td><td align="center"><img src="https://blog.ibireme.com/wp-content/uploads/2015/11/image_interlaced.gif"></td><td align="center"><img src="https://blog.ibireme.com/wp-content/uploads/2015/11/image_progressive.gif"></td></tr></tbody></table><p>å¯¹äºImage/IOçš„æ¸è¿›å¼è§£ç ï¼Œå…¶å®å’Œé™æ€å›¾è§£ç çš„è¿‡ç¨‹ç±»ä¼¼ã€‚ä½†æ˜¯ç¬¬ä¸€æ­¥åˆ›å»ºCGImageSourceæ—¶ï¼Œéœ€è¦ä½¿ç”¨ä¸“é—¨çš„<code>CGImageSourceCreateIncremental</code>æ–¹æ³•ï¼Œä¹‹åæ¯æ¬¡æœ‰æ–°çš„æ•°æ®ï¼ˆä¸‹è½½æˆ–è€…å…¶ä»–æµè¾“å…¥ï¼‰è¾“å…¥åï¼Œéœ€è¦ä½¿ç”¨<code>CGImageSourceUpdateData</code>ï¼ˆæˆ–è€…<code>CGImageSourceUpdateDataProvider</code>ï¼‰æ¥æ›´æ–°æ•°æ®ã€‚æ³¨æ„è¿™ä¸ªæ–¹æ³•éœ€è¦æ¯æ¬¡ä¼ å…¥æ‰€æœ‰è‡³ä»Šä¸ºæ­¢è§£ç çš„æ•°æ®ï¼Œä¸ä»…ä»…æ˜¯å½“å‰æ›´æ–°çš„æ•°æ®ã€‚</p><p>ä¹‹åçš„è¿‡ç¨‹ï¼Œå°±å’Œæ™®é€šçš„è§£ç ä¸€è‡´ï¼Œå°±ä¸å†è¯´æ˜äº†ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSData</span> *data;</span><br><span class="line"><span class="type">bool</span> finished = data.length == totalLength;</span><br><span class="line"><span class="built_in">CGImageSourceRef</span> source;</span><br><span class="line"><span class="comment">// æ›´æ–°æ•°æ®</span></span><br><span class="line"><span class="built_in">CGImageSourceUpdateData</span>(source, (__bridge <span class="built_in">CFDataRef</span>)data, finished);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å’Œæ™®é€šè§£ç è¿‡ç¨‹ä¸€æ ·</span></span><br><span class="line"><span class="built_in">CGImageRef</span> imageRef = <span class="built_in">CGImageSourceCreateImageAtIndex</span>(source, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure><h1 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h1><p>ç¼–ç è¿‡ç¨‹ï¼Œè¿™é‡ŒæŒ‡çš„å°±æ˜¯å°†ä¸€ä¸ªUIImageè¡¨ç¤ºçš„å›¾åƒï¼Œç¼–ç ä¸ºå¯¹åº”å›¾åƒæ ¼å¼çš„æ•°æ®ï¼Œè¾“å‡ºä¸€ä¸ªNSDataçš„è¿‡ç¨‹ã€‚Image/IOæä¾›çš„å¯¹åº”æ¦‚å¿µï¼Œå«åšCGImageDestinationï¼Œè¡¨ç¤ºä¸€ä¸ªè¾“å‡ºã€‚ä¹‹åçš„ç¼–ç ç›¸å…³çš„æ“ä½œï¼Œå’Œè¿™ä¸ªDestinationä¸€ä¸€å¯¹åº”ã€‚</p><h2 id="é™æ€å›¾-1"><a href="#é™æ€å›¾-1" class="headerlink" title="é™æ€å›¾"></a>é™æ€å›¾</h2><p>é™æ€å›¾çš„ç¼–ç ï¼ŒåŸºæœ¬å¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>åˆ›å»ºCGImageDestination</li><li>æ·»åŠ å›¾åƒæ ¼å¼å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰å’ŒCGImage</li><li>ç¼–ç å¾—åˆ°NSDataï¼Œæ¸…ç†</li></ol><h3 id="1-åˆ›å»ºCGImageDestination"><a href="#1-åˆ›å»ºCGImageDestination" class="headerlink" title="1. åˆ›å»ºCGImageDestination"></a>1. åˆ›å»ºCGImageDestination</h3><p>CGImageDestinationçš„åˆ›å»ºä¹Ÿæœ‰ä¸‰ä¸ªæ¥å£ï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªè¾“å‡ºçš„ç›®æ ‡æ¥è¾“å‡ºè§£ç åçš„æ•°æ®ã€‚åŒæ—¶ï¼Œç”±äºç¼–ç éœ€è¦æä¾›æ–‡ä»¶æ ¼å¼ï¼Œä½ éœ€è¦æŒ‡æ˜å¯¹åº”ç¼–ç çš„æ–‡ä»¶æ ¼å¼ï¼Œç”¨çš„æ˜¯<a href="https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/understanding_utis/understand_utis_intro/understand_utis_intro.html#//apple_ref/doc/uid/TP40001319">UTI Type</a>ã€‚å¯¹äºé™æ€å›¾æ¥è¯´ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°çš„æ•°é‡éƒ½å†™1å³å¯ã€‚</p><ul><li><code>CGImageDestinationCreateWithData</code>ï¼šæŒ‡å®šä¸€ä¸ªå¯å˜äºŒè¿›åˆ¶æ•°æ®ä½œä¸ºè¾“å‡º</li><li><code>CGImageDestinationCreateWithURL</code>ï¼šæŒ‡å®šä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä½œä¸ºè¾“å‡º</li><li><code>CGImageDestinationCreateWithDataConsumer</code>ï¼šæŒ‡å®šä¸€ä¸ªDataConsumerä½œä¸ºè¾“å‡º</li></ul><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CFStringRef</span> imageUTType; <span class="comment">//ç›®æ ‡æ ¼å¼ï¼Œæ¯”å¦‚kUTTypeJPEG</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªCGImageDestination</span></span><br><span class="line"><span class="built_in">CGImageDestinationRef</span> destination = <span class="built_in">CGImageDestinationCreateWithData</span>((__bridge <span class="built_in">CFMutableDataRef</span>)imageData, imageUTType, <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (! destination) &#123;</span><br><span class="line">    <span class="comment">// æ— æ³•ç¼–ç ï¼ŒåŸºæœ¬ä¸Šæ˜¯å› ä¸ºç›®æ ‡æ ¼å¼ä¸æ”¯æŒ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æ·»åŠ å›¾åƒæ ¼å¼å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰å’ŒCGImage"><a href="#2-æ·»åŠ å›¾åƒæ ¼å¼å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰å’ŒCGImage" class="headerlink" title="2. æ·»åŠ å›¾åƒæ ¼å¼å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰å’ŒCGImage"></a>2. æ·»åŠ å›¾åƒæ ¼å¼å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰å’ŒCGImage</h3><p>æ¥ä¸‹æ¥å°±æ˜¯æ·»åŠ å›¾åƒäº†ï¼Œç”±äºCGImageåªæ˜¯åŒ…å«åŸºæœ¬çš„å›¾åƒä¿¡æ¯ï¼Œå¾ˆå¤šé¢å¤–ä¿¡æ¯æ¯”å¦‚è¯´EXIFéƒ½å·²ç»ä¸¢å¤±äº†ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ï¼Œå¯ä»¥æ·»åŠ å¯¹åº”çš„å…ƒä¿¡æ¯ã€‚ä¸åƒè§£ç é‚£æ ·æä¾›äº†ä¸¤ä¸ªAPIåˆ†åˆ«è·å–å…ƒä¿¡æ¯å’Œå›¾åƒã€‚ä½¿ç”¨çš„æ¥å£æ˜¯<code>CGImageDestinationAddImage</code>ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœæœ‰è‡ªå®šä¹‰çš„å…ƒä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡å¦å¤–çš„<code>CGImageDestinationAddImageAndMetadata</code>æ¥æ·»åŠ <code>CGImageMetadata</code>ï¼Œè¿™ä¸ªä¸Šé¢è§£ç ä¹Ÿè¯´åˆ°è¿‡ï¼Œè¿™é‡Œå°±ä¸è§£é‡Šäº†ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªImageIOæœ€å¼ºå¤§çš„åŠŸèƒ½ï¼Œå«åš<code>CGImageDestinationAddImageFromSource </code>ï¼ˆè¿™ä¸ªä¸œè¥¿å¯ä»¥åª²ç¾<code>vImageConvert_AnyToAny</code>ï¼Œåç»­æ•™ç¨‹ä¼šè°ˆåˆ°ï¼‰ï¼Œè¿™ä¸ªèƒ½å¤Ÿä»ä¸€ä¸ªä»»æ„çš„CGImageSourceï¼Œæ·»åŠ ä¸€ä¸ªå›¾åƒå¸§åˆ°ä»»æ„ä¸€ä¸ªCGImageDestinationã€‚è¿™ä¸ªä¸€èˆ¬çš„ç”¨é€”ï¼Œå°±æ˜¯ä¸“é—¨ç»™å›¾åƒè½¬æ¢å™¨ç”¨çš„ï¼Œæ¯”å¦‚è¯´ä»å›¾åƒæ ¼å¼Aï¼Œè½¬æ¢åˆ°å›¾åƒæ ¼å¼Bã€‚æˆ‘ä»¬ä¸éœ€è¦å…ˆè§£ç åˆ°Açš„UIImageï¼Œå†é€šè¿‡ç¼–ç åˆ°Bçš„NSDataï¼Œç›´æ¥åœ¨ä¸­é—´å°±è¿›è¡Œäº†è½¬æ¢ã€‚èƒ½å¤Ÿæå¤§åœ°æå‡è½¬æ¢æ•ˆç‡ï¼ˆImage/IOåº•å±‚å°±æ˜¯é€šè¿‡vImageï¼Œä¼ çš„æ˜¯Bitmapçš„å¼•ç”¨ï¼Œæ²¡æœ‰é¢å¤–çš„æ¶ˆè€—ï¼‰ã€‚ä¸è¿‡è¿™ç¯‡æ•™ç¨‹ä¾§é‡äºImage/IOçš„ç¼–ç å’Œè§£ç ï¼Œè½¬æ¢å¯ä»¥è‡ªè¡Œå‚è€ƒå¤„ç†ï¼Œä¸å†è¯¦ç»†è¯´æ˜äº†ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGImageRef</span> imageRef = image.CGImage; <span class="comment">// å¾…ç¼–ç çš„CGImage</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯é€‰å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚EXIFæ–¹å‘</span></span><br><span class="line"><span class="built_in">CGImagePropertyOrientation</span> exifOrientation = kCGImagePropertyOrientationDown;</span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *frameProperties = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">imageProperties[(__bridge_transfer <span class="built_in">NSString</span> *) kCGImagePropertyExifDictionary] = @(exifOrientation);</span><br><span class="line"><span class="comment">// æ·»åŠ å›¾åƒå’Œå…ƒä¿¡æ¯</span></span><br><span class="line"><span class="built_in">CGImageDestinationAddImage</span>(destination, imageRef, (__bridge <span class="built_in">CFDictionaryRef</span>)frameProperties);</span><br></pre></td></tr></table></figure><h3 id="3-ç¼–ç å¾—åˆ°NSDataï¼Œæ¸…ç†"><a href="#3-ç¼–ç å¾—åˆ°NSDataï¼Œæ¸…ç†" class="headerlink" title="3. ç¼–ç å¾—åˆ°NSDataï¼Œæ¸…ç†"></a>3. ç¼–ç å¾—åˆ°NSDataï¼Œæ¸…ç†</h3><p>å½“æ·»åŠ å®Œæˆæ‰€æœ‰éœ€è¦ç¼–ç çš„CGImageä¹‹åï¼Œæœ€åä¸€æ­¥ï¼Œå°±æ˜¯è¿›è¡Œç¼–ç ï¼Œå¾—åˆ°å›¾åƒæ ¼å¼çš„æ•°æ®ã€‚è¿™é‡Œç›´æ¥ç”¨ä¸€ä¸ªæ–¹æ³•<code>CGImageDestinationFinalize</code>å³å¯ï¼Œç¼–ç å¾—åˆ°çš„æ•°æ®ï¼Œä¼šå†™å…¥æœ€æ—©åˆå§‹åŒ–æ—¶æä¾›çš„Dataæˆ–è€…DataConsumerã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">CGImageDestinationFinalize</span>(destination) == <span class="literal">NO</span>) &#123;</span><br><span class="line">    <span class="comment">// ç¼–ç å¤±è´¥</span></span><br><span class="line">    imageData = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¼–ç æˆåŠŸï¼Œæ¸…ç†â€¦â€¦</span></span><br><span class="line"><span class="built_in">CFRelease</span>(destination);</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€å›¾-1"><a href="#åŠ¨æ€å›¾-1" class="headerlink" title="åŠ¨æ€å›¾"></a>åŠ¨æ€å›¾</h2><p>åŠ¨æ€å›¾çš„ç¼–ç ï¼Œå…¶å®ä¸åƒè§£ç é‚£æ ·å›°éš¾ã€‚åªéœ€è¦å‡†å¤‡å¥½æ‰€æœ‰çš„åŠ¨æ€å›¾çš„å¸§ï¼ŒæŒ‰ç…§å¸§çš„é¡ºåºè¿›è¡Œä¸€ä¸€æ·»åŠ å³å¯ã€‚åŸºæœ¬æ­¥éª¤å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š</p><ol><li>é™æ€å›¾çš„æ­¥éª¤1ï¼Œæä¾›å¸§æ•°</li><li>éå†æ‰€æœ‰å›¾åƒå¸§ï¼Œé‡å¤é™æ€å›¾çš„æ­¥éª¤2</li><li>é™æ€å›¾çš„æ­¥éª¤3</li></ol><h3 id="1-æä¾›å¸§æ•°ï¼Œéå†å›¾åƒå¸§"><a href="#1-æä¾›å¸§æ•°ï¼Œéå†å›¾åƒå¸§" class="headerlink" title="1. æä¾›å¸§æ•°ï¼Œéå†å›¾åƒå¸§"></a>1. æä¾›å¸§æ•°ï¼Œéå†å›¾åƒå¸§</h3><p>åœ¨è¿›è¡ŒåŠ¨æ€å›¾ç¼–ç æ—¶ï¼Œåˆ›å»ºCGImageDestinationçš„æ—¶å€™éœ€è¦æä¾›åŠ¨æ€å›¾çš„å¼ æ•°ã€‚å³åœ¨<code>CGImageDestinationCreateWithData</code>çš„å‚æ•°ä¸­ï¼Œå°†<code>count</code>è®¾ç½®ä¸ºéœ€è¦ç¼–ç çš„æ€»å¼ æ•°ã€‚</p><p>å¦å¤–ï¼Œåœ¨éå†å›¾åƒå¸§çš„è¿‡ç¨‹ï¼Œå…¶å®åªéœ€è¦ä¸æ–­åœ°æŒ‰é¡ºåºæ·»åŠ å°±è¡Œäº†ï¼Œå¦‚æœéœ€è¦è®¾ç½®é¢å¤–å…ƒä¿¡æ¯ï¼Œä¹Ÿéœ€è¦æŒ‰é¡ºåºè®¾ç½®åˆ°å½“å‰å¸§ä¸Šã€‚ç›¸å¯¹äºè§£ç æ¥è¯´ç®€å•å¤šäº†ã€‚å…¶ä»–çš„æ²¡æœ‰ä»€ä¹ˆå¤§çš„åŒºåˆ«ã€‚æˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯ä»¥GIFä¸ºä¾‹ï¼Œç®€å•è¯´æ˜ä¸€ä¸‹ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span>&lt;<span class="built_in">UIImage</span> *&gt; *images;</span><br><span class="line"><span class="type">float</span> durations[frameCount];</span><br><span class="line"><span class="keyword">for</span> (size_t i = <span class="number">0</span>; i &lt; frameCount; i++) &#123;</span><br><span class="line">    <span class="type">float</span> frameDuration = durations[i];</span><br><span class="line">    <span class="built_in">CGImageRef</span> frameImageRef = images[i].CGImage;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *frameProperties = @&#123;(__bridge_transfer <span class="built_in">NSString</span> *)kCGImagePropertyGIFDictionary : @&#123;(__bridge_transfer <span class="built_in">NSString</span> *)kCGImagePropertyGIFUnclampedDelayTime : @(frameDuration)&#125;&#125;;</span><br><span class="line">    <span class="built_in">CGImageDestinationAddImage</span>(imageDestination, frameImageRef, (__bridge <span class="built_in">CFDictionaryRef</span>)frameProperties);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Image/IOå°è£…äº†éå¸¸ç®€å•ç›´è§‚çš„æ¥å£æ¥å¤„ç†å›¾åƒç¼–è§£ç ï¼Œå¯¹äºä»»ä½•å¼€å‘è€…æ¥è¯´éƒ½èƒ½è½»æ˜“ä¸Šæ‰‹ã€‚è€Œä¸”æ€§èƒ½æ–¹é¢å¾ˆå¤šæ ¼å¼éƒ½æœ‰Appleè‡ªå·±çš„ç¡¬ä»¶è§£ç å™¨æ¥åšä¿è¯ã€‚å¦å¤–ï¼Œå¯¹äºå›¾åƒè½¬æ¢ï¼ŒImage/IOæ‰€æä¾›çš„è¿™ç§Source-Destinationçš„æ“ä½œèƒ½å¤Ÿéå¸¸æ–¹ä¾¿åœ°åœ¨ä¸åŒæ ¼å¼ä¹‹é—´è½¬æ¢ï¼Œæœ‰å…´è¶£çš„äººåŠ¡å¿…å¯ä»¥è¯•è¯•ã€‚</p><p>ä¸è¿‡é—æ†¾çš„æ˜¯ï¼ŒImage/IOçš„æ¥å£è®¾è®¡å¹¶æ²¡æœ‰æä¾›å¯ä»¥æ‰©å±•æˆ–è€…æ’ä»¶åŒ–çš„åœ°æ–¹ï¼Œä¸æ”¯æŒçš„å›¾åƒæ ¼å¼å°±æ¯”è¾ƒæ— èƒ½ä¸ºåŠ›äº†ã€‚å…³äºè¿™ä¸ªé—®é¢˜ï¼Œè¯·æœŸå¾…ç³»åˆ—æ•™ç¨‹ç¬¬äºŒç¯‡â€”â€”ç¬¬ä¸‰æ–¹ç¼–è§£ç æ•™ç¨‹ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ•™ç¨‹æ˜¯ç³»åˆ—æ•™ç¨‹çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦æ˜¯é¢å‘äºæ²¡æœ‰æ€ä¹ˆæ¥è§¦è¿‡iOSå¹³å°ä¸Šå›¾åƒç¼–è§£ç çš„äººçš„ï¼Œä¸ä¼šæ¶‰åŠåˆ°å¤šåª’ä½“å¤„ç†ä¸­çš„æ•°å­—ä¿¡å·å¤„ç†ã€å›¾åƒç¼–ç çš„æ·±å…¥çŸ¥è¯†ã€‚è¿™æ˜¯ç³»åˆ—æœ€ç®€å•çš„ä¸€ç¯‡ï¼Œä¹‹åä¼šæœ‰å…³äºç¬¬ä¸‰æ–¹ç¼–è§£ç ï¼Œä»¥åŠvImageçš„å¦ä¸¤ç¯‡æ•™ç¨‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;Image-IO&quot;&gt;&lt;a href=&quot;#Image-IO&quot; class=&quot;headerlink&quot; title=&quot;Image/IO&quot;&gt;&lt;/a&gt;Image/IO&lt;/h1&gt;&lt;p&gt;Image/IOæ˜¯Appleæä¾›çš„ä¸€å¥—ç”¨äºå›¾ç‰‡ç¼–ç è§£ç çš„ç³»ç»Ÿåº“ï¼Œå¯¹å¤–æ˜¯ä¸€å±‚éå¸¸ç›´è§‚æ˜“ç”¨çš„Cçš„æ¥å£ã€‚ä¸Šå±‚çš„UIKitï¼ŒCore Imageï¼Œè¿˜æœ‰Core Graphicsä¸­çš„CGImageå¤„ç†ï¼Œéƒ½æ˜¯ä¾èµ–Image/IOåº“çš„ã€‚å› æ­¤ï¼ŒæŒæ¡Image/IOçš„åŸºæœ¬ç¼–è§£ç æ“ä½œï¼Œå¯¹ä¸€äº›å›¾åƒç›¸å…³çš„æ•°æ®å¤„ç†æ˜¯éå¸¸å¿…è¦çš„ã€‚è¿™ç¯‡æ•™ç¨‹å°±ä¸»è¦ä»ç®€å•çš„ç”¨æ³•ï¼Œè¯´æ˜Image/IOçš„ç”¨æ³•ï¼Œå®Œæ•´çš„æ–‡æ¡£ï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&quot;https://developer.apple.com/documentation/imageio&quot;&gt;Apple Image/IO&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;è§£ç &quot;&gt;&lt;a href=&quot;#è§£ç &quot; class=&quot;headerlink&quot; title=&quot;è§£ç &quot;&gt;&lt;/a&gt;è§£ç &lt;/h1&gt;&lt;p&gt;è§£ç ï¼ŒæŒ‡çš„æ˜¯è®²å·²ç»ç¼–ç è¿‡çš„å›¾åƒå°è£…æ ¼å¼çš„æ•°æ®ï¼Œè½¬æ¢ä¸ºå¯ä»¥è¿›è¡Œæ¸²æŸ“çš„å›¾åƒæ•°æ®ã€‚å…·ä½“æ¥è¯´ï¼ŒiOSå¹³å°ä¸Šå°±æŒ‡çš„æ˜¯å°†ä¸€ä¸ªè¾“å…¥çš„äºŒè¿›åˆ¶Dataï¼Œè½¬æ¢ä¸ºä¸Šå±‚UIç»„ä»¶æ¸²æŸ“æ‰€ç”¨çš„UIImageå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;Image/IOçš„è§£ç ï¼Œæ”¯æŒäº†å¸¸è§çš„å›¾åƒæ ¼å¼ï¼ŒåŒ…æ‹¬PNGï¼ˆåŒ…æ‹¬APNGï¼‰ã€JPEGã€GIFã€BMPã€TIFFï¼ˆå…·ä½“çš„ï¼Œå¯ä»¥é€šè¿‡&lt;code&gt;CGImageSourceCopyTypeIdentifiers&lt;/code&gt;æ¥æ‰“å°å‡ºæ¥ï¼Œä¸åŒå¹³å°ä¸å®Œå…¨ä¸€è‡´ï¼‰ã€‚åœ¨iOS 11ä¹‹åå¦å¤–æ”¯æŒäº†HEICï¼ˆå³ä½¿ç”¨äº†HEVCç¼–ç çš„HEIFæ ¼å¼ï¼‰ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="Image" scheme="http://dreampiggy.com/tags/Image/"/>
    
  </entry>
  
  <entry>
    <title>è¿‘æœŸå‚ä¸çš„APNGå’ŒWebPå¼€æºé¡¹ç›®çš„ç»å†åŠæ„Ÿå—</title>
    <link href="http://dreampiggy.com/2017/07/25/%E8%BF%91%E6%9C%9F%E5%8F%82%E4%B8%8E%E7%9A%84APNG%E5%92%8CWebP%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%BB%8F%E5%8E%86%E5%8F%8A%E6%84%9F%E5%8F%97/"/>
    <id>http://dreampiggy.com/2017/07/25/%E8%BF%91%E6%9C%9F%E5%8F%82%E4%B8%8E%E7%9A%84APNG%E5%92%8CWebP%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%BB%8F%E5%8E%86%E5%8F%8A%E6%84%9F%E5%8F%97/</id>
    <published>2017-07-25T22:44:10.000Z</published>
    <updated>2022-05-09T07:27:55.183Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« è®²çš„æ˜¯æœ‰å…³è¿‘æœŸè‡ªå·±å‚ä¸çš„å‡ ä¸ªå¼€æºé¡¹ç›®çš„ç»å†ä»¥åŠæ„Ÿå—ï¼Œä¸è¿‡å·§åˆçš„æ˜¯å†…å®¹éƒ½å’ŒAPNGå’ŒWebPè¿™ä¸¤ç§å›¾åƒæ ¼å¼ç›¸å…³ï¼Œé˜…è¯»å‰å»ºè®®å…ˆç®€å•ç•¥è¯»ä¸€ä¸‹ä¹‹å‰å†™çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="http://dreampiggy.com/2017/03/06/%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8A%E5%8A%A8%E6%80%81%E5%9B%BE%E6%A0%BC%E5%BC%8F%E5%AF%B9%E6%AF%94%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">å®¢æˆ·ç«¯ä¸ŠåŠ¨æ€å›¾æ ¼å¼å¯¹æ¯”å’Œè§£å†³æ–¹æ¡ˆ</a></p></blockquote><h1 id="SDWebImage"><a href="#SDWebImage" class="headerlink" title="SDWebImage"></a>SDWebImage</h1><p><a href="https://github.com/rs/SDWebImage">SDWebImage</a>æ˜¯iOSå¹³å°ä¸Šéå¸¸è‘—åçš„å›¾ç‰‡ä¸‹è½½ã€ç¼“å­˜åº“ï¼Œè€Œä»Šå¹´å‘å¸ƒçš„SDWebImage 4.0åœ¨æ¶æ„ã€æ¥å£å˜åŠ¨å¹¶å¸¦æ¥æ€§èƒ½ä¼˜åŒ–çš„åŒæ—¶ï¼Œè¿˜æ”¯æŒäº†Animated WebPï¼Œå› æ­¤æˆ‘å°±é«˜å…´åœ°å»å®éªŒäº†ä¸€ä¸‹ï¼Œæœ¬æƒ³ç€å¯ä»¥æ›¿ä»£ä¹‹å‰ä½¿ç”¨çš„<a href="https://github.com/ibireme/YYImage">YYImage</a>ã€‚ä½†æ˜¯ä¸€æµ‹è¯•å°±å‘ç°æ¸²æŸ“ä¸æ­£å¸¸ï¼Œè¿½å›å»çœ‹æºç ï¼Œå‘ç°SDWebImageçš„å®ç°å¯ä»¥è¯´æ˜¯Too naiveï¼Œå‹æ ¹æ²¡æœ‰æŒ‰ç…§WebPè§„èŒƒå®ç°ï¼Œå¤§éƒ¨åˆ†Animated WebPåŠ¨å›¾æ¸²æŸ“éƒ½æŒ‚äº†ï¼Œå®Œå…¨ä¸å¯ç”¨ï¼ˆè¿æµ‹è¯•éƒ½è¿‡ä¸äº†ï¼Œæ›´åˆ«è¯´ç”Ÿäº§ç¯å¢ƒäº†ï¼‰ã€‚æ¼”ç¤ºDemoåœ¨æ­¤ï¼š<a href="https://github.com/dreampiggy/AnimatedWebPDemo">AnimatedWebPDemo</a></p><p>æ€»ç»“å‡ºæ¥çš„å…·ä½“é—®é¢˜æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ol><li>SDç»˜åˆ¶æ¯å¸§çš„canvaså¤§å°ä¸æ­£ç¡®ï¼Œåœ¨ä»£ç ä¸­ï¼Œç›´æ¥å–å¾—å½“å‰å¸§frameçš„å¤§å°ï¼Œè€Œéæ•´ä¸ªcanvasçš„å¤§å°ã€‚è¿™å°±å¯¼è‡´æœ€åç”Ÿæˆçš„æ‰€æœ‰å¸§å›¾ç‰‡çš„æ•°ç»„ä¸­ï¼Œæ¯å¸§çš„å›¾åƒå¤§å°ä¸ä¸€è‡´ã€‚è¿™æ ·æ¸²æŸ“å°±ä¼šå‡ºç°Bugï¼ˆæŠŠæ‰€æœ‰å¸§æ‹‰ä¼¸åˆ°æœ€å¤§çš„é‚£ä¸ªå›¾åƒå¤§å°ä¸Šï¼‰ã€‚</li><li>SDçš„å®ç°æ²¡æœ‰è€ƒè™‘è¿‡<a href="https://developers.google.com/speed/webp/docs/riff_container#animation">WebP Disposal Method</a>ï¼Œè¿™ä¸ªåœ¨å¾ˆå¤šåŠ¨å›¾ä¸­éƒ½ä¼šç”¨åˆ°ï¼Œå› ä¸ºèƒ½å¤Ÿé‡å¤åˆ©ç”¨å‰ä¸€å¸§çš„ç”»å¸ƒï¼Œæ¥å¤§å¹…å‡å°‘æœ€åç”ŸæˆåŠ¨å›¾çš„ä½“ç§¯ã€‚å¸¸è§çš„åŠ¨å›¾æ ¼å¼å¦‚GIFã€APNGç”Ÿæˆå·¥å…·ä¸€èˆ¬éƒ½é‡‡ç”¨è¿™ç§Disposalï¼Œä¸ç„¶æœ€ç»ˆæ–‡ä»¶ä½“ç§¯è¾ƒå¤§ï¼ˆä½†Googleæä¾›çš„WebPå·¥å…·æš‚æ—¶æ²¡æœ‰è‡ªå¸¦è¿™ç§ä¼˜åŒ–çš„æ–¹å¼ï¼Œä¸€èˆ¬ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å¤„ç†ï¼‰ã€‚</li><li>UIKitè‡ªå¸¦çš„<code>UIImage.animatedImages</code>æ˜¯éå¸¸å¼±çš„ï¼ŒSDå¹¶æ²¡æœ‰æä¾›é¢å¤–çš„æŠ½è±¡ï¼Œè€Œæ˜¯ç›´æ¥ç”¨çš„è¿™ä¸ªæ¥å£ã€‚è¿™å¸¦æ¥çš„æœ€å¤§çš„é—®é¢˜ï¼Œæ˜¯UIImageéœ€è¦æä¾›ä¸€ä¸ªå›¾ç‰‡æ•°ç»„å’Œæ€»æ—¶é•¿ï¼Œä½†æ˜¯ä¼šå¯¹æ•°ç»„ä¸­æ¯ä¸ªå›¾ç‰‡å¹³å‡åˆ†é…æ—¶é•¿ã€‚è¿™ä¸Animated WebPçš„è§„èŒƒå°±æ˜¯ä¸åŒçš„ï¼Œåè€…å…è®¸å¯¹æ¯å¸§è®¾ç½®ä¸€ä¸ªä¸åŒçš„æŒç»­æ—¶é•¿ã€‚</li><li>UIImageViewç›´æ¥è®¾ç½®<code>image</code>å±æ€§ï¼Œæ˜¯ä¸æ”¯æŒè®¾ç½®å¾ªç¯æ¬¡æ•°çš„ï¼Œä¼šé»˜è®¤æ— é™å¾ªç¯æ’­æ”¾ã€‚è€Œæœ‰äº›Animated WebPå›¾ç‰‡éœ€è¦æœ‰å¾ªç¯æ¬¡æ•°ã€‚</li></ol><p>æ—¢ç„¶çŸ¥é“è¿™ä¹ˆå¤šå‘ï¼Œæƒ³ç€SDæ¯•ç«Ÿæ˜¯ä¸»æµæ¡†æ¶ï¼Œå°±èµ¶ç´§æäº†<a href="https://github.com/rs/SDWebImage/issues/1951">Issue</a>ï¼Œä½†æ˜¯è¿‡äº†ä¸€å‘¨å¤šï¼ŒSDç¤¾åŒºä¾ç„¶æ²¡æœ‰ä»»ä½•å›åº”ã€‚äºæ˜¯å°è¯•è‡ªå·±ä¸€ä¸ªä¸ªè§£å†³ã€‚æœ€åçš„æˆæœä¹Ÿæ¯”è¾ƒå¥½ï¼Œä¸Šè¿°4ä¸ªé—®é¢˜éƒ½å¾—åˆ°äº†è§£å†³ã€‚</p><h2 id="Canvaså¤§å°é—®é¢˜"><a href="#Canvaså¤§å°é—®é¢˜" class="headerlink" title="Canvaså¤§å°é—®é¢˜"></a>Canvaså¤§å°é—®é¢˜</h2><p>è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡libwebpçš„APIï¼Œä¿®æ”¹æ¥ä½¿ç”¨canvaså¤§å°è€Œä¸æ˜¯frameå¤§å°ï¼Œç¡®ä¿æ¯å¸§æœ€åçš„å›¾åƒå¤§å°ç›¸åŒã€‚å…¶ä¸­ï¼Œä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå¯¹äºé€æ˜çš„ä¸”frameæ¯”canvasè¦å°çš„å¸§ï¼Œç»˜åˆ¶å‡ºæ¥ç­‰ä»·äºå°†frameå¹³ç§»ï¼Œç„¶åæ‰€æœ‰å‰©ä½™éƒ¨åˆ†å¡«å……é€æ˜å€¼ã€‚åœ¨ä½¿ç”¨CGBitmapContextçš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨è¦ä¼ å…¥çš„BitmapçŸ¢é‡æ•°æ®ä¸Šåšå˜æ¢ï¼Œå‡å°‘ç»˜åˆ¶å¸¦æ¥çš„å¼€é”€ï¼ˆä¸è¿‡CGBitmapContextæœ¬èº«åº”è¯¥æœ‰ä¼˜åŒ–ï¼Œå¯¹äºè¿™ä¸ªå¼€é”€å½±å“ä¸å¤§ï¼Œä½†å‚è€ƒYYImageé‡Œé¢æœ‰è¿™ä¸€æ­¥å¤„ç†ï¼‰</p><h2 id="Disposal-Methodæ”¯æŒ"><a href="#Disposal-Methodæ”¯æŒ" class="headerlink" title="Disposal Methodæ”¯æŒ"></a>Disposal Methodæ”¯æŒ</h2><p>åœ¨ç»˜åˆ¶æ¯å¸§æ—¶ï¼ŒæŒ‰ç…§Animated WebPè§„èŒƒï¼Œå…±äº«ä¸€ä¸ªå…¨å±€çš„CGContextå½“ä½œcanvasï¼Œæ ¹æ®æ¯å¸§ä¸åŒçš„Disposal Methodï¼Œå¦‚æœä¸ºDisposal Backgroundï¼Œåˆ™åœ¨ç»˜åˆ¶å®Œå½“å‰å¸§åæ¸…ç©ºCGContextï¼Œå¦åˆ™çš„è¯ä¸å¤„ç†ï¼Œä¿ç•™åˆ°ä¸‹ä¸€å¸§ç»§ç»­ç»˜åˆ¶ï¼Œæœ€ç»ˆæµ‹è¯•å’ŒYYImageè¡Œä¸ºä¸€è‡´ã€‚</p><h2 id="æ¯å¸§æŒç»­æ—¶é•¿ç›¸ç­‰é—®é¢˜"><a href="#æ¯å¸§æŒç»­æ—¶é•¿ç›¸ç­‰é—®é¢˜" class="headerlink" title="æ¯å¸§æŒç»­æ—¶é•¿ç›¸ç­‰é—®é¢˜"></a>æ¯å¸§æŒç»­æ—¶é•¿ç›¸ç­‰é—®é¢˜</h2><p>è¿™ä¸ªé—®é¢˜ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºä½ æ— æ³•æ”¹åŠ¨UIKitå®ç°æ–¹å¼ã€‚æœ€åæƒ³äº†ä¸€ä¸ªæ¯”è¾ƒTrickçš„æ–¹å¼ã€‚æ€è·¯ä¹Ÿç®€å•ï¼Œè€ƒè™‘è¿™æ ·çš„æƒ…å†µï¼šç¬¬1å¸§æŒç»­æ—¶é—´ï¼š50msï¼Œç¬¬2å¸§æŒç»­æ—¶é—´ï¼š100msï¼Œç¬¬3å¸§æŒç»­æ—¶é—´ï¼š150msï¼Œæ€»å…±æ—¶é•¿300msã€‚åœ¨ä¾ç„¶ä½¿ç”¨UIImageçš„æ¥å£æƒ…å†µä¸‹ï¼ˆå³æ•°ç»„æ¯å¸§æ—¶é•¿å¹³å‡åˆ†é…ï¼‰ï¼Œé‚£å°±å¯ä»¥æä¾›ä¸€ä¸ª[1, 2, 2, 3, 3, 3]ï¼ˆå…ƒç´ è¡¨ç¤ºå¸§çš„ç¼–å·ï¼‰çš„å›¾åƒæ•°ç»„ï¼Œæ€»æ—¶é•¿300msã€‚è¿™æ ·çš„è¯å¹³å‡åˆ†åˆ°æ¯ä¸ªå…ƒç´ æ˜¯50msï¼Œè¡¨é¢ä¸Šçœ‹æ˜¯6å¸§ä½†å®é™…æ¸²æŸ“æ˜¯3å¸§ï¼Œä¹Ÿèƒ½è¾¾åˆ°æœ€åçš„æ˜¾ç¤ºæ•ˆæœã€‚è¿™æ ·å®ç°çš„è¯ï¼Œåªè¦æ±‚ä¸€ä¸ªæ‰€æœ‰å¸§æŒç»­æ—¶é—´çš„gcdï¼Œç„¶åå¯¹æ¯å¸§å›¾åƒï¼ŒæŒ‰è¯¥å¸§æ‰€å çš„æ¯”ä¾‹é‡å¤æ·»åŠ å¤šæ¬¡å°±å¯ä»¥äº†ã€‚</p><h2 id="å¾ªç¯æ¬¡æ•°é—®é¢˜"><a href="#å¾ªç¯æ¬¡æ•°é—®é¢˜" class="headerlink" title="å¾ªç¯æ¬¡æ•°é—®é¢˜"></a>å¾ªç¯æ¬¡æ•°é—®é¢˜</h2><p>ç”±äºSDçš„æ¥å£é—®é¢˜ï¼ˆç”¨åˆ°äº†UIImageViewçš„<code>sd_setImageWithURL</code>ï¼‰ï¼Œæ˜¯ç›´æ¥è®¾ç½®åˆ°<code>UIImageView.image</code>ä¸Šçš„ï¼Œè€Œä¸æ˜¯<code>animationImages</code>ã€‚è€Œç›´æ¥è®¾ç½®<code>image</code>ä¼šæ— è§†æ‰<code>animationRepeatCount</code>è¿™ä¸ªæœ¬æ¥ç”¨äºè®¾ç½®å¾ªç¯æ¬¡æ•°çš„å±æ€§ã€‚ä½†å¦‚æœSDæ¡†æ¶è‡ªåŠ¨è®¾ç½®<code>animationImages </code>å±æ€§çš„è¯ï¼Œå¯èƒ½å¯¹ä½¿ç”¨è€…ç°æœ‰ä»£ç æœ‰å½±å“ï¼ˆå› ä¸ºä½¿ç”¨è€…è¿˜æ˜¯ç”¨çš„<code>image</code>å±æ€§è€Œä¸æ˜¯<code>animationImages</code>å±æ€§ï¼‰ï¼Œå› æ­¤æœ€åçš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯åœ¨UIImageçš„æ‰©å±•ä¸­ï¼Œå•ç‹¬æä¾›äº†ä¸€ä¸ª<code>sd_webpLoopCount</code>çš„å±æ€§æ¥è·å–å¾ªç¯æ¬¡æ•°ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªè¡Œè®¾ç½®UIImageViewçš„å±æ€§ï¼Œæ¥å®ç°æŒ‡å®šå¾ªç¯æ¬¡æ•°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸€èˆ¬æƒ…å½¢ä¸‹ï¼ˆæ˜¾ç¤ºçš„åŠ¨å›¾è¶…è¿‡å¾ªç¯æ¬¡æ•°ååœåˆ°æœ€åä¸€å¸§ä¸Šï¼‰å°±å¯ä»¥è¿™æ ·å­ç”¨ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[imageView sd_setImageWithURL:webpURL completed:^(<span class="built_in">UIImage</span> * _Nullable image, <span class="built_in">NSError</span> * _Nullable error, SDImageCacheType cacheType, <span class="built_in">NSURL</span> * _Nullable imageURL) &#123;</span><br><span class="line">    imageView.image = image.images.lastObject;</span><br><span class="line">    imageView.animationDuration = image.duration;</span><br><span class="line">    imageView.animationRepeatCount = image.sd_webpLoopCount;</span><br><span class="line">    imageView.animationImages = image.images;</span><br><span class="line">    [imageView startAnimating];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿç®—æ˜¯ä¸€ä¸ªè§£å†³æ–¹å¼å§ã€‚</p><h2 id="æ„Ÿå—"><a href="#æ„Ÿå—" class="headerlink" title="æ„Ÿå—"></a>æ„Ÿå—</h2><p>åœ¨å†™å®Œè¿™äº›ï¼Œè·‘è¿‡å•å…ƒæµ‹è¯•ï¼Œæäº¤äº†<a href="https://github.com/rs/SDWebImage/pull/1952">Pull request</a>ä¹‹åï¼Œå›å¤´æ¥çœ‹ï¼Œæ‰èƒ½çœŸæ­£æ„Ÿåˆ°YYImageçš„å®åŠ›ã€‚</p><p>YYImageé€šè¿‡ä¸€ä¸ªæŠ½è±¡å±‚YYImageFrameï¼Œæ¥æŠŠGIFã€APNGå’ŒAnimated WebPä¸‰ç§æ ¼å¼ç»Ÿä¸€åˆ°ä¸€èµ·ï¼Œå¹¶ä¸”æä¾›äº†Encoderå’ŒDecoderå¯ä»¥åœ¨ä¸‰ç§æ ¼å¼æ¥äº’ç›¸è½¬æ¢ï¼ˆè¿™æ˜¯é‡ç‚¹ï¼‰ã€‚å…³äºç»˜åˆ¶éƒ¨åˆ†ï¼Œè¿˜ä½¿ç”¨åˆ°äº†<a href="https://developer.apple.com/documentation/accelerate">Accelerate Framework</a>ï¼Œé€šè¿‡vImageçš„GPUåŠ é€Ÿçš„Bitmapå˜æ¢æ¥æ›¿ä»£éƒ¨åˆ†CGBitmapContextç»˜åˆ¶ã€‚åœ¨ç¼“å­˜ä¸Šï¼Œç”±äºSDçš„æŠ½è±¡å±‚å­˜åœ¨ï¼Œä»–ä½¿ç”¨äº†<a href="https://developer.apple.com/documentation/imageio">ImageIO</a>æ¥ç›´æ¥ç¼“å­˜CGImageSourceï¼ˆSDé‡‡ç”¨çš„æ˜¯ç¼“å­˜äº†WebPçš„rawDataï¼‰ï¼Œæ•ˆç‡æå‡äº†å¾ˆé«˜ä¹Ÿå‡å°‘ç¼“å­˜å¤§å°ï¼ˆé€Ÿåº¦å¯¹æ¯”çš„è¯ï¼Œå¯ä»¥ä»é‚£ä¸ªDemoå·¥ç¨‹çœ‹åˆ°ï¼Œcheckoutåˆ°<code>fix_sd_animated_webp_canvas_size</code>åˆ†æ”¯ä¸Šè¿è¡Œï¼‰ã€‚æƒ³æƒ³è¿˜æ˜¯æŒºä½©æœibiremeè¿™ä¸ªäººçš„ï¼Œçœ‹æ¥ä»¥åè¿˜è¦å¤šä½¿ç”¨YYKitå¹¶å¤šå­¦ä¹ ã€‚</p><h1 id="apng2webp"><a href="#apng2webp" class="headerlink" title="apng2webp"></a>apng2webp</h1><p><a href="https://github.com/Benny-/apng2webp">apng2webp</a>æ˜¯ä¸€ä¸ªè½¬æ¢APNGåˆ°Animated WebPå›¾ç‰‡çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨Pythonè„šæœ¬ + å¤–éƒ¨å‘½ä»¤è¡Œå·¥å…·æ¥å®ç°ã€‚åœ¨ä¹‹å‰çš„å·¥ä½œéœ€æ±‚ä¸­ï¼Œä½¿ç”¨åˆ°æ¥ä¼˜åŒ–APNGçš„å¤§å°ï¼Œå¹¶ä¸”äº§å‡ºAnimated WebPæ¥è®©å®¢æˆ·ç«¯ä½¿ç”¨ã€‚</p><p>ä¸ºä»€ä¹ˆè¦è½¬æ¢APNGåˆ°Animated WebPå‘¢ï¼Œå…¶å®æ˜¯å› ä¸ºAPNGè¿™ä¸ªè§„èŒƒç”±äºæ²¡æœ‰è¿›å…¥åˆ°PNGæ ‡å‡†è§„èŒƒä¸­ï¼Œä¸€ç›´å¤„äºä¸€ä¸ªä¸æ¸©ä¸ç«çš„åœ°æ­¥ï¼Œç½‘ä¸Šçš„APNGåŠ¨å›¾æ•°é‡ä¹Ÿä¸å¤šï¼Œå¾ˆå¤šç½‘é¡µçš„PNGå›¾ç‰‡ä¸Šä¼ ä¹Ÿä¸æ”¯æŒã€‚è™½ç„¶å¦‚ä»Šå„å¤§æµè§ˆå™¨éƒ½å¯¹APNGæä¾›äº†æ”¯æŒï¼ˆChrome 59æ­£å¼æ”¯æŒäº†APNGï¼ŒiOSå¾ˆæ—©ä»8.0æ”¯æŒï¼ŒFireFoxå°±æ˜¯äº²çˆ¹ä¸€ç›´æ¨åŠ¨ï¼‰ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸Šï¼ŒAndroidç«¯æ²¡æœ‰ç›¸å¯¹é è°±çš„è§£ç å’Œæ¸²æŸ“ç»„ä»¶èƒ½å¤Ÿä½¿ç”¨ã€‚åå€’æ˜¯Animated WebPå€ŸåŠ©Googleäº²çˆ¹æ¨åŠ¨ï¼Œæˆä¸ºAndroidå¤©ç”Ÿæ”¯æŒçš„å›¾åƒæ ¼å¼ï¼Œå¹¶ä¸”iOSä¸Šä¹Ÿæœ‰YYImageæ¥æä¾›æ”¯æŒã€‚éšç€WebPçš„æµè¡Œï¼Œè¶Šæ¥è¶Šå¤šè®¾å¤‡ä¼°è®¡éƒ½ä¼šæ”¯æŒWebPå’ŒAnimated WebPï¼Œç”šè‡³æœ€ç»ˆè¶…è¶ŠGIFè¿™ä¸ªå¹¿ä¸ºæµè¡Œï¼Œä½†æ˜¯å·²æœ‰30å¹´å†å²ï¼Œåªæ”¯æŒ256è‰²å’Œ1ä½alphaé€šé“çš„å¤è€åŠ¨å›¾æ ¼å¼ã€‚</p><p>è¿™æ¬¡å¯¹apng2webpé¡¹ç›®ï¼Œä¸»è¦æ˜¯è´¡çŒ®äº†ä¸¤ä¸ªåŠŸèƒ½ã€‚</p><ol><li>Windowsçš„æ”¯æŒï¼Œå³ç°åœ¨ä¸‰å¤§æ¡Œé¢ç«¯å‘½ä»¤è¡Œå‡å¯ä½¿ç”¨</li><li>CIè‡ªåŠ¨Buildå’ŒTest</li></ol><h2 id="Windowsçš„æ”¯æŒ"><a href="#Windowsçš„æ”¯æŒ" class="headerlink" title="Windowsçš„æ”¯æŒ"></a>Windowsçš„æ”¯æŒ</h2><p>ç”±äºæ•´ä¸ªå¤–éƒ¨å‘½ä»¤è¡Œå·¥å…·(æœ‰å››ä¸ªå·¥å…·ï¼Œå…¶ä¸­<code>cwebp</code>å’Œ<code>webpmux</code>æ˜¯Googleå®˜æ–¹æä¾›çš„ï¼Œæœ‰Windows Buildï¼Œå¦ä¸¤ä¸ªæ˜¯æºç ç¼–è¯‘ï¼‰éƒ½æ˜¯UNIXå·¥å…·é“¾ä¸‹çš„ï¼Œä¾èµ–å‡ ä¸ªC++åº“ä¹ŸæŒºå¸¸è§ï¼Œä½†æ˜¯å°è¯•è¿‡ä½¿ç”¨VS 2015æºç ç¼–è¯‘è·ªäº†ï¼Œä½¿ç”¨<a href="https://github.com/Microsoft/vcpkg">vcpkg</a>è¿™ä¸ªéå¸¸æ–°çš„Windowsä¸Šçš„C++åŒ…ç®¡ç†å·¥å…·ï¼Œåˆçˆ†äº†ä¸€å †<a href="https://www.zhihu.com/question/62158323/answer/196189709">link error</a>ã€‚å¯¹äºæˆ‘è¿™ç§C++èœé¸Ÿæ¥è¯´ï¼Œæœ€ååªå¥½é€‰æ‹©äº†ç›´æ¥ä¸Š<a href="http://www.msys2.org/">Mysys2</a>å’ŒMinGW-w64ï¼Œä¸€é”®<code>pacman -S</code>å®‰è£…ä¾èµ–ï¼Œcmake makefileå¯ç”¨ï¼Œè·‘äº†ä¸€éæµ‹è¯•ä¹Ÿæ²¡é—®é¢˜ï¼Œç¡®å®éå¸¸æ–¹ä¾¿ã€‚ç”±äºMinGW-w64çš„ç¼–è¯‘äº§ç‰©ï¼Œä¼šä¾èµ–äºlibgccï¼Œwinpthreadsï¼Œä¸ºäº†ä½¿æœ€åçš„åˆ†å‘æ–¹ä¾¿ï¼Œäºæ˜¯åœ¨Windowsä¸Šæ”¹ç”¨é™æ€é“¾æ¥ã€‚</p><h2 id="CIå’Œå•å…ƒæµ‹è¯•"><a href="#CIå’Œå•å…ƒæµ‹è¯•" class="headerlink" title="CIå’Œå•å…ƒæµ‹è¯•"></a>CIå’Œå•å…ƒæµ‹è¯•</h2><p>å…³äºPythonçš„å•å…ƒæµ‹è¯•ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæœ€åå°±é€šè¿‡å¼•å…¥pytestï¼Œç›´æ¥å¯¹mainå‡½æ•°å’Œå¤–éƒ¨å·¥å…·è¿›è¡Œäº†æµ‹è¯•ï¼Œå†™èµ·æ¥ä¹Ÿç‰¹åˆ«ç®€å•ï¼ˆè‡ªåŠ¨åŒ¹é…æ–‡ä»¶åå’Œç±»åè¿™ç‚¹æŒºå¥½ï¼‰ã€‚ç”¨èµ·æ¥æ„Ÿè§‰æ¯”èµ·Objective-Cå’ŒJavaçš„å·¥å…·è¦å¥½ç”¨å¤šäº†ã€‚</p><p>åœ¨CI Buildä¸Šï¼Œå¯¹äºLinuxå’ŒmacOSçš„è¯ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨GitHubå®˜æ–¹åˆä½œçš„<a href="travis-ci.org">Travis CI</a>ï¼Œé…ç½®ä½¿ç”¨ymlè¯­æ³•ï¼Œå†åŠ ä¸Šä¸€ç³»åˆ—çš„Bashå‘½ä»¤ã€‚è€ŒWindowsä¸Šä½¿ç”¨çš„<a href="https://ci.appveyor.com/">Appveyor</a>ä¹Ÿéå¸¸å¥½ç”¨ï¼Œè‡ªå¸¦äº†<code>VS 2012,2015,2017</code>ï¼Œ<code>Msys2</code>ï¼Œ<code>MinGW-w64</code>ï¼Œ<code>cmake</code>ç­‰ä¸€ç³»åˆ—å·¥å…·ï¼Œä¸Šæ‰‹å¼€ç®±å³ç”¨ã€‚é…ç½®çš„è¯æ³¨æ„è¦ä½¿ç”¨CMDæˆ–è€…PowerShellï¼Œå¦‚æœä¸ç†Ÿæ‚‰ï¼Œç”šè‡³å¯ä»¥ç”¨Msys2è£…ä¸€äº›UNIXå·¥å…·æ¥æå®šï¼ˆå¥½å¤„ä¹‹ä¸€ï¼‰ã€‚</p><h2 id="æ„Ÿå—-1"><a href="#æ„Ÿå—-1" class="headerlink" title="æ„Ÿå—"></a>æ„Ÿå—</h2><p>æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯è‹¦åŠ›æ´»ï¼Œä¸è¿‡ä¹Ÿç®—ç†Ÿæ‚‰äº†ä¸€ä¸‹UNIXå·¥å…·åœ¨Windowsä¸Šç§»æ¤çš„ä¸€ç§æ‰‹æ®µï¼Œè€Œä¸”è¿˜å­¦ä¹ åˆ°äº†pytestå’Œå¼€æºé¡¹ç›®çš„CI Buildæ–¹å¼ï¼Œä¹Ÿç®—æœ‰ç‚¹æ„æ€å§ã€‚</p><h1 id="iSparta"><a href="#iSparta" class="headerlink" title="iSparta"></a>iSparta</h1><p><a href="https://github.com/iSparta/iSparta">iSparta</a>æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–çš„APNGå’ŒWebPè½¬æ¢å·¥å…·ï¼ŒåŒ…å«äº†å¾ˆå¤šåŠŸèƒ½ï¼ˆAPNGåˆæˆï¼ŒWebPè½¬æ¢ï¼Œå›¾ç‰‡å‹ç¼©ç­‰ï¼‰ï¼Œè™½è¯´æ˜¯å¼€æºé¡¹ç›®ï¼Œä½†æ˜¯ä¸Šä¸€æ¬¡æäº¤å·²ç»æ˜¯ä¸‰å¹´å‰äº†ã€‚è€Œæˆ‘æœ€å¸Œæœ›çš„APNGè½¬æ¢Animated WebPåŠŸèƒ½å´æ²¡æœ‰å®ç°ï¼ˆè¿™ä¹Ÿéš¾æ€ªï¼Œä¸‰å¹´å‰Animated WebPè§„èŒƒè¿˜æ²¡å‡ºæ¥ï¼‰ã€‚å¤§æ¦‚çœ‹äº†ä¸€çœ¼ï¼Œä½¿ç”¨çš„æ˜¯<a href="https://nwjs.io/">NW.js</a>ï¼ˆå…¶å®ç”¨çš„æ˜¯æ”¹åå‰å«åš<code>node-webkit</code>çš„ä¸œè¥¿ï¼‰ï¼Œæ˜¯ä¸€ä¸ªå’Œ<a href="https://electron.atom.io/">Electron</a>ç±»ä¼¼çš„ï¼Œä½¿ç”¨å‰ç«¯æŠ€æœ¯æ ˆæ¥æ„å»ºè·¨å¹³å°åº”ç”¨çš„æ¡†æ¶ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªChromiumçš„è¿è¡Œç¯å¢ƒæ¥æä¾›æ¸²æŸ“ï¼Œå†åŠ ä¸Šnode.jsæ¥æä¾›JS Runtimeã€‚ä¸Šæ‰‹ç›¸å¯¹å®¹æ˜“ã€‚</p><p>åŸºæœ¬ä¸Šçš„ç›®æ ‡ï¼Œæ˜¯ä¸ºäº†æä¾›æ›´å¥½çš„GUIå·¥å…·ï¼Œå› æ­¤ä¸»è¦å°±å‚è€ƒäº†ä¸€ä¸‹iSpartaçš„Issueï¼Œè§£å†³è¿™å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>æ”¯æŒAPNGè½¬æ¢Animated WebP</li><li>æ”¯æŒi18nå›½é™…åŒ–</li></ol><p>ç”±äºæˆ‘å¹¶ä¸æ˜¯ä¸“ä¸šå‰ç«¯å‡ºèº«ï¼ˆå¤§äºŒå­¦è¿‡ä¸€æ®µæ—¶é—´å‰ç«¯åŸºæœ¬çŸ¥è¯†å’ŒNode.jsç®€å•åº”ç”¨ï¼Œä¹Ÿæ¥è§¦è¿‡React Nativeï¼‰ï¼Œç»è¿‡è¿‘ä¸¤å¤©çš„å¥‹æ–—ï¼Œæ‰ç»ˆäºç£•ç£•ç¢°ç¢°å®Œæˆã€‚æœŸé—´é‡åˆ°è¿‡å„ç§é—®é¢˜ï¼ˆNW.jsçš„é—®é¢˜ï¼Œnodeç¬¬ä¸‰æ–¹åº“çš„é—®é¢˜ï¼Œè·¨å¹³å°è¡Œä¸ºä¸ä¸€è‡´çš„é—®é¢˜ç­‰ç­‰ï¼‰ï¼Œä¸è¿‡åœ¨è¿™é‡Œç•¥è¿‡è¯´ä¸€ä¸‹é‡ç‚¹å§ã€‚</p><h2 id="APNGæ”¯æŒAnimated-WebP"><a href="#APNGæ”¯æŒAnimated-WebP" class="headerlink" title="APNGæ”¯æŒAnimated WebP"></a>APNGæ”¯æŒAnimated WebP</h2><p>å…³äºè¿™ä¸ªåŠŸèƒ½ï¼Œè‡ªç„¶å¯ä»¥æƒ³åˆ°ä¸Šé¢çš„apng2webpå‘½ä»¤è¡Œå·¥å…·ï¼Œä¸è¿‡ç”±äºapng2webpæœ¬èº«æ˜¯Pythonå†™çš„è„šæœ¬æ¥è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œæ²¡å¿…è¦åœ¨NW.jsé‡Œæ‰“åŒ…ä¸€ä¸ªPythonç¯å¢ƒã€‚å› æ­¤æœ€åå°±å†³å®šç›´æ¥åœ¨JSé‡Œï¼Œå®ç°äº†ç›¸åŒé€»è¾‘çš„è„šæœ¬æ¥å®Œæˆã€‚ä¸è¿‡å®è¯è¯´è¿™éƒ¨åˆ†èŠ±è´¹çš„æ—¶é—´ä¸é•¿ï¼Œåœ¨GUIå¸ƒå±€ä¸Šæ‰æ˜¯é‡å¤´ã€‚å¤§ä½“æ¡†æ¶å‚è€ƒäº†é¡¹ç›®ä¸­çš„å·²æœ‰å†™æ³•ï¼Œä½†CSSçš„éƒ¨åˆ†ç”±äºå®åœ¨ç”Ÿç–ï¼ˆåŸé¡¹ç›®æœ‰ä¸€äº›å¸ƒå±€Hackï¼‰ï¼Œæœ€åä½¿ç”¨äº†<a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/">flexbox</a>å¸ƒå±€æ¥æå®šçš„ã€‚</p><h2 id="i18nå›½é™…åŒ–"><a href="#i18nå›½é™…åŒ–" class="headerlink" title="i18nå›½é™…åŒ–"></a>i18nå›½é™…åŒ–</h2><p>åœ¨ç½‘é¡µç«¯æ”¯æŒi18nå›½é™…åŒ–ï¼Œè¿™æ˜¯ç¡®å®æ˜¯ä»¥å‰æœªæ¥è§¦è¿‡çš„åœ°æ–¹ã€‚è€ƒè™‘åˆ°è¿™ä¸ªé¡¹ç›®æœ‰å¤§é‡æ•£è½çš„HTMLæ–‡æœ¬ä¸­ç¡¬ç¼–ç äº†ä¸­æ–‡æ–‡å­—ï¼Œè€Œåˆæ²¡æœ‰ä½¿ç”¨ç±»ä¼¼äºAngularã€Reactè¿™ç§å…ˆè¿›çš„æŠ€æœ¯æ¥æ”¯æŒæ¨¡æ¿ï¼Œå› æ­¤å°±éœ€è¦è‡ªè¡Œè§£å†³ã€‚æœ€å¼€å§‹æ€è€ƒäº†ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“çš„è§£å†³æ–¹æ¡ˆï¼ˆå³NW.jså½“ä½œæµè§ˆå™¨ï¼Œæœ¬åœ°èµ·nodeä½¿ç”¨expresså½“ä½œæœåŠ¡ç«¯ï¼Œæ¥è¿”å›æ¸²æŸ“å¥½å¯¹åº”å›½é™…åŒ–åçš„HTMLï¼‰ï¼Œä½†æ˜¯é‡åˆ°äº†é—®é¢˜ï¼Œå½“ä½œçº¯æµè§ˆå™¨åï¼ŒNW.jsæ— æ³•å†ä½¿ç”¨nodeç«¯çš„æœ¬åœ°åŒ…ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æ— æ³•è°ƒç”¨å¤–éƒ¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼ˆç›¸å½“äºRPCäº†ï¼‰ã€‚å› æ­¤è¿™ç§æ–¹æ¡ˆä¸å¯è¡Œã€‚</p><p>å†ç»è¿‡å°è¯•åï¼Œæœ€åä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯å¼•å…¥äº†<a href="https://github.com/mashpie/i18n-node">node-i18n</a>å’Œæ¨¡æ¿å¼•æ“ï¼ˆè¿™é‡Œç”¨çš„æ˜¯<a href="olado.github.io/doT/">doT</a>ï¼‰ã€‚åœ¨é¡¹ç›®ç›®å½•ä¸‹å‡†å¤‡å¥½i18nçš„æ–‡æœ¬èµ„æºï¼ˆæ¡†æ¶æ”¯æŒçš„æ˜¯JSONæ ¼å¼ï¼‰ã€‚ç„¶ååœ¨NW.jsåº”ç”¨å¯åŠ¨æ—¶åŠ è½½ä¸€ä¸ªç©ºbodyçš„é¡µé¢ï¼Œæ‰§è¡ŒJSæ¥è·å–i18nåçš„å­—ç¬¦ä¸²ï¼Œå†å°†è¿™äº›å­—ç¬¦ä¸²æ¸²æŸ“åˆ°åªæœ‰bodyçš„æ¨¡æ¿ä¸­ï¼Œæœ€åæŠŠå›½é™…åŒ–å®Œæˆåçš„HTML bodyæ’å…¥åˆ°åŸå§‹çš„é¡µé¢çš„bodyä¸­ã€‚æ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰å¤šä½™çš„å¼€é”€ï¼ˆé¿å…äº†æ¨¡æ¿æœªæ¸²æŸ“å‰è¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œä¸”å¯ä»¥ç¼“å­˜æ¨¡æ¿ç»“æœï¼Œå› ä¸ºå®é™…ä¸Šç»™å®šä¸€ç§localeï¼Œæ¨¡æ¿ç”Ÿæˆçš„HTMLæ˜¯å›ºå®šçš„ï¼‰ã€‚</p><h2 id="æ„Ÿå—-2"><a href="#æ„Ÿå—-2" class="headerlink" title="æ„Ÿå—"></a>æ„Ÿå—</h2><p>å…¶å®ç°åœ¨çœ‹çœ‹è‡ªå·±å¹³æ—¶ç”¨åˆ°çš„åº”ç”¨ï¼Œ<code>Atom</code>ã€<code>VS Code</code>ã€<code>GitKraken</code>ã€<code>é’‰é’‰</code>ï¼Œè¿™äº›çœ‹èµ·æ¥å·²ç»è¶³å¤Ÿå¤æ‚ï¼Œä¹Ÿéƒ½èƒ½å¤Ÿç”¨è¿™ç§å‰ç«¯æŠ€æœ¯æ ˆæ„å»ºèµ·æ¥äº†ã€‚ä»¥å‰è‡ªå·±å¦‚æœæåˆ°è·¨å¹³å°æ¡Œé¢å®¢æˆ·ç«¯åº”ç”¨ï¼Œç¬¬ä¸€ååº”å°±æ˜¯Qtï¼Œä¸è¿‡ç°åœ¨çœ‹æ¥ï¼Œå¦‚æœå¯¹å‰ç«¯æŠ€æœ¯æ ˆæœ‰æ‰€äº†è§£ï¼Œå¯¹æ€§èƒ½å’Œå®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œæ˜¯å¯ä»¥ä½¿ç”¨Electronæˆ–è€…NW.jsè¿™ç§æ¡†æ¶æ¥æ„å»ºã€‚è™½ç„¶æ›¾ç»è§è¿‡æœ‰äººæ‰¹åˆ¤è¿™äº›æ¡†æ¶ï¼ˆä½“ç§¯åºå¤§-æ‰“åŒ…äº†Chromiumå’ŒNodeï¼›å†…å­˜å ç”¨é«˜ï¼Œæ•ˆç‡ä½ä¸‹-WebKitæ¸²æŸ“è€Œä¸æ˜¯åŸç”ŸUIç»„ä»¶ï¼‰ï¼Œ<a href="https://www.reddit.com/r/programming/comments/64oqaq/electron_is_flash_for_the_desktop/">reddit</a>ä¸Šç”šè‡³æœ‰è®¨è®ºè¯´è¿™æ˜¯æ–°ä¸€ä»£çš„Adobe Flashã€‚</p><p>ä½†æˆ‘ä¸ªäººçœ‹æ¥ï¼Œä¸æ’æ–¥è¿™æ ·çš„æ¡†æ¶ï¼Œåªæ˜¯æ„Ÿè§‰å¦‚ä»Šçš„è§£å†³æ–¹æ¡ˆå¹¶ä¸æ˜¯ååˆ†å®Œç¾ï¼Œè¿™äº›å‰ç«¯æ ˆæŠ€æœ¯å†™çš„å®¢æˆ·ç«¯æœ€å¤§çš„é—®é¢˜å…¶å®æ˜¯ä»£ç å¤ç”¨é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šæ˜¯å„å®¶æœ‰è‡ªå·±çš„ä¸€å¥—ç»„ä»¶ï¼Œè€Œä¸”å¾ˆå¤šè§£å†³æ–¹æ¡ˆå¾ˆTrickã€‚æˆ‘è§‰å¾—æ›´ä¸ºç†æƒ³çš„æƒ…å†µï¼Œæ˜¯èƒ½å¤Ÿæä¾›ä¸€å¥—å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«äº†å¼€ç®±å³ç”¨çš„UIç»„ä»¶ï¼ˆå¹¶éæŒ‡Bootstrapè¿™ç§é€šç”¨Web UIç»„ä»¶ï¼Œè€Œæ˜¯ä¸“é—¨é’ˆå¯¹æ¡Œé¢å®¢æˆ·ç«¯ä¼˜åŒ–çš„ï¼Œç¬¦åˆå®¢æˆ·ç«¯çš„äº¤äº’æ–¹å¼ï¼‰ï¼Œèƒ½å¤Ÿå¼€å‘ï¼Œæ„å»ºï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…ä¸€ç«™å¼è‡ªåŠ¨å¤„ç†ï¼Œè¶³å¤Ÿå¤šçš„Nativeæ¡¥æ¥ï¼ˆè¿™ä¹Ÿæ˜¯ä¸€å¤§ç—›ç‚¹ï¼Œè§è¿‡ä¸€äº›åº”ç”¨åˆå›è¿‡å¤´åœ¨Electroné‡Œé¢ä½¿ç”¨Flashï¼‰ï¼Œæ›´å¤šçš„ä¼˜åŒ–ï¼Œæ¯”å¦‚å…±äº«Chromiumå®¹å™¨-ä¸å¿…æ¯ä¸ªåº”ç”¨çš„å¸¦ä¸Š200MBçš„è¿è¡Œç¯å¢ƒã€‚</p><p>æ€»ä½“æ¥è¯´ï¼ŒElectronæˆ–è€…NW.jsè¿™äº›æ¡†æ¶çš„å‰é€”è¿˜æ˜¯æ¯”è¾ƒå…‰æ˜çš„ï¼Œæ¯•ç«Ÿä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æ¡Œé¢åº”ç”¨å¼€å‘æˆæœ¬è¿˜æ˜¯å¤ªé«˜ï¼Œå°¤å…¶æ˜¯äº’è”ç½‘å…¬å¸çš„äº§å“ï¼Œè¿½æ±‚è·¨å¹³å°çš„æƒ…å†µä¸‹ï¼Œåœ¨æˆæœ¬ï¼ŒäººåŠ›è¿˜æœ‰æŠ€æœ¯éš¾ç‚¹è€ƒè™‘æ¥çœ‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶å®ï¼Œè¿™ä¸‰ä¸ªå¼€æºé¡¹ç›®éƒ½æ˜¯å±äºä¸€æ—¶å…´èµ·æ‰å»è´¡çŒ®çš„ï¼Œå¹¶ä¸æ˜¯ä¸ºäº†è€Œå»ä¸“é—¨å¯»æ‰¾çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆéƒ½æ˜¯WebPç›¸å…³ï¼Œæˆ–è®¸çœŸçš„æ˜¯å·§åˆå§ã€‚å‚ä¸è¿™äº›å¼€æºé¡¹ç›®ï¼Œè™½ç„¶èŠ±è´¹äº†ä¸€å®šçš„æ—¶é—´ç²¾åŠ›ï¼Œä½†æ˜¯è·å¾—çš„çŸ¥è¯†é¢ä¸Šçš„æå‡ç¡®å®éå¸¸å¤§ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š<code>WebPè§„èŒƒ</code>ã€<code>Accelerate Framework</code>ã€<code>è·¨å¹³å°C++ç§»æ¤</code>ã€<code>Pythonå•å…ƒæµ‹è¯•</code>ã€<code>CIé…ç½®</code>ã€<code>NW.js</code>å’Œ<code>å‰ç«¯i18n</code>ã€‚</p><p>è¯´å®è¯ï¼Œå‚ä¸å¼€æºé¡¹ç›®çš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°ä¸€äº›ç¤¾åŒºæ˜¯å¾ˆæœ‰æ„æ€çš„ï¼Œä½ èƒ½å¤Ÿå’Œä¸è®¤è¯†çš„äººå»åˆä½œï¼Œè¿˜èƒ½å¤Ÿç›´è§‚æ„Ÿå—åˆ°å…¶ä»–äººå¯¹é¡¹ç›®çš„å…³æ³¨ï¼Œæ›´èƒ½å¤Ÿæ¥è§¦å¾ˆå¤šä½ ä¹‹å‰ä»æ²¡æœ‰æ¥è§¦è¿‡çš„æŠ€æœ¯æ ˆã€‚æˆ‘ä¸èƒ½è¯´è‡ªå·±æ˜¯ä¸€ä¸ªæ„¿æ„èŠ±è´¹å¤§é‡ä¸ªäººæ—¶é—´å»è´¡çŒ®å¼€æºäº‹ä¸šçš„äººï¼Œä½†æ˜¯å…¶å®å¾ˆå¤šé¡¹ç›®å‚ä¸é—¨æ§›ä¸æ˜¯é‚£ä¹ˆé«˜ï¼Œæ— è®ºæ˜¯ä½ è‡ªå·±å¹³æ—¶ç”¨åˆ°çš„è½¯ä»¶ã€ç±»åº“ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªå°å·¥å…·ã€è„šæœ¬ã€ç¿»è¯‘ã€æ•™ç¨‹ï¼Œéƒ½å¯ä»¥è¯•ç€å‚ä¸ä¸€ä¸‹ã€‚æˆ‘è§‰å¾—ç¨‹åºå‘˜çš„çŸ¥è¯†ï¼Œå¹¶ä¸æ˜¯ä¸ºäº†å•çº¯ä¸ºäº†æ‰“å·¥æ¬ç –ï¼Œèƒ½å¤ŸæŠŠè‡ªå·±çš„æƒ³æ³•ä¸ä»–äººåˆ†äº«ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„ä¹è¶£ï¼Œä¸æ˜¯å—ï¼Ÿ</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« è®²çš„æ˜¯æœ‰å…³è¿‘æœŸè‡ªå·±å‚ä¸çš„å‡ ä¸ªå¼€æºé¡¹ç›®çš„ç»å†ä»¥åŠæ„Ÿå—ï¼Œä¸è¿‡å·§åˆçš„æ˜¯å†…å®¹éƒ½å’ŒAPNGå’ŒWebPè¿™ä¸¤ç§å›¾åƒæ ¼å¼ç›¸å…³ï¼Œé˜…è¯»å‰å»ºè®®å…ˆç®€å•ç•¥è¯»ä¸€ä¸‹ä¹‹å‰å†™çš„ä¸€ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;http://dreampiggy.com/2017/03/06/%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8A%E5%8A%A8%E6%80%81%E5%9B%BE%E6%A0%BC%E5%BC%8F%E5%AF%B9%E6%AF%94%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/&quot;&gt;å®¢æˆ·ç«¯ä¸ŠåŠ¨æ€å›¾æ ¼å¼å¯¹æ¯”å’Œè§£å†³æ–¹æ¡ˆ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;SDWebImage&quot;&gt;&lt;a href=&quot;#SDWebImage&quot; class=&quot;headerlink&quot; title=&quot;SDWebImage&quot;&gt;&lt;/a&gt;SDWebImage&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/rs/SDWebImage&quot;&gt;SDWebImage&lt;/a&gt;æ˜¯iOSå¹³å°ä¸Šéå¸¸è‘—åçš„å›¾ç‰‡ä¸‹è½½ã€ç¼“å­˜åº“ï¼Œè€Œä»Šå¹´å‘å¸ƒçš„SDWebImage 4.0åœ¨æ¶æ„ã€æ¥å£å˜åŠ¨å¹¶å¸¦æ¥æ€§èƒ½ä¼˜åŒ–çš„åŒæ—¶ï¼Œè¿˜æ”¯æŒäº†Animated WebPï¼Œå› æ­¤æˆ‘å°±é«˜å…´åœ°å»å®éªŒäº†ä¸€ä¸‹ï¼Œæœ¬æƒ³ç€å¯ä»¥æ›¿ä»£ä¹‹å‰ä½¿ç”¨çš„&lt;a href=&quot;https://github.com/ibireme/YYImage&quot;&gt;YYImage&lt;/a&gt;ã€‚ä½†æ˜¯ä¸€æµ‹è¯•å°±å‘ç°æ¸²æŸ“ä¸æ­£å¸¸ï¼Œè¿½å›å»çœ‹æºç ï¼Œå‘ç°SDWebImageçš„å®ç°å¯ä»¥è¯´æ˜¯Too naiveï¼Œå‹æ ¹æ²¡æœ‰æŒ‰ç…§WebPè§„èŒƒå®ç°ï¼Œå¤§éƒ¨åˆ†Animated WebPåŠ¨å›¾æ¸²æŸ“éƒ½æŒ‚äº†ï¼Œå®Œå…¨ä¸å¯ç”¨ï¼ˆè¿æµ‹è¯•éƒ½è¿‡ä¸äº†ï¼Œæ›´åˆ«è¯´ç”Ÿäº§ç¯å¢ƒäº†ï¼‰ã€‚æ¼”ç¤ºDemoåœ¨æ­¤ï¼š&lt;a href=&quot;https://github.com/dreampiggy/AnimatedWebPDemo&quot;&gt;AnimatedWebPDemo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ€»ç»“å‡ºæ¥çš„å…·ä½“é—®é¢˜æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;SDç»˜åˆ¶æ¯å¸§çš„canvaså¤§å°ä¸æ­£ç¡®ï¼Œåœ¨ä»£ç ä¸­ï¼Œç›´æ¥å–å¾—å½“å‰å¸§frameçš„å¤§å°ï¼Œè€Œéæ•´ä¸ªcanvasçš„å¤§å°ã€‚è¿™å°±å¯¼è‡´æœ€åç”Ÿæˆçš„æ‰€æœ‰å¸§å›¾ç‰‡çš„æ•°ç»„ä¸­ï¼Œæ¯å¸§çš„å›¾åƒå¤§å°ä¸ä¸€è‡´ã€‚è¿™æ ·æ¸²æŸ“å°±ä¼šå‡ºç°Bugï¼ˆæŠŠæ‰€æœ‰å¸§æ‹‰ä¼¸åˆ°æœ€å¤§çš„é‚£ä¸ªå›¾åƒå¤§å°ä¸Šï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;SDçš„å®ç°æ²¡æœ‰è€ƒè™‘è¿‡&lt;a href=&quot;https://developers.google.com/speed/webp/docs/riff_container#animation&quot;&gt;WebP Disposal Method&lt;/a&gt;ï¼Œè¿™ä¸ªåœ¨å¾ˆå¤šåŠ¨å›¾ä¸­éƒ½ä¼šç”¨åˆ°ï¼Œå› ä¸ºèƒ½å¤Ÿé‡å¤åˆ©ç”¨å‰ä¸€å¸§çš„ç”»å¸ƒï¼Œæ¥å¤§å¹…å‡å°‘æœ€åç”ŸæˆåŠ¨å›¾çš„ä½“ç§¯ã€‚å¸¸è§çš„åŠ¨å›¾æ ¼å¼å¦‚GIFã€APNGç”Ÿæˆå·¥å…·ä¸€èˆ¬éƒ½é‡‡ç”¨è¿™ç§Disposalï¼Œä¸ç„¶æœ€ç»ˆæ–‡ä»¶ä½“ç§¯è¾ƒå¤§ï¼ˆä½†Googleæä¾›çš„WebPå·¥å…·æš‚æ—¶æ²¡æœ‰è‡ªå¸¦è¿™ç§ä¼˜åŒ–çš„æ–¹å¼ï¼Œä¸€èˆ¬ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;UIKitè‡ªå¸¦çš„&lt;code&gt;UIImage.animatedImages&lt;/code&gt;æ˜¯éå¸¸å¼±çš„ï¼ŒSDå¹¶æ²¡æœ‰æä¾›é¢å¤–çš„æŠ½è±¡ï¼Œè€Œæ˜¯ç›´æ¥ç”¨çš„è¿™ä¸ªæ¥å£ã€‚è¿™å¸¦æ¥çš„æœ€å¤§çš„é—®é¢˜ï¼Œæ˜¯UIImageéœ€è¦æä¾›ä¸€ä¸ªå›¾ç‰‡æ•°ç»„å’Œæ€»æ—¶é•¿ï¼Œä½†æ˜¯ä¼šå¯¹æ•°ç»„ä¸­æ¯ä¸ªå›¾ç‰‡å¹³å‡åˆ†é…æ—¶é•¿ã€‚è¿™ä¸Animated WebPçš„è§„èŒƒå°±æ˜¯ä¸åŒçš„ï¼Œåè€…å…è®¸å¯¹æ¯å¸§è®¾ç½®ä¸€ä¸ªä¸åŒçš„æŒç»­æ—¶é•¿ã€‚&lt;/li&gt;
&lt;li&gt;UIImageViewç›´æ¥è®¾ç½®&lt;code&gt;image&lt;/code&gt;å±æ€§ï¼Œæ˜¯ä¸æ”¯æŒè®¾ç½®å¾ªç¯æ¬¡æ•°çš„ï¼Œä¼šé»˜è®¤æ— é™å¾ªç¯æ’­æ”¾ã€‚è€Œæœ‰äº›Animated WebPå›¾ç‰‡éœ€è¦æœ‰å¾ªç¯æ¬¡æ•°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ—¢ç„¶çŸ¥é“è¿™ä¹ˆå¤šå‘ï¼Œæƒ³ç€SDæ¯•ç«Ÿæ˜¯ä¸»æµæ¡†æ¶ï¼Œå°±èµ¶ç´§æäº†&lt;a href=&quot;https://github.com/rs/SDWebImage/issues/1951&quot;&gt;Issue&lt;/a&gt;ï¼Œä½†æ˜¯è¿‡äº†ä¸€å‘¨å¤šï¼ŒSDç¤¾åŒºä¾ç„¶æ²¡æœ‰ä»»ä½•å›åº”ã€‚äºæ˜¯å°è¯•è‡ªå·±ä¸€ä¸ªä¸ªè§£å†³ã€‚æœ€åçš„æˆæœä¹Ÿæ¯”è¾ƒå¥½ï¼Œä¸Šè¿°4ä¸ªé—®é¢˜éƒ½å¾—åˆ°äº†è§£å†³ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Code" scheme="http://dreampiggy.com/categories/Code/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="JavaScript" scheme="http://dreampiggy.com/tags/JavaScript/"/>
    
    <category term="C++" scheme="http://dreampiggy.com/tags/C/"/>
    
    <category term="Web" scheme="http://dreampiggy.com/tags/Web/"/>
    
    <category term="Image" scheme="http://dreampiggy.com/tags/Image/"/>
    
    <category term="å¼€æºæ´»åŠ¨" scheme="http://dreampiggy.com/tags/%E5%BC%80%E6%BA%90%E6%B4%BB%E5%8A%A8/"/>
    
  </entry>
  
  <entry>
    <title>Objective-Cä»£ç åº“çš„å®ç°éšè—</title>
    <link href="http://dreampiggy.com/2017/06/04/Objective-C%E4%BB%A3%E7%A0%81%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F/"/>
    <id>http://dreampiggy.com/2017/06/04/Objective-C%E4%BB%A3%E7%A0%81%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F/</id>
    <published>2017-06-04T17:46:41.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è™½ç„¶Swiftç°åœ¨æ˜¯å¼€å‘iOSæ¨èå…¥æ‰‹çš„æœ€ä½³è¯­è¨€ï¼Œä½†æ˜¯å¯¹äºä»£ç åº“è€Œè¨€ï¼Œæœ€å¤§çš„ä¸€ä¸ªé—®é¢˜æ˜¯Swift ABIä»ç„¶æ²¡æœ‰å®šä¸‹ï¼ˆä»Šå¹´å‘å¸ƒçš„çš„Swift 4.0ï¼Œä¾ç„¶æ”¾å¼ƒABIç¨³å®šæ€§ï¼Œè€Œæ³¨é‡äºSwiftæºä»£ç 3.x-&gt;4.0çš„å…¼å®¹æ€§ï¼‰ã€‚æ‰€ä»¥è¿™å°±æ„å‘³ç€Swift 3.xç¼–è¯‘çš„äºŒè¿›åˆ¶åº“ï¼Œåœ¨Swift 4.0å°†æ— æ³•é“¾æ¥ï¼Œåªèƒ½é‡æ–°ä»£ç ç¼–è¯‘ã€‚çœ‹æ¥è¿™åˆå°†æ˜¯Objective-Cè¿™é—¨å¤è€çš„è¯­æ³•ï¼Œèƒ½å¤Ÿä½œä¸ºä¸€äº›frameworké¦–é€‰å¼€å‘è¯­è¨€çš„ä¸€å¹´ã€‚</p></blockquote><p>å¯¹äºä¸€ä¸ªä»£ç åº“æ¥è¯´ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¸ºäº†éšè—ä¸€äº›å®ç°çš„ç»†èŠ‚ï¼Œæˆ–è€…å†…éƒ¨å¤„ç†æµç¨‹ï¼Œéœ€è¦ç¼–è¯‘åˆ°äºŒè¿›åˆ¶è¿›è¡Œåˆ†å‘ï¼Œå¹¶æä¾›Public Headeræ¥ä¾›å…¶ä»–å¼€å‘è€…è°ƒç”¨ã€‚</p><p>å› æ­¤ï¼Œå¼€å‘ä»£ç åº“çš„æ—¶å€™ï¼Œéœ€è¦æ˜ç¡®å“ªäº›APIæ˜¯å¯¹å¤–å…¬å¼€çš„ï¼Œå¯ä»¥ç”±å…¶ä»–å¼€å‘è€…è°ƒç”¨ã€‚é‚£äº›æ˜¯åº“å†…éƒ¨ä¹‹é—´äº’ç›¸è°ƒç”¨çš„ï¼Œä¸åº”è¯¥ç”±å¤–éƒ¨ä½¿ç”¨è€…è°ƒç”¨ã€‚è€ŒObjective-Cä¸åƒC++æä¾›äº†privateå…³é”®å­—æ¥é™åˆ¶ç›´æ¥è®¿é—®æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ã€‚å› æ­¤ï¼Œå°±éœ€è¦å°½é‡é¿å…ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•çš„å®šä¹‰å‡ºç°åœ¨å¤´æ–‡ä»¶ä¸­ã€‚åªè¦ä¸å¼•å…¥ç§æœ‰çš„å¤´æ–‡ä»¶ï¼Œé‚£å°±æ— æ³•ç›´æ¥è®¿é—®è¿™äº›å±æ€§å’Œæ–¹æ³•ã€‚</p><h1 id="éšè—å†…éƒ¨å±æ€§"><a href="#éšè—å†…éƒ¨å±æ€§" class="headerlink" title="éšè—å†…éƒ¨å±æ€§"></a>éšè—å†…éƒ¨å±æ€§</h1><p>ç§æœ‰å±æ€§ï¼Œå¯ä»¥åˆ†æˆä¸¤ç§ï¼Œä¸€ç§æ˜¯å¸Œæœ›æ”¾åˆ°ç±»å†…éƒ¨è€Œçº¯ç²¹ä¸æƒ³æš´éœ²ç»™ä»»ä½•äººçš„ï¼Œå¯ä»¥å«åšå†…éƒ¨å±æ€§ã€‚ä¸€ç§æ˜¯å¸Œæœ›æš´éœ²åˆ°Private Headerä¸­ï¼Œåªé™äºå¼•å…¥è¯¥å¤´æ–‡ä»¶çš„åœ°æ–¹è¿›è¡Œè®¿é—®ã€‚</p><p>å†…éƒ¨å±æ€§çš„å£°æ˜éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç±»æ‰©å±•å£°æ˜å±æ€§ï¼Œè€Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆgetterå’Œsetterï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–å·¥ä½œã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.m</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSObject</span> *internalObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h2 id="æ”¹å˜å±æ€§ä¿®é¥°ç¬¦"><a href="#æ”¹å˜å±æ€§ä¿®é¥°ç¬¦" class="headerlink" title="æ”¹å˜å±æ€§ä¿®é¥°ç¬¦"></a>æ”¹å˜å±æ€§ä¿®é¥°ç¬¦</h2><p>å¯¹äºå¾ˆå¤šæƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¤–æš´éœ²å±æ€§æ˜¯readonlyçš„ï¼Œä»¥é˜²æ­¢ä½¿ç”¨è€…æ‰‹åŠ¨ä¿®æ”¹ï¼Œä½†æ˜¯å†…éƒ¨æµç¨‹çš„æ—¶å€™ä¹Ÿéœ€è¦è¿™ä¸ªå±æ€§ï¼Œå¹¶ä¸”å¸Œæœ›æ˜¯readwriteçš„ï¼Œè¿™ä¸ªåœ¨ç±»æ‰©å±•ä¸­ç›´æ¥å¯ä»¥é‡æ–°å£°æ˜å·²æœ‰çš„å±æ€§ï¼Œå¹¶ä¿®æ”¹å±æ€§ä¿®é¥°ç¬¦ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSNumber</span> *number;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="comment">// Person.m</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readwrite</span>) <span class="built_in">NSNumber</span> *number;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œç”±äºç±»æ‰©å±•æ˜¯å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å£°æ˜çš„ï¼ˆä¸é™äº.må®ç°æ–‡ä»¶ï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå±æ€§ä¿®é¥°ç¬¦çš„ä¿®æ”¹ï¼Œæ”¾åˆ°Private Headerï¼ˆå¯ä»¥ç”¨<code>+Private</code>åç¼€ï¼Œä¹Ÿå¯ä»¥å‚è€ƒUIKitç­‰æ¡†æ¶èµ·åä¸º<code>UIKitInternal.h</code>ï¼‰ä¸­ï¼Œè¿™æ ·å¼•å…¥äº†Private Headerçš„åœ°æ–¹å¯ä»¥readwriteï¼Œæ²¡æœ‰å¼•å…¥çš„åœ°æ–¹æ˜¯readonlyã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person+Private.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readwrite</span>) <span class="built_in">NSNumber</span> *number;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h1 id="éšè—ç§æœ‰å±æ€§"><a href="#éšè—ç§æœ‰å±æ€§" class="headerlink" title="éšè—ç§æœ‰å±æ€§"></a>éšè—ç§æœ‰å±æ€§</h1><p>ä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€äº›å±æ€§æ˜¯ç§æœ‰çš„ï¼Œå³ç±»å®ç°å¤„å’Œå¼•å…¥äº†Private Headerçš„åœ°æ–¹æ‰å¯ä»¥è®¿é—®ã€‚è¿™ç§æ—¶å€™å°±éœ€è¦é‡‡å–åˆ«çš„æ–¹å¼äº†ã€‚å¸¸è§çš„æ–¹æ³•æ˜¯é€šè¿‡ç±»æ‰©å±•ï¼ˆä¸»è¦é’ˆå¯¹ç±»çš„å®ç°æ–‡ä»¶å¯è§ï¼‰æˆ–è€…ä½¿ç”¨å…³è”å¯¹è±¡ï¼ˆä¸»è¦é’ˆå¯¹ç±»çš„å®ç°æ–‡ä»¶ä¸å¯è§ï¼Œå¦‚å…¶ä»–ç¬¬ä¸‰æ–¹åº“çš„ç±»ï¼‰ä¸¤ç§æ–¹å¼ã€‚</p><h2 id="ç±»æ‰©å±•ï¼ˆClass-Extensionï¼‰"><a href="#ç±»æ‰©å±•ï¼ˆClass-Extensionï¼‰" class="headerlink" title="ç±»æ‰©å±•ï¼ˆClass Extensionï¼‰"></a>ç±»æ‰©å±•ï¼ˆClass Extensionï¼‰</h2><h3 id="é€šå¸¸æƒ…å½¢"><a href="#é€šå¸¸æƒ…å½¢" class="headerlink" title="é€šå¸¸æƒ…å½¢"></a>é€šå¸¸æƒ…å½¢</h3><p>ç±»æ‰©å±•ï¼Œä¸åŒäºCategoryï¼Œæœ€å¤§çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥ç›´æ¥æ·»åŠ å®ä¾‹å˜é‡ivaråˆ°ç±»çš„æœ¬èº«å®ç°ä¸­ï¼Œè€ŒCategoryæ˜¯æ— æ³•æ·»åŠ å®ä¾‹å˜é‡çš„ã€‚è€Œåœ¨ç±»æ‰©å±•ä¸­å£°æ˜çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨åœ¨ç¼–è¯‘æœŸåˆæˆï¼ŒåŒæ™®é€šç±»å£°æ˜å±æ€§çš„æ–¹å¼ç›¸åŒï¼Œä¸äº†è§£çš„å‚è§ï¼š<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html">CustomizingExistingClasses</a>ã€‚å› æ­¤ï¼Œå®é™…ä¸Šç±»æ‰©å±•éå¸¸é€‚åˆéšè—ç§æœ‰å±æ€§ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person+Private.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *privateID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰å­˜å–æ–¹æ³•"><a href="#è‡ªå®šä¹‰å­˜å–æ–¹æ³•" class="headerlink" title="è‡ªå®šä¹‰å­˜å–æ–¹æ³•"></a>è‡ªå®šä¹‰å­˜å–æ–¹æ³•</h3><p>å¯¹äºé€šå¸¸caseæ¥è¯´ï¼Œè¿™æ˜¯éå¸¸å¥½çš„è§£å†³æ–¹æ³•ï¼ˆä¸ç”¨ä»»ä½•é¢å¤–ä»£ç ï¼‰ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ æƒ³<strong>è‡ªå®šä¹‰è¿™ä¸ªå±æ€§çš„å­˜å–æ–¹æ³•</strong>ï¼ˆæ¯”å¦‚ï¼Œå®ä¾‹å˜é‡çš„æƒ°æ€§åˆå§‹åŒ–ï¼‰ï¼Œé‚£å°±ä¼šé‡åˆ°é—®é¢˜ã€‚å› ä¸ºå±æ€§åˆæˆçš„ivarï¼Œæ˜¯åªåœ¨ç±»æœ¬èº«å®ç°ä¸­åˆ›å»ºçš„ï¼Œåœ¨Categoryä¸­æ— æ³•åˆ›å»ºï¼Œè€Œä¸”ç±»çš„å®ç°åªèƒ½å®ç°ä¸€æ¬¡ï¼ˆåœ¨åŸå§‹çš„<code>Person.m</code>ä¸­å®ç°ï¼‰ã€‚è¯•æƒ³ä¸€ä¸‹è¿™æ ·å­çš„æƒ…å†µï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person+Private.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)privateID</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_privateID) &#123; <span class="comment">//Compile Error: undeclared identifier:_privateID</span></span><br><span class="line">        _privateID = <span class="string">@&quot;foo&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> _privateID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>æœ€ç®€å•çš„æ–¹å¼ï¼Œå°±æ˜¯ç›´æ¥æŠŠè‡ªå®šä¹‰çš„å­˜å–æ–¹æ³•å†™åœ¨ç±»æœ¬èº«å®ç°æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨Categoryä¸­æš´éœ²å¤´æ–‡ä»¶ï¼Œå¹¶ç”¨<code>@dynamic</code>æ¥æ ‡è®°è¿™ä¸ªå±æ€§ï¼ˆå¦åˆ™ç”±äºCategoryçœ‹ä¸åˆ°ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„getterå’Œsetterä¼šæŠ¥warningï¼‰ã€‚è‡ªå®šä¹‰å­˜å–æ–¹å¼å°±å’Œæ™®é€šçš„å†™æ³•ä¸€æ¨¡ä¸€æ ·ã€‚è¿™ç›¸å½“äºæ˜¯ä¸€ç§æŠŠå†…éƒ¨å±æ€§æš´éœ²å‡ºæ¥çš„æ–¹æ³•ã€‚ä¸è¿‡å®¹æ˜“å¯¼è‡´è€¦åˆï¼ˆå› ä¸ºå…¶å®æˆ‘ä»¬çš„ç§æœ‰å±æ€§ç›®æ ‡æ˜¯ç”¨äºå’Œå¤–éƒ¨ç±»äº¤äº’çš„ï¼Œä¸å¸Œæœ›æ”¾åˆ°Private Categoryä»¥å¤–ï¼‰ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Person.m</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *privateID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)privateID</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_privateID) &#123;</span><br><span class="line">        _privateID = <span class="string">@&quot;foo&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> _privateID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Person+Private.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *privateID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Person+Private.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"><span class="keyword">@dynamic</span> privateID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>å½“ç„¶ï¼Œèªæ˜çš„ä½ è‡ªç„¶ä¼šæƒ³åˆ°ï¼Œæ—¢ç„¶Categoryæ²¡æ³•å®šä¹‰ivarï¼Œé‚£ç›´æ¥åœ¨ç±»æ‰©å±•ä¸­å£°æ˜ä¸€ä¸ªivarä¸å°±è¡Œäº†ã€‚äºæ˜¯ä½ å¯ä»¥è¿™æ ·å†™ï¼Œä½†æ˜¯è¿™ä¼šå‡ºç°ä¸€ä¸ªç¼–è¯‘è­¦å‘Šï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person+Private.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> () </span>&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *_privateID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *privateID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Person+Private.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Compile Warning: category override method from class</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)privateID</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_privateID) &#123;</span><br><span class="line">        _privateID = <span class="string">@&quot;foo&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> _privateID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºåœ¨ç±»æ‰©å±•ä¸­å·²ç»å®šä¹‰äº†å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»åœ¨ç¼–è¯‘æœŸé—´ä¼šè‡ªåŠ¨åˆæˆå­˜å–æ–¹æ³•ï¼Œè€Œåœ¨Private Categoryä¸­è¦†ç›–å°±ä¼šè¦†ç›–æœ¬èº«åˆæˆçš„æ–¹æ³•ï¼ˆè™½ç„¶æˆ‘ä»¬ç¡®å®éœ€è¦è¿™æ ·ï¼‰ï¼Œä½†ç”±äºå¯ä»¥åœ¨å¤šå¤„å®šä¹‰Categoryï¼Œå¹¶ä¸”æ–¹æ³•è¦†ç›–çš„é¡ºåºä¸å®šï¼Œæ— æ³•ä¿è¯ä½ çš„å­˜å–æ–¹æ³•å°±æ˜¯çœŸå®æƒ³è¦çš„ï¼Œæ‰€ä»¥è¿™æ˜¯ç¼–è¯‘è­¦å‘Šã€‚å¯¹äºè¿™ç§éœ€è¦è‡ªå®šä¹‰å­˜å–æ–¹æ³•çš„ç§æœ‰å±æ€§çš„caseï¼Œåº”è¯¥åœ¨ç±»æ‰©å±•ä¸­å®šä¹‰ivarï¼Œåœ¨Private Categoryä¸­å®šä¹‰å±æ€§å¹¶å®ç°ã€‚æ³¨æ„ç”±äºåœ¨ç±»æ‰©å±•å®šä¹‰äº†ivarï¼Œä¸ä¼šè‡ªåŠ¨ç”Ÿæˆgetter+setterï¼Œ<strong>éœ€è¦è‡ªè¡ŒåŒæ—¶å®šä¹‰setterå’Œgetter</strong>ï¼Œæ³¨æ„å¯¹ä¸åŒå±æ€§ä¿®é¥°ç¬¦ï¼Œæ¯”å¦‚<code>copy</code>çš„è¯setteréœ€è¦ç”¨<code>[-copy]</code>ï¼Œ<code>weak</code>çš„è¯ivarè¦æ ‡æ³¨<code>__weak</code>ç­‰ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person+Private.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> () </span>&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *_privateID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *privateID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Person+Private.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)privateID</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_privateID) &#123;</span><br><span class="line">        _privateID = <span class="string">@&quot;foo&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> _privateID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setPrivateID:(<span class="built_in">NSString</span> *)privateID</span><br><span class="line">&#123;</span><br><span class="line">    _privateID = privateID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†ç±»ï¼ˆCategoryï¼‰å’Œå…³è”å¯¹è±¡"><a href="#åˆ†ç±»ï¼ˆCategoryï¼‰å’Œå…³è”å¯¹è±¡" class="headerlink" title="åˆ†ç±»ï¼ˆCategoryï¼‰å’Œå…³è”å¯¹è±¡"></a>åˆ†ç±»ï¼ˆCategoryï¼‰å’Œå…³è”å¯¹è±¡</h2><p>ç”±äºObjective-Cçš„å±æ€§ï¼Œå…¶å®å°±æ˜¯ivar+getteræ–¹æ³•+setteræ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨çš„åœ°æ–¹é€šè¿‡Runtimeæ¥è·å–ivarã€‚ä½†æ˜¯è¿™ç§æ–¹å¼å®é™…ä¸Šæ¥è¯´æ˜¯ç”¨çš„äººéå¸¸å°‘ã€‚ç¬¬ä¸€ä¸ªæ˜¯å¤æ‚ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸å¥½ä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„å®è¿›è¡Œè½¬æ¢ï¼ˆå› ä¸ºivaréœ€è¦è®¡ç®—offsetï¼Œæ ¹æ®ä¸åŒç±»å‹çš„type encodingè¿˜ä¸åŒâ€¦â€¦ï¼‰ï¼Œè€Œä¸”å¯¹äºè¿™ç§éœ€æ±‚æ¥è¯´ä¼˜ç‚¹å¤§æå°ç”¨äº†ã€‚å› æ­¤æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨å…³è”å¯¹è±¡ï¼ˆä¸äº†è§£çš„å‚è§ï¼š<a href="http://nshipster.com/associated-objects/">Associated Object</a>ï¼‰</p><p>ä½¿ç”¨äº†å…³è”å¯¹è±¡åï¼Œä¸ºäº†æ–¹ä¾¿ä¸å¿…è¦ç¹çåœ°ä¹¦å†™<code>objc_getAssociatedObject</code>ã€<code>objc_setAssociatedObject</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€äº›å®æ¥æ–¹ä¾¿ä½¿ç”¨ã€‚ç”±äºå±æ€§æ˜¯åŒ…æ‹¬äº†è¯­ä¹‰å’Œå¼•ç”¨è®¡æ•°ç›¸å…³å†…å®¹çš„ï¼Œå› æ­¤é’ˆå¯¹ä¸åŒçš„å±æ€§ä¿®é¥°ç¬¦ï¼Œéœ€è¦é‡‡ç”¨ä¸åŒçš„å®æ¥ä¿è¯å±æ€§çš„è¯­ä¹‰ã€‚</p><p>å±æ€§ä¿®é¥°ç¬¦çš„è¯­ä¹‰ï¼Œå¯ä»¥å‚è€ƒclangå®˜ç½‘çš„è¯´æ˜ï¼š<a href="http://clang.llvm.org/docs/AutomaticReferenceCounting.html#property-declarations">Objective-C Automatic Reference Counting</a>ï¼Œå¦‚ä¸‹ï¼š</p><blockquote><p><code>assign</code> implies <code>__unsafe_unretained</code> ownership.<br><code>copy</code> implies <code>__strong</code> ownership, as well as the usual behavior of copy semantics on the setter.<br><code>retain</code> implies <code>__strong</code> ownership.<br><code>strong</code> implies <code>__strong</code> ownership.<br><code>unsafe_unretained</code> implies <code>__unsafe_unretained</code> ownership.<br><code>weak</code> implies <code>__weak</code> ownership.</p></blockquote><p>ç”±äºå±æ€§ä¿®é¥°ç¬¦åªä¼šå½±å“setterï¼Œè€Œä¸æ˜¯getterï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªé€šç”¨å®ã€‚å¯¹åº”çš„setterå°±éœ€è¦å•ç‹¬æ ¹æ®æƒ…å†µç¼–å†™ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __GET_PROPERTY(property) objc_getAssociatedObject(self, @selector(property));</span></span><br></pre></td></tr></table></figure><h3 id="strong-retain"><a href="#strong-retain" class="headerlink" title="strong(retain)"></a>strong(retain)</h3><p><code>strong</code>æˆ–è€…<code>retain</code>ï¼Œå°±æ˜¯æ‰€æœ‰å¯¹è±¡çš„é»˜è®¤å±æ€§å­˜å–è¡Œä¸ºï¼Œéšå«ç€å¯¹å¯¹è±¡è¿›è¡Œretainè€Œä½¿å¼•ç”¨è®¡æ•°+1ã€‚è¿™ä¸ªå¯ç›´æ¥é€šè¿‡å…³è”å¯¹è±¡çš„è¡Œä¸ºè®¾ç½®ã€‚</p><p>å®ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __SET_STRONG(property) objc_setAssociatedObject(self, @selector(property), property, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *number;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSNumber</span> *)number</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> __GET_PROPERTY(number);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setNumber:(<span class="built_in">NSNumber</span> *)number</span><br><span class="line">&#123;</span><br><span class="line">    __SET_STRONG(number)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h3><p><code>copy</code>å±æ€§ä¿®é¥°ï¼Œè¡¨ç¤ºåœ¨è°ƒç”¨setterçš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦å¯¹å¯¹è±¡è¿›è¡Œ<code>copy</code>æ“ä½œï¼Œç„¶åå†è¡¨ç¤º<code>strong</code>ï¼Œåœ¨Objective-Cä¸­å…¶å®å°±æ˜¯å‘é€äº†<code>copyWithZone:</code>æ¶ˆæ¯ã€‚è¿™ä¸ªå¯ç›´æ¥é€šè¿‡å…³è”å¯¹è±¡çš„è¡Œä¸ºè®¾ç½®ã€‚</p><p>å®ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __SET_COPY(property) objc_setAssociatedObject(self, @selector(property), property, OBJC_ASSOCIATION_COPY_NONATOMIC);</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> __GET_PROPERTY(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    __SET_COPY(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="unsafe-unretained"><a href="#unsafe-unretained" class="headerlink" title="unsafe_unretained"></a>unsafe_unretained</h3><p><code>unsafe_unretained</code>å’Œ<code>assign</code>çš„è¯­ä¹‰æ˜¯ç›¸åŒçš„ï¼Œå‰è€…æ˜¯ARCä¸‹åŠ å…¥çš„ï¼Œè€Œåè€…ä»MRCå¼€å§‹å­˜åœ¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºåŸå§‹ç±»å‹ï¼ˆ<code>int</code>ã€<code>double</code>ã€<code>BOOL</code>ã€<code>NSInteger</code>)è¿™äº›ï¼Œç”±äºæœ¬èº«å°±æ˜¯copy by valueï¼Œè€Œä¸”ä¸å­˜åœ¨å¯¹è±¡å’Œå¼•ç”¨è®¡æ•°ç®¡ç†ï¼Œå› æ­¤å±æ€§å£°æ˜ç”¨<code>assign</code>ï¼ˆå¾ˆå°‘è§å†™<code>unsafe_unretained</code>ï¼Œè™½ç„¶å…è®¸ï¼‰ã€‚</p><p>è€Œå¯¹äºå¯¹è±¡è€Œè¨€ï¼Œä¸€èˆ¬å¦‚æœæƒ³è¡¨ç¤ºä¸æ”¹å˜ä»»ä½•å¼•ç”¨è®¡æ•°çš„å¼±å¼•ç”¨ï¼Œç°åœ¨éƒ½ç”¨çš„æ˜¯<code>weak</code>ï¼Œå› ä¸º<code>unsafe_unretained</code>ä¸ä¼šåƒ<code>weak</code>é‚£æ ·ï¼Œåœ¨å¯¹è±¡å¼•ç”¨è®¡æ•°é™åˆ°0è¢«é”€æ¯åï¼Œè‡ªåŠ¨ç½®nilï¼Œè€Œä¼šä¿æŒæŒ‡å‘çš„åœ°å€ï¼Œå› æ­¤å¯èƒ½éšæ—¶éƒ½æˆä¸ºé‡æŒ‡é’ˆè€Œä¸å®‰å…¨ã€‚ä½†æ˜¯ç”±äºå†å²ä»£ç ç¼˜æ•…ï¼Œè¿˜æœ‰å¾ˆå°‘çš„ä»£ç åº“åœ¨ç”¨ï¼Œå§‘ä¸”æš‚æ—¶ä¿ç•™ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå®ï¼Œä»…ç”¨äºè¡¨ç¤ºå¯¹è±¡çš„<code>unsafe_unretained</code>å’Œ<code>assign</code>ã€‚è¿™ä¸ªå¯ç›´æ¥é€šè¿‡å…³è”å¯¹è±¡çš„è¡Œä¸ºè®¾ç½®ã€‚è€Œå¯¹äºåŸå§‹ç±»å‹çš„å±æ€§ï¼Œå‚è§ä¸‹é¢çš„<code>assign</code></p><p>å®ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __SET_UNSAFE_UNRETAINED(property) objc_setAssociatedObject(self, @selector(property), property, OBJC_ASSOCIATION_ASSIGN);</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">unsafe_unretained</span>) <span class="built_in">NSObject</span> *unsafeObject;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSObject</span> *)unsafeObject</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> __GET_PROPERTY(unsafeObject);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setUnsafeObject:(<span class="built_in">NSObject</span> *)unsafeObject</span><br><span class="line">&#123;</span><br><span class="line">    __SET_UNSAFE_UNRETAINED(unsafeObject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="assign"><a href="#assign" class="headerlink" title="assign"></a>assign</h3><p>åŒºåˆ«äºä¸Šé¢é’ˆå¯¹å¯¹è±¡çš„<code>unsafe_unretained </code>å’Œ<code>assign</code>è¯­ä¹‰ï¼Œè¿™é‡Œçš„<code>assign</code>ç‰¹æŒ‡å¯¹åŸå§‹ç±»å‹çš„å±æ€§ä¿®é¥°ç¬¦ã€‚ç”±äºRuntimeçš„Associated Objectä¸€å®šæ˜¯ä¸€ä¸ªObjectï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠåŸå§‹ç±»å‹è¿›è¡Œè£…ç®±ï¼Œå°è£…ä¸ºä¸€ä¸ªObjectï¼Œåœ¨getterä¸­æ‹†ç®±ï¼Œæ‹¿åˆ°çœŸå®çš„åŸå§‹æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹ç”±äºæˆ‘ä»¬ä¸€å®šæ˜¯ä¸€ä¸ªObjectç®±å­ï¼Œåªè£…ä¸€ä¸ªçœŸå®çš„åŸå§‹æ•°æ®ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦è¿›è¡Œcopyï¼ˆç®±å­æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯å†…å®¹çš„åŸå§‹æ•°æ®æ¥æºæ˜¯copy by valueï¼‰ã€‚å¯ä»¥ç”¨<code>strong</code>æ¥ä¿®é¥°ã€‚</p><p>å¯¹äºä¸åŒçš„åŸå§‹ç±»å‹ï¼Œè£…ç®±çš„æ–¹å¼ä¸åŒï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºæ•°å€¼ç±»å‹ï¼ˆintã€doubleã€NSIntegerï¼‰ï¼Œå¯ä»¥ä½¿ç”¨NSNumberæ¥è£…ç®±ã€‚å¯¹äºå…¶ä»–ç±»å‹ï¼Œæ¯”å¦‚ç»“æ„ä½“ï¼Œå¯ä»¥ä½¿ç”¨NSValueæ¥è¿›è¡Œè£…ç®±ï¼ˆæ¯”å¦‚CGRectï¼ŒNSRange, Pointerï¼‰ã€‚å¯¹äºä¸åŒçš„è£…ç®±æ¥è¯´æ–¹å¼ä¸åŒï¼Œå› æ­¤ä¸å¥½åœ¨å®é‡Œé¢è¿›è¡Œå¤„ç†ï¼Œç›´æ¥æ¥æ”¶ä¸€ä¸ªè£…å¥½ç®±çš„valueå°±å¯ä»¥äº†ã€‚</p><p>å®ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __SET_ASSIGN(property, value) objc_setAssociatedObject(self, @selector(property), value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span></span><br></pre></td></tr></table></figure><p>ç”±äºè£…ç®±æ–¹å¼ä¸åŒï¼Œæ‹†ç®±æ–¹å¼è‚¯å®šä¸åŒã€‚ä¸è¿‡åªè¦æ‹¿åˆ°ç®±å­ä¹‹åï¼Œè‡ªå·±æ ¹æ®ç±»å‹æ¥è¿›è¡Œç›¸åº”æ‹†ç®±å³å¯ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">int</span> age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGRect</span> frame;</span><br><span class="line"></span><br><span class="line">- (<span class="type">int</span>)age</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSNumber</span> *value = __GET_PROPERTY(age);</span><br><span class="line">    <span class="keyword">return</span> value.intValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setAge:(<span class="type">int</span>)age</span><br><span class="line">&#123;</span><br><span class="line">    __SET_ASSIGN(age, @(age));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGRect</span>)frame</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSValue</span> *value = __GET_PROPERTY(frame);</span><br><span class="line">    <span class="keyword">return</span> value.CGRectValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setFrame:(<span class="built_in">CGRect</span>)frame</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSValue</span> *value = [<span class="built_in">NSValue</span> valueWithCGRect:frame];</span><br><span class="line">    __SET_ASSIGN(frame, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="weak"><a href="#weak" class="headerlink" title="weak"></a>weak</h3><p><code>weak</code>å±æ€§æŒ‡çš„æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œä¸æ”¹å˜å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼ŒåŒæ—¶å’Œ<code>assign</code>å’Œ<code>unsafe_unretained</code>çš„æœ€å¤§åŒºåˆ«ï¼Œåœ¨äºæœ‰ç€è‡ªåŠ¨ç½®nilçš„å®‰å…¨æ€§è´¨ã€‚ä¸€æ—¦weakå¯¹è±¡è¢«é”€æ¯ï¼Œè¯¥å¼•ç”¨ä¸ä¼šæˆä¸ºä¸€ä¸ªé‡æŒ‡é’ˆï¼Œè€Œä¼šè¢«ç«‹å³ç½®ä¸ºnilï¼Œä¿è¯äº†å®‰å…¨ã€‚å¯¹äºå¦‚ä»Šçš„ç°ä»£Objective-Cï¼Œèƒ½è¡¨ç¤ºå¼±å¼•ç”¨å…¨éƒ¨ä½¿ç”¨weakï¼Œåº”å½“é¿å…ä½¿ç”¨<code>assign</code>å’Œ<code>unsafe_unretained</code>è¡¨ç¤ºä¸€ä¸ªå¼±å¼•ç”¨ï¼ˆå°±ç®—è€ƒè™‘ä¸Šæ€§èƒ½é—®é¢˜ï¼Œweakç«‹å³ç½®nilé‡‡ç”¨äº†ä¸€ä¸ªå…¨å±€çš„weakè¡¨ï¼Œç”±Runtimeç®¡ç†ï¼Œå¼€é”€å’Œæ‰‹åŠ¨releaseåŸºæœ¬ä¸€è‡´ï¼Œä¸å¤ªå¯èƒ½æˆä¸ºæ€§èƒ½é—®é¢˜ï¼‰ã€‚</p><p>ç”±äº<code>weak</code>çš„ç‰¹æ®Šæ€§ï¼ˆå…¨å±€weakè¡¨ï¼‰ï¼Œå…³è”å¯¹è±¡æœ¬èº«å°±æ²¡æœ‰æä¾›weakçš„è¯­ä¹‰è¡Œä¸ºï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ¥æ¨¡æ‹Ÿä¸€ä¸ªç­‰ä»·çš„è¡Œä¸ºã€‚</p><p><strong>ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼š</strong><br>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªWeakContainerï¼ŒåªåŒ…å«ä¸€ä¸ªweakçš„å±æ€§ï¼Œæ¥å­˜æ”¾çœŸå®çš„weakå¼•ç”¨å¯¹è±¡ã€‚è¿™æ ·ï¼Œé€šè¿‡å…³è”å¯¹è±¡æŠŠæ•´ä¸ªWeakContainerå…³è”åˆ°Categoryçš„å±æ€§ä¸Šï¼Œç„¶åå­˜å–ä½¿ç”¨çš„æ—¶å€™è¿›è¡Œè£…ç®±å’Œæ‹†ç®±ï¼Œè§£å†³æ–¹æ¡ˆå³å¯ã€‚ä¸è¿‡å”¯ä¸€çš„ç¼ºç‚¹æ˜¯ç”±äºéœ€è¦å¼•å…¥ä¸€ä¸ªWeakContainerç±»ï¼Œæ— æ³•åšåˆ°Header Onlyã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WeakObjectContainer</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="type">id</span> object;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)containerWithObject:(<span class="type">id</span>)object;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WeakObjectContainer</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)containerWithObject:(<span class="type">id</span>)object</span><br><span class="line">&#123;</span><br><span class="line">    WeakObjectContainer *container = [[WeakObjectContainer alloc] init];</span><br><span class="line">    container.object = object;</span><br><span class="line">    <span class="keyword">return</span> container;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>å®ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;WeakObjectContainer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __SET_WEAK(property) objc_setAssociatedObject(self, @selector(property), [WeakObjectContainer containerWithObject:property], OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __GET_WEAK(property) [objc_getAssociatedObject(self, @selector(property)) object];</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>ä¸ºäº†åšåˆ°Header onlyï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€ä¸ªåŒ¿åçš„blockï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªweakå¼•ç”¨æŒ‡å‘å±æ€§å€¼ï¼Œç„¶åblockæ•è·å®ƒã€‚è¿™æ ·å­ï¼Œåªè¦æŠŠblockå…³è”åˆ°å¯¹è±¡ä¸Šï¼Œé‚£ä¹ˆåœ¨getterçš„æ—¶å€™ï¼Œé€šè¿‡ç›´æ¥æ‰§è¡Œblockè¿”å›è¿™ä¸ªweakå¯¹è±¡ï¼Œå°±å¯ä»¥æ‹¿åˆ°çœŸæ­£çš„å¼±å¼•ç”¨ï¼ˆå®ç°æ—¶ï¼Œblockè¦ç”¨copyï¼Œè€Œä¸”è¦åˆ¤ç©ºï¼‰ã€‚</p><p>å®ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __SET_WEAK(property) id __weak __weak_object = property; \</span></span><br><span class="line"><span class="meta">  id (^__weak_block)() = ^&#123; return __weak_object; &#125;; \</span></span><br><span class="line"><span class="meta">  objc_setAssociatedObject(self, @selector(property), __weak_block, OBJC_ASSOCIATION_COPY);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __GET_WEAK(property) objc_getAssociatedObject(self, @selector(property)) ? ((id (^)())objc_getAssociatedObject(self, @selector(property)))() : nil;</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="type">id</span> delegate;</span><br><span class="line"></span><br><span class="line">- (<span class="type">id</span>)delegate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> __GET_WEAK(delegate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setDelegate:(<span class="type">id</span>)delegate</span><br><span class="line">&#123;</span><br><span class="line">    __SET_WEAK(delegate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰å­˜å–æ–¹æ³•-1"><a href="#è‡ªå®šä¹‰å­˜å–æ–¹æ³•-1" class="headerlink" title="è‡ªå®šä¹‰å­˜å–æ–¹æ³•"></a>è‡ªå®šä¹‰å­˜å–æ–¹æ³•</h3><p>è‡ªå®šä¹‰å­˜å–æ–¹æ³•ä¸€èˆ¬ç±»çš„å±æ€§å†™æ³•ç±»ä¼¼ã€‚æ¯”å¦‚è¯´æƒ³è¦æƒ°æ€§åˆå§‹åŒ–ï¼ˆå³åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getterçš„æ—¶å€™ï¼Œæ‰ä¼šåˆå§‹åŒ–å±æ€§ï¼‰è¿™é‡Œå°±ä¸ç”¨<code>_name</code>æ¥æ“ä½œivarï¼Œè€Œæ˜¯é€šè¿‡setterï¼ˆå½“ç„¶ä¹Ÿèƒ½ç”¨<code>__SET_* </code>å®æ¥ç›´æ¥æ“ä½œå…³è”å¯¹è±¡ï¼‰å°±å¯ä»¥äº†ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *name = __GET_PROPERTY(name);</span><br><span class="line">    <span class="keyword">if</span> (!name) &#123;</span><br><span class="line">        name = <span class="string">@&quot;foo&quot;</span>;</span><br><span class="line">        [<span class="keyword">self</span> setName:name];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    __SET_COPY(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="éšè—å†…éƒ¨æ–¹æ³•"><a href="#éšè—å†…éƒ¨æ–¹æ³•" class="headerlink" title="éšè—å†…éƒ¨æ–¹æ³•"></a>éšè—å†…éƒ¨æ–¹æ³•</h1><h2 id="ç±»æ‰©å±•å®ç°ç±»çš„å†…éƒ¨æ–¹æ³•"><a href="#ç±»æ‰©å±•å®ç°ç±»çš„å†…éƒ¨æ–¹æ³•" class="headerlink" title="ç±»æ‰©å±•å®ç°ç±»çš„å†…éƒ¨æ–¹æ³•"></a>ç±»æ‰©å±•å®ç°ç±»çš„å†…éƒ¨æ–¹æ³•</h2><p>Objective-Cæ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„ç§æœ‰æ–¹æ³•ï¼Œæ¯•ç«Ÿæ˜¯Cè¯­è¨€çš„è¶…é›†å˜›ã€‚ä½†æ˜¯Objective-Cæä¾›äº†ä¸€ä¸ªç±»æ‰©å±•è¯­æ³•ï¼Œå…è®¸å®šä¹‰æ–¹æ³•çš„æ¥å£ã€‚å› æ­¤ï¼Œåªè¦æˆ‘ä»¬åœ¨.må®ç°æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›å†…éƒ¨æ–¹æ³•ï¼Œå°±å¯ä»¥å¯¹å¤–éšè—ï¼ˆå½“ç„¶ï¼Œclass-dump selectorè¿™äº›æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨çš„ï¼‰</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.m</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> ()</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)internalMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)internalMethod</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h1 id="éšè—ç§æœ‰æ–¹æ³•"><a href="#éšè—ç§æœ‰æ–¹æ³•" class="headerlink" title="éšè—ç§æœ‰æ–¹æ³•"></a>éšè—ç§æœ‰æ–¹æ³•</h1><h2 id="åˆ†ç±»å®ç°ç±»çš„ç§æœ‰æ–¹æ³•"><a href="#åˆ†ç±»å®ç°ç±»çš„ç§æœ‰æ–¹æ³•" class="headerlink" title="åˆ†ç±»å®ç°ç±»çš„ç§æœ‰æ–¹æ³•"></a>åˆ†ç±»å®ç°ç±»çš„ç§æœ‰æ–¹æ³•</h2><p>ä½†ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¾ˆå¤šåº“å†…éƒ¨ä½¿ç”¨çš„ç±»çš„ç§æœ‰æ–¹æ³•ï¼ˆç§æœ‰æ–¹æ³•å’Œå†…éƒ¨æ–¹æ³•è™½ç„¶éƒ½ä¸å¯¹å¤–å¯è§ï¼Œä½†æ˜¯å…¶å®ç›®æ ‡ä¸ä¸€æ ·ï¼Œç§æœ‰æ–¹æ³•ä¸€èˆ¬æ˜¯ä¸€äº›å¯ä»¥ç›´æ¥è®¾ç½®å®ä¾‹çš„çŠ¶æ€ï¼Œå†…éƒ¨æ•°æ®çš„å±é™©æ–¹æ³•ï¼Œç”¨äºåº“å†…éƒ¨çš„ä¸€äº›ç±»ä¹‹é—´ï¼Œäº’ç›¸è°ƒç”¨æ¥ä½¿ç”¨ã€‚è€Œå†…éƒ¨æ–¹æ³•ä¸€èˆ¬æ”¾ä¸€äº›å¤æ‚æµç¨‹å¤„ç†ï¼Œå·¥å…·æ–¹æ³•ï¼Œæ˜¯ä¸ºäº†ç®€åŒ–ä»£ç é€»è¾‘è€Œä½¿ç”¨çš„ï¼‰è¿™äº›æ–¹æ³•éœ€è¦å’Œå…¬å¼€å¤´æ–‡ä»¶çš„æ–¹æ³•åˆ†å¼€ï¼Œä¿æŒå¯¹å¤–éšè—ã€‚è¿™æ—¶å€™å°±å¾—ç”¨åˆ°Categoryã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠæƒ³è¦éšè—çš„ç§æœ‰æ–¹æ³•ï¼Œå…¨éƒ¨æ”¾åˆ°ä¸€ä¸ªPrivate Categoryé‡Œé¢ï¼Œåº“å†…éƒ¨å…¶ä»–éœ€è¦æ“ä½œçš„åœ°æ–¹ï¼Œå¼•ç”¨è¿™ä¸ªå¤´æ–‡ä»¶å³å¯ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person+Private.h</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)privateMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Person+Private.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)privateMethod</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h2 id="æš´éœ²å…¬å¼€ç±»çš„å†…éƒ¨æ–¹æ³•"><a href="#æš´éœ²å…¬å¼€ç±»çš„å†…éƒ¨æ–¹æ³•" class="headerlink" title="æš´éœ²å…¬å¼€ç±»çš„å†…éƒ¨æ–¹æ³•"></a>æš´éœ²å…¬å¼€ç±»çš„å†…éƒ¨æ–¹æ³•</h2><p>å¯¹äºå…¬å¼€ç±»ï¼Œæˆ‘ä»¬æœ‰å¯èƒ½åœ¨å®ç°ä¸­å®šä¹‰å¾ˆå¤šå†…éƒ¨çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯èƒ½ä¾èµ–ä¸€äº›ä¸Šä¸‹æ–‡ï¼Œæˆ–è€…æ˜¯åªåœ¨ç±»æ‰©å±•é‡Œé¢å®šä¹‰çš„å±æ€§ï¼ˆè€Œä¸æ˜¯åœ¨æˆ‘ä»¬çš„Privateåˆ†ç±»é‡Œé¢ï¼‰ã€‚å½“æˆ‘ä»¬åœ¨åº“çš„å…¶ä»–åœ°æ–¹ï¼Œä¹Ÿæƒ³ä½¿ç”¨è¿™äº›å†…éƒ¨æ–¹æ³•æ—¶ï¼Œä½†æ˜¯æ–¹æ³•å®šä¹‰ä¸åœ¨Private Headerä¸­ï¼ˆè™½ç„¶å®é™…ä¸Šåœ¨ç±»å†…éƒ¨å·²ç»å®ç°äº†ï¼‰ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼æ¥æš´éœ²ç±»çš„å†…éƒ¨æ–¹æ³•ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Person.m</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)publicMethod</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    [<span class="keyword">self</span> internalMethod];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æˆ‘ä»¬æƒ³æš´éœ²è¿™ä¸ªæ–¹æ³•ç»™å…¶ä»–å¼•ç”¨äº†Private Headerçš„åœ°æ–¹ä½¿ç”¨</span></span><br><span class="line">- (<span class="type">void</span>)internalMethod</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ˆé”™è¯¯ç¤ºèŒƒï¼‰ï¼š</strong></p><p>ä½¿ç”¨ä¸€ä¸ªPrivate Categoryï¼Œåœ¨å¤´æ–‡ä»¶ä¸­æš´éœ²è¿™ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯ç”±äºæ˜¯ç±»æœ¬èº«è€Œä¸æ˜¯Categoryçš„æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥æ‰¾ä¸åˆ°<code>internalMethod</code>çš„å®ç°çš„warningï¼ˆè™½ç„¶å®ƒç¡®å®åœ¨æœ¬èº«çš„ç±»ä¸­å®ç°äº†ï¼‰ã€‚æˆ‘ä»¬æ˜¯å¯ä»¥è­¦å‘Šç¼–è¯‘å™¨ï¼Œå¿½ç•¥warningï¼Œå› ä¸ºä½ çŸ¥é“å®é™…ä¸Šè¿™ä¸ªæ–¹æ³•å·²ç»æœ‰äº†å®ç°ï¼Œåªä¸è¿‡å¤´æ–‡ä»¶æ²¡æœ‰æš´éœ²ç½¢äº†ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•å¿½ç•¥è­¦å‘Šï¼Œä¼šå¿½ç•¥æ‰€æœ‰Private Categoryçš„æ–¹æ³•æ£€æŸ¥ï¼Œå‡å¦‚Person+Private.hä¸­å®šä¹‰çš„æ–¹æ³•çœŸçš„æ²¡æœ‰åœ¨Person+Private.mä¸­å®ç°ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•è­¦å‘Šï¼Œæ‰€ä»¥éå¸¸ä¸æ¨èã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Person+Private.h</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)internalMethod; <span class="comment">//åœ¨ç±»æœ¬èº«å®ç°ä¸­çš„å†…éƒ¨æ–¹æ³•ï¼Œæƒ³è¦æš´éœ²å‡ºå»</span></span><br><span class="line">- (<span class="type">void</span>)privateMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Person+Private.m</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> clang diagnostic push</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> clang diagnostic ignored <span class="string">&quot;-Wincomplete-implementation&quot;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> clang diagnostic pop</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>ä½¿ç”¨ç±»æ‹“å±•ï¼ˆè€Œä¸æ˜¯Private Categoryï¼‰æ¥æš´éœ²ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ï¼Œå®é™…ä¸Šè¿™æ‰æ˜¯æœ€ä½³çš„æ–¹å¼ï¼Œå› ä¸ºç±»æ‰©å±•å¹¶ä¸å±€é™äºä»»ä½•åœ°æ–¹ï¼Œè€Œä¸”å¯ä»¥åœ¨ä»»ä½•.hæˆ–è€….mä¸­è¿›è¡Œå£°æ˜ã€‚å®é™…ä¸Šï¼Œç±»æ‰©å±•åªæœ‰@interfaceè€Œä¸èƒ½æœ‰@implementationï¼Œæ˜¯æ–¹æ³•çš„æ¥å£è€Œä¸æ˜¯å®ç°ï¼Œä¸ä¼šå‡ºç°æ–¹æ³•é‡å®šä¹‰æˆ–è€…è¦†ç›–çš„é—®é¢˜ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨ç±»æ‰©å±•ä¸­åŠ å…¥å®é™…ç±»çš„å†…éƒ¨æ–¹æ³•å³å¯ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Person+Private.h</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> ()</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)internalMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)privateMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Person+Private.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span> (<span class="title">Private</span>)</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºç±»æ‰©å±•åœ¨ç¼–è¯‘å™¨æ£€æŸ¥æ—¶ï¼Œæ˜¯éœ€è¦å¯¹ç±»æœ¬èº«å®ç°çš„æ–¹æ³•è¿›è¡Œæ£€æŸ¥çš„ï¼Œå› æ­¤å‡å¦‚Personç±»æœ¬èº«æ²¡æœ‰å®ç°internalMethodï¼Œç¼–è¯‘å™¨ä¼šæŠ¥warningï¼Œè¿™ä¹Ÿä¿è¯äº†æ­£ç¡®æ€§ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Objective-Cæ¯•ç«Ÿå·²ç»å‡ åå¹´çš„è¯­è¨€äº†ï¼Œè¯­æ³•å±‚é¢ä¸Šå¯¹æŠ½è±¡éšè—æ”¯æŒçš„å°±ä¸å¥½ï¼Œä¸åƒSwiftæä¾›äº†å››ç§è®¿é—®æ§åˆ¶å…³é”®å­—ï¼š<code>public</code>ã€<code>internal</code>ã€<code>fileprivate</code>ã€<code>private</code>ï¼Œè€Œä¸”æ”¯æŒModuleï¼Œå†ä¹Ÿä¸ç”¨æ‹…å¿ƒå‘½åå’Œé‡å®šä¹‰é—®é¢˜äº†ã€‚ä¸è¿‡Swiftçš„ç°çŠ¶ï¼Œåœ¨Swift 4.0 ABIè¿˜ä¸èƒ½ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œä»£ç åº“åˆ†å‘å°±åªèƒ½ä½¿ç”¨æºä»£ç ï¼Œè¿™ç‚¹å¯¹äºå¾ˆå¤šå¼€å‘è€…è¿˜æœ‰ä¼ä¸šçš„å½±å“ç¡®å®æ¯”è¾ƒå¤§ã€‚ä¸è¿‡äº†è§£Objective-Cçš„å®ç°ä¹Ÿä¸æ˜¯ä»€ä¹ˆåäº‹ï¼Œæ¯•ç«Ÿè°ä¸å®šæ€»ä¼šæœ‰éœ€è¦å†™çš„çš„æ—¶å€™ã€‚å¸Œæœ›è¿™äº›ä»£ç åº“çš„æ¥å£ä¸å®ç°éšè—çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿå¸®åˆ°ä¸€äº›å¹³æ—¶æ²¡æœ‰æ¥è§¦è¿‡ä»£ç åº“å¼€å‘çš„äººå§ã€‚</p><h1 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h1><ol><li><a href="https://gist.github.com/dreampiggy/2f2da443874b329a2f5d12f546a7a0cf">å®Œæ•´Categoryå±æ€§å®</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è™½ç„¶Swiftç°åœ¨æ˜¯å¼€å‘iOSæ¨èå…¥æ‰‹çš„æœ€ä½³è¯­è¨€ï¼Œä½†æ˜¯å¯¹äºä»£ç åº“è€Œè¨€ï¼Œæœ€å¤§çš„ä¸€ä¸ªé—®é¢˜æ˜¯Swift ABIä»ç„¶æ²¡æœ‰å®šä¸‹ï¼ˆä»Šå¹´å‘å¸ƒçš„çš„Swift 4.0ï¼Œä¾ç„¶æ”¾å¼ƒABIç¨³å®šæ€§ï¼Œè€Œæ³¨é‡äºSwiftæºä»£ç 3.x-&amp;gt;4.0çš„å…¼å®¹æ€§ï¼‰ã€‚æ‰€ä»¥è¿™å°±æ„å‘³ç€Swift 3.xç¼–è¯‘çš„äºŒè¿›åˆ¶åº“ï¼Œåœ¨Swift 4.0å°†æ— æ³•é“¾æ¥ï¼Œåªèƒ½é‡æ–°ä»£ç ç¼–è¯‘ã€‚çœ‹æ¥è¿™åˆå°†æ˜¯Objective-Cè¿™é—¨å¤è€çš„è¯­æ³•ï¼Œèƒ½å¤Ÿä½œä¸ºä¸€äº›frameworké¦–é€‰å¼€å‘è¯­è¨€çš„ä¸€å¹´ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯¹äºä¸€ä¸ªä»£ç åº“æ¥è¯´ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¸ºäº†éšè—ä¸€äº›å®ç°çš„ç»†èŠ‚ï¼Œæˆ–è€…å†…éƒ¨å¤„ç†æµç¨‹ï¼Œéœ€è¦ç¼–è¯‘åˆ°äºŒè¿›åˆ¶è¿›è¡Œåˆ†å‘ï¼Œå¹¶æä¾›Public Headeræ¥ä¾›å…¶ä»–å¼€å‘è€…è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¼€å‘ä»£ç åº“çš„æ—¶å€™ï¼Œéœ€è¦æ˜ç¡®å“ªäº›APIæ˜¯å¯¹å¤–å…¬å¼€çš„ï¼Œå¯ä»¥ç”±å…¶ä»–å¼€å‘è€…è°ƒç”¨ã€‚é‚£äº›æ˜¯åº“å†…éƒ¨ä¹‹é—´äº’ç›¸è°ƒç”¨çš„ï¼Œä¸åº”è¯¥ç”±å¤–éƒ¨ä½¿ç”¨è€…è°ƒç”¨ã€‚è€ŒObjective-Cä¸åƒC++æä¾›äº†privateå…³é”®å­—æ¥é™åˆ¶ç›´æ¥è®¿é—®æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ã€‚å› æ­¤ï¼Œå°±éœ€è¦å°½é‡é¿å…ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•çš„å®šä¹‰å‡ºç°åœ¨å¤´æ–‡ä»¶ä¸­ã€‚åªè¦ä¸å¼•å…¥ç§æœ‰çš„å¤´æ–‡ä»¶ï¼Œé‚£å°±æ— æ³•ç›´æ¥è®¿é—®è¿™äº›å±æ€§å’Œæ–¹æ³•ã€‚&lt;/p&gt;
&lt;h1 id=&quot;éšè—å†…éƒ¨å±æ€§&quot;&gt;&lt;a href=&quot;#éšè—å†…éƒ¨å±æ€§&quot; class=&quot;headerlink&quot; title=&quot;éšè—å†…éƒ¨å±æ€§&quot;&gt;&lt;/a&gt;éšè—å†…éƒ¨å±æ€§&lt;/h1&gt;&lt;p&gt;ç§æœ‰å±æ€§ï¼Œå¯ä»¥åˆ†æˆä¸¤ç§ï¼Œä¸€ç§æ˜¯å¸Œæœ›æ”¾åˆ°ç±»å†…éƒ¨è€Œçº¯ç²¹ä¸æƒ³æš´éœ²ç»™ä»»ä½•äººçš„ï¼Œå¯ä»¥å«åšå†…éƒ¨å±æ€§ã€‚ä¸€ç§æ˜¯å¸Œæœ›æš´éœ²åˆ°Private Headerä¸­ï¼Œåªé™äºå¼•å…¥è¯¥å¤´æ–‡ä»¶çš„åœ°æ–¹è¿›è¡Œè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;å†…éƒ¨å±æ€§çš„å£°æ˜éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç±»æ‰©å±•å£°æ˜å±æ€§ï¼Œè€Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆgetterå’Œsetterï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–å·¥ä½œã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="Objective-C" scheme="http://dreampiggy.com/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>å®¢æˆ·ç«¯ä¸ŠåŠ¨æ€å›¾æ ¼å¼å¯¹æ¯”å’Œè§£å†³æ–¹æ¡ˆ</title>
    <link href="http://dreampiggy.com/2017/03/06/%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8A%E5%8A%A8%E6%80%81%E5%9B%BE%E6%A0%BC%E5%BC%8F%E5%AF%B9%E6%AF%94%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>http://dreampiggy.com/2017/03/06/%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8A%E5%8A%A8%E6%80%81%E5%9B%BE%E6%A0%BC%E5%BC%8F%E5%AF%B9%E6%AF%94%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2017-03-06T14:51:04.000Z</published>
    <updated>2022-05-09T07:27:55.183Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¯¹å„ç§å®¢æˆ·ç«¯æ¥è¯´ï¼Œæ— è®ºæ˜¯Webè¿˜æ˜¯ç§»åŠ¨ç«¯ï¼Œå›¾ç‰‡å æ®çš„å®¹é‡å’Œä¼ è¾“èµ„æºä¸€å®šæ˜¯éå¸¸å¤§çš„ã€‚å¯¹äºé™æ€å›¾ï¼Œæˆ‘ä»¬å¸¸è§çš„PNGå’ŒJPEGæ ¼å¼åœ¨å‹ç¼©ç‡å’Œç”»è´¨æ— æŸä¸Šéƒ½å­˜åœ¨ç€ä¸å°½å¦‚äººæ„çš„åœ°æ–¹ï¼Œè€ŒåŠ¨å›¾æ ¼å¼çš„GIFæ›´æ˜¯å­˜åœ¨ç€å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚å› æ­¤ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è¿ç§»åˆ°æ–°çš„å›¾ç‰‡æ ¼å¼ã€‚</p></blockquote><h1 id="GIF"><a href="#GIF" class="headerlink" title="GIF"></a>GIF</h1><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç”¨GIFå‘¢ï¼ŒGIFç”±äºæ—¶ä»£é™åˆ¶ï¼Œå­˜åœ¨çš„å¤©ç”Ÿçš„é—®é¢˜ã€‚GIFçš„è§„èŒƒæœ€æ–°ç‰ˆæœ¬æ˜¯åœ¨1989å¹´åˆ¶å®šçš„ï¼Œä¸€ä¸ª24ä½è‰²éƒ½æ²¡æœ‰æ™®åŠçš„æ—¶ä»£ï¼Œå› æ­¤ï¼ŒGIFè§„èŒƒåªæ”¯æŒ256è‰²ç´¢å¼•é¢œè‰²ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡æŠ–åŠ¨ã€å·®å€¼ç­‰æ–¹å¼æ¨¡æ‹Ÿè¾ƒå¤šä¸°å¯Œçš„é¢œè‰²ã€‚æ›´ä¸ºæ‚²å‰§çš„æ˜¯ï¼Œå®ƒçš„alphaé€šé“åªæœ‰1bitï¼Œæ¢è¨€ä¹‹ï¼Œä¸€ä¸ªåƒç´ è¦ä¹ˆå®Œå…¨é€æ˜ï¼Œè¦ä¹ˆå®Œå…¨ä¸é€æ˜ï¼Œè€Œä¸åƒç°åœ¨PNGçš„RGBAçš„8bit alphaé€šé“ï¼Œalphaå€¼ä¹Ÿå¯ä»¥å’ŒRGBä¸€æ ·éƒ½æœ‰255ä¸ªé€æ˜å€¼ã€‚è¿™å¯¼è‡´äº†æ‰€æœ‰GIFçš„å›¾ç‰‡å¸¦ä¸Šé€æ˜åº¦ä»¥åï¼Œè¾¹ç¼˜ä¼šå‡ºç°æ˜æ˜¾çš„é”¯é½¿ã€‚æ‰€ä»¥å¦‚æœä½ çš„å®¢æˆ·ç«¯éœ€è¦å±•ç¤ºå¸¦é€æ˜åº¦çš„åŠ¨å›¾ï¼ŒGIFåŸºæœ¬ä¸Šå¯ä»¥ä¸è€ƒè™‘</p><p><img src="http://blog.ibireme.com/wp-content/uploads/2015/11/gif_apng_demo.gif" title="GIFå’ŒAPNGå¯¹æ¯”"></p><p>å®é™…çš„åœ¨çº¿Demoï¼Œå»ºè®®ç”¨Safariæˆ–è€…Chrome+æ’æ‰“å¼€ï¼š<a href="http://apng.onevcat.com/demo">http://apng.onevcat.com/demo</a></p><h1 id="APNG"><a href="#APNG" class="headerlink" title="APNG"></a>APNG</h1><p>APNGæ˜¯Mozillaåœ¨2008å¹´å‘å¸ƒçš„å›¾ç‰‡æ ¼å¼ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨PNGçš„åŸºç¡€ä¸ŠåŠ ä¸Šä¸€ä¸ªæ‰©å±•ï¼Œè€Œä¸”éå¸¸ç®€å•å³å¯å®ç°ã€‚å› æ­¤èƒ½å¤Ÿå®Œå…¨æ”¯æŒRGBAã€‚è§„èŒƒå¯ä»¥å‚è§<a href="https://wiki.mozilla.org/APNG_Specification">APNG Specification</a>ã€‚</p><p>è™½ç„¶è¿™ä¸ªè§„èŒƒæ²¡æœ‰åŠ å…¥PNGå¼€å‘ç»„ï¼Œä½†æ˜¯å¾ˆå¤šæµè§ˆå™¨å·²ç»æ”¯æŒäº†APNGã€‚<br>æœ€ä¸»æ¨çš„æ˜¯Appleçš„Safariï¼ˆOS X 10.10ä»¥åçš„Safariï¼Œä»¥åŠiOS 8ä»¥åçš„Safariå’Œå†…ç½®WebViewï¼‰ï¼Œå·²ç»å®Œå…¨æ”¯æŒã€‚Firefoxäº²å„¿å­å½“ç„¶ä¸€ç›´æ˜¯æ”¯æŒçš„ã€‚Chromeæ¡Œé¢ç«¯å·²ç»ä»Chrome 59å¼€å§‹æ”¯æŒï¼Œç°åœ¨å°±å·®Edgeäº†ã€‚å…·ä½“æ”¯æŒç¨‹åº¦å‚è§<a href="http://caniuse.com/#feat=apng">æµè§ˆå™¨å…¼å®¹æ€§</a>ã€‚</p><p>APNGçš„ä¼˜åŠ¿ï¼Œåœ¨äºæ—¶é—´æ¯”è¾ƒé•¿ï¼Œå„ç§åŠ¨å›¾åˆ¶ä½œå·¥å…·ï¼Œä¼˜åŒ–å·¥å…·éƒ½æœ‰ç›¸åº”çš„é¡¹ç›®æ¥æ”¯æŒã€‚è€Œä¸”åœ¨iOSä¸Šçš„WebViewé‡Œé¢æ˜¯é™¤GIFå¤–ï¼Œå”¯ä¸€å®˜æ–¹æ”¯æŒçš„åŠ¨å›¾æ ¼å¼ï¼Œå› æ­¤å¦‚æœåšç§»åŠ¨ç«¯å¼€å‘éœ€è¦WebViewé¡µå¼•å…¥åŠ¨å›¾ï¼ŒAPNGè¿˜æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><p>å½“ç„¶ï¼ŒAPNGç»ˆç©¶æ˜¯åœ¨PNGçš„åŸºç¡€ä¸Šæ‰©å±•ï¼Œå¹¶æ²¡æœ‰å¼•å…¥ç‰¹åˆ«å‡ºè‰²çš„å‹ç¼©ç®—æ³•ï¼Œè€Œä¸”é—æ†¾çš„æ˜¯ï¼ŒçŸ­æœŸå†…APNGè¿˜æ²¡æœ‰å¼•å…¥åˆ°Chromeï¼Œä¹Ÿå°±æ„å‘³ç€Androidå¹³å°çš„WebViewä¹Ÿæ²¡æœ‰åŸç”Ÿæ”¯æŒï¼Œå› æ­¤ï¼Œç§»åŠ¨å¼€å‘åˆä¼šé¢ä¸´ä¸¤ç«¯å…¼å®¹æ€§é—®é¢˜ï¼Œè¿™ä¸ªåè¯å†è¯´ã€‚</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/1/14/Animated_PNG_example_bouncing_beach_ball.png" alt="APNGï¼ŒChromeéœ€è¦59æˆ–è€…æ›´é«˜" title="APNGï¼ŒChromeéœ€è¦æ’ä»¶æ”¯æŒæˆ–åœ¨çº¿é¢„è§ˆ"></p><h2 id="ç›¸å…³APNGå·¥å…·"><a href="#ç›¸å…³APNGå·¥å…·" class="headerlink" title="ç›¸å…³APNGå·¥å…·"></a>ç›¸å…³APNGå·¥å…·</h2><p>APNGå›¾å½¢åŒ–åˆ¶ä½œå·¥å…·å’Œåœ¨çº¿é¢„è§ˆ:<a href="http://isparta.github.io/index.html">iSparta</a><br>APNGå¤§å°ä¼˜åŒ–:<a href="https://sourceforge.net/projects/apng/files/APNG_Optimizer/">APNG Optimizer</a><br>APNG Chromeæ’ä»¶:<a href="https://chrome.google.com/webstore/detail/apng/ehkepjiconegkhpodgoaeamnpckdbblp">APNG for Chrome</a></p><h1 id="WebP"><a href="#WebP" class="headerlink" title="WebP"></a>WebP</h1><p>WebPæ˜¯Googleåœ¨2010å¹´å‘å¸ƒçš„å›¾ç‰‡æ ¼å¼ï¼Œå®Œå…¨å¼€æºï¼Œä½¿ç”¨äº†VP8ï¼ˆå°±æ˜¯WebMè§†é¢‘æ‰€ç”¨åˆ°çš„è§£ç å™¨ï¼‰ä½œä¸ºå¸§å‹ç¼©ç¼–ç å™¨ï¼Œè€Œä¸”åœ¨Chromeï¼ŒAndroidä¸Šå¾—åˆ°äº†åŸç”Ÿçš„æ”¯æŒï¼Œå…·ä½“è§„èŒƒå‚è§:<a href="https://developers.google.com/speed/webp/">WebP</a></p><p>åŒæ ·çš„æ”¯æŒRGBAï¼Œè€Œä¸”é™æ€WebPçš„å‹ç¼©ç‡æ¯”èµ·åŒè´¨é‡PNGå¹³å‡è¦é«˜ä¸Š20%å·¦å³ã€‚ç°åœ¨å„å¤§Appå‚å•†å·²ç»æœ‰å¼€å§‹è¿ç§»WebPã€‚é™¤äº†é™æ€çš„WebPï¼Œè¿˜æœ‰åŠ¨æ€WebPæ ¼å¼(Animated WebP)æ”¯æŒï¼Œä¸è¿‡åŠ¨æ€WebPéœ€è¦libwebp 0.4ä»¥åæ‰æ­£å¼æ”¯æŒï¼Œå¹¶éœ€è¦muxå’Œdemuxæ¨¡å—ï¼Œå¦‚æœè‡ªè¡Œç¼–è¯‘éœ€è¦æ³¨æ„ã€‚</p><p>Googleå®˜æ–¹æä¾›äº†libwebpè¿™ä¸ªè§£ç åº“åœ¨å„ä¸ªå¹³å°çš„äºŒè¿›åˆ¶ç‰ˆæœ¬å’ŒMakefileï¼Œå¹¶ä¸”å¯ä»¥å®šåˆ¶å¼€å¯çš„åŠŸèƒ½ã€‚ä¸è¿‡ç”±äºä¸åƒAPNGé‚£æ ·åŸºäºPNGæ‰©å±•ï¼Œç›¸å…³çš„å·¥å…·å¾ˆæ¬ ç¼ºï¼ŒåŸºæœ¬å…¨é WebP Projectæä¾›çš„å·¥å…·ã€‚</p><p><code>cwebp</code>:PNG/JPEG -&gt; WebP<br><code>dwebp</code>:WebP -&gt; PNG/JPEG<br><code>vwebp</code>:WebPå‘½ä»¤è¡Œé¢„è§ˆå·¥å…·<br><code>webpmux</code>:å¤šå¼ WebPåˆ¶ä½œåŠ¨æ€WebP<br><code>gif2webp</code>:GIF -&gt; åŠ¨æ€WebP</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/0/9e/63a17a7087e6ab1a209460b54136b.webp" alt="Animated WebPï¼ŒSafariä¸æ”¯æŒ" title="Animated WebPï¼ŒSafariä¸æ”¯æŒ"></p><h2 id="WebPå·¥å…·"><a href="#WebPå·¥å…·" class="headerlink" title="WebPå·¥å…·"></a>WebPå·¥å…·</h2><p>åŸºæœ¬ä¸Šæ¥è¯´ï¼Œæ‰‹åŠ¨åˆ¶ä½œWebPä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºGoogleæ²¡æœ‰æä¾›WebP Optimizerä¹‹ç±»çš„ä¸œè¥¿ï¼Œå¦‚æœæˆ‘æœ‰100å¸§åŸºæœ¬æ— å·®åˆ«çš„å›¾ä½¿ç”¨webpmuxåˆæˆåŠ¨å›¾ï¼Œæœ€ç»ˆè¾“å‡ºçš„æ–‡ä»¶å¤§å°ä¼šæ¯”è¾ƒå¤§ã€‚å› æ­¤ï¼Œä¸€èˆ¬æ¨èçš„åšæ³•ï¼Œæ˜¯å…ˆé€šè¿‡PNGåˆ¶ä½œAPNGï¼ˆæ¯”å¦‚iSparataï¼‰ï¼Œç»è¿‡APNG Optimizerä¹‹åï¼Œå†ä»APNGè½¬æ¢åˆ°åŠ¨æ€WebPï¼Œè¿™ä¸ªæµç¨‹å¯ä»¥ç”¨è¿™ä¸ªé¡¹ç›®æ¥ä¸€é”®æå®šã€‚<br>åŒæ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ffmpegæ¥è½¬æ¢è§†é¢‘åˆ°Animated WebPï¼Œä¸€èˆ¬ä½¿ç”¨MOVå°è£…æ ¼å¼ï¼ˆUEå¸¸ç”¨çš„Prå¯¼å‡ºçš„MOVå¯ä»¥æ”¯æŒalphaé€šé“ï¼‰ã€‚ä¸è¿‡ç»è¿‡æµ‹è¯•è½¬æ¢å‡ºæ¥çš„Anmimated WebPå¤§å°ç›¸å¯¹æ¯”è¾ƒå¤§çš„ï¼ˆå°¤å…¶åŒæ ·çš„losslessä¸‹ï¼‰ï¼Œä¸å¦‚PNG-&gt;APNG-&gt;Animtated Webpè¿™ä¸ªæµç¨‹æ•ˆæœå¥½ã€‚</p><p><a href="https://github.com/Benny-/apng2webp">apng2webp</a>:APNG -&gt; Animated WebP<br><a href="https://gist.github.com/dreampiggy/52c658253de3ba22fd3dec4d3f3182ab">ffmpeg</a>:MOV -&gt; Animated WebP</p><h1 id="å…¶ä»–ç²—æš´çš„è§£å†³æ–¹æ¡ˆ"><a href="#å…¶ä»–ç²—æš´çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–ç²—æš´çš„è§£å†³æ–¹æ¡ˆ"></a>å…¶ä»–ç²—æš´çš„è§£å†³æ–¹æ¡ˆ</h1><p>åƒå›½å†…çš„å¾®åšæ¡Œé¢ç‰ˆï¼Œæä¾›çš„åŠ¨å›¾æ˜¯é€šè¿‡PNGé…åˆCSS Spiritï¼Œé ç€ä¸æ–­JSè½®æ’­åˆ‡æ¢PNGå­å›¾æ‰€æ‹¼å‡ºæ¥çš„ï¼Œè¿™ä¸ªå¸¦æ¥çš„å¸¦å®½æ¶ˆè€—ä¼šæ˜¯éå¸¸é«˜çš„ï¼Œå› ä¸ºå®Œå…¨æ˜¯å¤šå¼ å›¾ç‰‡æ··åˆï¼Œé™¤éæœ‰ç€å…¼å®¹æ€§åŒ…è¢±ï¼ˆIEä¹‹ç±»ï¼‰ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚</p><p><img src="http://img.t.sinajs.cn/t6/style/images/common/steps_gold2.png" alt="æš´åŠ›å®ç°" title="æš´åŠ›å®ç°"></p><h1 id="APNGå’ŒWebPå„å¹³å°å®ç°"><a href="#APNGå’ŒWebPå„å¹³å°å®ç°" class="headerlink" title="APNGå’ŒWebPå„å¹³å°å®ç°"></a>APNGå’ŒWebPå„å¹³å°å®ç°</h1><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><p><a href="http://caniuse.com/#feat=apng">APNG æµè§ˆå™¨æ”¯æŒ</a><br><a href="http://caniuse.com/#feat=webp">WebP æµè§ˆå™¨æ”¯æŒï¼Œæ³¨æ„Animated WebPæ”¯æŒ</a></p><h2 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h2><p>APNG:</p><ul><li><a href="https://github.com/ibireme/YYImage">YYImage</a></li><li><a href="https://github.com/onevcat/APNGKit">APNGKit</a></li></ul><p>Animated WebP:</p><ul><li><a href="https://github.com/ibireme/YYImage">YYImage</a></li></ul><p>WebP:</p><ul><li><a href="https://github.com/rs/SDWebImage">SDWebImage</a>ï¼Œæ³¨æ„SDä½¿ç”¨çš„libwebpå¹¶æ²¡æœ‰åŠ å…¥muxå’Œdemuxï¼Œæ•…æ— æ³•æ”¯æŒAnimated WebP</li></ul><p>WebView:</p><ul><li>UIWebViewï¼ŒWKWebViewå’ŒSafariViewControllerå‡åªæ”¯æŒAPNGï¼ˆiOS 8ä»¥åï¼‰ï¼Œä¸æ”¯æŒWebpå’ŒAnimated WebP</li></ul><p>YYImageï¼Œå¯¹æ˜¾ç¤ºåŠ¨æ€å›¾ï¼Œä½¿ç”¨äº†ä¸€ä¸ªUIImageViewçš„å­ç±»YYAnimatedImageViewï¼Œé€šè¿‡ç›´æ¥æ’å…¥äº†ä¸€ä¸ªCALayeræ¥ä½œä¸ºå›¾ç‰‡çš„æ¸²æŸ“layerï¼Œå¹¶ç”¨<code>CADisplayLink</code>è¿™ä¸ªå¸§å®šæ—¶å™¨æ¥åˆ·æ–°åŠ¨å›¾å¸§ï¼Œé€šè¿‡å¼‚æ­¥çº¿ç¨‹å¤„ç†è§£ç ï¼Œè¿˜æœ‰ä¸€äº›Cçš„åŠ¨æ€åˆ†é…å’Œå›æ”¶å†…å­˜æ¥é¿å…éå¸¸é«˜çš„å†…å­˜å ç”¨ï¼Œä¿è¯äº†æ€§èƒ½ã€‚å¹¶ä¸”è‡ªåŠ¨å¤„ç†äº†ä»è§†å›¾æ¶ˆå¤±ä»¥åŠæ»šåŠ¨ï¼ˆå¯ä»¥åˆ‡æ¢åˆ°RunLoopCommonModeæ¥æ»šåŠ¨æ—¶å€™ä¾ç„¶æ˜¾ç¤ºåŠ¨å›¾è€Œä¸æš‚åœï¼‰æƒ…å†µçš„é—®é¢˜ï¼Œå®ç°ä¹Ÿéå¸¸æœ‰æ„æ€ï¼Œæœ‰å…´è¶£çš„äººå¯ä»¥çœ‹ä¸€çœ‹ã€‚</p><h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h2><p>APNG:</p><ul><li><a href="https://github.com/sahasbhop/apng-view">APNG View</a></li></ul><p>Animated WebP:</p><ul><li><a href="https://github.com/facebook/fresco">Fresco</a></li></ul><p>WebView:</p><ul><li>Android 4.3ä»¥åæ‰æ”¯æŒå¸¦losslesså’Œalphaçš„WebP</li></ul><p>AndroidåŸºæœ¬ä¸Šå¯¹APNGå¯ä»¥è¯´æ˜¯æ²¡æœ‰ä»€ä¹ˆæ”¯æŒçš„ï¼Œæ‰€ä»¥å¦‚æœæ˜¯ç§»åŠ¨å¼€å‘ä¸¤ä¸ªå¹³å°å…¼é¡¾ï¼Œå»ºè®®åŒæ—¶å‡†å¤‡APNGï¼ˆfor iOS WebViewï¼‰å’ŒAnimated WebPï¼Œå®¢æˆ·ç«¯ä¸Šå»ºè®®éƒ½æ˜¯ç”¨Animated WebPï¼Œå› ä¸ºVP8çš„è§£ç é€Ÿåº¦ç›¸å¯¹äºAPNGæœ‰ä¸€äº›ä¼˜åŠ¿ã€‚</p><p><img src="http://blog.ibireme.com/wp-content/uploads/2015/11/anim_bench.png"></p><h1 id="å­˜åœ¨çš„å‘"><a href="#å­˜åœ¨çš„å‘" class="headerlink" title="å­˜åœ¨çš„å‘"></a>å­˜åœ¨çš„å‘</h1><h2 id="Webå’Œç§»åŠ¨ç«¯å¯¹äºAPNGå’ŒAnimated-WebPå¾ªç¯æ¬¡æ•°ä¸åŒ"><a href="#Webå’Œç§»åŠ¨ç«¯å¯¹äºAPNGå’ŒAnimated-WebPå¾ªç¯æ¬¡æ•°ä¸åŒ" class="headerlink" title="Webå’Œç§»åŠ¨ç«¯å¯¹äºAPNGå’ŒAnimated WebPå¾ªç¯æ¬¡æ•°ä¸åŒ"></a>Webå’Œç§»åŠ¨ç«¯å¯¹äºAPNGå’ŒAnimated WebPå¾ªç¯æ¬¡æ•°ä¸åŒ</h2><p>è¿™ä¸ªæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„å‘ï¼Œåœ¨Safari for iOSï¼ˆSafari for macOSæ­£å¸¸ï¼‰å’ŒChromeé¢„è§ˆAPNGå’ŒAnimated WebPçš„æ—¶å€™ï¼ŒåŠ¨å›¾çš„å¾ªç¯æ¬¡æ•°ä¸ºå¯¹åº”åŸå›¾çš„loop+1ã€‚æ¯”å¦‚Animated WebPæœ‰100å¸§ï¼Œloopä¸º2ï¼Œé‚£ä¹ˆChromeä¼šå¾ªç¯æ€»è®¡å±•ç¤º300å¸§</p><p>åˆšå¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ç§»åŠ¨ç«¯å®ç°åº“çš„é—®é¢˜ï¼Œæ¯•ç«ŸGoogleå’ŒAppleè¿™ç§å¤§å‚ä¸€èˆ¬ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ä½†æ˜¯å†å‚é˜…äº†APNGå’ŒAnimated WebPçš„è§„èŒƒï¼Œå‘ç°ç¡®å®æ˜¯Safariå’ŒChromeæœ¬èº«çš„é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ<a href="https://wiki.mozilla.org/APNG_Specification">APNGè§„èŒƒ</a>ä¸­çš„<code>num_plyas</code>å­—æ®µï¼Œå’Œ<a href="https://developers.google.com/speed/webp/docs/riff_container">WebPè§„èŒƒ</a>çš„<code>loop_count</code>å­—æ®µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Loop Count: 16 bits (uint16)</span><br><span class="line">The number of times to loop the animation. 0 means infinitely.</span><br><span class="line">This chunk MUST appear if the Animation flag in the VP8X chunk is set. If the Animation flag is not set and this chunk is present, it SHOULD be ignored.</span><br></pre></td></tr></table></figure><p>è§„èŒƒæåˆ°çš„ä¼ªä»£ç æè¿°ä¹Ÿè¡¨ç¤ºï¼Œloop countä¸º0è¡¨ç¤ºæ— é™å¾ªç¯å±•ç¤ºé¦–å¸§åˆ°å°¾å¸§ï¼Œè€Œloop count &gt;= 1ï¼Œå±•ç¤ºé¦–å¸§åˆ°å°¾å¸§loop countæ¬¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> VP8X.flags.hasAnimation</span><br><span class="line">canvas â† new image of size VP8X.canvasWidth x VP8X.canvasHeight <span class="keyword">with</span></span><br><span class="line">         background color ANIM.background_color.</span><br><span class="line">loop_count â† ANIM.loopCount</span><br><span class="line">dispose_method â† ANIM.disposeMethod</span><br><span class="line"><span class="keyword">if</span> loop_count == <span class="number">0</span>:</span><br><span class="line">    loop_count = âˆ</span><br><span class="line">frame_params â† nil</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">next</span> chunk <span class="keyword">in</span> image_data <span class="keyword">is</span> ANMF</span><br><span class="line"><span class="keyword">for</span> loop = <span class="number">0.</span>.loop_count - <span class="number">1</span></span><br><span class="line">    clear canvas to ANIM.background_color <span class="keyword">or</span> application defined color</span><br><span class="line">    until eof <span class="keyword">or</span> non-ANMF chunk</span><br><span class="line">        frame_params.frameX = Frame X</span><br><span class="line">        frame_params.frameY = Frame Y</span><br><span class="line">        frame_params.frameWidth = Frame Width Minus One + <span class="number">1</span></span><br><span class="line">        frame_params.frameHeight = Frame Height Minus One + <span class="number">1</span></span><br><span class="line">        frame_params.frameDuration = Frame Duration</span><br><span class="line">        <span class="comment">#......</span></span><br><span class="line">        Show the contents of the canvas <span class="keyword">for</span></span><br><span class="line">            frame_params.frameDuration * 1ms.</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼ŒAPNGå¯¹åº”çš„<code>num_plays</code>å­—æ®µæ„æ€æ˜¯ä¸€æ ·çš„ï¼Œå¤§å®¶å¯ä»¥ä½¿ç”¨è¿™ä¸ªåœ¨çº¿æµ‹è¯•ç”¨ä¾‹ï¼ŒSafariè¡¨ç°é”™è¯¯è€Œå¤šå¾ªç¯äº†ä¸€æ¬¡ï¼š<a href="https://philip.html5.org/tests/apng/tests.html#num-plays-1">https://philip.html5.org/tests/apng/tests.html#num-plays-1</a></p><p>è§£å†³åŠæ³•ï¼š<br>ç”±äºä¸èƒ½æ›´æ”¹æµè§ˆå™¨çš„å®ç°ï¼Œéƒ¨åˆ†æƒ…å†µä¹Ÿä¸å¥½å¼•å…¥JSæ¥æ‰‹åŠ¨å®ç°ï¼Œå› æ­¤ï¼Œå¯¹äºAPNGï¼Œä¸€èˆ¬åªç”¨åœ¨iOSçš„WebViewä¸Šï¼Œå› æ­¤å¯ä»¥ç›´æ¥åˆ¶ä½œAPNGå›¾çš„æ—¶å€™ï¼ŒæŠŠå¾ªç¯å‡ä¸€ã€‚è€ŒAnimated WebPï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯å®ç°åŠ ä¸€ä¸ªHackï¼Œå¦‚æœloopä¸æ˜¯0æ‰‹åŠ¨å‡ä¸€ï¼Œä¿æŒå’ŒWebä¸€è‡´æ€§ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸“é—¨æä¾›ä¸€ä¸ªloop countåŠ ä¸€çš„å›¾ç»™Chrome/Androidçš„WebViewï¼‰ï¼Œå¸Œæœ›ä¹‹åä¸¤å¤§æµè§ˆå™¨æ˜¯å¦å¯ä»¥æŠŠè¿™ä¸ªBugä¿®å¤äº†ï¼ˆå½“ç„¶ï¼Œä¸æ’é™¤è”åˆä¸€èµ·æ›´æ”¹äº†è§„èŒƒçš„å¯èƒ½æ€§ï¼‰</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>GIFä½œä¸ºä¸€ä¸ªåŠ¨å›¾æ ¼å¼å·²ç»å¤ªè¿‡äºå¤è€äº†ï¼Œå°¤å…¶æ˜¯å½“å‰ç§»åŠ¨å’ŒWebç«™éœ€è¦å¼•å…¥å„ç§åŠ¨æ€è¡¨æƒ…ï¼Œå¤´åƒçš„æ—¶å€™ï¼ŒGIFçš„é€æ˜é—®é¢˜å·²ç»æ˜¯ä¸å¯æ¥å—çš„ã€‚WebPé•¿æœŸå‘å±•ä¹Ÿæ˜¯æ¯”è¾ƒçœ‹å¥½ï¼ˆç›¸æ¯”APNGæ²¡æœ‰è¿›å…¥PNGå¼€å‘ç»„ï¼ŒåŸºæœ¬ä¸å†æ´»è·ƒï¼‰ï¼Œå¼€æºå¤–åŠ æ— æˆæƒè´¹ç”¨ï¼Œæˆ–è®¸èƒ½å¤Ÿå’ŒWebMä¸€æ ·ï¼Œæˆä¸ºäº’è”ç½‘ä¸‹é¦–é€‰çš„å›¾ç‰‡å’Œè§†é¢‘æ ¼å¼ã€‚è€Œç§»åŠ¨å®¢æˆ·ç«¯ï¼Œåœ¨å¾ˆå¤šç§éœ€æ±‚ä¸‹ï¼ˆåŠ¨æ€è¡¨æƒ…ï¼Œç”¨æˆ·æ ‡å¿—ï¼Œå¹¿å‘Šï¼‰ç­‰ä¸Šé¢ï¼Œé‡‡ç”¨è¿™ç§APNGå’ŒAnimated WebPå°±èƒ½å¤Ÿè½»æ¾è§£å†³ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å¯¹å„ç§å®¢æˆ·ç«¯æ¥è¯´ï¼Œæ— è®ºæ˜¯Webè¿˜æ˜¯ç§»åŠ¨ç«¯ï¼Œå›¾ç‰‡å æ®çš„å®¹é‡å’Œä¼ è¾“èµ„æºä¸€å®šæ˜¯éå¸¸å¤§çš„ã€‚å¯¹äºé™æ€å›¾ï¼Œæˆ‘ä»¬å¸¸è§çš„PNGå’ŒJPEGæ ¼å¼åœ¨å‹ç¼©ç‡å’Œç”»è´¨æ— æŸä¸Šéƒ½å­˜åœ¨ç€ä¸å°½å¦‚äººæ„çš„åœ°æ–¹ï¼Œè€ŒåŠ¨å›¾æ ¼å¼çš„GIFæ›´æ˜¯å­˜åœ¨ç€å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚å› æ­¤ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è¿ç§»åˆ°æ–°çš„å›¾ç‰‡æ ¼å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;GIF&quot;&gt;&lt;a href=&quot;#GIF&quot; class=&quot;headerlink&quot; title=&quot;GIF&quot;&gt;&lt;/a&gt;GIF&lt;/h1&gt;&lt;p&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç”¨GIFå‘¢ï¼ŒGIFç”±äºæ—¶ä»£é™åˆ¶ï¼Œå­˜åœ¨çš„å¤©ç”Ÿçš„é—®é¢˜ã€‚GIFçš„è§„èŒƒæœ€æ–°ç‰ˆæœ¬æ˜¯åœ¨1989å¹´åˆ¶å®šçš„ï¼Œä¸€ä¸ª24ä½è‰²éƒ½æ²¡æœ‰æ™®åŠçš„æ—¶ä»£ï¼Œå› æ­¤ï¼ŒGIFè§„èŒƒåªæ”¯æŒ256è‰²ç´¢å¼•é¢œè‰²ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡æŠ–åŠ¨ã€å·®å€¼ç­‰æ–¹å¼æ¨¡æ‹Ÿè¾ƒå¤šä¸°å¯Œçš„é¢œè‰²ã€‚æ›´ä¸ºæ‚²å‰§çš„æ˜¯ï¼Œå®ƒçš„alphaé€šé“åªæœ‰1bitï¼Œæ¢è¨€ä¹‹ï¼Œä¸€ä¸ªåƒç´ è¦ä¹ˆå®Œå…¨é€æ˜ï¼Œè¦ä¹ˆå®Œå…¨ä¸é€æ˜ï¼Œè€Œä¸åƒç°åœ¨PNGçš„RGBAçš„8bit alphaé€šé“ï¼Œalphaå€¼ä¹Ÿå¯ä»¥å’ŒRGBä¸€æ ·éƒ½æœ‰255ä¸ªé€æ˜å€¼ã€‚è¿™å¯¼è‡´äº†æ‰€æœ‰GIFçš„å›¾ç‰‡å¸¦ä¸Šé€æ˜åº¦ä»¥åï¼Œè¾¹ç¼˜ä¼šå‡ºç°æ˜æ˜¾çš„é”¯é½¿ã€‚æ‰€ä»¥å¦‚æœä½ çš„å®¢æˆ·ç«¯éœ€è¦å±•ç¤ºå¸¦é€æ˜åº¦çš„åŠ¨å›¾ï¼ŒGIFåŸºæœ¬ä¸Šå¯ä»¥ä¸è€ƒè™‘&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://blog.ibireme.com/wp-content/uploads/2015/11/gif_apng_demo.gif&quot; title=&quot;GIFå’ŒAPNGå¯¹æ¯”&quot;&gt;&lt;/p&gt;
&lt;p&gt;å®é™…çš„åœ¨çº¿Demoï¼Œå»ºè®®ç”¨Safariæˆ–è€…Chrome+æ’æ‰“å¼€ï¼š&lt;a href=&quot;http://apng.onevcat.com/demo&quot;&gt;http://apng.onevcat.com/demo&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;APNG&quot;&gt;&lt;a href=&quot;#APNG&quot; class=&quot;headerlink&quot; title=&quot;APNG&quot;&gt;&lt;/a&gt;APNG&lt;/h1&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="Web" scheme="http://dreampiggy.com/tags/Web/"/>
    
    <category term="Image" scheme="http://dreampiggy.com/tags/Image/"/>
    
  </entry>
  
  <entry>
    <title>2016å¹´æœ«æ€»ç»“å’Œè¿‘æœŸæ„Ÿæƒ³</title>
    <link href="http://dreampiggy.com/2016/12/31/2016%E5%B9%B4%E6%9C%AB%E6%80%BB%E7%BB%93%E5%92%8C%E8%BF%91%E6%9C%9F%E6%84%9F%E6%83%B3/"/>
    <id>http://dreampiggy.com/2016/12/31/2016%E5%B9%B4%E6%9C%AB%E6%80%BB%E7%BB%93%E5%92%8C%E8%BF%91%E6%9C%9F%E6%84%9F%E6%83%B3/</id>
    <published>2016-12-31T20:38:16.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¹´åçš„æœ€åä¸€å¤©ï¼Œä¹Ÿæ˜¯è¯¥æ€»ç»“ä¸€ä¸‹è¿™ä¸€å¹´çš„æˆé•¿äº†ã€‚</p></blockquote><h1 id="ä»æ ¡å›­åˆ°å®ä¹ "><a href="#ä»æ ¡å›­åˆ°å®ä¹ " class="headerlink" title="ä»æ ¡å›­åˆ°å®ä¹ "></a>ä»æ ¡å›­åˆ°å®ä¹ </h1><p>è½¯ä»¶ä¸“ä¸šçš„å¤§ä¸‰å­¦å¹´ï¼Œå¦‚æœä½ ä¸è€ƒç ”ç•™å­¦çš„è¯ï¼Œè¯´èµ·æ¥éƒ½æ˜¯ä¼šèµ°å®ä¹ åŠ æ ¡æ‹›çš„æµç¨‹ã€‚è‡ªå·±è¿™å¹´å°è±¡æœ€æ·±çš„ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªä¸‹åŠå¹´çš„å®ä¹ ï¼Œé¢è¯•ï¼Œä»¥åŠç°åœ¨çš„å®ä¹ äº†ã€‚</p><p>å¤§ä¸‰ä¸Šçš„å®ä¹ å½“æ—¶è‡ªå·±é”™è¿‡äº†æœºä¼šï¼Œåªè¿›å…¥äº†ä¸€ä¸ªæ™®é€šçš„äº’è”ç½‘å…¬å¸ï¼Œä½†æ˜¯ä¹Ÿå­¦åˆ°äº†æ›´å¤šæ ¡å›­ä¸­æ— æ³•è§åˆ°çš„ä¸œè¥¿ï¼ˆæ¯”å¦‚å¤šç§»åŠ¨Appå¤šProjectç®¡ç†ï¼ŒMapKitï¼ŒReact Nativeï¼‰ï¼Œå¼€é˜”äº†ä¸€ç‚¹çœ¼ç•Œã€‚çœŸæ­£çš„ä¸‹åŠå¹´å¥½å‡ ä¸ªæœˆéƒ½åœ¨å¿™ç€æ ¡æ‹›é¢è¯•ç›¸å…³çš„ä¸œè¥¿ï¼Œä»ä¸­ä¹Ÿæ€»ç»“äº†ä¸€äº›ç»éªŒå§ï¼ˆè™½ç„¶ä¸çŸ¥é“å¯¹ç¤¾æ‹›æ˜¯å¦æœ‰å¸®åŠ©ï¼‰ã€‚ç„¶è€Œåˆ°ç°åœ¨ï¼Œä»å—äº¬æ¥åˆ°äº†åŒ—äº¬ï¼Œæå‰è¿‡æ¥å¤´æ¡è¿™è¾¹å®ä¹ ã€‚</p><p>å®ä¹ å¼€å§‹éƒ½æ˜¯å…´å¥‹å’Œå¥½å¥‡çš„ï¼Œå› ä¸ºå¯ä»¥çœ‹åˆ°å…¬å¸çš„å„ç§è®¾æ–½ï¼Œç¦åˆ©ï¼Œè¿˜æœ‰è®¤è¯†å„å¼å„æ ·çš„äººã€‚æ¥è¿™è¾¹ä¹Ÿæ˜¯ä¸“é—¨æ‹‰äº†ä¸¤ä¸ªåŒå…¬å¸çš„åº”å±Šç”Ÿä¸€èµ·æ¥ï¼Œä¹ŸæŒºæ„‰å¿«çš„ã€‚å…¬å¸ç¦»å¾—è¿‘ï¼Œç»„é‡Œçš„äººä¹Ÿéƒ½æ¯”è¾ƒå‰å®³ï¼ˆè‡³å°‘éƒ½æ˜¯æˆ‘è¯·æ•™åˆ«äººæ•™è‚²çš„æƒ…å½¢ï¼‰ï¼Œè™½ç„¶ä¸Šç­ç´¯äº†äº›ï¼Œä½†æ˜¯æ„Ÿè§‰è‡ªå·±æˆé•¿ä¹Ÿæ˜¯éå¸¸çš„å¤§ï¼Œå¾ˆéš¾æƒ³è±¡å‡å¦‚ä¸æ¥å®ä¹ ï¼Œå…¨é è‡ªå·±æ‘¸ç´¢ï¼Œæ˜å¹´ç›´æ¥æ¯•ä¸šè¿‡æ¥ä¸Šç­è‡ªå·±æ˜¯ä»€ä¹ˆæ ·çš„æ°´å¹³ã€‚</p><h1 id="è¿‘æœŸå·¥ä½œæ„Ÿæƒ³"><a href="#è¿‘æœŸå·¥ä½œæ„Ÿæƒ³" class="headerlink" title="è¿‘æœŸå·¥ä½œæ„Ÿæƒ³"></a>è¿‘æœŸå·¥ä½œæ„Ÿæƒ³</h1><p>æ¥åˆ°å¤´æ¡è¿™è¾¹ä¹Ÿåˆšåˆšå¥½ä¸€ä¸ªæœˆäº†æŠŠã€‚è¿™æœŸé—´æœ€å¤§çš„æ„Ÿè§¦ï¼Œå°±æ˜¯è‡ªå·±çš„å·¥ä½œå’Œäº§å“å°†ä¼šé¢å¯¹çš„æ˜¯ä¸Šåƒä¸‡çº§åˆ«çš„æ—¥æ´»ç”¨æˆ·ï¼Œè€Œä¸”ä¸åŒäºä¹‹å‰çš„å®ä¹ é‚£æ ·ä¸€äººè´Ÿè´£éå¸¸å°çš„ä¸šåŠ¡ï¼Œçœ‹çœ‹éœ€æ±‚ï¼Œå†™å†™ä»£ç ï¼Œæµ‹è¯•ç®€å•è¿‡ä¸€éï¼Œç›´æ¥å°±gitæä¸Šå»äº†ã€‚åœ¨è¿™é‡Œï¼Œæ•´ä¸ªå·¥ä½œæµéƒ½æ˜¯æœ‰ä¸“é—¨æœ‰PMè·Ÿï¼Œå¹¶ä¸”å¼€å‘éƒ½æ˜¯è‡ªå·±checkoutåˆ†æ”¯ä¸æ–­mergeï¼ŒèŠ‚å¥æ›´æ˜¯å¿«äº†ä¸å°‘ã€‚ææµ‹æµç¨‹ä¹Ÿæ˜¯æ›´åŠ çš„ä¸¥æ ¼ï¼Œå› ä¸ºç°åœ¨ä½ å¼€å‘çš„äº§å“ä¸å†æ˜¯å‘å±•å¯è’™é˜¶æ®µçš„ä¸å®Œæˆå“ï¼Œä¸€ä¸ªéœ€æ±‚å¦‚æœä¸èƒ½è¦†ç›–å¥½å®Œæ•´çš„è¾¹ç•Œæƒ…å†µï¼Œå®æ„¿ä¸è¦è¿™ä¸ªåŠŸèƒ½ï¼Œä¹Ÿä¸èƒ½å¸¦ç€ä¸€ç‚¹ä¾¥å¹¸å¿ƒç†ä¸Šçº¿ã€‚åœ¨åƒä¸‡çº§åˆ«ä½¿ç”¨é‡çš„å†²å‡»ä¸‹ï¼Œä»»ä½•æƒ…å†µéƒ½å¯èƒ½å‘ç”Ÿã€‚å› æ­¤ä¸€å®šè¦åšå¥½ç‰¹æ®Šæƒ…å†µçš„å¤„ç†ã€‚</p><p>åŒæ—¶ï¼Œåœ¨äº§å“è¾¾åˆ°ä¸€å®šè§„æ¨¡ï¼Œæˆ‘ä¹Ÿè¶Šå‘å¯Ÿè§‰åˆ°ABæµ‹è¯•ã€å¼€å…³ã€æ—¥å¿—ç›‘æ§å’ŒæŠ¥è­¦åŠŸèƒ½çš„é‡è¦æ€§äº†ã€‚ç§»åŠ¨Appä¸åŒäºWebå‰ç«¯ï¼Œä¸€æ—¦å‘ä¸€ä¸ªç‰ˆå‡ºå»ï¼Œé‚£ä¹ˆå°±å¾—è€ƒè™‘å¯¹åº”çš„å…¼å®¹æ€§å’Œç•™å­˜ç‡ã€‚ä¸€æ—¦å‡ºç°çº¿ä¸ŠBugï¼Œç«‹å³å‘ç°å¹¶ä¸”å…³é—­å¯¹åº”çš„åŠŸèƒ½æ˜¯éå¸¸é‡è¦çš„è§£å†³æ–¹å¼ï¼Œä¹‹åå¯ä»¥å†è€ƒè™‘ä½¿ç”¨çƒ­ä¿®å¤æŠ€æœ¯æ¥å¯¹æ—§ç‰ˆæœ¬è¿›è¡Œå¤„ç†ã€‚æ¥è¿™é‡Œå¯ä»¥çœ‹åˆ°å„ç§åŠŸèƒ½éƒ½è€ƒè™‘äº†åŸ‹ç‚¹ï¼Œæ—¥å¿—ï¼Œè¿˜æœ‰ABæµ‹çš„å¼€å…³ã€‚åœ¨æ ¡å›­æœŸé—´è‡ªå·±æ¥è§¦å¼€å‘æµç¨‹ä¸­å°‘äº†å¾ˆå¤šå…³äºè¿™æ–¹é¢çš„æ„è¯†ï¼Œæ­£éœ€è¦å€Ÿæ­¤å¤šåŠ æ³¨æ„ã€‚</p><h1 id="å·¥ä½œä¸­çš„æŠ€æœ¯é—®é¢˜"><a href="#å·¥ä½œä¸­çš„æŠ€æœ¯é—®é¢˜" class="headerlink" title="å·¥ä½œä¸­çš„æŠ€æœ¯é—®é¢˜"></a>å·¥ä½œä¸­çš„æŠ€æœ¯é—®é¢˜</h1><h2 id="AVFoundationçš„æ³¨æ„"><a href="#AVFoundationçš„æ³¨æ„" class="headerlink" title="AVFoundationçš„æ³¨æ„"></a>AVFoundationçš„æ³¨æ„</h2><p>ç”±äºæœ‰éœ€æ±‚è¦åšå½•åƒå’Œäººè„¸è¯†åˆ«ç›¸å…³çš„ä¸œè¥¿ï¼Œå› æ­¤è‡ªå·±æ‰çœŸæ­£ä½¿ç”¨äº†AVFoundationè¿™ä¸ªAppleæä¾›çš„åª’ä½“åº“ã€‚è™½ç„¶ä½ å¯ä»¥ç®€å•çš„åœ¨SFä¸Šæœåˆ°ä¸€å †ç­”æ¡ˆï¼Œä½†æ˜¯çœŸå®çš„å¼€å‘æœ‰å¾ˆå¤šæ½œåœ¨çš„é—®é¢˜ã€‚å°¤å…¶æ˜¯è¿™ç§æ¶‰åŠåˆ°ç¡¬ä»¶å±‚é¢çš„APIï¼Œç¨ä¸ç•™ç¥å°±ä¼šæŠ¥Crashã€‚</p><p>æ¯”å¦‚æœ€å¸¸è§çš„é—®é¢˜ï¼Œç”¨æ¥ä¿æŒä¸€ä¸ªè¾“å…¥è®¾å¤‡åˆ°è¾“å‡ºè®¾å¤‡çš„ä¼šè¯ï¼Œä¼šç”¨åˆ°Sessionï¼Œè€ŒAVFoundationä¸­çš„è¿™ä¸ª<code>AVCaptureSession</code>çš„å¾ˆå¤šæ–¹æ³•ï¼Œéƒ½æ˜¯é˜»å¡çš„ã€‚ç®€å•çš„å¯åŠ¨å½•åˆ¶æµ<code>- startRunning</code>æ–¹æ³•ä¹Ÿæ˜¯é˜»å¡çº¿ç¨‹çš„ï¼ˆè¿™ä¸€ç‚¹åœ¨æ–‡æ¡£ä¸­æœ‰è¯´æ˜ï¼Œéœ€è¦æ³¨æ„ï¼‰ï¼Œè¦ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„concurrent queueæ¥å¤„ç†ï¼Œå¹¶ä¸”è¿˜è¦è®°å¾—dispatchåˆ°mainQueueä¸Šæ¥ä¾›å¤–éƒ¨UIKitçš„ä½¿ç”¨ï¼Œä¸ç„¶å…¶å®çœ‹èµ·æ¥è¡¨é¢ä¸ŠUIæ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯æ•´ä¸ªUIResponserå°±ä¼šå—åˆ°å½±å“ã€‚å…¶ä»–çš„è¿˜æœ‰æ¯”å¦‚ä¿®æ”¹è¾“å…¥æµï¼Œè¾“å‡ºæµçš„é…ç½®ï¼ˆæ¯”å¦‚è§†é¢‘æµçš„æ–¹å‘ï¼Œå¸§ç‡ä¹‹ç±»ï¼‰çš„é…ç½®æ—¶å€™ï¼Œä¹Ÿå¾—é…åˆ<code>- beginConfiguration</code>å’Œ<code>- commitConfiguration</code>ï¼Œä¸ç„¶ä¼šå‡ºç°çº¿ç¨‹å†²çªçš„é—®é¢˜ã€‚</p><p>è¿˜æœ‰çš„å‘ç‚¹ï¼Œä¸åŒäºImagePickerï¼ŒAVFoundationçš„é‡‡é›†å›è°ƒä¹Ÿéœ€è¦ä½ æ‰‹åŠ¨æŒ‡å®šçº¿ç¨‹ï¼Œæ¯”å¦‚<code>AVCaptureAudioDataOutputSampleBufferDelegate</code>å¯ä»¥ç”¨æ¥æŒç»­çš„é‡‡é›†bufferæ¥ç”Ÿæˆå¯¹äºçš„Imageï¼Œè¿›è€Œç”¨äº<code>OpenCV</code>æˆ–è€…è‡ªå¸¦çš„<code>CIDetercor</code>åšäººè„¸è¯†åˆ«çš„æŒç»­è¿½è¸ªã€‚ä½†æ˜¯åœ¨è°ƒè¯•æ—¶å€™æ²¡æœ‰æ³¨æ„åˆ°å›è°ƒåœ¨éä¸»çº¿ç¨‹è€Œè¿›è¡Œäº†UIæ“ä½œå¯¼è‡´å„ç§çš„é—®é¢˜ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼Œçœ‹æ¥è‡ªå·±ç†è®ºä¸Šçš„çŸ¥è¯†å’Œå®é™…çš„ç»éªŒè¿˜éœ€è¦å†ç£¨ç»ƒä¸€äº›ã€‚</p><h2 id="æ‰‹åŠ¨å¤„ç†å•å‘æ•°æ®æµçš„å‘"><a href="#æ‰‹åŠ¨å¤„ç†å•å‘æ•°æ®æµçš„å‘" class="headerlink" title="æ‰‹åŠ¨å¤„ç†å•å‘æ•°æ®æµçš„å‘"></a>æ‰‹åŠ¨å¤„ç†å•å‘æ•°æ®æµçš„å‘</h2><p>å› ä¸ºä¹‹å‰ä¸€ç›´åœ¨çœ‹ä¸€äº›Reactå‘€ï¼ŒRxç³»åˆ—çš„ä¸œè¥¿ï¼Œæ‰€ä»¥è§åˆ°ä¸€ä¸ªéœ€æ±‚çœ‹åˆ°å¯¹åº”çš„é¡µé¢çŠ¶æ€ä¸å¤šï¼Œå°±æƒ³è¯•è¯•ç”¨è¿™ç§å•é¡¹ç»‘å®šæ•°æ®æµæ¥å†™ã€‚ç”±äºAppå¯¹åŒ…å¤§å°æ¯”è¾ƒæ•æ„Ÿï¼Œä¹Ÿæ²¡æœ‰å¼•å…¥<code>ReactiveCocoa</code>ï¼Œè‡ªå·±å‚è€ƒç€Reactçš„Reduxä¸€èˆ¬ï¼Œæ”¾äº†ä¸€ä¸ªå•ç‹¬çš„Store Modelæ¥ä½œä¸ºçŠ¶æ€çš„Storeï¼ŒåŒæ—¶å®šä¹‰äº†åå‡ ç§çŠ¶æ€ã€‚æ‰€æœ‰çš„Viewå±‚ï¼ˆViewå’ŒViewControllerï¼‰çš„äº¤äº’å¯¼è‡´çš„çŠ¶æ€å˜åŒ–ï¼Œæ¨¡å‹å˜åŒ–å¿…é¡»é€šè¿‡ViewModelçš„è°ƒç”¨æ‰èƒ½ä¿®æ”¹Store Modelï¼Œè€ŒModelçš„æ•°æ®æ ¡éªŒä¹Ÿéƒ½ä¸¢åˆ°äº†ViewModelé‡Œé¢ã€‚è¿™å°±å½¢æˆäº†ç±»ä¼¼Reduxé‚£ç§View(Viewï¼ViewController) -&gt; Action(ViewModel) -&gt; Store(Model) -&gt; Viewçš„å•é¡¹æ•°æ®æµåŠ¨ã€‚</p><p>çœ‹èµ·æ¥ä¸€åˆ‡éƒ½å¾ˆç¾å¥½ï¼Œä½†æ˜¯å®é™…å†™èµ·æ¥å°±å‘ç°ç®€å•ç…§æ¬çš„å•å‘æ•°æ®æµçš„é—®é¢˜äº†ã€‚éšç€éœ€æ±‚çš„å˜åŠ¨ï¼Œç»å¸¸ä¼šæœ‰é‚£ç§éœ€è¦ä½ è¿™ä¸€ä¸ªViewControllerå®ä¾‹çš„æŸäº›æ“ä½œååŒæ­¥åˆ°å…¶ä»–ViewControllerçš„UIä¸Šï¼ˆæ¯”å¦‚ç”¨æˆ·äº¤äº’æˆ–è€…ç½‘ç»œè¯·æ±‚çš„å“åº”æ”¹å˜äº†Store Modelï¼Œåœ¨å¯¼èˆªæ ˆä¸Šå‰å‡ ä¸ªé¡µé¢ä¹Ÿéœ€è¦åˆ·æ–°UIï¼‰ï¼ŒæŒ‰ç…§æœ€ç¬¨çš„å†™æ³•é‚£ç§åœ¨å½“å‰çš„ViewControllerç»‘å®šä¸€ä¸ªcallbackæˆ–è€…delegateå›è°ƒè‚¯å®šæ˜¯ä¸å¥½çš„ï¼ˆè™½ç„¶æˆ‘ä¹‹å‰ä¹Ÿè¿™ä¹ˆå†™è¿‡ï¼Œå‚è€ƒäº†Androidçš„Intentä¹Ÿæ˜¯è¿™æ ·å­åšçš„ï¼‰ã€‚ä½†æ˜¯å‚è€ƒçš„Reduxçš„ç®¡ç†æ–¹å¼ä¸‹ï¼Œå…¶å®æ˜¯ä¸ä¼šç‰¹åˆ«è€ƒè™‘è¿™ç§æƒ…å†µçš„ï¼Œå› ä¸ºReactçš„renderæ–¹æ³•ä¼šåœ¨ä½ çš„propså˜åŠ¨çš„æ—¶å€™è§¦å‘ï¼Œä½ æœ€å¤šå¯ä»¥åˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯éœ€è¦rerenderå°±è¡Œäº†ã€‚ç„¶è€Œåœ¨åŸç”ŸAppä¸­ï¼Œä½ å‡ ä¹æ€»æ˜¯é¿å…rerenderï¼Œåªæ˜¯æ”¹å˜æŸäº›UIçš„å±æ€§ç½¢äº†ã€‚</p><p>æœ€å¼€å§‹æˆ‘çš„è§£å†³ç­–ç•¥æ˜¯æ”¾åˆ°äº†<code>ViewWillAppear</code>ä¸­ï¼Œå¼ºè¡ŒSwitchäº†å½“å‰çš„çŠ¶æ€æ¥ä¼ é€’Modelåˆ°Viewå±‚ã€‚ä½†æ˜¯è¿™ç§æƒ…å†µä¸‹ä¼šå¯¼è‡´æŠŠä½ çš„æ­£å¸¸Viewé€»è¾‘ä¹Ÿå†™çš„ç‰¹åˆ«ä¹±ï¼ˆå¾—æœ‰å„ç§åˆ¤æ–­ï¼‰ã€‚æ›´å¯æ€•çš„æ˜¯å½“ä½ çš„ViewControllerå¹¶ä¸æ˜¯ä¸€å¯¹ä¸€ç»‘å®šç»™çœŸæ­£çš„é¡µé¢ï¼Œè€Œæ˜¯ä¸€ä¸ªViewControlleræ¨¡ç‰ˆå¯¹åº”äº”å…­ç§ç±»ä¼¼é¡µé¢å¸ƒå±€çš„ContainerViewæ—¶ï¼Œä½ å°±å¯ä»¥å‘ç°ä»£ç ä¸­ä¼šæœ‰å¥½å‡ å¤„ä¸åŒçš„Switchã€‚è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ¶æ„ã€‚ç°åœ¨çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ViewModelç»‘å®šäº†æ‰€æœ‰ViewControllerçš„å¼±å¼•ç”¨ï¼Œåœ¨ViewModelé€šç”¨çš„çŠ¶æ€å¤„ç†é€»è¾‘ä¸­åˆ¤æ–­ï¼Œå¹¶ä¸”ç›´æ¥è°ƒç”¨ViewControllerçš„updateViewsï¼Œç»§è€Œèµ°åˆ°çœŸå®çš„æŸä¸ªViewçš„UIåˆ·æ–°æ–¹æ³•ä¸­ã€‚ä½†æ˜¯è¿™æ ·åšçš„ç¼ºç‚¹å°±æ˜¯ä½ çš„ViewModelé€»è¾‘ä¼šåŒæ—¶åŒ…æ‹¬äº†ç¬¬ä¸€æ¬¡åˆå§‹åŒ–å’Œæ›´æ–°çš„ä¸œè¥¿ï¼Œè¿™å°±æ˜¯æ¯”è¾ƒè®©äººéº»çƒ¦çš„åœ°æ–¹ã€‚ä¹Ÿè¯•è¿‡KVOæ¥ç»‘å®šäº†Viewï¼Œä½†æ˜¯ç”±äºæˆ‘çš„ViewControlleræœ¬èº«å°±æ˜¯ä¸ªé€šç”¨æ¨¡ç‰ˆï¼Œç»‘å®šçš„çœŸå®å®ä¾‹å’Œé”€æ¯æ—¶æœºä¹Ÿå¾—åˆ¤æ–­ï¼Œæ‰€ä»¥Passâ€¦â€¦</p><p>ç°åœ¨æƒ³æƒ³ï¼ŒReactiveCocoaè¿™ç§åŒå‘æ•°æ®ç»‘å®šè§£å†³æ–¹æ¡ˆï¼Œç¡®å®æ˜¯å®ç°Reactive Programmingæ‰€éœ€è¦çš„ã€‚æ²¡æœ‰äº†æ•°æ®ç»‘å®šï¼Œæ•´ä¸ªå¼€å‘æµç¨‹çš„æ•ˆç‡æ·±çŸ¥ä¼šé™ä½åˆ°æ‰‹åŠ¨å¤„ç†çŠ¶æ€ä¹‹ä¸‹ã€‚ç»‘å®šåå¼€å‘è€…ä¸éœ€è¦å†æ‰‹åŠ¨å¤„ç†updateçš„æ—¶æœºï¼Œåªéœ€è¦æå‰åœ¨viewä¸­å®šä¹‰ä¸€å¥—æ˜ å°„ï¼ŒviewModelåªéœ€è¦å¤„ç†Modelçš„å˜åŒ–ï¼Œä¹Ÿä¸éœ€è¦ç®¡æ˜¯å¦éœ€è¦å›è°ƒviewControllerçš„updateæƒ…å†µäº†ã€‚</p><h1 id="æ˜å¹´çš„ç®€å•æ‰“ç®—"><a href="#æ˜å¹´çš„ç®€å•æ‰“ç®—" class="headerlink" title="æ˜å¹´çš„ç®€å•æ‰“ç®—"></a>æ˜å¹´çš„ç®€å•æ‰“ç®—</h1><p>åŸºæœ¬ä¸Šï¼Œæ˜å¹´å°±æ˜¯çœŸæ­£çš„æ¯•ä¸šç”Ÿå’Œåœ¨èŒäººå‘˜äº†ã€‚å…¬å¸ä¸ä¼šåƒå­¦æ ¡é‚£æ ·éšå¿ƒæ‰€æ¬²ï¼Œä¼°è®¡åˆ°æ—¶å€™è‡ªç”±æ—¶é—´å°†ä¼šå°‘äº†å¾ˆå¤šã€‚æŠ€æœ¯æ–¹é¢ï¼Œæ„Ÿè§‰è‡ªå·±åœ¨ç§»åŠ¨å¼€å‘è¿™æ¡è·¯ä¸Šè¿˜æ˜¯å¯ä»¥èµ°ä¸‹å»çš„ï¼Œåªä¸è‡ªå·±é‡ç‚¹æƒ³å…³æ³¨åå·¥ç¨‹å’Œä¸­é—´å±‚æŠ€æœ¯çš„é¢†åŸŸï¼Œæ¯”å¦‚ä¹‹å‰çœ‹çš„ä¸€äº›ç½‘ç»œä¸­é—´ä»¶ï¼Œæ¨¡å‹ä¿æŠ¤ï¼Œæ—¥å¿—ç›‘æ§ä¹‹ç±»ã€‚è™½ç„¶ä¹‹å‰å‘äº†ä¸€éƒ¨åˆ†å…³äºCore Animationçš„ä¸œè¥¿ï¼Œä½†æ˜¯å‘ç°UIè¿™éƒ¨åˆ†çœŸçš„å¹¶ä¸æ˜¯ç‰¹åˆ«æ„Ÿå…´è¶£ï¼Œè‡ªå·±çš„ç›®æ ‡ä¹Ÿå°±åœ¨èƒ½å¤Ÿå®ŒæˆåŸºæœ¬çš„éœ€æ±‚ä¸‹å’Œç®€å•çš„ç»˜å›¾åŠ¨ç”»å³å¯ã€‚</p><p>è¿˜æœ‰çš„æ–¹é¢ï¼Œæ–°çš„ä¸€å¹´è¦å¤šæ¥è§¦æ¥è§¦é¢†åŸŸåœˆå­å†…å’Œåœˆå­å¤–çš„äººã€‚è€å®è¯´è‡ªå·±çš„äº¤é™…èƒ½åŠ›è¿˜æ˜¯éå¸¸æ¬ ç¼ºçš„ï¼Œæ— è®ºæ˜¯åšç§»åŠ¨çš„æŠ€æœ¯åœˆå­ï¼Œè¿˜æ˜¯åŒå­¦æœ‹å‹çš„ç”Ÿæ´»åœˆå­ï¼Œéƒ½éœ€è¦æ›´ä¸ºå…³æ³¨ã€‚åœ¨å­¦æ ¡èƒ½å¤Ÿåªå…³å¿ƒçœ¼å‰äº‹ï¼Œä½†æ˜¯åˆ°ç¤¾ä¼šä¸Šæ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚ä¸€ä¸ªäººçš„èƒ½åŠ›å†å¼ºï¼Œå¤„å¢ƒå†å¥½ï¼Œæ€»æ¯”ä¸ä¸Šå‘¨å›´çš„æœ‹å‹å’ŒåŒäº‹çš„ååŠ›ã€‚</p><p>å°±è¿™æ ·å§ï¼Œ2016å°†è¦è¿‡å»ï¼Œæ˜å¹´å°†æ˜¯ä¸€ä¸ªæ›´æ–°ï¼Œä¹Ÿæ›´åŠ å……æ»¡æœºé‡çš„ä¸€å¹´ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å¹´åçš„æœ€åä¸€å¤©ï¼Œä¹Ÿæ˜¯è¯¥æ€»ç»“ä¸€ä¸‹è¿™ä¸€å¹´çš„æˆé•¿äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;ä»æ ¡å›­åˆ°å®ä¹ &quot;&gt;&lt;a href=&quot;#ä»æ ¡å›­åˆ°å®ä¹ &quot; class=&quot;headerlink&quot; title=&quot;ä»æ ¡å›­åˆ°å®ä¹ &quot;&gt;&lt;/a&gt;ä»æ ¡å›­åˆ°å®ä¹ &lt;/h1&gt;&lt;p&gt;è½¯ä»¶ä¸“ä¸šçš„å¤§ä¸‰å­¦å¹´ï¼Œå¦‚æœä½ ä¸è€ƒç ”ç•™å­¦çš„è¯ï¼Œè¯´èµ·æ¥éƒ½æ˜¯ä¼šèµ°å®ä¹ åŠ æ ¡æ‹›çš„æµç¨‹ã€‚è‡ªå·±è¿™å¹´å°è±¡æœ€æ·±çš„ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªä¸‹åŠå¹´çš„å®ä¹ ï¼Œé¢è¯•ï¼Œä»¥åŠç°åœ¨çš„å®ä¹ äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¤§ä¸‰ä¸Šçš„å®ä¹ å½“æ—¶è‡ªå·±é”™è¿‡äº†æœºä¼šï¼Œåªè¿›å…¥äº†ä¸€ä¸ªæ™®é€šçš„äº’è”ç½‘å…¬å¸ï¼Œä½†æ˜¯ä¹Ÿå­¦åˆ°äº†æ›´å¤šæ ¡å›­ä¸­æ— æ³•è§åˆ°çš„ä¸œè¥¿ï¼ˆæ¯”å¦‚å¤šç§»åŠ¨Appå¤šProjectç®¡ç†ï¼ŒMapKitï¼ŒReact Nativeï¼‰ï¼Œå¼€é˜”äº†ä¸€ç‚¹çœ¼ç•Œã€‚çœŸæ­£çš„ä¸‹åŠå¹´å¥½å‡ ä¸ªæœˆéƒ½åœ¨å¿™ç€æ ¡æ‹›é¢è¯•ç›¸å…³çš„ä¸œè¥¿ï¼Œä»ä¸­ä¹Ÿæ€»ç»“äº†ä¸€äº›ç»éªŒå§ï¼ˆè™½ç„¶ä¸çŸ¥é“å¯¹ç¤¾æ‹›æ˜¯å¦æœ‰å¸®åŠ©ï¼‰ã€‚ç„¶è€Œåˆ°ç°åœ¨ï¼Œä»å—äº¬æ¥åˆ°äº†åŒ—äº¬ï¼Œæå‰è¿‡æ¥å¤´æ¡è¿™è¾¹å®ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;å®ä¹ å¼€å§‹éƒ½æ˜¯å…´å¥‹å’Œå¥½å¥‡çš„ï¼Œå› ä¸ºå¯ä»¥çœ‹åˆ°å…¬å¸çš„å„ç§è®¾æ–½ï¼Œç¦åˆ©ï¼Œè¿˜æœ‰è®¤è¯†å„å¼å„æ ·çš„äººã€‚æ¥è¿™è¾¹ä¹Ÿæ˜¯ä¸“é—¨æ‹‰äº†ä¸¤ä¸ªåŒå…¬å¸çš„åº”å±Šç”Ÿä¸€èµ·æ¥ï¼Œä¹ŸæŒºæ„‰å¿«çš„ã€‚å…¬å¸ç¦»å¾—è¿‘ï¼Œç»„é‡Œçš„äººä¹Ÿéƒ½æ¯”è¾ƒå‰å®³ï¼ˆè‡³å°‘éƒ½æ˜¯æˆ‘è¯·æ•™åˆ«äººæ•™è‚²çš„æƒ…å½¢ï¼‰ï¼Œè™½ç„¶ä¸Šç­ç´¯äº†äº›ï¼Œä½†æ˜¯æ„Ÿè§‰è‡ªå·±æˆé•¿ä¹Ÿæ˜¯éå¸¸çš„å¤§ï¼Œå¾ˆéš¾æƒ³è±¡å‡å¦‚ä¸æ¥å®ä¹ ï¼Œå…¨é è‡ªå·±æ‘¸ç´¢ï¼Œæ˜å¹´ç›´æ¥æ¯•ä¸šè¿‡æ¥ä¸Šç­è‡ªå·±æ˜¯ä»€ä¹ˆæ ·çš„æ°´å¹³ã€‚&lt;/p&gt;
&lt;h1 id=&quot;è¿‘æœŸå·¥ä½œæ„Ÿæƒ³&quot;&gt;&lt;a href=&quot;#è¿‘æœŸå·¥ä½œæ„Ÿæƒ³&quot; class=&quot;headerlink&quot; title=&quot;è¿‘æœŸå·¥ä½œæ„Ÿæƒ³&quot;&gt;&lt;/a&gt;è¿‘æœŸå·¥ä½œæ„Ÿæƒ³&lt;/h1&gt;</summary>
    
    
    
    <category term="Life" scheme="http://dreampiggy.com/categories/Life/"/>
    
    
    <category term="å·¥ä½œ" scheme="http://dreampiggy.com/tags/%E5%B7%A5%E4%BD%9C/"/>
    
  </entry>
  
  <entry>
    <title>FRPå¯¹æ¯”â€”ReactiveCocoaã€RxSwiftã€Baconä»¥åŠèƒŒåçš„Functional</title>
    <link href="http://dreampiggy.com/2016/11/17/FRP%E7%AE%80%E4%BB%8B%E2%80%94ReactiveCocoa%E3%80%81RxSwift%E3%80%81Bacon%E4%BB%A5%E5%8F%8A%E8%83%8C%E5%90%8E%E7%9A%84Functional/"/>
    <id>http://dreampiggy.com/2016/11/17/FRP%E7%AE%80%E4%BB%8B%E2%80%94ReactiveCocoa%E3%80%81RxSwift%E3%80%81Bacon%E4%BB%A5%E5%8F%8A%E8%83%8C%E5%90%8E%E7%9A%84Functional/</id>
    <published>2016-11-17T14:57:20.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ReactiveCocoaå’ŒRxSwift"><a href="#ReactiveCocoaå’ŒRxSwift" class="headerlink" title="ReactiveCocoaå’ŒRxSwift"></a>ReactiveCocoaå’ŒRxSwift</h1><p>iOSçš„å¼€å‘ä¸Šï¼ŒObjective-Cå¯ä»¥è¯´æ—¢æ˜¯ä¸€ä¸ªå·¨å¤§çš„æˆåŠŸï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå·¨å¤§çš„é™åˆ¶ã€‚Cocoa Touchæä¾›çš„åŸç”ŸAPIæœ¬èº«å°±æ˜¯ç›®æ ‡å½“å¹´çš„äº‹ä»¶é©±åŠ¨å’Œæ¶ˆæ¯æ´¾å‘çš„GUIç¼–ç¨‹æ¨¡å‹ï¼Œå¹¶ä¸”ä¸“é—¨ä¸ºObjective-Cè¿™é—¨ç±»smalltalkçš„æ¶ˆæ¯å¼OOè¯­è¨€è®¾è®¡çš„ï¼Œæ›´ä¸ºå°´å°¬çš„æ˜¯iOSä¸Šæ²¡æœ‰OS Xä¸Šè‡ªå¸¦çš„<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CocoaBindings/CocoaBindings.html">Data Binding</a>ã€‚ç§ç§åŸå› ï¼Œå¯¼è‡´Target-Acionï¼ŒKVOï¼ŒNotificationï¼ŒAppleå¼MVCæ¶æ„æ‰ä¼šä¸€ç›´æˆä¸ºiOSå¼€å‘çš„ä¸»æµã€‚ç„¶è€Œï¼Œåšè¿‡å¼€å‘çš„éƒ½çŸ¥é“ï¼Œè¿™å¥—æ¶æ„åœ¨å¤§å‹Appï¼Œå°¤å…¶å¤æ‚æ˜¯ç½‘ç»œè¯·æ±‚å’Œäººæœºäº¤äº’ç‰¹åˆ«å¤šçš„æƒ…å†µä¸‹ï¼Œéå¸¸å®¹æ˜“è®©æ•´ä¸ªAppæ¶æ„å˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚</p><p>Appleå¼çš„MVCï¼Œåˆç§°ä¸ºMassive View Controllerï¼Œä¼šè®©ä½ æ•´ä¸ªä¸šåŠ¡ä»£ç å’ŒUIç»‘å®šä»£ç å……æ–¥åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å¯¼è‡´å¾ˆå¤šäººç»å¸¸ä¼šåœ¨Viewä¸­ï¼Œç›´æ¥#includeä¸€ä¸ªModeldçš„å¤´æ–‡ä»¶ï¼Œç„¶åèµ·ä¸€ä¸ª<code>configureInfo: </code>çš„æ–¹æ³•ï¼Œç›´æ¥åœ¨é‡Œé¢æŠŠModelçš„æ•°æ®æ‹¿æ¥ç»‘å®šåˆ°Viewçš„å±æ€§ä¸Šã€‚ä¸ä¿¡ï¼Ÿè¯•è¯•æœä¸€éä½ æ‰€æœ‰çš„Viewï¼ŒæŠŠModelçš„å¤´æ–‡ä»¶åˆ æ‰ï¼Œçœ‹çœ‹èƒ½å¦ç¼–è¯‘é€šè¿‡ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> userCell <span class="operator">=</span> tableView.dequeueReusableCellWithIdentifier(<span class="string">&quot;identifier&quot;</span>) <span class="keyword">as</span> <span class="type">UserCell</span></span><br><span class="line">userCell.configureWithUser(user)</span><br></pre></td></tr></table></figure><p>MVPæ¶æ„æˆ–è®¸æ˜¯ä½ çš„æ•‘æ˜Ÿï¼Œä¸è¿‡å®é™…ä¸Šï¼ŒMVPåªæ˜¯ä¸€ä¸ªå·¥ç¨‹åŒ–çš„è§£å†³é—®é¢˜ï¼ŒæŠŠMassive View Controllerå˜æˆMassive View Presenterï¼Œå¸¦æ¥ç›¸å¯¹æ˜ç¡®çš„æ¶æ„åˆ†å±‚çš„å‰¯ä½œç”¨å°±æ˜¯è¿‘ä¹ä¸¤å€çš„ä»£ç é‡ã€‚è€Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMVVMçš„æ¶æ„å°±æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„çªç ´ï¼Œå’ŒMVPä¸€æ ·æŠŠView/ViewControlleræ‰”åˆ°ä¸€èµ·ï¼Œä½†æ˜¯å¼•å…¥å•ç‹¬çš„ViewModelï¼Œé€šè¿‡Viewåˆ°ViewModelçš„å•å‘ç»‘å®šï¼ŒViewModelå¯¹Modelçš„è®¢é˜…ï¼Œæ—¢é¿å…äº†MVCé€ æˆçš„ä»£ç æ··ä¹±ï¼Œåˆå‡å°‘äº†MVPçš„é€ æˆçš„é‡å¤ä»£ç ã€‚è€Œå®è·µä¸Šï¼Œæåˆ°MVVMï¼Œå°±å¾— æåˆ°<a href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a>æˆ–è€…<a href="https://github.com/ReactiveX/RxSwift">RxSwift</a>ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯FRPçš„GUIæ¡†æ¶å®ç°ã€‚</p><h2 id="ReactiveCocoa"><a href="#ReactiveCocoa" class="headerlink" title="ReactiveCocoa"></a>ReactiveCocoa</h2><blockquote><p>ä¸ºäº†ç»Ÿä¸€æœ¯è¯­ï¼ŒReactiveCocoaä¸­çš„æ¦‚å¿µè¿™é‡Œéƒ½æè¿°æˆRxä¸­ç±»ä¼¼çš„æ¦‚å¿µï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ä¸œè¥¿</p></blockquote><p>ReactiveCocoaæŠŠäº‹ä»¶æµçš„æ¥å£ï¼Œå®šä¹‰ä¸º<code>RACStream</code>ã€‚è€Œå®é™…ä¸Šï¼Œé€šå¸¸çš„äº‹ä»¶æµå®ç°éƒ½æ˜¯<code>RACSignal</code>å¯¹è±¡ï¼Œè¿™ä¸ªSignalæ˜¯ä¸€ä¸ªå†·äº‹ä»¶æµï¼ˆä¹Ÿå¯ä»¥å«åšpush-drivenï¼‰ï¼Œå³æœ‰è®¢é˜…è€…è®¢é˜…åï¼Œæ‰ä¼š<code>å¼€å§‹ä»å¤´ä¾æ¬¡å‘é€äº‹ä»¶</code>ã€‚è€Œå¯¹åº”çš„å†·äº‹ä»¶æµæ¥å£å«åš<code>RACMulticastConnection</code>ï¼Œå³æ²¡æœ‰è®¢é˜…è€…ä¹Ÿä¼šå‘é€äº‹ä»¶æµã€‚çƒ­äº‹ä»¶å¯ä»¥é€šè¿‡<code>publish</code>å’Œ<code>multicast</code>è½¬æ¢åˆ°çƒ­äº‹ä»¶æµï¼Œè¿™å¯¹äºå¾ˆå¤šè¯·æ±‚ï¼Œæ¯”å¦‚WebSocketè¿™ç§ä¸éœ€è¦é‡å…¥çš„äº‹ä»¶æµæ¥è¯´å¾ˆæœ‰ç”¨ã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†æ”¯æŒObjective-Cè¯­è¨€ä¸Šå¯¹æ³›å‡½æ€§çš„ç¼ºä¹ï¼Œæä¾›äº†å¦ä¸€ä¸ªäº‹ä»¶æµçš„å®ç°<code>RACSequence</code>å¯¹è±¡ï¼Œç”¨æ¥å¤„ç†é›†åˆç±»å‹çš„äº‹ä»¶æµã€‚</p><p>ä¸€æ—¦è®¢é˜…ä¹‹åï¼Œäº‹ä»¶æµå°±å¯ä»¥è§£åŒ…ï¼Œæ‹¿åˆ°ä¸åŒçŠ¶æ€ä¸‹çš„æ•°æ®ï¼ŒObjective-Cçš„æ¥å£å°±æ˜¯å’ŒRxç±»ä¼¼çš„ä¸‰ç§ï¼š<br><code>void (^next)(id) </code>ï¼šæ‹¿åˆ°äº‹ä»¶æœ¬èº«ï¼Œäº‹ä»¶æµæœ¬èº«ç»§ç»­æµåŠ¨<br><code>void (^error)(NSError *)</code>ï¼šå¤„ç†é”™è¯¯äº‹ä»¶ï¼Œerrorå’Œcompletedåäº‹ä»¶æµå‡ç»“æŸï¼Œä¸¤ç§çŠ¶æ€å¿…å±€å…¶ä¸€<br><code>void (^completed)()</code>ï¼šäº‹ä»¶æµæ­£å¸¸ç»“æŸçš„å¤„ç†</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="keyword">self</span>.usernameTextField.rac_textSignal</span><br><span class="line">filter:^<span class="type">BOOL</span>(<span class="type">id</span> value)&#123;</span><br><span class="line">   <span class="built_in">NSString</span>*text = value;</span><br><span class="line">   <span class="keyword">return</span> text.length &gt; <span class="number">3</span>;</span><br><span class="line">&#125;]</span><br><span class="line">subscribeNext:^(<span class="type">id</span> x)&#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>, x);</span><br><span class="line">  &#125;];</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>rac_textSignal</code>å°±æ˜¯ä¸€ä¸ªäº‹ä»¶æºï¼Œè€Œåé¢çš„filterï¼Œæ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œå¯¹äº‹ä»¶æµçš„äº‹ä»¶å˜æ¢åˆ°çœŸæ­£è®¢é˜…è€…å…³å¿ƒçš„æ•°æ®ï¼Œæœ€åçš„<code>subscribeNext</code>æ˜¯ä¸€ä¸ªä¾¿æ·æ–¹æ³•ï¼Œè®¢é˜…å¹¶ç”Ÿå‘½nextçŠ¶æ€çš„å¤„ç†æ–¹å¼ã€‚æ•´ä¸ªæµç¨‹æ¨¡æ‹Ÿçš„æ˜¯ä¸€ä¸ªTextFiledçš„ç”¨æˆ·è¾“å…¥äº‹ä»¶æµçš„èµ°å‘ï¼Œç”¨æˆ·çš„æ‰€æœ‰è¾“å…¥ï¼Œä¸€æ—¦è¶…è¿‡3ä¸ªæ–‡æœ¬ï¼Œå°±ä¼šæµåŠ¨å¹¶ä¸”æ‰“å°å‡ºæ¥ï¼Œæ³¨æ„å†·äº‹ä»¶æµæ˜¯<strong>æ•´ä¸ªæµä»å¤´å¼€å§‹çš„</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hel</span><br><span class="line">hell</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><p>å°±å¦‚ä¸Šä¸€ç¯‡ç®€ä»‹ä¸­æåˆ°çš„é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä¸æ–­æ·»åŠ æ–°çš„æ“ä½œç¬¦ï¼Œæ¥çµæ´»å¤„ç†æˆ‘ä»¬çš„å…³å¿ƒçš„äº‹ä»¶æµã€‚è™½ç„¶Objective-Cæœ¬èº«æ²¡æœ‰ä»»ä½•æ³›å‡½æ€§çš„æ¥å£ï¼Œä½†æ˜¯ReactiveCocoaå°è£…çš„<code>RACSequence</code>æœ¬èº«æä¾›äº†ç›¸å½“ä¸°å¯Œçš„æ“ä½œç¬¦ï¼ŒåŒ…æ‹¬å¸¸è§çš„<code>map</code>,<code>flatmap</code>,<code>filter</code>,<code>combine</code>,<code>switch</code>ç­‰ï¼Œæ¯”å¦‚ä½ å¯ä»¥æŠŠç”¨æˆ·åå’Œå¯†ç æ¡†çš„æ£€éªŒäº‹ä»¶åº”ç”¨<code>combineLastest</code>æ¥ç¡®ä¿äºŒè€…æ°¸è¿œåŒæ—¶æ»¡è¶³æ‰å…è®¸ç™»é™†ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RACSignal *signUpActiveSignal =</span><br><span class="line">  [RACSignal combineLatest:@[validUsernameSignal, validPasswordSignal]</span><br><span class="line">                    reduce:^<span class="type">id</span>(<span class="built_in">NSNumber</span> *usernameValid, <span class="built_in">NSNumber</span> *passwordValid) &#123;</span><br><span class="line">                      <span class="keyword">return</span> @([usernameValid boolValue] &amp;&amp; [passwordValid boolValue]);</span><br><span class="line">                    &#125;];</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å’ŒéReactiveä»£ç å’Œè°ç›¸å¤„ï¼ŒReactiveCocoaæä¾›äº†ä¸€ä¸ª<code>RACSubject</code>ç±»å‹ï¼Œæ˜¯ç”¨æ¥å¤„ç†æœ‰å‰¯ä½œç”¨çš„æµçš„ï¼Œå³è¿™ä¸ªæµæ˜¯å¯å˜çš„ã€‚ä½ å¯ä»¥æ‰‹åŠ¨åˆ›é€ ä¸€ä¸ªæ–°çš„æµï¼Œå¹¶ä¸æ–­è°ƒç”¨<code>sendNext:</code>æ¥æ‰‹åŠ¨å‘é€äº‹ä»¶ç»™å…¶ä»–è®¢é˜…è€…ï¼Œè¿™å°±ç±»ä¼¼äº†ä¼ ç»Ÿçš„æ¶ˆæ¯äº‹ä»¶ç»‘å®šæœºåˆ¶ã€‚è¿™ä¸ªå¯¹äºä¸€äº›æ¡ä»¶ä¸‹ï¼Œæ¯”å¦‚ç±»ä¼¼è¿ç»­åŠ è½½é¡µé¢çš„ä¿¡å·ï¼Œè§†å›¾è·³è½¬ç­‰ç­‰æœ‰ä¸€å®šçš„ä½œç”¨ï¼Œä¸è¿‡å¯¹äºç½‘ç»œè¯·æ±‚ç­‰ï¼Œåº”å½“ä½¿ç”¨<code>RACSignal</code>ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[[_button rac_signalForControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>] subscribeNext:^(<span class="type">id</span> x) &#123;  </span><br><span class="line">    [<span class="keyword">self</span>.loggerSubject sendNext:<span class="string">@&quot;pop&quot;</span>];  </span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];  </span><br><span class="line">      </span><br><span class="line">&#125;];  </span><br></pre></td></tr></table></figure><p>å¦‚å‰é¢æ‰€è¯´ï¼ŒReactiveCocoaæ˜¯ä¸€ä¸ªæ–¹ä¾¿æ‰“é€ MVVMæ¶æ„çš„æ¡†æ¶ï¼Œæä¾›çš„<code>RACå®</code>å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œå•å‘ç»‘å®šï¼ŒæŠŠäº‹ä»¶ç»“æœåŒä½ çš„UIå¯¹è±¡å±æ€§ç»‘å®šèµ·æ¥ï¼Œé¿å…äº†ç¹ççš„ä»£ç å¤„ç†ï¼Œè¾¾åˆ°Reactive Programming</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RAC(<span class="keyword">self</span>.passwordTextField, backgroundColor) =</span><br><span class="line">  [validPasswordSignal</span><br><span class="line">    map:^<span class="type">id</span>(<span class="built_in">NSNumber</span> *passwordValid) &#123;</span><br><span class="line">      <span class="keyword">return</span> [passwordValid boolValue] ? [<span class="built_in">UIColor</span> clearColor] : [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure><p><img src="https://koenig-media.raywenderlich.com/uploads/2014/01/CombinePipeline.png"></p><p>ç®€å•æ¥çœ‹ï¼ŒReactiveCocoaçœŸä¸æ„§æ˜¯Cocoaï¼Œæ‰€æœ‰çš„è®¾è®¡å›´ç»•Cocoaçš„è®¾è®¡æ¨¡å¼ï¼Œæä¾›äº†æ–¹ä¾¿çš„å®ï¼Œå¹¶ä¸”å¼±åŒ–äº†æ³›å‡½æ¦‚å¿µï¼Œæä¾›äº†å¾ˆå¤šå‰¯ä½œç”¨å¤„ç†çš„æ–¹å¼ï¼Œä¸åƒRxé‚£æ ·çº¯ç²¹ã€‚ç„¶è€Œéšç€Objective-Cè¯­è¨€çš„æ…¢æ…¢æ·¡åŒ–ï¼Œæ•´ä¸ªé¡¹ç›®ä¹‹åä¹Ÿè½¬ä¸ºä¾èµ–ReactiveSwiftçš„å®ç°ã€‚åœ¨å½“å‰iOSå¼€å‘çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨Objective-Cè¯­è¨€ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸äºŒçš„FRPä¹‹é€‰ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨Swiftï¼Œæœ€å¥½ä½¿ç”¨æ­£ç»Ÿçš„RxSwiftã€‚</p><h2 id="RxSwift"><a href="#RxSwift" class="headerlink" title="RxSwift"></a>RxSwift</h2><p><img src="https://pic3.zhimg.com/v2-4b572f2ac5bc28905f043c7999c83c2a_r.jpg"></p><p><a href="http://reactivex.io/">ReactiveX</a>ï¼Œä¹Ÿå°±æ˜¯Rxï¼Œæ˜¯ä¸€ä¸ªå¤§çš„è¯­è¨€æ— å…³çš„FRPæ¶æ„è®¾è®¡ï¼Œåªè¦ä½ äº†è§£äº†ä¸€ä¸ªè¯­è¨€ä¸‹çš„ç”¨æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¾¾åˆ°<code>learn once, write everywhere</code>ï¼ˆè·‘â€¦â€¦ï¼‰</p><p>åœ¨Rxä¸­ï¼Œäº‹ä»¶æµå®šä¹‰ä¸ºä¸€ä¸ª<code>Observable</code>ï¼Œè€Œè®¢é˜…è€…å¯¹åº”çš„æ˜¯<code>Disposable</code>æ¥å£ï¼ˆRxJavaé‡Œé¢å¯¹åº”çš„å°±æ˜¯<code>Subscriber</code>ï¼‰ï¼Œäº‹ä»¶æµå¯ä»¥é€šè¿‡subscribeæ¥è®¢é˜…ï¼Œä¹Ÿæ˜¯å¯¹åº”äº†ä¸‰ä¸ªçŠ¶æ€<code>onNext</code>ï¼Œ<code>onError</code>ï¼Œ<code>onCompleted</code>ã€‚</p><p>è¿™é‡Œï¼Œå°±ä»¥RxSwiftä¸ºå‡†ï¼Œä»‹ç»ä¸€ä¸‹ç®€å•çš„åŒºåˆ«ã€‚é¦–å…ˆï¼Œå¾—ç›ŠäºSwiftçš„è¯­æ³•ï¼ŒReactiveCocoaçš„Data Bindingä¹Ÿå˜å¾—æ›´ç®€å•äº†ï¼Œä¸éœ€è¦å®åŒ…è£¹å’Œæå‰å£°æ˜ï¼Œçœ‹èµ·æ¥æ›´ä¸ºæ¸…æ™°</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> primeTextField.rx.text           <span class="comment">// Observable&lt;String&gt;</span></span><br><span class="line">.map &#123; <span class="type">WolframAlphaIsPrime</span>(<span class="type">Int</span>(<span class="variable">$0</span>) <span class="operator">??</span> <span class="number">0</span>) &#125;      <span class="comment">// Observable&lt;Observable&lt;Prime&gt;&gt;</span></span><br><span class="line">.concat()                                       <span class="comment">// Observable&lt;Prime&gt;</span></span><br><span class="line">.filter &#123; <span class="variable">$0</span>.isPrime &#125;                          <span class="comment">// Observable&lt;Prime&gt;</span></span><br><span class="line">.map &#123; <span class="string">&quot;number <span class="subst">\(<span class="variable">$0</span>.n)</span> is prime&quot;</span> &#125;              <span class="comment">// Observable&lt;String&gt;</span></span><br><span class="line">.bindTo(resultLabel.rx.text)                    <span class="comment">// bind to label text</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼ŒRxä¸­ï¼Œä¸åŒäºReactiveCocoaï¼Œäº‹ä»¶æµæœ¬èº«éƒ½æ˜¯<code>Observable</code>ï¼Œè‡³äºæ˜¯å†·è¿˜æ˜¯çƒ­ï¼Œæ˜¯é€šè¿‡<code>publish</code>å’Œ<code>connect</code>æ“ä½œå¾—åˆ°çš„ï¼Œä¸åŒäºReactiveCocoaä¸­çš„<code>RACSignal</code>å’Œ<code>RACMulticastConnection</code>è¿™ç§åˆ†å¼€çš„è®¾è®¡ï¼Œå¯¼è‡´å¿…é¡»ç”¨å¯¹åº”çš„æ“ä½œç¬¦ï¼Œåœ¨Rxä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œç¬¦éƒ½æ˜¯ä¸€è‡´çš„è¡¨ç°ï¼Œè¿™ç‚¹æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ”¹è¿›ã€‚</p><p>åŒæ—¶ï¼ŒRxçš„æ“ä½œç¬¦ä¹Ÿæ˜¯æœ€ä¸°å¯Œçš„ï¼Œä»€ä¹ˆ<code>lift</code>ï¼Œ<code>switch</code>è¿™ç§å¸¸ç”¨çš„ï¼Œåœ¨ReactiveCocoaä¸­å°±å¾—è‡ªå·±ç»„åˆä¸€å¥—ã€‚å½“ç„¶ï¼ŒRxçš„è‡ªå®šä¹‰æ“ä½œç¬¦ä¹Ÿå¾ˆå¤šç®€å•ï¼Œä½ åªéœ€è¦ä¸€ä¸ª<code>T -&gt; Observable&lt;T&gt;</code>ç±»å‹çš„å‡½æ•°æ¥å®šä¹‰</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">ObservableType</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">replaceWith</span>&lt;<span class="type">R</span>&gt;(<span class="params">value</span>: <span class="type">R</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">R</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> map &#123; <span class="keyword">_</span> <span class="keyword">in</span> value &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä½“ä¸Šçœ‹ï¼ŒRxæ˜¯å¦‚ä»Šæ¯”è¾ƒæœ‰åï¼Œå¹¶ä¸”æˆå¥—çš„FRPè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”è¿ç§»åˆ°ä¸åŒå¹³å°ä¸Šçš„å­¦ä¹ æˆæœ¬éå¸¸ä½ã€‚ReactiveCocoaæœ¬èº«å¦‚ä»Šå·²ç»åˆ†ç¦»ä¸ºSwiftç‰ˆå’ŒObjective-Cç‰ˆï¼Œå¹¶ä¸”åè€…ä¸å†ç»§ç»­ç»´æŠ¤ï¼Œå› æ­¤å¯¹äºæ··åˆObjective-Cå’ŒSwiftï¼Œæˆ–è€…çº¯Swifté¡¹ç›®ï¼ŒRxSwiftæ˜¯ä¸€ä¸ªæ„å»ºMVVMå’ŒFRPæ¶æ„çš„ä¸äºŒé€‰æ‹©ã€‚</p><h1 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h1><p>ä¸ºä»€ä¹ˆè¿™é‡Œè¦æåˆ°Promiseå‘¢ï¼Œå› ä¸ºReactive Programmingéœ€è¦å¤„ç†çš„å¾ˆå¤šï¼Œå°±æ˜¯å¯¹å¼‚æ­¥è¯·æ±‚å’Œé¢‘ç¹äº‹ä»¶å“åº”çš„å¤„ç†ã€‚è€ŒPromiseæ˜¯ä¸€ä¸ªæ¯”è¾ƒæµè¡Œçš„JavaScriptå¹³å°å¼‚æ­¥è§£å†³æ–¹æ¡ˆã€‚åœ¨å’ŒFRPçš„é…åˆä¸Šé¢ï¼Œå¯ä»¥é€šè¿‡ä¸æ–­çš„thenç»„åˆæˆéœ€è¦çš„Promiseäº‹ä»¶ï¼Œå¹¶ä¸”Promiseçš„è¶…é›†ï¼Œä¹Ÿå°±æ˜¯Futureï¼Œæœ¬èº«å°±æœ‰æ­é…ä¸åŒçš„Futureæ“ä½œç¬¦æ¥è¾¾åˆ°ç±»ä¼¼äºRxçš„ç»„åˆæ•ˆæœã€‚</p><p>ä¸è¿‡ï¼ŒPromiseçš„ç›®çš„ï¼Œåœ¨äºå¯¹å¼‚æ­¥è¯·æ±‚æµç¨‹çš„æ§åˆ¶ï¼Œè€Œæœ¬èº«å¹¶æ²¡æœ‰å¯¹äº‹ä»¶æµçš„ç®¡ç†ã€‚åŸå§‹çš„Promiseè™½ç„¶æœ‰ç€ç±»ä¼¼Rxçš„äº‹ä»¶æµç±»ä¼¼ç‰¹ç‚¹ï¼š<code>ä¸å¯å˜æ€§</code>ã€<code>å¯ç»„åˆæ€§</code>ï¼Œä½†æ˜¯å…³é”®åŒºåˆ«åœ¨äºPromiseè‡ªèº«æ˜¯å•æ¬¡æµåŠ¨ï¼Œæ•°æ®æµåªä¼šä»thenå¼€å§‹èµ°åˆ°ç»“æŸæˆ–è€…catchæ‰ï¼Œæ— æ³•å¤šæ¬¡é‡æ–°æµåŠ¨ï¼›ä¸æ”¯æŒæµç¨‹ä¸­æ–­å–æ¶ˆï¼›éœ€è¦é…åˆå…¶ä»–æ¡†æ¶å±‚é¢çš„ä¸œè¥¿ï¼Œæ¥è¾¾åˆ°å®Œæ•´äº‹ä»¶æµå’ŒGUIæ•°æ®ç»‘å®šï¼Œè¿™é‡Œå°±å¾—æåˆ°<a href="https://github.com/baconjs/bacon.js/">Bacon</a></p><h1 id="Bacon"><a href="#Bacon" class="headerlink" title="Bacon"></a>Bacon</h1><p><img src="https://baconjs.github.io/logo.png"></p><p>Baconæ˜¯JavaScriptä¸Šçš„ä¸€ä¸ªFRPæ¡†æ¶ï¼Œå€Ÿé‰´äºçŸ¥åçš„<a href="https://github.com/dominictarr/event-stream">EventStream</a>æ‰€å®ç°çš„äº‹ä»¶æµï¼ŒBaconåœ¨è¿™ä¹‹ä¸Šå®Œæˆäº†FRPæ‰€éœ€è¦çš„ä¸€åˆ‡ï¼šäº‹ä»¶æµï¼Œå˜æ¢ï¼Œæ•°æ®ç»‘å®šï¼Œæ¯”èµ·æ­£ç»Ÿçš„RxJSæ¥è¯´ï¼Œæä¾›äº†æ›´é€‚åˆWebå‰ç«¯åº”ç”¨çš„çš„<code>EventStream</code>å’Œ<code>Property</code>ï¼Œä¸éœ€è¦è¢«RxJSçš„Hot/Cold Observerableçƒ¦æ‰°ã€‚å¹¶ä¸”åŸç”Ÿæ”¯æŒäº†æ‰€æœ‰æƒ°æ€§æ±‚å€¼ï¼Œåœ¨benchmarkä¸Šæ¯”èµ·RxJSæœ‰ç€ä¸é”™çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p><ul><li>ç¤ºä¾‹â€”â€”è®¡æ•°å™¨</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> plus = $(<span class="string">&quot;#plus&quot;</span>).<span class="title function_">asEventStream</span>(<span class="string">&quot;click&quot;</span>).<span class="title function_">map</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> minus = $(<span class="string">&quot;#minus&quot;</span>).<span class="title function_">asEventStream</span>(<span class="string">&quot;click&quot;</span>).<span class="title function_">map</span>(-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> both = plus.<span class="title function_">merge</span>(minus)</span><br><span class="line">.<span class="title function_">scan</span>(<span class="number">0</span>, add) <span class="comment">// add +1 or -1 base on click eventstream</span></span><br><span class="line">.<span class="title function_">onValue</span>(<span class="function"><span class="params">sum</span> =&gt;</span> $(<span class="string">&quot;#sum&quot;</span>).<span class="title function_">text</span>(sum))</span><br><span class="line">.<span class="title function_">onError</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(e))</span><br><span class="line">.<span class="title function_">onEnd</span>(<span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">&#x27;total: &#x27;</span> + $(<span class="string">&quot;#sum&quot;</span>).<span class="property">text</span>));</span><br></pre></td></tr></table></figure><p>é™¤äº†ä¸“é—¨æä¾›çš„EventStreamå’ŒProperyçš„ä¸¤ç§Observableï¼Œå¹¶ä¸”æä¾›äº†æ›´å¥½çš„äº‹ä»¶æºæ”¯æŒï¼Œä½ å¯ä»¥ä»åŸç”Ÿçš„DOMäº‹ä»¶æ¥è§¦å‘äº‹ä»¶æºï¼Œå¯ä»¥ä»Promiseæ¥è§¦å‘ï¼ˆè¿™æ˜¯ä¸€ä¸ªå¤§çš„ä¼˜åŠ¿ï¼‰ï¼Œç”šè‡³ä»callbackæˆ–è€…è‡ªå®šä¹‰çš„binderéƒ½å¯ä»¥ã€‚åœ¨RxJSçš„åŸºç¡€ä¸Šæœ‰äº†æ¯”è¾ƒå¤§çš„æå‡ã€‚ä¸è¿‡å…·ä½“å·¥ç¨‹ä¸Šè®²ä¸¤è€…éƒ½æ˜¯Rxå®ç°çš„FRPï¼Œå–èˆè¿˜è¦çœ‹è‡ªå·±çš„ç‰¹å®šé€‰æ‹©ï¼ˆå¹¸å¥½æˆ‘ä¸åšå‰ç«¯ï¼‰</p><h1 id="Functional"><a href="#Functional" class="headerlink" title="Functional"></a>Functional</h1><blockquote><p>ç”±äºè‡ªå·±ä¹Ÿä¸æ˜¯Haskell Guyï¼Œä»…ä»…æ¥è§¦è¿‡ä¸€ç‚¹ç‚¹JSã€Closureå’ŒSwiftè¿™äº›æœ‰æ³›å‡½ç¼–ç¨‹æ€æƒ³çš„è¯­è¨€ ï¼Œå¦‚æœæƒ³å…·ä½“äº†è§£å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå…³äº<code>Functor</code>ã€<code>Applicative</code>ä»¥åŠ<code>Monad</code>çš„çŸ¥è¯†ï¼Œæ¨èèŠ±ä¸Š10åˆ†é’Ÿçœ‹ä¸€ä¸‹ç®€å•çš„å›¾æ–‡æ•™ç¨‹ï¼šåˆ†åˆ«æœ‰<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html">åŸæ–‡(æ¨è)</a>ã€<a href="http://www.mokacoding.com/blog/functor-applicative-monads-in-pictures/">Swiftç‰ˆ</a>å’Œ<a href="https://medium.com/@tzehsiang/javascript-functor-applicative-monads-in-pictures-b567c6415221#.5upsphilw">JSç‰ˆ</a></p></blockquote><p><img src="http://adit.io/imgs/functors/bind_def.png"></p><p>ä¸‹é¢è¿™äº›å†…å®¹ï¼Œé»˜è®¤ä¸ºå·²ç»æŒæ¡äº†ä¸Šè¿°ç®€å•ç†è§£ï¼Œå¦‚æœçœ‹ä¸å¤ªæ‡‚å¯ä»¥å›è¿‡å¤´é‡æ–°çœ‹ä¸€ä¸‹å¯¹åº”çš„FunctionalçŸ¥è¯†</p><h2 id="ReactiveX"><a href="#ReactiveX" class="headerlink" title="ReactiveX"></a>ReactiveX</h2><p>Rxçš„<code>Observable</code>çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª<code>Event Monad</code>ï¼Œå³ä¸Šä¸‹æ–‡ï¼ˆå°±æ˜¯å›¾æ–‡æ•™ç¨‹ä¸­åŒ…è£¹çš„ç›’å­ï¼‰ä¸ºEventçš„ä¸€ä¸ªMonadï¼Œè¿™é‡Œçš„Eventå®šä¹‰ï¼Œå¯ä»¥å¯¹åº”è¯­è¨€çš„structæˆ–è€…enumï¼ŒåŒ…æ‹¬äº†<code>next</code>ã€<code>error</code>å’Œ<code>complete</code>ä¸‰ä¸ªä¸Šä¸‹æ–‡å³å¯ã€‚è¿™é‡Œæˆªå–çš„æ˜¯Swiftè¯­è¨€çš„å®ç°ï¼Œ<code>map</code>æ–¹æ³•å®ç°æ‹†è£…ç®±ï¼ˆç±»ä¼¼Optionalï¼Œå³Haskellçš„Maybeï¼‰</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Event</span>&lt;<span class="title class_">Element</span>&gt; &#123;</span><br><span class="line">    <span class="comment">/// Next element is produced.</span></span><br><span class="line">    <span class="keyword">case</span> next(<span class="type">Element</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Sequence terminated with an error.</span></span><br><span class="line">    <span class="keyword">case</span> error(<span class="type">Swift</span>.<span class="type">Error</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Sequence completed successfully.</span></span><br><span class="line">    <span class="keyword">case</span> completed</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Event</span> &#123;</span><br><span class="line">    <span class="comment">/// Maps sequence elements using transform. If error happens during the transform .error</span></span><br><span class="line">    <span class="comment">/// will be returned as value</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">map</span>&lt;<span class="type">Result</span>&gt;(<span class="keyword">_</span> <span class="params">transform</span>: (<span class="type">Element</span>) <span class="keyword">throws</span> -&gt; <span class="type">Result</span>) -&gt; <span class="type">Event</span>&lt;<span class="type">Result</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> .next(element):</span><br><span class="line">                <span class="keyword">return</span> .next(<span class="keyword">try</span> transform(element))</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> .error(error):</span><br><span class="line">                <span class="keyword">return</span> .error(error)</span><br><span class="line">            <span class="keyword">case</span> .completed:</span><br><span class="line">                <span class="keyword">return</span> .completed</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> <span class="keyword">let</span> e &#123;</span><br><span class="line">            <span class="keyword">return</span> .error(e)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ŒRxçš„<code>subscribe</code>æ–¹æ³•å°±æ˜¯ä¸€ä¸ªè§£åŒ…ï¼Œä¹Ÿå°±æ˜¯<code>Monad&lt;Event&gt;.map()</code>ï¼Œæ¥æ”¶ä¸€ä¸ª<code>(Event) -&gt; void</code>çš„å‚æ•°ã€‚æˆ–è€…ä½¿ç”¨æ›´ä¸€èˆ¬ç›´è§‚çš„ä¸‰ä¸ªå‚æ•°<code>onNext: (Element) -&gt; Void</code>ã€<code>onError: (Error) -&gt; Void</code>ã€<code>onCompleted: (Void) -&gt; Void</code>æ–¹æ³•ï¼ˆåœ¨å…¶ä»–è¯­è¨€å®è·µä¸Šï¼ŒRxJSå°±æ˜¯ä¸‰ä¸ªfunctionå‚æ•°ï¼Œè€ŒRxJavaä¸ºäº†æ”¯æŒJava7å¯ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»ï¼‰</p><p>ç†è®ºï¼š</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Monad</span> <span class="type">Event</span> &lt;$&gt; subscribe</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.interval(<span class="number">0.3</span>)</span><br><span class="line">.subscribe &#123; event <span class="keyword">in</span></span><br><span class="line"><span class="built_in">print</span>(event) <span class="comment">// unwraped event</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cancel <span class="operator">=</span> searchWikipedia(<span class="string">&quot;me&quot;</span>)</span><br><span class="line">.subscribe(onNext: &#123; results <span class="keyword">in</span></span><br><span class="line"><span class="built_in">print</span>(results)</span><br><span class="line">&#125;, onError: &#123; error <span class="keyword">in</span></span><br><span class="line"><span class="built_in">print</span>(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Rxçš„Operatoræ˜¯<code>Functor</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>(Event) -&gt; Event</code>ï¼Œå› æ­¤å¯ä»¥é€šè¿‡Monadä¸æ–­<code>bind</code>ä½ æƒ³è¦çš„ç»„åˆå­ï¼Œç›´åˆ°æœ€ç»ˆç¬¦åˆUIæ§ä»¶éœ€è¦çš„æ•°æ®</p><p>ç†è®ºï¼š</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Monad</span> <span class="type">Event</span> &gt;&gt;= map &gt;&gt;= concat &gt;&gt;= filter &gt;&gt;= map &lt;$&gt; subscribe</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> primeTextField.rx.text           <span class="comment">// Observable&lt;String&gt;</span></span><br><span class="line">.map &#123; <span class="type">WolframAlphaIsPrime</span>(<span class="type">Int</span>(<span class="variable">$0</span>) <span class="operator">??</span> <span class="number">0</span>) &#125;      <span class="comment">// Observable&lt;Observable&lt;Prime&gt;&gt;</span></span><br><span class="line">.concat()                                       <span class="comment">// Observable&lt;Prime&gt;</span></span><br><span class="line">.filter &#123; <span class="variable">$0</span>.isPrime &#125;                          <span class="comment">// Observable&lt;Prime&gt;</span></span><br><span class="line">.map &#123; <span class="variable">$0</span>.intValue &#125;                            <span class="comment">// Observable&lt;Int&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Promise-Future"><a href="#Promise-Future" class="headerlink" title="Promise / Future"></a>Promise / Future</h2><p>Promiseæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª<code>Monad</code>ï¼ŒåŒ…è£¹çš„ä¸Šä¸‹æ–‡å°±æ˜¯<code>resolve</code>å’Œ<code>reject</code>ã€‚<br>ä½ å¯èƒ½åé©³è¯´<code>Promise.then(f)</code>ä¸­çš„<code>f</code>ï¼Œå¯ä»¥æ˜¯<code>value =&gt; value</code>ï¼Œè€Œå¹¶ä¸æ˜¯ä¸€ä¸ªè¢«PromiseåŒ…è£¹çš„ç±»å‹å•Šã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œç”±äºJavaScriptç±»å‹çš„åŠ¨æ€æ€§ï¼ŒPromise.thenä¸­ç›´æ¥è¿”å›valueç±»å‹æ˜¯ä¸ªè¯­æ³•ç³–ç½¢äº†ï¼Œå®é™…ä¸Šä¼šå¤„ç†ä¸º<code>value =&gt; Promise.resolve(value)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">v</span> =&gt;</span> v+<span class="number">1</span>) <span class="comment">//ä¾¿æ·å†™æ³•ç½¢äº†ï¼Œè¿”å›çš„æ˜¯resolvedçŠ¶æ€çš„Promiseå¯¹è±¡</span></span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">v</span> =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(v+<span class="number">1</span>)) <span class="comment">//å®Œæ•´å†™æ³•</span></span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">v</span> =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;error &#x27;</span> + v)) <span class="comment">//æƒ³è¦è¿”å›rejectedçŠ¶æ€ï¼Œæ— ä¾¿æ·æ–¹æ³•</span></span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(e)) <span class="comment">// error 3</span></span><br></pre></td></tr></table></figure><p>åŸç†ï¼š</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Monad</span> <span class="type">Promise</span> &gt;&gt;= <span class="keyword">then</span> &gt;&gt;= <span class="keyword">then</span> &gt;&gt;= catch &gt;&gt;= <span class="keyword">then</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v + <span class="number">1</span>; <span class="comment">// 1</span></span><br><span class="line">  &#125;.<span class="title function_">then</span>(<span class="function"><span class="params">v</span> =&gt;</span>  &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;error&#x27;</span>); <span class="comment">//reject</span></span><br><span class="line">  &#125;.<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e); <span class="comment">// error</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;.<span class="title function_">then</span>(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;end&#x27;</span>, v); <span class="comment">// end 0</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>FRPæœ¬èº«å‘å±•æ—¶é—´å¹¶ä¸é•¿ï¼Œä¸»è¦æ˜¯å› ä¸ºå½“å¹´çš„GUIç¨‹åºçš„å¤æ‚åº¦å’Œéœ€æ±‚å˜åŒ–æˆéƒ½ï¼Œå’Œç°å¦‚ä»Šç›¸æ¯”æœ‰ç€æ˜æ˜¾çš„å·®è·ã€‚ä¼ ç»Ÿçš„äº‹ä»¶é©±åŠ¨åœ¨æ„ä»¶åŸå‹å’Œç®€å•äº¤äº’çš„Appç¡®å®éå¸¸ç®€å•ï¼Œä½†éšç€æ¶æ„çš„å‘å±•å’Œä¸šåŠ¡å¢å¤šï¼Œåˆ°äº†è¿MVPéƒ½æ— æ³•æ‰¿æ‹…çš„åœ°æ­¥ï¼ŒMVVMçš„æå‡ºå’Œç›¸åº”çš„FRPæ¡†æ¶å°±æ˜¯ä¸€ä¸ªæ•‘å‘½ç¨»è‰ã€‚</p><p>è™½ç„¶ç°å¦‚ä»Šæ¥è¯´ï¼ŒFRPçš„ä¸»è¦é—®é¢˜åœ¨äºå…¥é—¨é—¨æ§›ç›¸å¯¹é«˜ä¸€ç‚¹ï¼Œä¸è¿‡åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™å°±å’Œå½“å¹´Webèµ°å‘Angularå’ŒReactä¸€æ ·ï¼Œéƒ½æ˜¯éœ€è¦ä¸€æ®µæ—¶é—´è¿‡æ¸¡çš„ã€‚åœ¨Androidå¹³å°ä¸Šï¼ŒRxJavaå·²ç»è·å¾—äº†ç›¸å½“å¤§çš„æˆåŠŸå’Œæ¨å¹¿ï¼ŒReactiveCocoaå¯èƒ½åœ¨å›½å†…å¹¶ä¸å¦‚RxJavaé‚£æ ·å‡ºåï¼Œä½†ä¼°è®¡åœ¨æ—¥åï¼ŒFRPï¼‹MVVMï¼‹Reactive Nativeï¼‹Reduxè¿™ç§æ··åˆAppæ¶æ„å°†ä¼šå¾—åˆ°æ›´å¤§æ¨å¹¿å’Œå‘å±•ï¼Œå¦‚æœAppleæˆ–è€…Googleå†åŠ ä¸€æŠŠæ¨æ‰‹ï¼Œåˆ°é‚£æ—¶å€™æ‰å¯ä»¥è¯´Reactive Programmingçš„æ—¶ä»£çœŸæ­£åˆ°æ¥äº†å§ã€‚</p><p>#å‚è€ƒèµ„æ–™</p><ul><li><a href="https://github.com/ReactiveCocoa/ReactiveObjC">RxObjc</a></li><li><a href="https://github.com/ReactiveCocoa/ReactiveSwift">RxSwift</a></li><li><a href="http://reactivex.io/">ReactiveX</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></li><li><a href="https://github.com/baconjs/bacon.js/">Bacon</a></li><li><a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html">Monad</a></li><li><a href="http://nshipster.cn/reactivecocoa/">NSHipster</a></li><li><a href="https://www.raywenderlich.com/62699/reactivecocoa-tutorial-pt1">ReactiveCocoa Tutorial</a></li><li><a href="http://blog.leichunfeng.com/blog/2015/11/08/functor-applicative-and-monad/">ReactiveCocoa Monad</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ReactiveCocoaå’ŒRxSwift&quot;&gt;&lt;a href=&quot;#ReactiveCocoaå’ŒRxSwift&quot; class=&quot;headerlink&quot; title=&quot;ReactiveCocoaå’ŒRxSwift&quot;&gt;&lt;/a&gt;ReactiveCocoaå’ŒRxSwift&lt;/h1&gt;&lt;p&gt;iOSçš„å¼€å‘ä¸Šï¼ŒObjective-Cå¯ä»¥è¯´æ—¢æ˜¯ä¸€ä¸ªå·¨å¤§çš„æˆåŠŸï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå·¨å¤§çš„é™åˆ¶ã€‚Cocoa Touchæä¾›çš„åŸç”ŸAPIæœ¬èº«å°±æ˜¯ç›®æ ‡å½“å¹´çš„äº‹ä»¶é©±åŠ¨å’Œæ¶ˆæ¯æ´¾å‘çš„GUIç¼–ç¨‹æ¨¡å‹ï¼Œå¹¶ä¸”ä¸“é—¨ä¸ºObjective-Cè¿™é—¨ç±»smalltalkçš„æ¶ˆæ¯å¼OOè¯­è¨€è®¾è®¡çš„ï¼Œæ›´ä¸ºå°´å°¬çš„æ˜¯iOSä¸Šæ²¡æœ‰OS Xä¸Šè‡ªå¸¦çš„&lt;a href=&quot;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CocoaBindings/CocoaBindings.html&quot;&gt;Data Binding&lt;/a&gt;ã€‚ç§ç§åŸå› ï¼Œå¯¼è‡´Target-Acionï¼ŒKVOï¼ŒNotificationï¼ŒAppleå¼MVCæ¶æ„æ‰ä¼šä¸€ç›´æˆä¸ºiOSå¼€å‘çš„ä¸»æµã€‚ç„¶è€Œï¼Œåšè¿‡å¼€å‘çš„éƒ½çŸ¥é“ï¼Œè¿™å¥—æ¶æ„åœ¨å¤§å‹Appï¼Œå°¤å…¶å¤æ‚æ˜¯ç½‘ç»œè¯·æ±‚å’Œäººæœºäº¤äº’ç‰¹åˆ«å¤šçš„æƒ…å†µä¸‹ï¼Œéå¸¸å®¹æ˜“è®©æ•´ä¸ªAppæ¶æ„å˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;Appleå¼çš„MVCï¼Œåˆç§°ä¸ºMassive View Controllerï¼Œä¼šè®©ä½ æ•´ä¸ªä¸šåŠ¡ä»£ç å’ŒUIç»‘å®šä»£ç å……æ–¥åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å¯¼è‡´å¾ˆå¤šäººç»å¸¸ä¼šåœ¨Viewä¸­ï¼Œç›´æ¥#includeä¸€ä¸ªModeldçš„å¤´æ–‡ä»¶ï¼Œç„¶åèµ·ä¸€ä¸ª&lt;code&gt;configureInfo: &lt;/code&gt;çš„æ–¹æ³•ï¼Œç›´æ¥åœ¨é‡Œé¢æŠŠModelçš„æ•°æ®æ‹¿æ¥ç»‘å®šåˆ°Viewçš„å±æ€§ä¸Šã€‚ä¸ä¿¡ï¼Ÿè¯•è¯•æœä¸€éä½ æ‰€æœ‰çš„Viewï¼ŒæŠŠModelçš„å¤´æ–‡ä»¶åˆ æ‰ï¼Œçœ‹çœ‹èƒ½å¦ç¼–è¯‘é€šè¿‡ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; userCell &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; tableView.dequeueReusableCellWithIdentifier(&lt;span class=&quot;string&quot;&gt;&amp;quot;identifier&amp;quot;&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;UserCell&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;userCell.configureWithUser(user)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;MVPæ¶æ„æˆ–è®¸æ˜¯ä½ çš„æ•‘æ˜Ÿï¼Œä¸è¿‡å®é™…ä¸Šï¼ŒMVPåªæ˜¯ä¸€ä¸ªå·¥ç¨‹åŒ–çš„è§£å†³é—®é¢˜ï¼ŒæŠŠMassive View Controllerå˜æˆMassive View Presenterï¼Œå¸¦æ¥ç›¸å¯¹æ˜ç¡®çš„æ¶æ„åˆ†å±‚çš„å‰¯ä½œç”¨å°±æ˜¯è¿‘ä¹ä¸¤å€çš„ä»£ç é‡ã€‚è€Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMVVMçš„æ¶æ„å°±æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„çªç ´ï¼Œå’ŒMVPä¸€æ ·æŠŠView/ViewControlleræ‰”åˆ°ä¸€èµ·ï¼Œä½†æ˜¯å¼•å…¥å•ç‹¬çš„ViewModelï¼Œé€šè¿‡Viewåˆ°ViewModelçš„å•å‘ç»‘å®šï¼ŒViewModelå¯¹Modelçš„è®¢é˜…ï¼Œæ—¢é¿å…äº†MVCé€ æˆçš„ä»£ç æ··ä¹±ï¼Œåˆå‡å°‘äº†MVPçš„é€ æˆçš„é‡å¤ä»£ç ã€‚è€Œå®è·µä¸Šï¼Œæåˆ°MVVMï¼Œå°±å¾— æåˆ°&lt;a href=&quot;https://github.com/ReactiveCocoa/ReactiveCocoa&quot;&gt;ReactiveCocoa&lt;/a&gt;æˆ–è€…&lt;a href=&quot;https://github.com/ReactiveX/RxSwift&quot;&gt;RxSwift&lt;/a&gt;ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯FRPçš„GUIæ¡†æ¶å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ReactiveCocoa&quot;&gt;&lt;a href=&quot;#ReactiveCocoa&quot; class=&quot;headerlink&quot; title=&quot;ReactiveCocoa&quot;&gt;&lt;/a&gt;ReactiveCocoa&lt;/h2&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="Functional" scheme="http://dreampiggy.com/tags/Functional/"/>
    
    <category term="Swift" scheme="http://dreampiggy.com/tags/Swift/"/>
    
    <category term="JavaScript" scheme="http://dreampiggy.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>FRPç®€ä»‹â€”è®ºGUIç¨‹åºæ¶æ„å‘å±•</title>
    <link href="http://dreampiggy.com/2016/11/16/FRP%E7%AE%80%E4%BB%8B%E2%80%94%E8%AE%BAGUI%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%8F%91%E5%B1%95/"/>
    <id>http://dreampiggy.com/2016/11/16/FRP%E7%AE%80%E4%BB%8B%E2%80%94%E8%AE%BAGUI%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%8F%91%E5%B1%95/</id>
    <published>2016-11-16T22:31:10.000Z</published>
    <updated>2022-05-09T07:27:55.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç†Ÿæ‚‰åšç«¯GUIç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼ŒWebå‰ç«¯ï¼‰çš„åŒå­¦ä¸€å®šä¼šçŸ¥é“ï¼ŒåšUIæœ€å¤§çš„é—®é¢˜å°±æ˜¯æ¨¡å‹å’Œè§†å›¾å¯¹è±¡çš„ç»‘å®šï¼Œè§†å›¾å¯¹è±¡çš„çŠ¶æ€ç®¡ç†ï¼Œä»¥åŠäº‹ä»¶æ¶ˆæ¯çš„å¤„ç†ã€‚</p></blockquote><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä¼ ç»Ÿçš„GUIç¼–ç¨‹çš„ä¸€å¤§æ ¸å¿ƒï¼Œå°±æ˜¯ä½¿ç”¨äº†äº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ¨¡å‹ã€‚UIå¯¹è±¡çš„å¸ƒå±€ã€çŠ¶æ€ç­‰ï¼Œé€šè¿‡å¤–éƒ¨çš„æ¶ˆæ¯äº‹ä»¶ï¼ˆç‚¹å‡»ï¼Œè§¦æ‘¸ï¼Œç½‘ç»œè¯·æ±‚å“åº”ç­‰ç­‰ï¼‰æ¥è§¦å‘ã€‚è¿™æ˜¯ç”±äºGUIç¨‹åºçš„äººæœºäº¤äº’çš„å¤©ç”Ÿæ€§è´¨å†³å®šçš„ï¼ˆå½“ç„¶ï¼Œè¿™é‡Œçš„GUIä¸åŒ…æ‹¬æ¸¸æˆï¼Œæ¸¸æˆä¸€èˆ¬é‡‡ç”¨ç«‹å³çš„å¸§é©±åŠ¨è€Œéäº‹ä»¶ï¼‰ã€‚å¯¹äºGUIç¼–ç¨‹çš„æ¶æ„æ–¹é¢ï¼Œä»å‘ç°åˆ°ç°åœ¨ï¼Œä¸å¤–ä¹è¿™å‡ ç§ï¼š</p><h1 id="ä¼ ç»Ÿçš„äº‹ä»¶ç›‘å¬ï¼Œæ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼š"><a href="#ä¼ ç»Ÿçš„äº‹ä»¶ç›‘å¬ï¼Œæ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼š" class="headerlink" title="ä¼ ç»Ÿçš„äº‹ä»¶ç›‘å¬ï¼Œæ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼š"></a>ä¼ ç»Ÿçš„äº‹ä»¶ç›‘å¬ï¼Œæ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼š</h1><p><img src="http://www.codeproject.com/KB/java/677591/EventModel.jpg"></p><p>è¿™æ˜¯æœ€å¸¸è§ï¼Œä¹Ÿæ˜¯æœ€è´´è¿‘GUIç¨‹åºåº•å±‚å®ç°çš„æ¨¡å‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒGUIç¨‹åºçš„æ¡†æ¶å…¥å£å°±æ˜¯ä¸€ä¸ªå¤§çš„while(true)å¾ªç¯ï¼Œé€šè¿‡åœ¨å¾ªç¯å†…ä¸æ–­å‘çª—å£ç®¡ç†å™¨è¯·æ±‚æ¶ˆæ¯ï¼ˆæ¯”å¦‚ç‚¹å‡»äº‹ä»¶ç­‰ç”¨æˆ·è¾“å…¥ï¼‰ï¼Œé€šè¿‡æŠŠåº•å±‚çš„æ¶ˆæ¯å›è°ƒå‡½æ•°å›è°ƒæˆ–è€…IPCæœºåˆ¶ï¼Œå°è£…æˆä¸€ä¸ªä¸ªå¯¹å¼€å‘è€…å‹å¥½çš„äº‹ä»¶å¯¹è±¡æ¥æ´¾å‘å‡ºæ¥ã€‚</p><p>å› æ­¤ï¼Œä¼ ç»Ÿçš„è¿™ç§æ¨¡å‹ï¼Œåœ¨GUIå¼€å‘çš„æ—¶å€™ï¼Œé€šè¿‡æŠŠUIå¯¹è±¡ç»‘å®šæŒ‡å®šçš„äº‹ä»¶ç›‘å¬å™¨ï¼Œåœ¨ç›‘å¬å™¨çš„ä»£ç ä¸­æ‰‹åŠ¨æ”¹å˜çŠ¶æ€ï¼Œæ¥è¾¾åˆ°äººæœºäº¤äº’ã€‚å½“ç„¶ï¼Œè¿™ä¸€ç‚¹è¿˜ä¸å¤Ÿï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æ³•æ‰‹åŠ¨æ¥è§¦å‘å¤šä¸ªUIå¯¹è±¡çš„å…³è”å…³ç³»ï¼Œä¹Ÿå¾ˆéš¾å¤„ç†éè¾“å…¥ç±»å‹äº‹ä»¶ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œæ–‡ä»¶è¯»å†™ã€‚å› æ­¤å°±éœ€è¦å¼•å…¥æ¶ˆæ¯çš„æœºåˆ¶ï¼Œé€šè¿‡æ´¾å‘æ¶ˆæ¯ï¼ŒUIå¯¹è±¡å¯ä»¥é€‰æ‹©æ˜¯å¦å¤„ç†è¯¥æ¶ˆæ¯ï¼Œæˆ–è€…é‡æ–°æ´¾å‘æ¶ˆæ¯ç»™å…¶ä»–UIå¯¹è±¡ï¼Œå¯¹äºç½‘ç»œè¯·æ±‚ç­‰ï¼Œæ—¢å¯ä»¥ç”¨é«˜å±‚çš„æ¶ˆæ¯å¤„ç†ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é€šè¿‡å›è°ƒå‡½æ•°æ¥å¤„ç†ã€‚è¿™æ ·æ•´å¥—æœºåˆ¶å°±æ˜¯ä¼ ç»Ÿçš„GUIç¨‹åºçš„æ ¸å¿ƒæœºåˆ¶ã€‚</p><p>ä¼ ç»Ÿçš„GUIäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œä¸€ç›´ä¼´éšç€å†å²çš„å‘å±•ï¼Œè¯ç”Ÿäº†æ— æ•°çš„è§£å†³æ–¹æ¡ˆå’ŒGUIæ¡†æ¶ï¼Œä»æ—©æœŸçš„æš´åŠ›çš„å‡½æ•°æŒ‡é’ˆæ¥ç»‘å®šäº‹ä»¶å›è°ƒï¼Œåˆ°å¦‚ä»Šå„ç§é¢å‘å¯¹è±¡çš„æ¶ˆæ¯-äº‹ä»¶æœºåˆ¶ã€‚åŸºæœ¬ä½ åœ¨å„ç§GUIæ¡†æ¶ä¸­éƒ½èƒ½æ‰¾åˆ°ã€‚ä¸è¿‡ï¼Œé—æ†¾çš„äº‹ï¼Œä¸€èˆ¬çš„Eventéƒ½æ˜¯å•ä¸ªæ¶ˆæ¯æˆ–è€…äº‹ä»¶å¯¹è±¡ï¼Œä½ å¯ä»¥å†æ´¾å‘ç»™å…¶ä»–UIå¯¹è±¡æ¥å¤„ç†ï¼Œä½†æ•´ä¸ªæµç¨‹ä¸æ˜¯éå¸¸å“åº”å˜åŒ–çš„ï¼Œå‡å¦‚éœ€è¦æ–°çš„æ¶ˆæ¯å¤„ç†ï¼Œå°±å¾—åœ¨å„å¤„çš„ç›‘å¬å™¨ä¸Šæ‰‹åŠ¨ä¿®æ”¹ä»£ç ï¼Œè¿™ä¸€ç‚¹ä¹Ÿä¸Reactive</p><p>ä¸¾ä¾‹ï¼š</p><ul><li><a href="https://developer.apple.com/library/content/documentation/General/Conceptual/CocoaEncyclopedia/Target-Action/Target-Action.html">iOS Target-Action</a></li><li><a href="https://developer.android.com/guide/topics/ui/ui-events.html">Android Event</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/EventListener">Web EventListener</a></li><li><a href="http://doc.qt.io/qt-4.8/signalsandslots.html">Qt Singal Slot</a></li><li><a href="https://msdn.microsoft.com/en-us/library/ms753115.aspx">WPF Events</a></li></ul><h1 id="æ•°æ®ç»‘å®šå’ŒçŠ¶æ€ç®¡ç†"><a href="#æ•°æ®ç»‘å®šå’ŒçŠ¶æ€ç®¡ç†" class="headerlink" title="æ•°æ®ç»‘å®šå’ŒçŠ¶æ€ç®¡ç†"></a>æ•°æ®ç»‘å®šå’ŒçŠ¶æ€ç®¡ç†</h1><p><img src="http://i.stack.imgur.com/KZFfe.png"></p><p>éšç€GUIç¨‹åºçš„å‘å±•ï¼Œå°¤å…¶æ˜¯Webå‰ç«¯é¢†åŸŸçš„å‘å±•ï¼Œä¼ ç»Ÿçš„äº‹ä»¶æ¶ˆæ¯æœºåˆ¶ä¹Ÿè¶Šæ¥è¶Šéš¾ä»¥æ–¹ä¾¿åº”å¯¹å¤§å‹GUIåº”ç”¨ã€‚éšç€ä½ çš„GUIç¨‹åºäº¤äº’è¶Šæ¥è¶Šå¤šæ ·ï¼Œç½‘ç»œè¯·æ±‚è¶Šæ¥è¶Šå¤šï¼Œä¸åŒUIå¯¹è±¡ä¹‹é—´å…³è”è¶Šæ¥å¤æ‚ï¼Œä¸€ä¸ªäº‹ä»¶è¿‡æ¥ï¼Œä¹Ÿè®¸ä½ éœ€è¦ä¿®æ”¹åå¤šä¸ªç›¸å…³UIå¯¹è±¡çš„å±æ€§å’Œå¸ƒå±€ï¼›åŒæ—¶ç½‘ç»œè¯·æ±‚çš„å›è°ƒï¼Œä½ åˆå¾—åˆ†å‘å°è£…æˆå¤šç§æ¶ˆæ¯å‘é€å‡ºå»ã€‚æœ€ç»ˆï¼Œä½ å†™çš„UIé€»è¾‘ä»£ç ï¼Œå°†è¾¾åˆ°ï¼š<code>æ¶ˆæ¯å¯¹åº”äº‹ä»¶æ•° * äº‹ä»¶ç»‘å®šçš„UIå¯¹è±¡æ•° * UIå¯¹è±¡éœ€è¦ä¿®æ”¹çš„å±æ€§æ•°</code>è¿™æ ·ä¸€ç§åœ°æ­¥ã€‚è¿™å°±å¯¹GUIå¼€å‘å¸¦æ¥äº†ä¸€ä¸ªéå¸¸å¤§çš„æŒ‘æˆ˜ã€‚</p><p>å› æ­¤ï¼Œè¿™å°±å¸¦æ¥ä¸€ä¸ªGUIå¼€å‘çš„æ–°æ¨¡å¼ã€‚æˆ‘ä»¬å¯ä»¥é‡æ–°æ€è€ƒä¸€ä¸‹ï¼Œå‡å¦‚æˆ‘ä»¬æŠŠæ¶ˆæ¯æºï¼Œé€šè¿‡ä¸€å®šçš„ç­–ç•¥ï¼Œç›´æ¥åŒUIçš„å±æ€§ç»‘å®šèµ·æ¥ï¼Œè¿™å°±æ˜¯æ•°æ®ç»‘å®šã€‚å¯ä»¥é€šè¿‡å»ºç«‹ä¸€å¥—æ¡†æ¶å°è£…æ¶ˆæ¯å’Œäº‹ä»¶ï¼Œå¹¶è‡ªåŠ¨åŒ–äº‹ä»¶åˆ°UIå¯¹è±¡å±æ€§è¿™ä¸€æµç¨‹ã€‚åŒæ—¶ï¼Œä¸ºäº†æ­£ç¡®ä¿®æ”¹UIå¯¹è±¡çš„å±æ€§ï¼Œä¼ ç»Ÿçš„äº‹ä»¶æ¶ˆæ¯æœºåˆ¶ä¸€èˆ¬ä¼šåœ¨äº‹ä»¶ç›‘å¬å™¨ä¸Šè®¡ç®—UIå¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼Œå¹¶æ‰‹åŠ¨ä¿®æ”¹éœ€è¦ä¿®æ”¹çš„å±æ€§ã€‚å› æ­¤ï¼Œæ•°æ®ç»‘å®šçš„æ—¶å€™ä¹Ÿéœ€è¦å¼•å…¥çŠ¶æ€ç®¡ç†ã€‚åœ¨è¿™å¥—æ¡†æ¶ä¸­ï¼ŒUIå¯¹è±¡æœ¬èº«ä¸éœ€è¦å­˜å‚¨çŠ¶æ€ï¼Œéœ€è¦æœ‰ä¸€å±‚æ¥å¤„ç†ä¸åŒçŠ¶æ€å¯¹åº”çš„UIå¯¹è±¡ç»‘å®šæ–¹å¼ï¼Œæ•´ä¸ªData Flowä»æ•°æ®æ¨¡å‹å‡ºå‘ï¼Œè§¦å‘çŠ¶æ€æ”¹å˜ï¼Œç„¶ååŒæ­¥åˆ°UIå¯¹è±¡å¯¹åº”çŠ¶æ€ä¸‹çš„ç»‘å®šæ–¹å¼ï¼Œæœ€ç»ˆæ”¹å˜UIå¯¹è±¡çš„å±æ€§ã€‚</p><p>å½“ç„¶ï¼Œä»ä¸Šé¢çš„è¯´æ³•ä¹Ÿèƒ½çœ‹å‡ºï¼Œæœ€ç®€å•çš„å®ç°ï¼Œè‡³å°‘è¦è¾¾åˆ°äº‹ä»¶-&gt;UIå¯¹è±¡çš„å•å‘ç»‘å®šï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å­˜åœ¨äº‹ä»¶&lt;-&gt;å¯¹è±¡çš„åŒå‘ç»‘å®šã€‚æ•°æ®ç»‘å®šå¸¸è§äºä½¿ç”¨ç±»XMLå¸ƒå±€çš„GUIæ¡†æ¶ï¼Œå› ä¸ºçº¯XMLæ— æ³•å­˜å‚¨çŠ¶æ€ã€‚æ¯”å¦‚Vue.jsçš„XMLæ¨¡ç‰ˆï¼ŒReactçš„JSXï¼ŒAndroidçš„XMLå¸ƒå±€ï¼ŒWPFçš„XAMLç­‰ç­‰ã€‚è€Œå¯¹äºiOSåº”ç”¨è€Œè¨€ï¼Œé™¤äº†æ­é…Storyboardæ¥ç®€åŒ–çŠ¶æ€ï¼Œä»£ç å¸ƒå±€ä¸­ä¸€èˆ¬é‡‡ç”¨MVVMæ¶æ„ï¼Œå°†Viewå’ŒViewControllerè¿™ä¸ªä¸Viewç´§è€¦åˆçš„æ¨¡å—æ”¾åœ¨ä¸€èµ·å½“åšViewå±‚ï¼Œå…¶ä¸­ViewControllerä¸“é—¨è´Ÿè´£ViewModelçš„æ•°æ®ç»‘å®šåˆ°UIå¯¹è±¡ä¸Šï¼ŒæŠŠæ‰€æœ‰Viewäº§ç”Ÿçš„äº‹ä»¶æ´¾å‘å›ViewModelï¼ˆæ¯”å¦‚æŒ‰é’®çš„ç‚¹å‡»ï¼ŒTargetä¸ºViewModelï¼‰ï¼Œæœ¬èº«ä¸è´Ÿè´£ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚è€ŒViewModelå°±æ˜¯çœŸæ­£ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ï¼Œè´Ÿè´£ç®¡ç†Viewçš„çŠ¶æ€ã€è§¦å‘çš„äº‹ä»¶æ¥æ›´æ–°Modelï¼ŒModelæ›´æ–°å¾—åˆ°çš„æ•°æ®å’ŒçŠ¶æ€å˜åŒ–åˆ™ä»£ç†ç»™Viewã€‚ä¸è¿‡å®è·µä¸Šä¸€èˆ¬éƒ½ç›´æ¥é‡‡ç”¨ReactiveCocoaäº†ï¼ˆå½“ç„¶ï¼Œå®ƒæ•°æ®ç»‘å®šåªæ˜¯å°éƒ¨åˆ†ï¼ŒçœŸæ­£é‡è¦åœ°æ–¹åœ¨FRPä¸Šï¼‰</p><p>ä¸¾ä¾‹ï¼š</p><ul><li><a href="https://facebook.github.io/react/">React.js</a></li><li><a href="https://facebook.github.io/react-native/">React Native</a></li><li><a href="https://github.com/reactjs/redux">Redux</a></li><li><a href="https://vuejs.org/">Vue.js</a></li><li><a href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a></li><li><a href="https://developer.android.com/topic/libraries/data-binding/index.html">Android Data Binding</a></li><li><a href="https://msdn.microsoft.com/en-us/library/ms752347.aspx">WPF</a></li></ul><h1 id="FRPâ€”â€”Functional-Reactive-Programming"><a href="#FRPâ€”â€”Functional-Reactive-Programming" class="headerlink" title="FRPâ€”â€”Functional Reactive Programming"></a>FRPâ€”â€”Functional Reactive Programming</h1><p><img src="https://camo.githubusercontent.com/995c301de2f566db10748042a5a67cc5d9ac45d9/687474703a2f2f692e696d6775722e636f6d2f484d47574e4f352e706e67"></p><p>æ•°æ®ç»‘å®šçœ‹èµ·æ¥å¾ˆç›´è§‚å¾ˆç¾å¥½ï¼Œä½†æ˜¯çŠ¶æ€ç®¡ç†å´ä¸æ˜¯ã€‚éšç€UIå¯¹è±¡çš„å¢åŠ ï¼ŒGUIåº”ç”¨çš„çŠ¶æ€å°±ä¼šå†æ¬¡é¢ä¸´<code>ç»„ä»¶çŠ¶æ€æ•°=å…³è”çš„ç»„ä»¶çŠ¶æ€æ•°æ±‚ç§¯</code>è¿™æ ·ä¸€ä¸ªç´¯ä¹˜å…³ç³»ã€‚è€Œä¸”æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå› ä¸ºçŠ¶æ€è¿™ç§ä¸œè¥¿ï¼Œä¸åŒäºå…·ä½“çš„UIå¯¹è±¡å±æ€§ï¼Œè¦æ”¹å˜åªèƒ½é‡æ–°è§¦å‘ï¼Œæ‰€ä»¥å½“çŠ¶æ€æµä»æ•°æ®æºå¼€å§‹å‘ä¸‹ä¼ é€’çš„æ—¶å€™ï¼Œå‡å¦‚æŸäº›UIå¯¹è±¡æƒ³è¦ä¿®æ”¹å¹¶ç»§ç»­ä¼ é€’ï¼Œå°±åªèƒ½å†è§¦å‘æ–°çš„çŠ¶æ€ï¼Œè¿™æ›´åŠ é‡äº†çŠ¶æ€ç®¡ç†çš„å‹åŠ›ã€‚</p><p>è¿™æ—¶å€™ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³åˆå‘æŒ¥äº†åŠŸåŠ›ã€‚ä¸åŒäºä¼ ç»Ÿäº‹ä»¶æ¶ˆæ¯æœºåˆ¶çš„ç¹çå’Œå¤æ‚ï¼Œä¹Ÿä¸éœ€è¦é¢å¯¹å¤æ‚çŠ¶æ€æ—¶ç®¡ç†ï¼ŒFRPçš„æ€æƒ³ï¼Œåœ¨äºæŠŠä¸å®šæœŸçš„äº‹ä»¶è§¦å‘ï¼Œå½“åšä¸€ä¸ªäº‹ä»¶æµï¼Œè®©ä¸åŒçš„è®¢é˜…è€…æ¥è®¢é˜…ï¼Œå¹¶ç»‘å®šäº‹ä»¶æµçš„æ•°æ®åˆ°UIå¯¹è±¡çš„å±æ€§ä¸Šã€‚</p><p>å€Ÿç”±å‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ï¼Œäº‹ä»¶æµæœ¬èº«æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œä½†è®¢é˜…è€…å¯ä»¥é€šè¿‡ç»„åˆæ— å‰¯ä½œç”¨çš„å‡½æ•°æ¥å¾—åˆ°ä¸€ä¸ªå±äºè‡ªå·±å®šåˆ¶çš„æ–°çš„äº‹ä»¶æµï¼Œä¸åŒè®¢é˜…è€…å¯ä»¥é‡ç”¨å…¶ä»–è®¢é˜…è€…å·²ç»ç»„åˆè¿‡çš„äº‹ä»¶æµã€‚äº‹ä»¶æµçš„æµåŠ¨æ–¹å‘å°±æ˜¯æ—¶é—´è½´æ–¹å‘ï¼Œè€Œè®¢é˜…è€…å¯ä»¥ç»„åˆå¾—åˆ°æ–°çš„äº‹ä»¶æµçš„å‰¯æœ¬ï¼ŒæŸæ—¶åˆ»åŸäº‹ä»¶çš„çŠ¶æ€ï¼Œè¯¥è®¢é˜…è€…å°±èƒ½å¾—åˆ°è¯¥æ—¶åˆ»äº‹ä»¶å¯¹åº”å˜åŒ–åçš„çŠ¶æ€ï¼Œç”¨æ¥ç»‘å®šUIå¯¹è±¡ã€‚</p><p>æ¯”å¦‚ä½ éœ€è¦åšä¸€ä¸ªç‚¹å‡»ç›‘æµ‹çš„åŠŸèƒ½ï¼Œéœ€è¦ç»™ä¸€ä¸ªæ–‡æœ¬æ¡†æ˜¾ç¤ºåœ¨250msé—´éš”å†…è¿ç»­ç‚¹å‡»ä¸¤æ¬¡ä»¥ä¸Šçš„æ¬¡æ•°ã€‚å¦‚æœæ¢åšä¼ ç»Ÿäº‹ä»¶æ¶ˆæ¯æœºåˆ¶ï¼Œé‚£ä¹ˆå°±å¾—å†™ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ•è·äº‹ä»¶ï¼Œä¸€ä¸ªè®¡æ—¶å™¨ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå…¨å±€çŠ¶æ€é‡è®°å½•å½“å‰è¿™250msç‚¹å‡»çš„æ¬¡æ•°ã€‚æ¢åšæ•°æ®ç»‘å®šçš„æ–¹å¼ç¨å¾®ç®€åŒ–äº†ä¸€ç‚¹ï¼Œä¸€ä¸ªç»‘å®šå¤„ç†å‡½æ•°ï¼Œä½†æ˜¯å¾—å¼•å…¥ä¸¤ä¸ªé¢å¤–çŠ¶æ€ï¼šå½“å‰è½®æ¬¡æ•°å¢åŠ çŠ¶æ€ï¼Œå’Œåˆ‡æ¢ä¸‹ä¸€è½®çš„çŠ¶æ€ã€‚è€Œæ¢åšFRPï¼Œå°±å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæŠŠç‚¹å‡»äº‹ä»¶æµï¼Œç›´æ¥é€šè¿‡è¿ç®—ç¬¦ç»„åˆåˆ°çœŸæ­£çš„æ•°æ®æµï¼Œç»‘å®šåˆ°UIå¯¹è±¡çš„å³å¯ã€‚</p><p>FRPçš„æ ¸å¿ƒï¼Œåœ¨äºäº‹ä»¶æµå¯å¤šæ¬¡è§¦å‘ï¼Œä»¥åŠå„ç§æ“ä½œç¬¦ç”¨æ¥ä½œäº‹ä»¶æµå˜æ¢ï¼Œæœ€ç»ˆäº¤åˆ°è®¢é˜…è€…æ‰‹ä¸Šçš„ï¼Œå°±æ˜¯çœŸæ­£UIå¯¹è±¡æƒ³è¦çš„æ•°æ®æµï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥æŠŠè¿™ä¸ªæ•°æ®æµç»‘å®šåˆ°UIå¯¹è±¡ä¸Šï¼Œè¾¾åˆ°æ•´ä¸ªData Flowçš„å®Œæ•´æ€§ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><ul><li><a href="http://reactivex.io/">ReactiveX</a></li><li><a href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a></li><li><a href="https://github.com/dominictarr/event-stream">EventStream</a></li></ul><h1 id="SO"><a href="#SO" class="headerlink" title="SO?"></a>SO?</h1><p>ä¼ ç»Ÿçš„äº‹ä»¶é©±åŠ¨å°†æ°¸è¿œæ˜¯GUIæ¡†æ¶çš„åŸºç¡€ï¼Œå› ä¸ºæœ€è´´è¿‘å®ç°å±‚ï¼Œè€Œä¸”å¯æ‰©å±•æ€§å¼ºã€‚ä½†æ˜¯å®é™…å¼€å‘ä¸­ï¼Œäº‹ä»¶æ¶ˆæ¯é©±åŠ¨å°†å¯¼è‡´ä½ çš„äº‹ä»¶ç›‘å¬å™¨éå¸ƒå„å¤„ï¼Œä¹Ÿä¼šå¼ºè¡ŒæŠŠViewå±‚å’ŒModelå±‚ç»‘å®šåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”ä¸åˆ©äºä¿®æ”¹ã€‚è€Œæ•°æ®ç»‘å®šå’ŒFRPçš„æ¶æ„èƒ½å¤Ÿå°†GUIç¨‹åºçš„UIå¯¹è±¡ï¼Œå’Œæ•°æ®ç›¸å¯¹åˆ†ç¦»å¼€ï¼ŒViewä¸éœ€è¦ç®¡ä»€ä¹ˆäº‹ä»¶ï¼Œåªéœ€è¦è‡ªå·±å…³ç³»çš„ï¼Œä¸ºäº†æ¸²æŸ“çš„å±æ€§æ•°æ®å³å¯ã€‚</p><p>åœ¨ç°åœ¨çœ‹æ¥ï¼ŒFRPæ˜¯åœ¨æ•°æ®ç»‘å®šçš„åŸºç¡€ä¸Šï¼Œé¿å…äº†è¿‡é‡çš„çŠ¶æ€ç®¡ç†ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤§å¤§ç®€åŒ–ä»£ç é‡ï¼Œæƒ³å¯¹å®¹æ˜“è¾¾åˆ°MVVMæ¶æ„ï¼Œå¯¹äºå¤§å‹åº”ç”¨æ„å»ºæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä¹‹åçš„ä¼šç®€å•ä»‹ç»å‡ ä¸ªFRPæ¡†æ¶å’Œæ¯”è¾ƒï¼ŒåŒæ—¶å¯ä»¥ç§‘æ™®ä¸€ä¸‹FRPèƒŒåçš„Functionalç®€å•åŸç†ã€‚æœŸå¾…ä»Šåçš„MVVMå’ŒFRPï¼Œåœ¨ç§»åŠ¨å’ŒWebå¹³å°èƒ½å¤Ÿå¾—åˆ°æ›´å¤§çš„æ¨å¹¿ï¼Œè§£æ”¾å¹¿å¤§äººæ°‘ç”Ÿäº§åŠ›ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ç†Ÿæ‚‰åšç«¯GUIç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼ŒWebå‰ç«¯ï¼‰çš„åŒå­¦ä¸€å®šä¼šçŸ¥é“ï¼ŒåšUIæœ€å¤§çš„é—®é¢˜å°±æ˜¯æ¨¡å‹å’Œè§†å›¾å¯¹è±¡çš„ç»‘å®šï¼Œè§†å›¾å¯¹è±¡çš„çŠ¶æ€ç®¡ç†ï¼Œä»¥åŠäº‹ä»¶æ¶ˆæ¯çš„å¤„ç†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;ä¼ ç»Ÿçš„GUIç¼–ç¨‹çš„ä¸€å¤§æ ¸å¿ƒï¼Œå°±æ˜¯ä½¿ç”¨äº†äº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ¨¡å‹ã€‚UIå¯¹è±¡çš„å¸ƒå±€ã€çŠ¶æ€ç­‰ï¼Œé€šè¿‡å¤–éƒ¨çš„æ¶ˆæ¯äº‹ä»¶ï¼ˆç‚¹å‡»ï¼Œè§¦æ‘¸ï¼Œç½‘ç»œè¯·æ±‚å“åº”ç­‰ç­‰ï¼‰æ¥è§¦å‘ã€‚è¿™æ˜¯ç”±äºGUIç¨‹åºçš„äººæœºäº¤äº’çš„å¤©ç”Ÿæ€§è´¨å†³å®šçš„ï¼ˆå½“ç„¶ï¼Œè¿™é‡Œçš„GUIä¸åŒ…æ‹¬æ¸¸æˆï¼Œæ¸¸æˆä¸€èˆ¬é‡‡ç”¨ç«‹å³çš„å¸§é©±åŠ¨è€Œéäº‹ä»¶ï¼‰ã€‚å¯¹äºGUIç¼–ç¨‹çš„æ¶æ„æ–¹é¢ï¼Œä»å‘ç°åˆ°ç°åœ¨ï¼Œä¸å¤–ä¹è¿™å‡ ç§ï¼š&lt;/p&gt;
&lt;h1 id=&quot;ä¼ ç»Ÿçš„äº‹ä»¶ç›‘å¬ï¼Œæ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼š&quot;&gt;&lt;a href=&quot;#ä¼ ç»Ÿçš„äº‹ä»¶ç›‘å¬ï¼Œæ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ä¼ ç»Ÿçš„äº‹ä»¶ç›‘å¬ï¼Œæ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼š&quot;&gt;&lt;/a&gt;ä¼ ç»Ÿçš„äº‹ä»¶ç›‘å¬ï¼Œæ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼š&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;http://www.codeproject.com/KB/java/677591/EventModel.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æœ€å¸¸è§ï¼Œä¹Ÿæ˜¯æœ€è´´è¿‘GUIç¨‹åºåº•å±‚å®ç°çš„æ¨¡å‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒGUIç¨‹åºçš„æ¡†æ¶å…¥å£å°±æ˜¯ä¸€ä¸ªå¤§çš„while(true)å¾ªç¯ï¼Œé€šè¿‡åœ¨å¾ªç¯å†…ä¸æ–­å‘çª—å£ç®¡ç†å™¨è¯·æ±‚æ¶ˆæ¯ï¼ˆæ¯”å¦‚ç‚¹å‡»äº‹ä»¶ç­‰ç”¨æˆ·è¾“å…¥ï¼‰ï¼Œé€šè¿‡æŠŠåº•å±‚çš„æ¶ˆæ¯å›è°ƒå‡½æ•°å›è°ƒæˆ–è€…IPCæœºåˆ¶ï¼Œå°è£…æˆä¸€ä¸ªä¸ªå¯¹å¼€å‘è€…å‹å¥½çš„äº‹ä»¶å¯¹è±¡æ¥æ´¾å‘å‡ºæ¥ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Code" scheme="http://dreampiggy.com/categories/Code/"/>
    
    
    <category term="Functional" scheme="http://dreampiggy.com/tags/Functional/"/>
    
  </entry>
  
  <entry>
    <title>Core Animation 3Dä»¿å°„å˜æ¢çŸ¥è¯†</title>
    <link href="http://dreampiggy.com/2016/11/01/Core-Animation-3D%E4%BB%BF%E5%B0%84%E5%8F%98%E6%8D%A2%E7%9F%A5%E8%AF%86/"/>
    <id>http://dreampiggy.com/2016/11/01/Core-Animation-3D%E4%BB%BF%E5%B0%84%E5%8F%98%E6%8D%A2%E7%9F%A5%E8%AF%86/</id>
    <published>2016-11-01T19:04:10.000Z</published>
    <updated>2016-11-02T11:21:22.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Core-Animation-3D-ä»¿å°„å˜æ¢çŸ¥è¯†"><a href="#Core-Animation-3D-ä»¿å°„å˜æ¢çŸ¥è¯†" class="headerlink" title="Core Animation 3D ä»¿å°„å˜æ¢çŸ¥è¯†"></a>Core Animation 3D ä»¿å°„å˜æ¢çŸ¥è¯†</h1><blockquote><p>ä¹‹å‰å†™çš„Core Graphicsæ˜¯2Då¹³é¢ä¸Šçš„åæ ‡å˜æ¢ï¼Œè€ŒiOSå¼€å‘ä¸­ï¼Œä¸ºäº†å®ç°å¤æ‚çš„åŠ¨ç”»æ•ˆæœï¼Œè§†å›¾åˆ‡æ¢æ•ˆæœï¼Œä¼šç”¨åˆ°å¾ˆå¤š3Då˜æ¢ï¼Œè¿™å°±æ˜¯Core Animationæä¾›çš„CATransform3Dï¼Œå…¶ä¸­å¤§éƒ¨åˆ†APIéƒ½å’Œ2Dæƒ…å†µç±»ä¼¼ï¼Œä½†è¿™é‡Œéœ€è¦è¯¦ç»†è§£é‡Šä¸€ä¸‹é€è§†æŠ•å½±è¿™ä¸ªæ¦‚å¿µï¼Œå’Œm34è¿™ä¸ªå€¼çš„çœŸå®æ¥æºï¼Œä¸€äº›åšå®¢æŠ„æ¥æŠ„å»å´æ²¡æœ‰ç‚¹åˆ°ç‚¹å­ä¸Šï¼Œè®©äººçœ‹ä¸ä¸‹å»â€¦â€¦</p></blockquote><h1 id="å˜æ¢çŸ©é˜µ"><a href="#å˜æ¢çŸ©é˜µ" class="headerlink" title="å˜æ¢çŸ©é˜µ"></a>å˜æ¢çŸ©é˜µ</h1><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="built_in">CATransform3D</span> &#123;</span><br><span class="line">  <span class="built_in">CGFloat</span> m11, m12, m13, m14;</span><br><span class="line">  <span class="built_in">CGFloat</span> m21, m22, m23, m24;</span><br><span class="line">  <span class="built_in">CGFloat</span> m31, m32, m33, m34;</span><br><span class="line">  <span class="built_in">CGFloat</span> m41, m42, m43, m44;</span><br><span class="line">&#125; <span class="built_in">CATransform3D</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç»“æ„ä½“å¯¹åº”çš„æ˜¯è¿™æ ·ä¸€ä¸ª4x4çš„å˜æ¢çŸ©é˜µï¼š</p><p>$ \begin{bmatrix} m11 &amp; m12 &amp; m13 &amp; m14 \\ m21 &amp; m22 &amp; m23 &amp; m24 \\ m31 &amp; m32 &amp; m33 &amp; m34 \\ m41 &amp; m42 &amp; m43 &amp; m44 \end{bmatrix} $</p><p>çŸ©é˜µå®šä¹‰çš„é¡ºåºå’Œç»“æ„ä½“ä¸€è‡´ï¼Œå…ˆè¡Œååˆ—ï¼ˆæ³¨æ„ï¼Œé‚£ä¸ªã€ŠCore Animation Advanced Techniquesã€‹çŸ©é˜µçš„å›¾æ˜¯é”™è¯¯çš„ï¼Œè¡Œåˆ—ç”»åäº†ï¼‰ï¼Œåˆ™å¯¹åº”çš„çŸ©é˜µä¹˜æ³•ä¸º</p><p>$ \begin{bmatrix} x &amp; y &amp; z &amp; 1 \end{bmatrix} \times \begin{bmatrix} m11 &amp; m12 &amp; m13 &amp; m14 \\ m21 &amp; m22 &amp; m23 &amp; m24 \\ m31 &amp; m32 &amp; m33 &amp; m34 \\ m41 &amp; m42 &amp; m43 &amp; m44 \end{bmatrix} = \\ \begin{bmatrix} m11x+m21y+m31z+m41 &amp; m12x+m22y+m32z+m42 &amp; m13x+m23y+m33z+m43 &amp; m14+m24+m34+m44 \end{bmatrix} $</p><p>æ³¨æ„ï¼š</p><ul><li>è¿™é‡Œå®šä¹‰çš„å‘é‡æœ€åä¸€ä½è¡¨ç¤ºé½æ¬¡å‘é‡å…ƒç´ ï¼Œå¦‚æœä¸ä¸º1ï¼Œéœ€è¦å†åŒ–ä¸ºé½æ¬¡åæ ‡ï¼ˆé€šå¸¸æƒ…å†µå¯ä»¥å–m14,m24,m34,m44ä¸º0,0,0,1ï¼‰ï¼Œå¯¹åº”çœŸæ­£çš„x,y,zåæ ‡</li></ul><p>$ \begin{bmatrix} \frac{m11x+m21y+m31z+m41}{m14+m24+m34+m44} &amp; \frac{m12x+m22y+m32z+m42}{m14+m24+m34+m44} &amp; \frac{m13x+m23y+m33z+m43}{m14+m24+m34+m44} \end{bmatrix} $</p><ul><li>iOSè®¾å¤‡ä¸Šï¼Œæ˜¯æŒ‰ç…§å·¦æ‰‹ç³»çš„ä¸‰ç»´ç©ºé—´ï¼Œå³æ­£é¢é¢å¯¹è®¾å¤‡å±å¹•ï¼Œåæ ‡åŸç‚¹ä»å±å¹•å·¦ä¸Šæ–¹èµ·ï¼Œxè½´æŒ‡å‘å³æ–¹ï¼Œyè½´æŒ‡å‘ä¸‹æ–¹ï¼Œzè½´ä¸ºå±å¹•æŒ‡å‘çœ¼çƒã€‚è€ŒmacOSä¸Šæ˜¯å³æ‰‹ç³»ï¼ŒåŸç‚¹æ˜¯å±å¹•å·¦ä¸‹è§’ï¼Œxè½´æŒ‡å‘å³æ–¹ï¼Œyè½´æŒ‡å‘ä¸Šæ–¹ï¼ˆç›¸åï¼‰ï¼Œzè½´åŒæ ·ä¸ºå±å¹•æŒ‡å‘çœ¼çƒï¼Œè¦æ³¨æ„</li></ul><p><img src="http://dreampiggy-image.test.upcdn.net/image/0/07/5c010c6b630ab7aa0892428016d7e.jpeg"></p><h1 id="å¹³ç§»"><a href="#å¹³ç§»" class="headerlink" title="å¹³ç§»"></a>å¹³ç§»</h1><p>ç±»ä¼¼äºŒç»´ç©ºé—´çš„å¹³ç§»ï¼Œå˜æ¢çŸ©é˜µç¬¬å››è¡Œçš„m41,m42,m43å¯¹åº”çš„å°±æ˜¯xã€yã€zçš„å¹³ç§»é‡ï¼Œå› æ­¤çŸ©é˜µå˜æ¢å¾ˆç®€å•ï¼Œæ¯”å¦‚å°†[x,y]å‘é‡å¹³ç§»åˆ°[x+a,y+b,z+c]ï¼š</p><p>å¹³ç§»çŸ©é˜µï¼š<br>$ \begin{bmatrix} x &amp; y &amp; z &amp; 1 \end{bmatrix} \times \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp; 0 \\ a &amp; b &amp; c &amp; 1 \end{bmatrix} = \begin{bmatrix} x+a &amp; y+b &amp; z+c &amp; 1 \end{bmatrix} $</p><p>å¯¹åº”æ„é€ APIï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CATransform3D</span> <span class="built_in">CATransform3DMakeTranslation</span>(<span class="built_in">CGFloat</span> tx, <span class="built_in">CGFloat</span> ty, <span class="built_in">CGFloat</span> tz);</span><br></pre></td></tr></table></figure><h1 id="ç¼©æ”¾"><a href="#ç¼©æ”¾" class="headerlink" title="ç¼©æ”¾"></a>ç¼©æ”¾</h1><p>åŒäºŒç»´ç©ºé—´çš„ç¼©æ”¾ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å‘é‡åæ ‡ä¹˜ä»¥ç³»æ•°ï¼Œé‚£ä¹ˆæ„é€ å‡ºæ¥ä¸€ä¸ªå¯¹è§’çŸ©é˜µå³å¯</p><p>ç¼©æ”¾çŸ©é˜µï¼š</p><p>$ \begin{bmatrix} x &amp; y &amp; z &amp; 1 \end{bmatrix} \times \begin{bmatrix} a &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; a &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; a &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} = \begin{bmatrix} ax &amp; ay &amp; az &amp; 1 \end{bmatrix} $</p><p>å¯¹åº”çš„æ„é€ APIï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CATransform3D</span> <span class="built_in">CATransform3DMakeScale</span>(<span class="built_in">CGFloat</span> sx, <span class="built_in">CGFloat</span> sy, <span class="built_in">CGFloat</span> sz);</span><br></pre></td></tr></table></figure><h1 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a>æ—‹è½¬</h1><p>å‚è€ƒäºŒç»´çš„æ—‹è½¬ï¼ŒäºŒç»´çš„æ—‹è½¬æˆ‘ä»¬è®¨è®ºçš„æ˜¯æŸä¸ªlayerï¼Œä»¥å®ƒè‡ªèº«çš„anchorPointä¸ºåŸç‚¹ï¼Œé€šè¿‡é¡ºæ—¶é’ˆé€†æ—¶é’ˆçš„æ—‹è½¬ã€‚ä½†æ˜¯å¯¹äºä¸‰ç»´æ¥è¯´æ—‹è½¬å°±éº»çƒ¦äº†ï¼Œå› ä¸ºå‘é‡ä¸ä¼šä»…ä»…åœ¨XoYå¹³é¢ä¸Šã€‚è™½ç„¶å®é™…ä¸Šå¯ä»¥å®šä¹‰ç»•ä»»æ„è½´æ—‹è½¬ï¼Œä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬åªç ”ç©¶ç»•ä¸‰ä¸ªåæ ‡è½´ï¼ˆx,y,zï¼‰çš„æ—‹è½¬ã€‚å…¶ä¸­ï¼Œå¯¹äºç»•zè½´çš„æ—‹è½¬ï¼Œå¯ä»¥çœ‹ä½œç­‰ä»·äºäºŒç»´çš„æ—‹è½¬ï¼ˆXoYå¹³é¢å†…ï¼‰ï¼Œä½†ç»•xå’Œç»•yå°±è¶…å‡ºäº†å±å¹•</p><p>å¯¹äºç»•åæ ‡è½´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¯¹åº”æ—‹è½¬å¹³é¢çš„æŠ•å½±çœ‹æˆäºŒç»´çš„æƒ…å†µï¼Œå› æ­¤å‰é¢æ¨å¯¼è¿‡çš„æ—‹è½¬çŸ©é˜µåŒæ ·é€‚ç”¨äºä¸‰ç»´ç»•è½´æƒ…å†µï¼Œåªéœ€è¦é’ˆå¯¹ä¸åŒåæ ‡è½´é€‰å®šä¸åŒçš„åæ ‡ç½¢äº†ï¼Œå³é€šè¿‡æŠŠå‰ä¸€ç¯‡æ¨å¯¼æ–¹ç¨‹æ›¿æ¢xï¼Œyï¼Œzå˜é‡å¾—åˆ°ï¼š</p><p>$ \begin{cases} x^{â€˜} = x \cos \theta - y \sin \theta \\ y^{â€˜} = y \cos \theta + x \sin \theta \\ z^{â€˜} = z \end{cases} $</p><p>ç»•xè½´çš„æ—‹è½¬çŸ©é˜µï¼ˆå›ºå®šxï¼Œä»yæ—‹è½¬åˆ°zï¼Œå³ç”¨yæ›¿æ¢xï¼Œzæ›¿æ¢yï¼Œxæ›¿æ¢zï¼‰ï¼š</p><p>$ \begin{bmatrix} x &amp; y &amp; z &amp; 1 \end{bmatrix} \times \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; \cos \theta &amp; \sin \theta &amp; 0 \\ 0 &amp; - \sin \theta &amp; \cos \theta &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} = \begin{bmatrix} x &amp; y \cos \theta - z \sin \theta &amp; z \cos \theta + y \sin \theta&amp; 1 \end{bmatrix} $</p><p>ç»•yè½´çš„æ—‹è½¬çŸ©é˜µï¼ˆå›ºå®šyï¼Œä»zæ—‹è½¬åˆ°xï¼Œå³ç”¨zæ›¿æ¢xï¼Œxæ›¿æ¢yï¼Œyæ›¿æ¢zï¼‰ï¼š</p><p>$ \begin{bmatrix} x &amp; y &amp; z &amp; 1 \end{bmatrix} \times \begin{bmatrix} \cos \theta &amp; 0 &amp; - \sin \theta &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; 0 \\ \sin \theta &amp; 0 &amp; \cos \theta &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} = \begin{bmatrix} x \cos \theta + z \sin \theta &amp; y &amp; z \cos \theta - x \sin \theta &amp; 1 \end{bmatrix} $</p><p>å¯¹åº”APIï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CATransform3D</span> <span class="built_in">CATransform3DMakeRotation</span>(<span class="built_in">CGFloat</span> radians, <span class="built_in">CGFloat</span> x, <span class="built_in">CGFloat</span> y, <span class="built_in">CGFloat</span> z);</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿™ä¸ªAPIä¸­ï¼Œradiansæ˜¯å¼§åº¦ä¸ç”¨è¯´ï¼Œx,y,zåˆ†åˆ«ä»‹äº[-1,1]ä¹‹é—´ï¼Œè¡¨ç¤ºä¸€ä¸ªä»»æ„çš„å•ä½å‘é‡ï¼ˆ[x,y,z]çš„é•¿åº¦æ˜¯1ï¼Œæ¯”å¦‚è®¾ç½®[1,0,0]å°±æŒ‡çš„æ˜¯ç»•xè½´æ­£æ–¹å‘æ—‹è½¬å¯¹åº”å¼§åº¦å€¼ï¼Œå‰é¢è§£é‡Šè¿‡iOSå’ŒmacOSçš„æ­£/è´Ÿå¼§åº¦å¯¹åº”é¡º/é€†æ—¶é’ˆäº†ï¼‰</p><h1 id="é”™åˆ‡"><a href="#é”™åˆ‡" class="headerlink" title="é”™åˆ‡"></a>é”™åˆ‡</h1><p>ç±»ä¼¼äºŒç»´çš„æƒ…å†µï¼Œæ¯”å¦‚å¯¹zè½´ä¾èµ–ä¸å˜ï¼Œxå’Œyçº¿æ€§å˜æ¢ï¼Œé‚£ä¹ˆå¯¹åº”çš„å°±æ˜¯m12å’Œm21ï¼Œä¹Ÿæ˜¯æ²¡æœ‰ä¸“é—¨çš„APIï¼Œç”¨<code>CATransform3DIdentity </code>ä¾¿æºåˆå§‹åŒ–ç»“æ„ä½“åˆ›å»ºä¸€ä¸ªå§ï¼Œè®¾ç½®å¯¹åº”çš„çŸ©é˜µå€¼å³å¯</p><p>é”™åˆ‡çŸ©é˜µï¼š</p><p>$ \begin{bmatrix} x &amp; y &amp; z &amp; 1 \end{bmatrix} \times \begin{bmatrix} 1 &amp; m21 &amp; 0 &amp; 0 \\ m12 &amp; 1 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} = \begin{bmatrix} x+m12y &amp; m21x+y &amp; z &amp; 1 \end{bmatrix} $</p><p>æ‰‹åŠ¨æ„é€ APIï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The identity transform: [1 0 0 0; 0 1 0 0; 0 0 1 0; 0 0 0 1]</span></span><br><span class="line"><span class="built_in">CATransform3DIdentity</span> transform = <span class="built_in">CATransform3DIdentity</span>;</span><br><span class="line">transform.m12 = <span class="number">1.0</span>;</span><br><span class="line">transform.m21 = <span class="number">1.0</span>;</span><br></pre></td></tr></table></figure><h1 id="é€è§†æŠ•å½±"><a href="#é€è§†æŠ•å½±" class="headerlink" title="é€è§†æŠ•å½±"></a>é€è§†æŠ•å½±</h1><p>å®é™…ä¸­ä½ å¦‚æœç›´æ¥ä½¿ç”¨æ—‹è½¬ï¼Œä¼šæ³¨æ„åˆ°æ—‹è½¬å‰åï¼Œç»“æœçœ‹èµ·æ¥ç«Ÿç„¶å’Œæ™®é€šçš„ç¼©æ”¾ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› å…¶å®å¾ˆç®€å•ï¼Œå‡å¦‚ç»•yè½´æ—‹è½¬ï¼Œç©ºé—´ä¸­çš„å›¾å±‚è™½ç„¶æ—‹è½¬äº†ï¼Œä½†æ˜¯æ˜¾ç¤ºåˆ°XoYå¹³é¢ï¼ˆä¹Ÿå°±æ˜¯iPhoneçš„å±å¹•ä¸Šï¼‰çš„æ—¶å€™ï¼Œä¼šæŠŠ3Dçš„ç‰©ä½“è¿›è¡Œæ­£æŠ•å½±ï¼Œè¿™æ ·å­çœ‹ä¸Šå»å°±åƒæ˜¯å·¦å³å‹ç¼©ä¸€æ ·</p><p>è€Œå­¦è¿‡ç»˜ç”»çš„éƒ½çŸ¥é“äººçš„è§†é‡å¹¶ä¸æ˜¯å¹³è¡Œçš„ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªé€è§†å›¾çš„æ¦‚å¿µï¼Œçœ¼ç›å‰æœ‰å®é™…å¹³è¡Œçš„ä¸¤æ¡çº¿æ®µå‘å‡ºï¼ˆç›¸å½“äºzè½´æ–¹å‘çš„å‘é‡ï¼‰ï¼Œäººçœ¼çœ‹èµ·æ¥ä¼šç›¸äº¤äºä¸€ç‚¹ä¸Šï¼ˆç„¦ç‚¹ï¼ŒFocal pointï¼‰ï¼Œè¿™æ‰äº§ç”Ÿäº†3Dæ„Ÿ</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/7/a9/a7ed0efe4aebcddaef0d090c631b4.jpeg"></p><p>è€Œå¯¹äºå˜æ¢çŸ©é˜µï¼Œå¦‚æœè¦å®ç°é€è§†æŠ•å½±ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿè¿™é‡Œå°±ç”¨åˆ°äº†å‰é¢ä»‹ç»è¿‡ä½†ä¸€ç›´å¿½ç•¥çš„å€¼<code>m34</code></p><h2 id="åŸç†å’Œæ¨å¯¼ï¼š"><a href="#åŸç†å’Œæ¨å¯¼ï¼š" class="headerlink" title="åŸç†å’Œæ¨å¯¼ï¼š"></a>åŸç†å’Œæ¨å¯¼ï¼š</h2><p>ä¸ºä»€ä¹ˆå•å•ä¿®æ”¹ä¸€ä¸ª<code>m34</code>çš„å€¼ï¼Œå°±èƒ½è¾¾åˆ°è¿™ç§é€è§†3Dçš„æ•ˆæœå‘¢ï¼Ÿæˆ‘ç®€å•çœ‹äº†å¾ˆå¤šç±»ä¼¼çš„åšå®¢éƒ½æ²¡æœ‰æ­£é¢å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®è¿™æ˜¯å˜æ¢çŸ©é˜µçš„é€è§†æŠ•å½±ç»“è®ºï¼Œå¯ä»¥é€šè¿‡ç®€å•çš„æ•°å­¦æ¨å¯¼å¾—åˆ°</p><p>Core Animationå·²ç»å®šä¹‰äº†ç„¦ç‚¹çš„x,yåæ ‡ï¼Œå°±æ˜¯è¿™ä¸ªå›¾å±‚çš„anchorPointï¼ˆé”šç‚¹ï¼‰ï¼ŒåŒæ—¶å–z=0çš„XoYå¹³é¢ä½œä¸ºå›¾åƒå¹³é¢ï¼ˆä¹Ÿå°±æ˜¯iPhoneçš„å±å¹•å¹³é¢ï¼‰ï¼Œé‚£ä¹ˆå‡å¦‚æˆ‘å¸Œæœ›æŠ•å½±ä¸­å¿ƒåˆ°å›¾åƒå¹³é¢çš„è·ç¦»æ˜¯dï¼Œå¯ä»¥å‡è®¾ç„¦ç‚¹åæ ‡ä¸º(0,0,d)ï¼Œç°åœ¨å¯¹<code>m34</code>çš„å€¼è¿›è¡Œèµ‹å€¼ä¸ºwï¼Œåˆå§‹å‘é‡åæ ‡ä¸º(x,y,z)ï¼Œå¼€å§‹æ¨å¯¼ï¼š</p><p>çŸ©é˜µä¹˜æ³•ï¼š</p><p>$ \begin{bmatrix} x &amp; y &amp; z &amp; 1 \end{bmatrix} \times \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp; w \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} = \begin{bmatrix} x &amp; y &amp; z &amp; zw+1 \end{bmatrix} $</p><p>æ­¤æ—¶å¾—åˆ°çš„å‘é‡ä¸ä¸ºé½æ¬¡ï¼Œéœ€è¦è¿›è¡Œé½æ¬¡åŒ–ï¼Œå¾—åˆ°çœŸæ­£çš„åæ ‡ï¼š</p><p>$ \begin{bmatrix} x^{â€˜} &amp; y^{â€˜} &amp; z^{â€˜} \end{bmatrix} = \begin{bmatrix} \frac{x}{zw+1} &amp; \frac{y}{zw+1} &amp; \frac{z}{zw+1} \end{bmatrix} $</p><p>æœ€åå¯¹XoYå¹³é¢è¿›è¡ŒæŠ•å½±ï¼Œåˆ™æœ€ç»ˆçœ‹åˆ°çš„äºŒç»´å‘é‡åº”è¯¥ä¸º$ (\frac{x}{zw+1}, \frac{y}{zw+1}) $</p><p>ç°åœ¨è€ƒè™‘xè½´çš„æƒ…å†µï¼ˆyè½´åŒç†ï¼‰ï¼Œæˆ‘ä»¬çŸ¥é“çœŸå®ä¸‰ç»´ç©ºé—´çš„xåæ ‡æ˜¯xï¼Œ<br>ç°åœ¨å¾—åˆ°é€è§†æŠ•å½±ä¸‹çš„xåæ ‡æ˜¯x/(zw+1)</p><p>ä¸ºäº†å¾—åˆ°då’Œwçš„å…³ç³»ï¼Œè¿™é‡Œå¼•ç”¨ä¸€å¹…å›¾ï¼Œç»¿è‰²çš„ç‚¹ä¸ºåŸå§‹ç‚¹ï¼Œçº¢è‰²çš„ç‚¹ä¸ºæŠ•å½±åˆ°XoYå¹³é¢ä¸Šçš„ç‚¹ï¼Œæˆ‘ä»¬è¿™é‡Œæ¨å¯¼ä¸éœ€è¦ç®¡å…·ä½“çš„å€¼ï¼Œåªæ˜¯ä¸ºäº†æ›´æ¸…æ™°åœ°å‘ç°è§„å¾‹ï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/1/8e/421990115e6623fdd5a5bec14d03a.jpg" alt="7525866072_efebf5cd22.jpg"></p><p>$ \because ç”±å›¾ï¼Œä¾æ®ç›¸ä¼¼ä¸‰è§’å½¢åŸç† \\ \therefore \left| \frac{x}{zw+1}: x \right| = d : (\left|z\right|+d) \\ å»ç»å¯¹å€¼å·ï¼Œä¸”d\neq0,x\neq0ï¼Œå¾— \\ \frac{1}{zw+1} = \frac{1}{1-\frac{z}{d}} \\ \therefore w = - \frac{1}{d} $</p><p>è¿™æ ·å°±å¾—åˆ°é‡è¦çš„ç»“è®ºï¼š<code>w=-(1/d)</code>ï¼Œå³ï¼Œå‡å®šç„¦ç‚¹ï¼ˆå°±æ˜¯äººçœ¼ï¼‰è·ç¦»åŸç‚¹è·ç¦»ä¸ºdï¼Œåˆ™<code>m34</code>åº”å½“å¡«å†™<code>-(1/d)</code></p><p>é»˜è®¤åˆå§‹å˜æ¢çŸ©é˜µçš„<code>m34</code>éƒ½æ˜¯0ï¼Œä¹Ÿå°±æ˜¯è¯´è®¤ä¸ºç„¦ç‚¹æ— é™è¿œï¼Œå› æ­¤çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•3Dæ„Ÿã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œå‡å¦‚æˆ‘ä»¬å–dè¶Šå¤§ï¼Œåˆ™çœ‹èµ·æ¥è¶Šæ²¡æœ‰æŠ•å°„å’Œ3Dæ„Ÿï¼›å–dè¶Šå°ï¼Œåˆ™3Dæ„Ÿå’Œå¤±çœŸæ„Ÿè¶Šå¼ºçƒˆï¼Œä¸€èˆ¬æ¨èçš„då€¼åœ¨500~1000ä¹‹é—´ï¼Œä¹Ÿå°±æ˜¯è¯´<code>m34</code>å¡«å†™-1/500å³å¯</p><p>è®¾ç½®å˜æ¢çŸ©é˜µçš„<code>m34</code>ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CATransform3D</span> transform = <span class="built_in">CATransform3DIdentity</span>;</span><br><span class="line"><span class="comment">//apply perspective</span></span><br><span class="line">transform.m34 = - <span class="number">1.0</span> / <span class="number">500.0</span>;</span><br><span class="line"><span class="comment">//rotate by 45 degrees along the Y axis</span></span><br><span class="line">transform = <span class="built_in">CATransform3DRotate</span>(transform, M_PI_4, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//apply to layer</span></span><br><span class="line"><span class="keyword">self</span>.layerView.layer.transform = transform;</span><br></pre></td></tr></table></figure><p><img src="http://dreampiggy-image.test.upcdn.net/image/9/12/fa3e96d6a571f355e18899eca3296.jpeg" alt="5.13.jpeg"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Core Animationæä¾›çš„CATransform3Dä¸»è¦çš„å‡ ä¸ªå˜æ¢éƒ½åœ¨è¿™é‡Œä»‹ç»äº†ï¼Œå°¤å…¶æ˜¯é€è§†æŠ•å½±ï¼Œä¸€å®šè¦ç†è§£åŸç†ï¼ŒçŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦ä¿®æ”¹<code>m34</code>æ¥æ§åˆ¶é€è§†ç„¦ç‚¹ã€‚</p><p>å½“ç„¶ï¼Œå®é™…ä¸ŠCATransform3Dä¸»è¦ç”¨æ¥ä½œå„ç§3DåŠ¨ç”»æ•ˆæœï¼Œæ¯”å¦‚ä½ å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªViewçš„è½¬åœºæ•ˆæœï¼Œæä¸ª3Dç›¸å†Œï¼Œç”šè‡³å¯ä»¥åœ¨ä¸éœ€è¦æ¥è§¦OpenGLçš„æƒ…å†µä¸‹å†™ä¸ªå°æ¸¸æˆï¼ˆæ¯”å¦‚é­”æ–¹å•Šä¹‹ç±»ï¼‰ï¼Œå¯¹äºiOSè¿›é˜¶éå¸¸æœ‰å¸®åŠ©ã€‚æœ€è¿‘æœ‰ç‚¹å¿™æ²¡å¤ªå…³æ³¨ï¼Œæ„Ÿè§‰è‡ªå·±è¿˜æ˜¯éœ€è¦å­¦ä¹ ä¸€ä¸ªã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques/blob/master/5-%E5%8F%98%E6%8D%A2/%E5%8F%98%E6%8D%A2.md">iOS Core Animation Techniques</a></p><p><a href="http://geeklu.com/2012/07/ios-3d-perspective/">iOSçš„ä¸‰ç»´é€è§†æŠ•å½±</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Core-Animation-3D-ä»¿å°„å˜æ¢çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#Core-Animation-3D-ä»¿å°„å˜æ¢çŸ¥è¯†&quot; class=&quot;headerlink&quot; title=&quot;Core Animation 3D ä»¿å°„å˜æ¢çŸ¥è¯†&quot;&gt;&lt;/a&gt;Core Animation 3D ä»¿å°„å˜æ¢çŸ¥è¯†&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;ä¹‹å‰å†™çš„Core Graphicsæ˜¯2Då¹³é¢ä¸Šçš„åæ ‡å˜æ¢ï¼Œè€ŒiOSå¼€å‘ä¸­ï¼Œä¸ºäº†å®ç°å¤æ‚çš„åŠ¨ç”»æ•ˆæœï¼Œè§†å›¾åˆ‡æ¢æ•ˆæœï¼Œä¼šç”¨åˆ°å¾ˆå¤š3Då˜æ¢ï¼Œè¿™å°±æ˜¯Core Animationæä¾›çš„CATransform3Dï¼Œå…¶ä¸­å¤§éƒ¨åˆ†APIéƒ½å’Œ2Dæƒ…å†µç±»ä¼¼ï¼Œä½†è¿™é‡Œéœ€è¦è¯¦ç»†è§£é‡Šä¸€ä¸‹é€è§†æŠ•å½±è¿™ä¸ªæ¦‚å¿µï¼Œå’Œm34è¿™ä¸ªå€¼çš„çœŸå®æ¥æºï¼Œä¸€äº›åšå®¢æŠ„æ¥æŠ„å»å´æ²¡æœ‰ç‚¹åˆ°ç‚¹å­ä¸Šï¼Œè®©äººçœ‹ä¸ä¸‹å»â€¦â€¦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;å˜æ¢çŸ©é˜µ&quot;&gt;&lt;a href=&quot;#å˜æ¢çŸ©é˜µ&quot; class=&quot;headerlink&quot; title=&quot;å˜æ¢çŸ©é˜µ&quot;&gt;&lt;/a&gt;å˜æ¢çŸ©é˜µ&lt;/h1&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;CATransform3D&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; m11, m12, m13, m14;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; m21, m22, m23, m24;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; m31, m32, m33, m34;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; m41, m42, m43, m44;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;built_in&quot;&gt;CATransform3D&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;è¿™ä¸ªç»“æ„ä½“å¯¹åº”çš„æ˜¯è¿™æ ·ä¸€ä¸ª4x4çš„å˜æ¢çŸ©é˜µï¼š&lt;/p&gt;
&lt;p&gt;$ \begin{bmatrix} m11 &amp;amp; m12 &amp;amp; m13 &amp;amp; m14 \\ m21 &amp;amp; m22 &amp;amp; m23 &amp;amp; m24 \\ m31 &amp;amp; m32 &amp;amp; m33 &amp;amp; m34 \\ m41 &amp;amp; m42 &amp;amp; m43 &amp;amp; m44 \end{bmatrix} $&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="CoreAnimation" scheme="http://dreampiggy.com/tags/CoreAnimation/"/>
    
  </entry>
  
  <entry>
    <title>React Nativeä¹‹Reduxæ¶æ„å…¥é—¨</title>
    <link href="http://dreampiggy.com/2016/10/26/React-Native%E4%B9%8BRedux%E6%9E%B6%E6%9E%84%E5%85%A5%E9%97%A8/"/>
    <id>http://dreampiggy.com/2016/10/26/React-Native%E4%B9%8BRedux%E6%9E%B6%E6%9E%84%E5%85%A5%E9%97%A8/</id>
    <published>2016-10-26T17:23:28.000Z</published>
    <updated>2016-10-26T17:39:01.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¦‚ä»Šä¹Ÿæ˜¯å…¥äº†ç§»åŠ¨iOSå¼€å‘çš„å‘ï¼Œæœ€è¿‘ä¸ä»…å­¦ä¹ äº†Core Animationçš„éƒ¨åˆ†çŸ¥è¯†ï¼Œè¿˜æ¥è§¦åˆ°React Nativeï¼Œè¿™ä¸€Facebookå‡ºå“çš„React for Native Platformæ¡†æ¶ï¼Œå…¶ä¸­Reactæœ¬èº«å…¥é—¨æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œè€ŒReduxå…¥é—¨å°±ç›¸å¯¹å›°éš¾äº†ï¼Œå› æ­¤åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œæœ€åæœ‰è‡ªå·±å†™çš„Slideså¯ä»¥å‚è€ƒ</p></blockquote><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><blockquote><p>ä¸ºä»€ä¹ˆéœ€è¦Redux</p></blockquote><ol><li>RNçš„stateï¼ˆå¯å˜ï¼Œå­ç»„ä»¶ä¸å¯è§ï¼‰å’Œpropsï¼ˆä¸å¯å˜ï¼Œå­ç»„ä»¶å¯è§ï¼‰çš„è®¾è®¡ï¼Œåœ¨é¢å¯¹å¤§å‹é¡¹ç›®æ—¶å€™ï¼Œå®¹æ˜“å› ä¸ºä¸ç»æ„ä¿®æ”¹stateé€ æˆçŠ¶æ€æ··ä¹±ï¼Œç»„ä»¶æ¸²æŸ“é”™è¯¯</li><li>RNä½¿ç”¨äº†Virtual DOMï¼Œä¸éœ€è¦Targetç»‘å®š-&gt;Actionä¿®æ”¹UIå±æ€§ï¼Œåªè¦å½“çŠ¶æ€å˜åŒ–ï¼Œrenderæ–°çŠ¶æ€ä¸‹çš„ç»„ä»¶ï¼Œæ•°æ®å•å‘ä¼ é€’ï¼Œè€ŒMVCçš„è®¾è®¡æ¨¡å¼å­˜åœ¨åŒå‘æ•°æ®æµ</li><li>RNä¸æ˜“è¿›è¡Œæµ‹è¯•ï¼ŒReduxæä¾›äº†éå¸¸æ–¹ä¾¿çš„mockæµ‹è¯•æ–¹å¼</li></ol><h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å®‰è£…Reduxï¼š</span><br><span class="line">npm install --save redux</span><br><span class="line">å®‰è£…React Nativeå’ŒReduxç»‘å®šåº“ï¼š</span><br><span class="line">npm install --save react-redux</span><br><span class="line">å®‰è£…Redux Thunkå¼‚æ­¥Actionä¸­é—´ä»¶ï¼š</span><br><span class="line">npm install --save redux-thunk</span><br></pre></td></tr></table></figure><h1 id="Redux-åŸåˆ™"><a href="#Redux-åŸåˆ™" class="headerlink" title="Redux åŸåˆ™"></a>Redux åŸåˆ™</h1><ol><li>å•ä¸€æ•°æ®æº<br> <strong>æè¿°ï¼š</strong> æ•´ä¸ªåº”ç”¨çš„Â stateÂ è¢«å‚¨å­˜åœ¨ä¸€ä¸ªå¯¹è±¡æ ‘ä¸­ï¼Œå¯¹è±¡æ ‘å­˜åœ¨äºå”¯ä¸€çš„Â storeÂ ä¸­<br> <strong>è¯´æ˜ï¼š</strong> ReduxæŠŠæ‰€æœ‰stateé›†ä¸­ç®¡ç†ï¼Œé¿å…äº†å„å¤„ä¸´æ—¶çš„çŠ¶æ€é€ æˆçš„ä¸å¯æ§</li><li>State æ˜¯åªè¯»çš„<br> <strong>æè¿°ï¼š</strong> æƒŸä¸€æ”¹å˜ state çš„æ–¹æ³•å°±æ˜¯è§¦å‘Â action<br> <strong>è¯´æ˜ï¼š</strong> action æ˜¯ä¸€ä¸ªå«æœ‰ type å±æ€§çš„æ™®é€šJSå¯¹è±¡ï¼Œtype å±æ€§å¯ä»¥ç”¨å…·ä½“çš„stringå¸¸é‡ï¼Œæ¥è¡¨ç¤ºäº‹ä»¶</li><li>ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹<br> <strong>æè¿°ï¼š</strong> ç¼–å†™Â reducers æ¥æè¿°å¯¹åº”actionå¦‚ä½•ä¿®æ”¹ state<br> <strong>è¯´æ˜ï¼š</strong> reducerå‡½æ•°æ˜¯çº¯å‡½æ•°ï¼Œæ— å‰¯ä½œç”¨ï¼Œå®šä¹‰ä¸ºreducer(state, action) =&gt; newStateï¼Œä¸€èˆ¬å¯ä»¥ç”¨ switch(action.type) æ¥åˆ¤æ–­ä¸åŒçš„actionï¼ŒåŒæ—¶returnä¸€ä¸ªæ–°çš„state</li></ol><h1 id="Redux-æ•°æ®æµ"><a href="#Redux-æ•°æ®æµ" class="headerlink" title="Redux æ•°æ®æµ"></a>Redux æ•°æ®æµ</h1><p><img src="http://dreampiggy-image.test.upcdn.net/image/6/ac/b29d443e4577ad15dd62c800c5fc4.png"></p><ol><li>Componentè§¦å‘ä¸€ä¸ªAction Creatorï¼ˆç”¨æ¥dispatchæŸä¸ªå…·ä½“çš„Actionçš„å‡½æ•°ï¼‰ï¼Œdispatchåˆ°Storeä¸­    </li><li>Reducerè¿›è¡Œåˆ¤æ–­ï¼Œé€šè¿‡(state, action) =&gt; newStateå¾—åˆ°æ–°çš„çŠ¶æ€ï¼Œå†™å›åˆ°Storeä¸­    </li><li>Storeç»‘å®šåˆ°Componentï¼ŒæŠŠstateèµ‹å›Componentçš„propsï¼Œç„¶åComponentå°±å¯ä»¥renderäº†ï¼Œæ•´ä¸ªæµç¨‹ä¹Ÿæ¯”è¾ƒæ¸…æ™°    </li></ol><h1 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h1><p>Actionæ˜¯ä¸€ä¸ªæ™®é€šJSå¯¹è±¡ï¼Œè‡³å°‘åŒ…æ‹¬ä¸€ä¸ª<code>type</code>å±æ€§ä»£è¡¨äº‹ä»¶ï¼Œå…¶ä»–å±æ€§å¯ä»¥ç”¨æ¥ä¼ é€’æ•°æ®ã€‚å®è·µä¸Šå¯¹ä¸€ä¸ªæµç¨‹å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæµç¨‹å¯ä»¥åŒ…æ‹¬ç½‘ç»œè¯·æ±‚ï¼Œæœ€åè¿”å›Actionï¼Œè¿™ä¸ªå‡½æ•°å«Action Creator</p><p>Type:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">ADD_TODO</span> = <span class="string">&#x27;ADD_TODO&#x27;</span>;</span><br></pre></td></tr></table></figure><p>Actionï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> action = &#123; <span class="attr">type</span>: <span class="variable constant_">ADD_TODO</span>, <span class="attr">text</span>: <span class="string">&#x27;Build my first Redux app&#x27;</span> &#125;</span><br></pre></td></tr></table></figure><p>Action Creatorï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params">input</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="variable constant_">ADD_TODO</span>, <span class="attr">text</span>: input &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/a/b8/1e6f0b3d3f531817fb9bf7aed7ad3.png"><br><img src="http://dreampiggy-image.test.upcdn.net/image/2/5c/d3050cfb96161668957d6b51fe00a.png"></p><h1 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h1><p>Reduceræ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ ¹æ®Storeä¸­çš„å‰ä¸€æ¬¡çš„stateï¼Œå’ŒStoreä¸­è¢«dispatchè¿‡æ¥çš„Actionï¼Œè¿”å›ä¸€ä¸ªæ–°çš„stateå¹¶å†™å…¥Storeï¼Œå³ï¼š <code>(state, action) =&gt; newState</code></p><p>Reducerï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toDoReducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line"><span class="keyword">switch</span>(action.<span class="property">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="attr">ADD_TODO</span>:</span><br><span class="line"><span class="keyword">return</span> &#123;<span class="attr">text</span>: action.<span class="property">text</span>,<span class="attr">completed</span>: <span class="literal">false</span>&#125;</span><br><span class="line"><span class="attr">default</span>:</span><br><span class="line"><span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li>è¿”å›çš„æ˜¯æ–°stateï¼Œå¦‚æœéœ€è¦ä¿ç•™éƒ¨åˆ†æ—§stateå€¼ï¼Œä½¿ç”¨â€¦stateï¼ˆES7çš„å¯¹è±¡å±•å¼€è¯­æ³•ï¼Œå¯¹å¯¹è±¡ä¼šæµ…æ‹·è´å¯¹åº”å±æ€§ï¼Œè¿™é‡Œç­‰ä»·äºObject.assign({}, state, newState)ï¼‰ï¼Œå¯¹åº”åˆå¹¶stateçš„è¯åªä¼šåˆå¹¶ä¸€å±‚ï¼Œè€Œå­å±æ€§ä¼šè¢«è¦†ç›–æ‰ï¼Œå¯¹å¤æ‚stateéœ€è¦æ‰‹åŠ¨åˆå¹¶</li><li>ä¸ºäº†éµå¾ªReducerçš„çº¯å‡½æ•°æ€§ï¼Œä¸åº”è¯¥ç›´æ¥ä¿®æ”¹stateçš„å€¼ï¼Œç„¶åreturn stateï¼Œé™¤éä½¿ç”¨Immutable.jsï¼ˆè§åï¼‰</li><li>å®é™…ä¸­ï¼Œåº”å½“æŠŠä¸åŒæ¨¡å—çš„ä»£ç ï¼Œæ„é€ ä¸åŒçš„Reducerï¼Œæœ€åå†åˆå¹¶ï¼ˆå› ä¸ºçº¯å‡½æ•°æ€§ï¼Œæ— å‰¯ä½œç”¨ï¼‰</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;reduxâ€™;</span></span><br><span class="line"><span class="string">import todos from &#x27;</span>./todosâ€™;</span><br><span class="line"><span class="keyword">import</span> counter <span class="keyword">from</span> <span class="string">&#x27;./counterâ€™;</span></span><br><span class="line"><span class="string">export default combineReducers(&#123; todos, counter &#125;)</span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/4/2d/bbcfa2df98958ec1a4c027b7a883e.png"></p><h1 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h1><p>Storeå­˜å‚¨äº†ä¸€ä¸ªProviderçš„<code>æ‰€æœ‰çš„state</code>ï¼ŒåŒæ—¶æ¥æ”¶dispatchè¿‡æ¥Actionã€‚Reduxæä¾›çš„æ¯ä¸ªProvideræ ¹ç»„ä»¶æœ‰å”¯ä¸€å¯¹åº”çš„Storeã€‚å®è·µä¸­å¯ä»¥æ‹†åˆ†å¤šä¸ªä¸šåŠ¡æ¨¡å—åˆ°å¤šä¸ªProviderç»„ä»¶ï¼Œæ¯ä¸ªProviderç»„ä»¶åˆ©ç”¨Reduxæ¶æ„ï¼Œç»‘å®šè‡ªå·±çš„Storeï¼Œæ¨¡å—å†…çš„ä¸šåŠ¡æµç¨‹å†™åˆ°å¯¹åº”çš„Action Creatorä¸­</p><p>Storeï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&#x27;./reducers/BusListReducer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer);</span><br></pre></td></tr></table></figure><ol><li>Storeçš„è¯»å†™ï¼Œå¯ä»¥è°ƒç”¨getState()æ¥è·å–å½“å‰stateï¼Œç”¨dispatch()æ¥åˆ†å‘Actionæ”¹å˜state</li><li>Storeåˆ›å»ºçš„æ—¶å€™ï¼Œé™¤äº†éœ€è¦ç»‘å®šReducerï¼Œè¿˜å¯ä»¥åº”ç”¨ä¸­é—´ä»¶ï¼Œæ¯”å¦‚æ—¥å¿—ä¸­é—´ä»¶ï¼ŒReact Thunkä¸­é—´ä»¶ï¼ˆé’ˆå¯¹å¼‚æ­¥Action Creatorï¼‰    </li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">logger</span> = store =&gt; <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;dispatching&#x27;</span>, action);</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">next</span>(action);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;next state&#x27;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> createStoreWithMiddleware = <span class="title function_">applyMiddleware</span>([logger, thunk])(createStore);</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/e/c6/3c631d1a7bd31016e1fdf45e63428.png"></p><h1 id="Componentç»‘å®š"><a href="#Componentç»‘å®š" class="headerlink" title="Componentç»‘å®š"></a>Componentç»‘å®š</h1><p>æ•´ä¸ªæ§åˆ¶æµï¼Œå°±å·®æœ€åStoreä¸­çš„stateç»‘å®šåˆ°ç»„ä»¶äº†ï¼Œæˆ‘ä»¬é€šè¿‡Reduxæä¾›çš„<code>connect()</code>ï¼Œç»‘å®šéœ€è¦çš„stateä»¥åŠAction Creatoråˆ°ä½ çš„ç»„ä»¶çš„propsä¸Šï¼Œè¿™æ ·ç»„ä»¶å°±å¯ä»¥é€šè¿‡propsæ¥è°ƒç”¨Action Creatorï¼Œæˆ–è€…æ ¹æ®ä¸åŒpropsæ¥render()ä¸åŒçš„ç»„ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mapStateToProps</span>(<span class="params">state</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: state.<span class="property">name</span></span><br><span class="line">    <span class="attr">age</span>: state.<span class="property">age</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapDispatchToProps</span>(<span class="params">dispatch</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">actions</span>: <span class="title function_">bindActionCreators</span>(actions, dispatch)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="title class_">BusList</span>);</span><br></pre></td></tr></table></figure><ol><li>æ³¨æ„connectè¿”å›çš„å°±æ˜¯ç»‘å®šåçš„React Componentï¼Œç”¨çš„æ—¶å€™è®°å¾—export default</li></ol><p>ä¸¾ä¾‹ï¼š</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/9/19/10bde796c214db134bb166bbac540.png"></p><h1 id="Stateåˆå¹¶å’ŒImmutable-js"><a href="#Stateåˆå¹¶å’ŒImmutable-js" class="headerlink" title="Stateåˆå¹¶å’ŒImmutable.js"></a>Stateåˆå¹¶å’ŒImmutable.js</h1><blockquote><p>ä¸ºä»€ä¹ˆStateåˆå¹¶å¾ˆå›°éš¾</p></blockquote><ol><li>Reducerä¸­ï¼Œé€šè¿‡â€¦stateå¯¹è±¡æ‰©å±•ç¬¦ï¼Œå†åˆå¹¶actionçš„stateï¼Œè¿™ç§åˆå¹¶æ˜¯ä¸€å±‚åˆå¹¶ï¼Œä¸ä¼šåˆå¹¶å­å±æ€§è€Œä¼šç›´æ¥è¦†ç›–æ‰ï¼Œæ„å‘³ç€å¯¹äºå¤æ‚çš„stateï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹å­å±‚çº§çš„å±æ€§ï¼Œå°±å¾—æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶åˆå¹¶éƒ¨åˆ†stateçš„å±æ€§ï¼Œè€Œä¸æ˜¯ç”¨â€¦stateç›´æ¥æ‰©å±•</li><li>Reducerä¸ºäº†ä¿æŒçº¯å‡½æ•°æ€§ï¼Œåº”å½“ç¦æ­¢å¯¹stateç›´æ¥ä¿®æ”¹éƒ¨åˆ†å±æ€§ï¼Œä½†ç›´æ¥â€¦stateçš„æ‹·è´åœ¨å¤§é‡é¡¹ç›®stateæ ‘åºå¤§çš„æƒ…å½¢ä¸‹ä¼šæœ‰ä¸€å®šçš„æ•ˆç‡å½±å“</li><li>åœ¨1ï¼Œ2ä¸¤æ¡çš„æƒ…å½¢ä¸‹ï¼Œå¦‚ä½•åœ¨ä¸ä¿®æ”¹åŸå§‹stateçš„å‰æä¸Šï¼Œåˆèƒ½è¿”å›ä¸€ä¸ªåŸstateå±æ€§éƒ¨åˆ†å˜åŒ–åçš„newStateå°±æˆäº†ä¸€ä¸ªé—®é¢˜</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123; <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">4</span> &#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·å†™æ³•</span></span><br><span class="line"><span class="comment">// let g = Object.assign(&#123;&#125;, a, &#123;</span></span><br><span class="line"><span class="comment">// b: &#123; d: 5 &#125;</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="keyword">let</span> g = &#123;</span><br><span class="line">...a,</span><br><span class="line"><span class="attr">b</span>: &#123; <span class="attr">d</span>: <span class="number">5</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g); <span class="comment">// &#123; b: &#123; d: 5 &#125; &#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>Immutable.jsè§£å†³äº†ä»€ä¹ˆ</p></blockquote><ol><li>Immutable.jsçš„å®ç°å¤æ‚ä¸å¯å˜å¯¹è±¡çš„é«˜æ•ˆcopyå’Œéƒ¨åˆ†ä¿®æ”¹ï¼Œå†…éƒ¨é€šè¿‡Persistent Data Structureï¼ˆæŒä¹…åŒ–æ•°æ®ç»“æ„ï¼‰ï¼Œå³ä¸€ä¸ªä¸å¯å˜çš„å¯¹è±¡æ ‘ã€‚åœ¨ä½¿ç”¨æ—§æ•°æ®åˆ›å»ºæ–°æ•°æ®æ—¶ï¼Œé€šè¿‡éƒ¨åˆ†ç»“æ„å…±äº«ï¼Œå¦‚æœå¯¹è±¡æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåªä¿®æ”¹è¿™ä¸ªèŠ‚ç‚¹å’Œå—å®ƒå½±å“çš„çˆ¶èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹åˆ™è¿›è¡Œå…±äº«</li><li>è¿™æ ·æ—¢é¿å…äº†DeepCopyé€ æˆçš„æ€§èƒ½å¼€é”€ï¼Œåˆèƒ½è¾¾åˆ°æ‰€æœ‰è¿”å›çš„æ•°æ®ä»ç„¶æ˜¯ä¸å¯å˜çš„ï¼Œç¬¦åˆäº†reducer(state,action) =&gt; newStateçš„çº¯å‡½æ•°æ€§</li></ol><blockquote><p>å…·ä½“å¦‚ä½•å®è·µé…åˆRedux</p></blockquote><ol><li>å¯¹stateä¸­<code>éƒ¨åˆ†å¤æ‚çš„å±æ€§</code>ï¼Œå¯ä»¥ä½¿ç”¨Immutableçš„æ•°æ®å•ç‹¬åŒ…è£¹ï¼Œåœ¨ç»„ä»¶render()å¤„å•ç‹¬è§£åŒ…æ‰€æœ‰Immutableå¯¹è±¡</li><li>å¦‚æœstateæœ¬èº«å°±å«æœ‰å„ç§å¤æ‚å±æ€§ï¼Œå¯ä»¥ç›´æ¥<code>æŠŠstateæœ¬èº«åŒ…è£¹</code>ï¼Œç”¨Immutable.Mapè¡¨ç¤ºstateæœ¬èº«ï¼Œç„¶åé€šè¿‡Immutableçš„APIæ“ä½œä¿®æ”¹éƒ¨åˆ†å±æ€§ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„Immutableå¯¹è±¡ä½œä¸ºnewStateï¼Œåœ¨ç»„ä»¶çš„mapStateToProps()æ–¹æ³•ä¸­ï¼ŒæŠŠImmutableå¯¹è±¡åŒ…è£¹çš„stateè§£åŒ…ä¸ºJavaScriptçš„å¯¹è±¡</li><li>å¯¹äºå…¶ä»–ç»„ä»¶ï¼Œå¯ä»¥åœ¨<code>shouldComponentUpdate()</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡Immutableçš„æ¯”è¾ƒï¼Œæ¥é¿å…æ— ç”¨çš„re-render</li></ol><p>ä¸¾ä¾‹ï¼šListViewç®€å•åº”ç”¨ï¼ˆé¿å…re-render)</p><p><img src="http://dreampiggy-image.test.upcdn.net/image/e/8c/42c765d2eea6cb90e2eef9dfae949.png"><br><img src="http://dreampiggy-image.test.upcdn.net/image/b/71/a6d9a50d4ff1c8eebbd462279c073.png"><br><img src="http://dreampiggy-image.test.upcdn.net/image/7/db/e8fcbe8a12f6d2796e64a37e5c4ae.png"><br><img src="http://dreampiggy-image.test.upcdn.net/image/9/7f/7b039ac17e7828a2fe4f3d033ad73.png"></p><h1 id="æ›´å¤šæ€è€ƒ"><a href="#æ›´å¤šæ€è€ƒ" class="headerlink" title="æ›´å¤šæ€è€ƒ"></a>æ›´å¤šæ€è€ƒ</h1><ol><li>Actionçš„å®šä¹‰è§„èŒƒï¼Ÿï¼ˆå¯¹äºä¸éœ€è¦rerenderçš„æ‰€æœ‰Actionå®šä¹‰ä¸€ä¸ªå•ç‹¬typeï¼Ÿï¼‰<br>Reducerä¸­stateå¤æ‚å¤šçº§ç»“æ„ï¼Œå¦‚ä½•è§„èŒƒåˆå¹¶å¾—åˆ°newStateï¼Ÿï¼ˆImmutable.jså¿…è¦æ€§ï¼‰</li><li>å¤§å‹ç»„ä»¶çš„renderæ–¹æ³•è§£è€¦åˆæ–¹å¼ï¼ˆswitchï¼Ÿï¼‰</li><li>ç§»åŠ¨ç«¯æ˜¯å¦æœ‰æœåŠ¡ç«¯æ¸²æŸ“çš„å¿…è¦ï¼Ÿï¼ˆdispatchè¿‡å»çš„Actionå¦‚æœéœ€è¦å¤æ‚è®¡ç®—ï¼ŒæŠŠæ•´ä¸ªstoreäº¤ç»™æœåŠ¡ç«¯æ¥è®¡ç®—ï¼‰</li><li>ç½‘ç»œè¯·æ±‚ä½¿ç”¨fetch APIå°è£…æ˜¯å¦è¶³å¤Ÿï¼Ÿ</li><li>Native Moduleçš„JSç«¯å¼•å…¥ï¼ˆcallbackï¼Ÿè¿˜æ˜¯Promise + async awaitï¼‰</li><li>Mockæµ‹è¯•çš„å…·ä½“å®è·µï¼Ÿï¼ˆActionï¼ŒReducerï¼ŒComponentä¸‰ä¸ªæ–¹é¢ï¼‰</li></ol><h1 id="Slides"><a href="#Slides" class="headerlink" title="Slides"></a>Slides</h1><ul><li><a href="https://raw.githubusercontent.com/dreampiggy/iOS-Resume/master/React%20Native%E8%BF%9B%E9%98%B6-Redux%E6%9E%B6%E6%9E%84%E5%92%8C%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86.pptx">React Nativeè¿›é˜¶-Reduxæ¶æ„å’ŒçŠ¶æ€ç®¡ç†.pptx</a></li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="http://facebook.github.io/react-native/docs">React Nativeå®˜æ–¹æ–‡æ¡£</a></li><li><a href="http://redux.js.org/">Reduxå®˜æ–¹æ–‡æ¡£</a></li><li><a href="http://cn.redux.js.org/">Reduxå®˜æ–¹æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰</a></li><li><a href="https://github.com/camsong/blog/issues/3">Immutable.jsè§£æ</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></li><li><a href="http://redux.js.org/docs/recipes/UsingObjectSpreadOperator.html">Object Spread Syntaxï¼ˆå¯¹è±¡å±•å¼€ç¬¦ï¼‰</a></li><li><a href="http://www.jianshu.com/p/14933fd9c312">React Native Reduxæ¶æ„å‚è€ƒ</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å¦‚ä»Šä¹Ÿæ˜¯å…¥äº†ç§»åŠ¨iOSå¼€å‘çš„å‘ï¼Œæœ€è¿‘ä¸ä»…å­¦ä¹ äº†Core Animationçš„éƒ¨åˆ†çŸ¥è¯†ï¼Œè¿˜æ¥è§¦åˆ°React Nativeï¼Œè¿™ä¸€Facebookå‡ºå“çš„React for Native Platformæ¡†æ¶ï¼Œå…¶ä¸­Reactæœ¬èº«å…¥é—¨æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œè€ŒReduxå…¥é—¨å°±ç›¸å¯¹å›°éš¾äº†ï¼Œå› æ­¤åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œæœ€åæœ‰è‡ªå·±å†™çš„Slideså¯ä»¥å‚è€ƒ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆéœ€è¦Redux&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;RNçš„stateï¼ˆå¯å˜ï¼Œå­ç»„ä»¶ä¸å¯è§ï¼‰å’Œpropsï¼ˆä¸å¯å˜ï¼Œå­ç»„ä»¶å¯è§ï¼‰çš„è®¾è®¡ï¼Œåœ¨é¢å¯¹å¤§å‹é¡¹ç›®æ—¶å€™ï¼Œå®¹æ˜“å› ä¸ºä¸ç»æ„ä¿®æ”¹stateé€ æˆçŠ¶æ€æ··ä¹±ï¼Œç»„ä»¶æ¸²æŸ“é”™è¯¯&lt;/li&gt;
&lt;li&gt;RNä½¿ç”¨äº†Virtual DOMï¼Œä¸éœ€è¦Targetç»‘å®š-&amp;gt;Actionä¿®æ”¹UIå±æ€§ï¼Œåªè¦å½“çŠ¶æ€å˜åŒ–ï¼Œrenderæ–°çŠ¶æ€ä¸‹çš„ç»„ä»¶ï¼Œæ•°æ®å•å‘ä¼ é€’ï¼Œè€ŒMVCçš„è®¾è®¡æ¨¡å¼å­˜åœ¨åŒå‘æ•°æ®æµ&lt;/li&gt;
&lt;li&gt;RNä¸æ˜“è¿›è¡Œæµ‹è¯•ï¼ŒReduxæä¾›äº†éå¸¸æ–¹ä¾¿çš„mockæµ‹è¯•æ–¹å¼&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;å‡†å¤‡&quot;&gt;&lt;a href=&quot;#å‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;å‡†å¤‡&quot;&gt;&lt;/a&gt;å‡†å¤‡&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;å®‰è£…Reduxï¼š&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	npm install --save redux&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;å®‰è£…React Nativeå’ŒReduxç»‘å®šåº“ï¼š&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	npm install --save react-redux&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;å®‰è£…Redux Thunkå¼‚æ­¥Actionä¸­é—´ä»¶ï¼š&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	npm install --save redux-thunk&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://dreampiggy.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://dreampiggy.com/tags/iOS/"/>
    
    <category term="React Native" scheme="http://dreampiggy.com/tags/React-Native/"/>
    
    <category term="Redux" scheme="http://dreampiggy.com/tags/Redux/"/>
    
  </entry>
  
</feed>
